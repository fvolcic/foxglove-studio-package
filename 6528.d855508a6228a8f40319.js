"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6528],{25934:(Me,_,n)=>{n.d(_,{Z:()=>ge});var ee=n(52322),N=n(69629),H=n.n(N),r=n(2784),te=n(87438),fe=n(4812),le=n(91004),K=n(23503),R=n(24468),J=n(16846),C=n(40605),T=n(27788),$=n(42146),k=n(64578);function G(o){(0,$.tm)((t,e,i,g)=>{e instanceof Error||typeof e=="string"||console.warn("Invalid Error type",e),o.send("sendNotification",{message:t,details:e instanceof Error?e.toString():e,type:i,severity:g})})}function ne(o){G(o),(0,k.Z)()}var he=n(6881),ue=n(30686),w=n(22354),p=n(23571),f=n(77075),I="../../packages/studio-base/src/components/Chart/worker/ChartJSManager.ts";const v=K.ZP.getLogger(I);function W(o){return(t,e)=>{const i=o.listeners(t);!e||i.includes(e)||o.on(t,e)}}function Z(o){return(t,e)=>{e&&o.off(t,e)}}class z{constructor(t){this._fakeNodeEvents=new ue.Z,this._fakeDocumentEvents=new ue.Z,v.info(`new ChartJSManager(id=${t.id})`),this.init(t)}async init({id:t,node:e,type:i,data:g,options:y,devicePixelRatio:u,fontLoaded:E}){const F=await E;v.debug(`ChartJSManager(${t}) init, default font "${F.family}" status=${F.status}`);const Y={addEventListener:W(this._fakeNodeEvents),removeEventListener:Z(this._fakeNodeEvents),ownerDocument:{addEventListener:W(this._fakeDocumentEvents),removeEventListener:Z(this._fakeDocumentEvents)}},V=w.L.start?.bind(w.L);w.L.start=(X,re,pe)=>{const ve=X.ctx;X.ctx={canvas:Y};const ae=V?.(X,re,pe);return X.ctx=ve,ae};const de={...this.addFunctionsToConfig(y),devicePixelRatio:u,font:{family:f.R.MONOSPACE},responsive:!1},oe=new R.kL(e,{type:i,data:g,options:de,plugins:[he.Z,w.L]});w.L.start=V,this._chartInstance=oe}wheel(t){const e=t.target;return e.getBoundingClientRect=()=>e.boundingClientRect,this._fakeNodeEvents.emit("wheel",t),this.getScales()}mousedown(t){const e=t.target;return e.getBoundingClientRect=()=>e.boundingClientRect,this._fakeNodeEvents.emit("mousedown",t),this.getScales()}mousemove(t){const e=t.target;return e.getBoundingClientRect=()=>e.boundingClientRect,this._fakeNodeEvents.emit("mousemove",t),this.getScales()}mouseup(t){const e=t.target;return e.getBoundingClientRect=()=>e.boundingClientRect,this._fakeDocumentEvents.emit("mouseup",t),this.getScales()}panstart(t){const e=t.target;return e.getBoundingClientRect=()=>e.boundingClientRect,(0,p.Y)(this._chartInstance)?.$zoom.panStartHandler(t),this.getScales()}panmove(t){const e=t.target;return e.getBoundingClientRect=()=>e.boundingClientRect,(0,p.Y)(this._chartInstance)?.$zoom.panHandler(t),this.getScales()}panend(t){const e=t.target;return e.getBoundingClientRect=()=>e.boundingClientRect,(0,p.Y)(this._chartInstance)?.$zoom.panEndHandler(t),this.getScales()}update({options:t,width:e,height:i,isBoundsReset:g,data:y}){const u=this._chartInstance;if(u==null)return{};if(t!=null){u.options.plugins=this.addFunctionsToConfig(t).plugins;const E=t.scales??{};(g||E.x?.min!=null&&E.x.max!=null)&&u.options.scales&&(u.options.scales.x=E.x),(g||E.y?.min!=null&&E.y.max!=null)&&u.options.scales&&(u.options.scales.y=E.y)}if(e!=null||i!=null){let E=!1;const F=Math.floor(e??u.width),Y=Math.floor(i??u.height);e!=null&&Math.abs(u.width-F)>Number.EPSILON&&(u.canvas.width=F,E=!0),i!=null&&Math.abs(u.height-Y)>Number.EPSILON&&(u.canvas.height=Y,E=!0),E&&u.resize(F,Y)}return y!=null&&(u.data=y),u.update("none"),this.getScales()}destroy(){this._chartInstance?.destroy()}getElementsAtEvent({event:t}){const e={native:!0,x:t.clientX,y:t.clientY},i=this._chartInstance?.getElementsAtEventForMode(e,this._chartInstance.options.interaction?.mode??"intersect",this._chartInstance.options.interaction??{},!1)??[],g=new Array;for(const y of i){const u=this._chartInstance?.data?.datasets[y.datasetIndex]?.data[y.index];u==null||typeof u=="number"||g.push({data:u,datasetIndex:y.datasetIndex,view:{x:y.element.x,y:y.element.y}})}return g.sort((y,u)=>{const E=t.clientX-y.view.x,F=t.clientY-y.view.y,Y=t.clientX-u.view.x,V=t.clientY-u.view.y,de=E*E+F*F,oe=Y*Y+V*V;return de-oe}),g}getDatalabelAtEvent({event:t}){this._chartInstance?.notifyPlugins("beforeEvent",{event:t});const e=this._lastDatalabelClickContext;return this._lastDatalabelClickContext=void 0,e?.dataset.data[e.dataIndex]}getScales(){const t={},e=this._chartInstance?.scales.x;e&&(t.x={pixelMin:e.left,pixelMax:e.right,min:e.min,max:e.max});const i=this._chartInstance?.scales.y;return i&&(t.y={pixelMin:i.bottom,pixelMax:i.top,min:i.min,max:i.max}),t}addFunctionsToConfig(t){const e=t.plugins?.datalabels;if(e){e.listeners={click:g=>{this._lastDatalabelClickContext=g}},e.formatter=(g,y)=>g.label??null;const i=e.color??"white";e.color=g=>g.dataset.data[g.dataIndex]?.labelColor??i}return t}}async function P(){const o=new FontFace("IBM Plex Mono",`url(${T}) format('woff2')`);return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self.fonts.add(o):document.fonts.add(o),await o.load()}const S=P();R.kL.register(R.jn,R.od,R.ST,R.ho,R.uw,R.f$,R.FB,R.RM,R.Gu,R.De,R.Dx,R.u,C.Z);const L=new Intl.NumberFormat(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});function D(o){const t=o.options?.scales?.x;return t?.ticks&&(t.ticks.callback=function(e,i,g){return i===0||i===g.length-1?L.format(e):J.aL.formatters.numeric.apply(this,[e,i,g])}),o}class l{constructor(t){this._managers=new Map,this._rpc=t,typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&ne(this._rpc),t.receive("initialize",e=>{e.fontLoaded=S;const i=new z(e);return this._managers.set(e.id,i),i.getScales()}),t.receive("wheel",e=>this._getChart(e.id).wheel(e.event)),t.receive("mousedown",e=>this._getChart(e.id).mousedown(e.event)),t.receive("mousemove",e=>this._getChart(e.id).mousemove(e.event)),t.receive("mouseup",e=>this._getChart(e.id).mouseup(e.event)),t.receive("panstart",e=>this._getChart(e.id).panstart(e.event)),t.receive("panend",e=>this._getChart(e.id).panend(e.event)),t.receive("panmove",e=>this._getChart(e.id).panmove(e.event)),t.receive("update",e=>this._getChart(e.id).update(D(e))),t.receive("destroy",e=>{const i=this._managers.get(e.id);i&&(i.destroy(),this._managers.delete(e.id))}),t.receive("getElementsAtEvent",e=>this._getChart(e.id).getElementsAtEvent(e)),t.receive("getDatalabelAtEvent",e=>this._getChart(e.id).getDatalabelAtEvent(e))}_getChart(t){const e=this._managers.get(t);if(!e)throw new Error(`Could not find chart with id ${t}`);return e}}var a=n(45243),h=n(43185),j=n(36537),m="../../packages/studio-base/src/components/Chart/index.tsx";const b=K.ZP.getLogger(m);function O(){return new Worker(new URL(n.p+n.u(5764),n.b))}const Ce=null,we=(0,j.N)(window).devicePixelRatio??1,A=new h.Z(O,4);function me(o){const t=o.currentTarget.getBoundingClientRect();return{cancelable:!1,clientX:o.clientX-t.left,clientY:o.clientY-t.top,target:{boundingClientRect:t.toJSON()}}}const Q=typeof HTMLCanvasElement.prototype.transferControlToOffscreen=="function";function se(o){const[t]=(0,r.useState)(()=>(0,le.Z)()),e=(0,r.useRef)(!1),i=(0,r.useRef)(),g=(0,r.useRef)(null),y=(0,te.Z)(),u=(0,r.useRef)(),E=o.options.plugins?.zoom?.zoom?.enabled??!1,F=o.options.plugins?.zoom?.pan?.enabled??!1,{type:Y,data:V,isBoundsReset:de,options:oe,width:X,height:re,onStartRender:pe,onFinishRender:ve}=o,ae=(0,r.useRef)(),x=(0,r.useRef)(),Se=(0,r.useRef)(!1),Ee=(0,r.useRef)({});(0,r.useLayoutEffect)(()=>{b.info(`Register Chart ${t}`);let s;if(Q)s=A.registerWorkerListener(t);else{const{local:M,remote:c}=(0,a.t)();new l(new a.Z(c)),s=new a.Z(M)}const d=async(M,c,B)=>await s.send(M,{id:t,...c},B);return ae.current=d,()=>{b.info(`Unregister chart ${t}`),d("destroy").catch(()=>{}),x.current=void 0,ae.current=void 0,e.current=!1,Ee.current={},i.current?.remove(),i.current=void 0,Q&&A.unregisterWorkerListener(t)}},[t]);const Ne=(0,r.useRef)(o.onScalesUpdate);Ne.current=o.onScalesUpdate;const U=(0,r.useCallback)((s,d)=>{if(!y())return;const M=u.current;u.current=s;const c=JSON.stringify(M),B=JSON.stringify(s);c!==B&&Ne.current?.(s,d??{userInteraction:!1})},[y]),Re=(0,r.useCallback)(()=>{const s=Ee.current,d={};if(!(X===0||re===0)&&(s.data!==V&&(s.data=d.data=V),s.options!==oe&&(s.options=d.options=oe),s.height!==re&&(s.height=d.height=re),s.width!==X&&(s.width=d.width=X),d.isBoundsReset=de,Object.keys(d).length!==0))return d},[V,re,oe,de,X]),{error:ke}=(0,fe.Z)(async()=>{if(!ae.current)return;if(!e.current){if(!g.current)return;const M=Re();if(!M)return;if(i.current)throw new Error("Canvas has already been initialized");const c=document.createElement("canvas");c.style.width="100%",c.style.height="100%",c.width=M.width??0,c.height=M.height??0,g.current.appendChild(c),i.current=c,e.current=!0,pe?.();const B=typeof c.transferControlToOffscreen=="function"?c.transferControlToOffscreen():c,q=await ae.current("initialize",{node:B,type:Y,data:M.data,options:M.options,devicePixelRatio:we,width:M.width,height:M.height},[B]);x.current=ae.current,U(q),ve?.();return}if(!x.current)return;const s=Re();if(!s)return;pe?.();const d=await x.current("update",s);U(d),ve?.()},[Re,U,ve,pe,Y]);(0,r.useLayoutEffect)(()=>{const s=g.current;if(!s||!F)return;const d=new(H()).Manager(s),M=o.options.plugins?.zoom?.pan?.threshold??10;return d.add(new(H()).Pan({threshold:M})),d.on("panstart",async c=>{if(Se.current=!0,!x.current)return;const B=c.target.getBoundingClientRect();await x.current("panstart",{event:{cancelable:!1,deltaY:c.deltaY,deltaX:c.deltaX,center:{x:c.center.x,y:c.center.y},target:{boundingClientRect:B.toJSON()}}})}),d.on("panmove",async c=>{if(!x.current)return;const B=c.target.getBoundingClientRect(),q=await x.current("panmove",{event:{cancelable:!1,deltaY:c.deltaY,deltaX:c.deltaX,target:{boundingClientRect:B.toJSON()}}});U(q,{userInteraction:!0})}),d.on("panend",async c=>{if(!x.current)return;const B=c.target.getBoundingClientRect(),q=await x.current("panend",{event:{cancelable:!1,deltaY:c.deltaY,deltaX:c.deltaX,target:{boundingClientRect:B.toJSON()}}});U(q,{userInteraction:!0})}),()=>{d.destroy()}},[U,F,o.options.plugins?.zoom?.pan?.threshold]);const Le=(0,r.useCallback)(async s=>{if(!E||!x.current)return;const d=s.currentTarget.getBoundingClientRect(),M=await x.current("wheel",{event:{cancelable:!1,deltaY:s.deltaY,deltaX:s.deltaX,clientX:s.clientX,clientY:s.clientY,target:{boundingClientRect:d.toJSON()}}});U(M,{userInteraction:!0})},[E,U]),De=(0,r.useCallback)(async s=>{if(Se.current=!1,!x.current)return;const d=await x.current("mousedown",{event:me(s)});U(d)},[U]),Te=(0,r.useCallback)(async s=>{if(x.current)return await x.current("mouseup",{event:me(s)})},[]),xe=(0,r.useRef)(!1),{onHover:ye}=o,Be=(0,r.useCallback)(async s=>{if(xe.current=!0,ye==null||x.current==null)return;const d=await x.current("getElementsAtEvent",{event:me(s)});y()&&xe.current&&ye(d)},[ye,y]),$e=(0,r.useCallback)(()=>{xe.current=!0},[]),We=(0,r.useCallback)(()=>{xe.current=!1,ye?.([])},[ye]),Ze=(0,r.useCallback)(async s=>{if(!o.onClick||!x.current||!y()||Se.current)return;const d=s.currentTarget.getBoundingClientRect(),M=s.clientX-d.left,c=s.clientY-d.top,B=await x.current("getDatalabelAtEvent",{event:{x:M,y:c,type:"click"}});let q,Ie;const ie=u.current?.x;if(ie){const be=ie.pixelMax-ie.pixelMin;q=(ie.max-ie.min)/be*(M-ie.pixelMin)+ie.min}const ce=u.current?.y;if(ce){const be=ce.pixelMax-ce.pixelMin;Ie=(ce.max-ce.min)/be*(c-ce.pixelMin)+ce.min}o.onClick({datalabel:B,x:q,y:Ie})},[y,o]);if(ke)throw ke;return(0,ee.jsx)("div",{ref:g,onWheel:Le,onClick:Ze,onMouseDown:De,onMouseMove:Be,onMouseLeave:We,onMouseEnter:$e,onMouseUp:Te,style:{width:X,height:re,cursor:"crosshair",position:"relative"}})}const ge=se},96133:(Me,_,n)=>{n.d(_,{J:()=>ee});function ee(N,H){if(typeof N.value=="object")throw new Error("filterMatches only works on paths where global variables have been filled in");if(N.value==null)return!1;let r=H;for(const te of N.path)if(typeof r!="object"||r==null||(r=r[te],r==null))return!1;return r!=null&&r==N.value}},81187:(Me,_,n)=>{n.d(_,{Iq:()=>G,wm:()=>ue});var ee=n(76635),N=n(2784),H=n(57051),r=n(59506),te=n(88665),fe=n.n(te);function le(w,{initiallyTrue:p}){const f=(0,N.useRef)(p?void 0:w),I=!fe()(f.current,w);return f.current=w,I}var K=n(51668),R=n(36423),J=n(35528),C=n(96133),T=n(60351),$=n(94670),k=n(1012);function G(w){const{topics:p,datatypes:f}=r.Ui(),{globalVariables:I}=(0,R.Z)(),v=(0,H.O4)(w),W=(0,N.useMemo)(()=>{const l={};for(const a of v){const h=(0,k.ZP)(a);h&&(l[a]=ne(h,I))}return l},[I,v]),Z=(0,K.Z)(W),z=(0,N.useMemo)(()=>{const l=(0,J.N_)(p),a=new Set,h=[];for(const j of v){const m=(0,k.ZP)(j);if(m){if(a.has(m.topicName))continue;a.add(m.topicName);const b=l[m.topicName];b&&h.push(b)}}return h},[p,v]),P=(0,K.Z)(z),S=(0,N.useMemo)(()=>{const l=new Map;function a(h,j){if(j.includes(h))return;const m=f.get(h);if(m){l.set(h,m);for(const b of m.definitions)(b.isComplex===!0||(0,J.bV)(b.name)!=null)&&a(b.type,[...j,h])}}for(const{schemaName:h}of P.values())h!=null&&a(h,[]);return l},[f,P]),L=(0,K.Z)(S),D=(0,N.useRef)({});if(le([P,L],{initiallyTrue:!0})&&(D.current={}),le([Z],{initiallyTrue:!1}))for(const[l,a]of Object.entries(D.current)){const h=Z[l];(!h||!(0,ee.isEqual)(a.filledInPath,h))&&delete D.current[l]}return(0,N.useCallback)((l,a)=>{if(!v.includes(l))throw new Error(`path (${l}) was not in the list of cached paths`);const h=Z[l];if(!h)return;const j=D.current[l]=D.current[l]??{filledInPath:h,weakMap:new WeakMap},{weakMap:m}=j;if(!m.has(a)){const O=he(a,h,P,L);return m.set(a,O),O}return m.get(a)},[L,Z,v,P])}function ne(w,p){return{...w,messagePath:w.messagePath.map(f=>{if(f.type==="slice"){const I=typeof f.start=="object"?Number(p[f.start.variableName]):f.start,v=typeof f.end=="object"?Number(p[f.end.variableName]):f.end;return{...f,start:isNaN(I)?0:I,end:isNaN(v)?1/0:v}}else if(f.type==="filter"&&typeof f.value=="object"){let I;const v=p[f.value.variableName];return(typeof v=="number"||typeof v=="string")&&(I=v),{...f,value:I}}return f})}}function he(w,p,f,I){const v=(0,$.pb)(I),W=(0,J.N_)(f)[p.topicName];if(!W||w.topic!==p.topicName)return;for(const S of p.messagePath)if(S.type==="filter"){if(!(0,C.J)(S,w.message))return[]}else break;const Z=[];function z(S,L,D,l){if(S==null||l==null)return;const a=p.messagePath[L],h=p.messagePath[L+1],j=l.structureType==="primitive"&&l.primitiveType==="json";if(a)if(a.type==="name"&&l.structureType==="message"){const m=l.nextByName[a.name],O=!(m?.structureType==="primitive"&&m.primitiveType==="json")&&m?m:{structureType:"primitive",primitiveType:"json",datatype:""};z(S[a.name],L+1,`${D}.${a.repr}`,O)}else if(a.type==="slice"&&(l.structureType==="array"||j)){const{start:m,end:b}=a;if(typeof m=="object"||typeof b=="object")throw new Error("getMessagePathDataItems  only works on paths where global variables have been filled in");const O=m,Ce=b;if(typeof O!="number"||typeof Ce!="number")return;const we=S.length;for(let A=O;A<=Math.min(Ce,we-1);A++){const me=A>=0?A:we+A,Q=S[me];if(Q==null)continue;let se;if(h&&h.type==="filter")se=`${D}[:]`;else if(typeof Q=="object"){const ge=T.H.find(o=>o in Q);ge!=null?se=`${D}[:]{${ge}==${Q[ge]}}`:se=`${D}[${A}]`}else se=`${D}[${A}]`;z(Q,L+1,se,!j&&l.structureType==="array"?l.next:l)}}else a.type==="filter"?(0,C.J)(a,S)&&z(S,L+1,`${D}{${a.repr}}`,l):j&&a.type==="name"?z(S[a.name],L+1,`${D}.${a.repr}`,{structureType:"primitive",primitiveType:"json",datatype:""}):console.warn(`Unknown pathItem.type ${a.type} for structureType: ${l.structureType}`);else{let m;const b=p.messagePath[L-1];if(b&&b.type==="name"){const O=b.name;m=(0,J.Hh)(I)[l.datatype]?.[O]?.[S]}Z.push({value:S,path:D,constantName:m})}}const P=W.schemaName==null?{structureType:"message",datatype:"",nextByName:{}}:v[W.schemaName];return P&&z(w.message,0,(0,k.dH)(p.topicName),P),Z}function ue(w){const p=(0,H.O4)(w),f=G(p);return(0,N.useCallback)(I=>{const v={};for(const W of p){const Z=(0,k.ZP)(W);if(!Z){v[W]=[];continue}const z=I[Z.topicName];if(!z)continue;const P=[];v[W]=P;for(const S of z){const L=f(W,S);L&&P.push({messageEvent:S,queriedData:L})}}return v},[p,f])}},43185:(Me,_,n)=>{n.d(_,{Z:()=>R});var ee=n(12982),N=n.n(ee),H=n(829),r=n.n(H),te=n(45243),fe=n(42146);function le(J){J.receive("sendNotification",({message:C,details:T,type:$,severity:k})=>{(0,fe.ZP)(C,T,$,k)})}function K(J){le(J)}class R{constructor(C,T){this._createWorker=C,this._maxWorkerCount=T,this._workerStates=new Array(T),this._allListeners=new Set}testing_workerCount(){return this._workerStates.filter(Boolean).length}testing_getWorkerState(C){return this._workerStates.find(T=>T?.listenerIds.includes(C))}registerWorkerListener(C){if(this._allListeners.has(C))throw new Error("cannot register the same listener id twice");if(this._allListeners.add(C),this._workerStates.filter(Boolean).length<this._maxWorkerCount){const G=this._createWorker(),ne=new te.Z(G);K(ne);const he=N()(this._workerStates,ue=>!ue);return this._workerStates[he]={worker:G,rpc:ne,listenerIds:[C]},ne}const k=r()(this._workerStates.filter(Boolean),G=>G?.listenerIds.length)[0];if(!k)throw new Error("no worker state");return k.listenerIds.push(C),k.rpc}unregisterWorkerListener(C){if(!this._allListeners.has(C))throw new Error("Cannot find listener to unregister");this._allListeners.delete(C);const T=N()(this._workerStates,k=>k?k.listenerIds.includes(C):!1),$=this._workerStates[T];T>=0&&$&&($.listenerIds=$.listenerIds.filter(k=>k!==C),$.listenerIds.length===0&&(this._workerStates[T]=void 0,$.worker.terminate(),$.rpc.terminate()))}}}}]);

//# sourceMappingURL=6528.d855508a6228a8f40319.js.map