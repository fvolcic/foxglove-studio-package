(()=>{"use strict";var x={61888:(t,a,e)=>{const u="$$RESPONSE",l="$$ERROR";function h(){const n={onmessage:void 0,postMessage(r,d){const f=new MessageEvent("message",{data:r});s.onmessage&&s.onmessage(f)},terminate:()=>{}},s={onmessage:void 0,postMessage(r,d){const f=new MessageEvent("message",{data:r});n.onmessage&&n.onmessage(f)},terminate:()=>{}};return{local:n,remote:s}}class i{constructor(s){if(this._messageId=0,this._pendingCallbacks={},this._receivers=new Map,this._onChannelMessage=r=>{const{id:d,topic:f,data:v}=r.data;if(f===u){this._pendingCallbacks[d]?.(r.data),delete this._pendingCallbacks[d];return}new Promise(p=>{const _=this._receivers.get(f);if(!_)throw new Error(`no receiver registered for ${f}`);p(_(v))}).then(p=>{if(!p)return this._channel.postMessage({topic:u,id:d});const _=p[i.transferables];delete p[i.transferables];const g={topic:u,id:d,data:p};this._channel.postMessage(g,_)}).catch(p=>{const _={topic:u,id:d,data:{[l]:!0,name:p.name,message:p.message,stack:p.stack}};this._channel.postMessage(_)})},this._channel=s,this._channel.onmessage)throw new Error("channel.onmessage is already set. Can only use one Rpc instance per channel.");this._channel.onmessage=this._onChannelMessage}terminate(){for(const[s,r]of Object.entries(this._pendingCallbacks))r({topic:u,id:s,data:{[l]:!0,name:"Error",message:"Rpc terminated",stack:new Error().stack}})}async send(s,r,d){const f=this._messageId++,v={topic:s,id:f,data:r},p=new Promise((_,g)=>{this._pendingCallbacks[f]=k=>{if(k.data?.[l]!=null){const M=new Error(k.data.message);M.name=k.data.name,M.stack=k.data.stack,g(M)}else _(k.data)}});return this._channel.postMessage(v,d),await p}receive(s,r){if(this._receivers.has(s))throw new Error(`Receiver already registered for topic: ${s}`);this._receivers.set(s,r)}}i.transferables="$$TRANSFERABLES";var m=e(42146);function w(){const n=e.g.fetch;e.g.fetch=async(s,r)=>{const d=new TypeError(`Failed to fetch: ${s}`);return await n(s,r).catch(f=>{throw f.message==="Failed to fetch"?d:f})}}function S(n){(0,m.tm)((s,r,d,f)=>{r instanceof Error||typeof r=="string"||console.warn("Invalid Error type",r),n.send("sendNotification",{message:s,details:r instanceof Error?r.toString():r,type:d,severity:f})})}function C(n){S(n),w()}var E=e(14077),b=e(9459);class c{constructor(s){this._renderStates={},C(s),s.receive("initialize",async({id:r,canvas:d})=>{this._renderStates[r]={canvas:d,hitmap:new OffscreenCanvas(d.width,d.height),markers:[]}}),s.receive("mouseMove",async({id:r,x:d,y:f})=>{const v=this._renderStates[r];if(!v)return;const p=(v.dimensions?.transform??new DOMMatrix).inverse(),_=new DOMPoint(d,f).matrixTransform(p),g=v.canvas.getContext("2d")?.getImageData(d,f,1,1),k=v.hitmap.getContext("2d")?.getImageData(d,f,1,1),M=k?(0,b.uD)(k.data):void 0;if(g)return{color:{r:g.data[0],g:g.data[1],b:g.data[2],a:g.data[3]},position:{x:Math.round(_.x),y:Math.round(_.y)},markerIndex:M,marker:M!=null?v.markers[M]:void 0}}),s.receive("renderImage",r=>{const{id:d,geometry:f,imageMessage:v,rawMarkerData:p,options:_}=r,g=this._renderStates[d];return g?(g.canvas.width!==f.viewport.width&&(g.canvas.width=f.viewport.width,g.hitmap.width=f.viewport.width),g.canvas.height!==f.viewport.height&&(g.canvas.height=f.viewport.height,g.hitmap.height=f.viewport.height),g.markers=p.markers,(0,E.c)({canvas:g.canvas,geometry:f,hitmapCanvas:g.hitmap,imageMessage:v,options:_,rawMarkerData:p}).then(k=>g.dimensions=k)):Promise.resolve(void 0)})}}e.g.postMessage&&!e.g.onmessage&&new c(new i(e.g))},9459:(t,a,e)=>{e.d(a,{A0:()=>i,KS:()=>b,Y5:()=>l,uD:()=>m});var u=e(31953);function l(c,n,s){let r=n.width/c.width;const d=c.height*r;return s==="fit"&&d>n.height&&(r=n.height/c.height),s==="fill"&&d<n.height&&(r=n.height/c.height),s==="other"&&(r=1),r}function h(c,n){const s=c.toString(16);return"0".repeat(n-s.length)+s}function i(c){return h(c,6)}function m(c){if(!(c.length<4||c[3]!==255))return(c[0]<<16)+(c[1]<<8)+c[2]}function w(c,n,s){const r=[],d=E(c);for(const{name:f,schemaName:v}of n)d&&f.startsWith(d+"/")&&v!=null&&s.includes(v)&&r.push(f);return r.sort()}function S(c,n){return n.filter(s=>c.some(r=>s.endsWith(r.split("/").pop())))}function C(c){const n=E(c);if(n)return`${n}/camera_info`}function E(c){let n=c.split("/");return n.pop(),n=n.filter(s=>s!=="old"),n.length>1?n.join("/"):void 0}function b(c){const{markers:n,transformMarkers:s,cameraInfo:r}=c;if(n.length===0)return{markers:n,cameraModel:void 0,originalHeight:void 0,originalWidth:void 0};let d;if(s){if(!r)return;d=new u.HL(r)}return{markers:n,cameraModel:d,originalWidth:r?.width,originalHeight:r?.height}}},2661:(t,a,e)=>{e.d(a,{e:()=>l});const u=e.g;function l(i){u.foxgloveStudioReportErrorFn?.(i)}function h(i){u.foxgloveStudioReportErrorFn=i}},53542:(t,a,e)=>{e.d(a,{g:()=>u});class u extends Error{constructor(h,i){if(super(),this.details=h,this.extraInfo=i,this.name="AppError",this.message="",h instanceof Error?this.message=h.stack??h.message:typeof h=="string"&&(this.message=h),i!=null)if(i.componentStack!=null)this.message+=`

${i.componentStack}`;else try{const m=JSON.stringify(i);this.message+=`

${m}`}catch{this.message+=`

[ Either cyclic object or object with BigInt(s) ]`}this.message===""&&(this.message="Unknown Error")}}},42146:(t,a,e)=>{e.d(a,{ZP:()=>C,tm:()=>w});var u=e(2661),l=e(53542),h=e(77498);const i=(E,b,c,n)=>{if((0,h.KC)()){(n==="error"?console.error:n==="warn"?console.warn:console.info)("Web Worker has uninitialized sendNotification function; this means this error message cannot show up in the UI (so we show it here in the console instead).",E,b,c);return}console.error("Notification before error display is mounted",E,b,c)};let m=i;function w(E){if(m!==i)throw new Error("Tried to overwrite existing NotificationHandler");m=E}function S(){if(m===i)throw new Error("Tried to unset NotificationHandler but it was already the default");m=i}function C(E,b,c,n){c==="app"&&(n==="warn"||n==="error")&&(0,u.e)(new l.g(b,E)),m(E,b,c,n)}C.expectCalledDuringTest=()=>{throw new Error("Should be overriden in setupTestFramework.ts")}},77498:(t,a,e)=>{e.d(a,{KC:()=>u});const u=()=>typeof e.g.postMessage<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,l=()=>typeof SharedWorkerGlobalScope<"u"&&self instanceof SharedWorkerGlobalScope,h=i=>{const m=typeof fetch<"u"&&fetch("data:test").then(()=>!0).catch(()=>!1);return async(...w)=>{if(await m)throw new Error("Content security policy too loose.");return i(...w)}}}},O={};function o(t){var a=O[t];if(a!==void 0)return a.exports;var e=O[t]={exports:{}};return x[t](e,e.exports,o),e.exports}o.m=x,o.x=()=>{var t=o.O(void 0,[4077],()=>o(61888));return t=o.O(t),t},(()=>{var t=[];o.O=(a,e,u,l)=>{if(e){l=l||0;for(var h=t.length;h>0&&t[h-1][2]>l;h--)t[h]=t[h-1];t[h]=[e,u,l];return}for(var i=1/0,h=0;h<t.length;h++){for(var[e,u,l]=t[h],m=!0,w=0;w<e.length;w++)(l&!1||i>=l)&&Object.keys(o.O).every(n=>o.O[n](e[w]))?e.splice(w--,1):(m=!1,l<i&&(i=l));if(m){t.splice(h--,1);var S=u();S!==void 0&&(a=S)}}return a}})(),o.d=(t,a)=>{for(var e in a)o.o(a,e)&&!o.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:a[e]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce((a,e)=>(o.f[e](t,a),a),[])),o.u=t=>""+t+".85e9c07cfc37d60ae027.js",o.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),o.o=(t,a)=>Object.prototype.hasOwnProperty.call(t,a),(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var a=o.g.document;if(!t&&a&&(a.currentScript&&(t=a.currentScript.src),!t)){var e=a.getElementsByTagName("script");e.length&&(t=e[e.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={1888:1},a=l=>{var[h,i,m]=l;for(var w in i)o.o(i,w)&&(o.m[w]=i[w]);for(m&&m(o);h.length;)t[h.pop()]=1;u(l)};o.f.i=(l,h)=>{t[l]||importScripts(o.p+o.u(l))};var e=self.webpackChunk=self.webpackChunk||[],u=e.push.bind(e);e.push=a})(),(()=>{var t=o.x;o.x=()=>o.e(4077).then(t)})();var y=o.x()})();

//# sourceMappingURL=1888.5e25ea143d4e3898ab31.js.map