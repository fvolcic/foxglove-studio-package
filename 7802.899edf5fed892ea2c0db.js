"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7802],{14571:(fe,b,a)=>{a.d(b,{o:()=>S});var t=a(52322),s=a(2784);class S extends s.Component{constructor(){super(...arguments),this.state={hadError:!1}}componentDidCatch(Y){this.setState({hadError:!0}),this.props.onError(Y)}render(){return this.state.hadError?(0,t.jsx)(t.Fragment,{}):this.props.children}}},89820:(fe,b,a)=>{a.d(b,{CW:()=>R,KV:()=>E,ZP:()=>$});var t=a(52322),s=a(71092),S=a(65992),H=a(66198),Y=a(70943),_=a(45434),F=a(72283),C=a(93812),O=a(2784);const P=240,m=(0,S.ZP)(H.Z)({fontSize:"1rem !important","& svg:not(.MuiSvgIcon-root)":{fontSize:"1rem !important"}}),u=(0,S.ZP)(Y.Z)(({theme:y})=>({minHeight:"auto",minWidth:"auto",padding:y.spacing(1,1.5,1.125),color:y.palette.text.secondary,"&.Mui-selected":{color:y.palette.text.primary}})),p=(0,S.ZP)(_.Z)({minHeight:"auto",".MuiTabs-indicator":{transform:"scaleX(0.75)",height:2}}),h=(0,S.ZP)("div")(({theme:y})=>({position:"relative",backgroundColor:y.palette.background.default,width:280}));function E({children:y}){return y}function R({children:y}){return(0,t.jsx)(C.Z,{padding:1,overflowX:"hidden",overflowY:"auto",style:{maxHeight:P},children:y})}function $({children:y,checked:Pe,icon:ke,onSelectTab:ee,selectedTab:ne,tooltip:Te,dataTest:be}){if(!(ne!=null)){let j=ne;return O.Children.forEach(y,re=>{j==null&&(j=re.props.name)}),(0,t.jsx)(F.Z,{square:!1,elevation:4,style:{pointerEvents:"auto"},children:(0,t.jsx)(m,{color:Pe===!0?"info":"default",title:Te,"data-testid":`ExpandingToolbar-${Te}`,onClick:()=>ee(j),children:ke})})}let he;O.Children.forEach(y,j=>{(!he||j.props.name===ne)&&(he=j)});const je=(j,re)=>{re!=null&&ee(re)};return(0,t.jsxs)(F.Z,{"data-testid":be,square:!1,elevation:4,style:{pointerEvents:"auto"},children:[(0,t.jsx)(F.Z,{children:(0,t.jsxs)(C.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,t.jsx)(p,{textColor:"inherit",value:ne,onChange:je,children:O.Children.map(y,j=>(0,t.jsx)(u,{label:j.props.name,value:j.props.name}))}),(0,t.jsx)(m,{onClick:()=>ee(void 0),children:(0,t.jsx)(s.iRs,{})})]})}),(0,t.jsx)(h,{children:he})]})}},47802:(fe,b,a)=>{a.r(b),a.d(b,{default:()=>Yn});var t=a(52322),s=a(2784),S=a(28316),H=a(57051),Y=a(14571),_=a(14075),F=a(591),C=a(68434),O=a(76665),P=a(76635),m=a(8740),u=a(77210),p=a(56961),h=a(80078),E=a(82056),R=a(84877);function $(e){const{itemsForClickPosition:i}=e,n=(0,s.useRef)(null),[o,r]=(0,s.useState)(),c=(0,s.useCallback)(()=>r(void 0),[]),[T,f]=(0,s.useState)(),g=(0,s.useCallback)(d=>{d.preventDefault(),d.stopPropagation(),r({x:d.clientX,y:d.clientY}),f(i({x:d.clientX,y:d.clientY}))},[i]);return(0,s.useEffect)(()=>{const d=n.current;if(!d)return;const v=d.closest(`.${R.DY}`);return v?.addEventListener("contextmenu",g),()=>{v?.removeEventListener("contextmenu",g)}},[g]),(0,t.jsx)("div",{ref:n,onContextMenu:d=>d.preventDefault(),children:(0,t.jsx)(u.Z,{open:o!=null,onClose:c,anchorReference:"anchorPosition",anchorPosition:o?{top:o.y,left:o.x}:void 0,MenuListProps:{dense:!0},children:(T??[]).map((d,v)=>d.type==="divider"?(0,t.jsx)(p.Z,{variant:"middle"},`divider_${v}`):(0,t.jsx)(h.Z,{onClick:()=>{c(),d.onclick()},disabled:d.disabled,children:(0,t.jsx)(E.Z,{children:d.label})},`item_${v}_${d.label}`))})})}var y=a(93812),Pe=a(29176),ke=a(88724),ee=a(36537),ne=a(77075),Te=a(27999),be=a(62515),Ve=a(4812),he=a(31115),je=a(91004),j=a(86451),re=a(43185),_e=a(93553),en=a(63079),nn=a(31563),Ae=a(65992),tn=a(96027),ze=a(75254),on=a(50799),an=a(66198);function He(e){const[i,n]=(0,s.useState)(!1),o=(0,s.useCallback)(r=>{e.current&&(r.type==="mouseenter"?n(!0):n(!1))},[e]);return(0,s.useEffect)(()=>{const r=e.current;if(!r)return;const c=r.closest(`.${R.DY}`);return c?.addEventListener("mouseenter",o),c?.addEventListener("mouseleave",o),()=>{c?.removeEventListener("mouseenter",o),c?.removeEventListener("mouseleave",o)}},[e,o]),i}const sn=(0,Ae.ZP)(tn.Z,{shouldForwardProp:e=>e!=="visible"})(({visible:e,theme:i})=>({position:"absolute",bottom:0,left:0,zIndex:i.zIndex.tooltip,margin:i.spacing(.75),visibility:e?"visible":"hidden",".hoverScreenshot &":{opacity:1}})),rn=(0,Ae.ZP)(ze.Z)({flex:"auto",lineHeight:1}),ln=(0,Ae.ZP)(on.Z)({width:"100%"});function cn({zoom:e,setZoom:i,setZoomMode:n,resetPanZoom:o,open:r=!1,...c}){const[T,f]=(0,s.useState)(void 0),g=(0,s.useRef)(null),d=He(g),v=Boolean(T),z=D=>{f(D.currentTarget)},M=()=>{f(void 0)},w=(0,s.useCallback)(()=>{i(e+1*.5)},[i,e]),le=(0,s.useCallback)(()=>{i(e-1*.5)},[i,e]),te=(0,s.useCallback)(()=>{n("fit"),o(),M()},[o,n]),Z=(0,s.useCallback)(()=>{n("fill"),o(),M()},[o,n]),G=(0,s.useCallback)(()=>{n("other"),o(),M()},[o,n]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(sn,{variant:"elevation",ref:g,visible:d||v||r,...c,children:(0,t.jsx)(an.Z,{id:"zoom-button","aria-controls":v?"zoom-menu":void 0,"aria-haspopup":"true","aria-expanded":v?"true":void 0,onClick:z,children:(0,t.jsx)(nn.Z,{fontSize:"small"})})}),(0,t.jsxs)(u.Z,{id:"zoom-menu",anchorEl:T,open:v||r,onClose:M,MenuListProps:{"aria-labelledby":"zoom-button",dense:!0,disablePadding:!0},anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},children:[(0,t.jsxs)(y.Z,{padding:2,gap:1,children:[(0,t.jsxs)(C.Z,{variant:"body2",color:"text.secondary",children:["Scroll or use the ",(0,t.jsx)("br",{}),"buttons below to zoom"]}),(0,t.jsxs)(ln,{size:"small",style:{width:"100%"},children:[(0,t.jsx)(ze.Z,{value:"zoom-out",onClick:le,children:(0,t.jsx)(en.Z,{fontSize:"small"})}),(0,t.jsx)(rn,{disabled:!0,value:"zoom-value",children:`${Math.round(e*100)}%`}),(0,t.jsx)(ze.Z,{value:"zoom-in",onClick:w,children:(0,t.jsx)(_e.Z,{fontSize:"small"})})]})]}),(0,t.jsx)(p.Z,{}),(0,t.jsx)(h.Z,{divider:!0,onClick:G,"data-testid":"hundred-zoom",children:"Zoom to 100%"}),(0,t.jsx)(h.Z,{divider:!0,onClick:te,"data-testid":"fit-zoom",children:"Zoom to fit"}),(0,t.jsx)(h.Z,{onClick:Z,"data-testid":"fill-zoom",children:"Zoom to fill"})]})]})}var Fe=a(14077);const mn=(0,m.ZL)()(e=>({root:{overflow:"hidden",width:"100%",height:"100%",position:"relative"},errorMessage:{top:0,left:0,width:"100%",height:"100%",display:"flex",position:"absolute",alignItems:"center",justifyContent:"center",color:e.palette.error.main},canvasContainer:{position:"absolute",top:0,left:0,width:"100%",height:"100%",canvas:{width:"100%",height:"100%",imageRendering:"pixelated"}},canvasImageRenderingSmooth:{canvas:{imageRendering:"auto"}}})),Ke=new re.Z(()=>new Worker(new URL(a.p+a.u(1888),a.b)),1),dn=typeof HTMLCanvasElement.prototype.transferControlToOffscreen=="function";function un(e){const{rawMarkerData:i,image:n,config:o,saveConfig:r,onStartRenderImage:c}=e,{mode:T}=o,{classes:f,cx:g}=mn(),d=(e.renderInMainThread??!1)||!dn,[v,z]=(0,s.useReducer)(x=>x+1,0),[M,w]=(0,s.useState)(),[le,te]=(0,s.useState)(T),[Z,G]=(0,s.useState)(),D=(0,s.useRef)(null),{width:ce,height:me,ref:Be}=(0,be.NB)({refreshRate:0,refreshMode:"debounce"}),[ve,B]=(0,s.useState)(void 0),de=(0,s.useRef)(),[X]=(0,s.useState)(()=>(0,je.Z)());(0,s.useLayoutEffect)(()=>{const x=document.createElement("canvas");G(x),D.current?.appendChild(x);let V=!0;const K=X;if(d){const U=se=>{const q=se.geometry.viewport.width,ie=se.geometry.viewport.height;return q!==x.width&&(x.width=q),ie!==x.height&&(x.height=ie),(0,Fe.c)({...se,hitmapCanvas:void 0})};B(()=>U)}else{const U=Ke.registerWorkerListener(K);de.current=U;const se=ie=>{const{geometry:$n,imageMessage:Gn,options:Xn,rawMarkerData:Jn}=ie;return U.send("renderImage",{geometry:$n,id:K,imageMessage:Gn,options:Xn,rawMarkerData:Jn})},q=x.transferControlToOffscreen();U.send("initialize",{id:K,canvas:q},[q]).then(()=>{V&&B(()=>se)}).catch(ie=>{V&&(console.error(ie),w(ie))})}return()=>{V=!1,x.remove(),!d&&(de.current=void 0,Ke.unregisterWorkerListener(K))}},[d,X]);const{setPan:ue,setZoom:k,pan:{x:oe,y:ae},zoom:J,setContainer:ye,panZoomHandlers:Ie}=(0,he.Z)({minZoom:.5,initialPan:o.pan,initialZoom:o.zoom});(0,s.useLayoutEffect)(()=>{Z&&ye(Z)},[Z,ye]);const Ce=(0,s.useMemo)(()=>({imageSmoothing:o.smooth,minValue:o.minValue,maxValue:o.maxValue}),[o.minValue,o.maxValue,o.smooth]),W=window.devicePixelRatio,{error:Se}=(0,Ve.Z)(async()=>{if(!Z||!ve||ce==null||me==null)return;const x=Math.floor(ce*W),V=Math.floor(me*W),K={x:Math.floor(oe*W),y:Math.floor(ae*W),scale:J},U=c();try{return await ve({canvas:Z,geometry:{flipHorizontal:o.flipHorizontal??!1,flipVertical:o.flipVertical??!1,panZoom:K,rotation:o.rotation??0,viewport:{width:x,height:V},zoomMode:le??"fit"},imageMessage:n,rawMarkerData:i,options:Ce})}finally{U()}},[Z,o.flipHorizontal,o.flipVertical,o.rotation,W,ve,me,n,c,oe,ae,i,Ce,J,ce,le]);(0,s.useLayoutEffect)(()=>{r({pan:{x:oe,y:ae},zoom:J})},[oe,ae,r,J]);const We=(0,s.useCallback)(x=>{const V=e.setActivePixelData,K=x.currentTarget.getBoundingClientRect(),U=x.clientX-K.x,se=x.clientY-K.y;de.current?.send("mouseMove",{id:X,x:U*W,y:se*W}).then(q=>{q?.marker?V(q):V(void 0)})},[W,e.setActivePixelData,X]),xe=(0,s.useCallback)(()=>{ue({x:0,y:0}),k(1),z()},[ue,k]),l=(0,s.useCallback)(()=>{k(x=>x+1*.5)},[k]),I=(0,s.useCallback)(()=>{k(x=>x-1*.5)},[k]),L=(0,s.useCallback)(()=>{te("other"),xe()},[xe,te]),Q=(0,s.useMemo)(()=>({"=":l,"-":I,0:L}),[L,l,I]);return(0,t.jsxs)("div",{ref:Be,className:f.root,tabIndex:0,children:[(0,t.jsx)(j.Z,{keyDownHandlers:Q}),M&&(0,t.jsxs)("div",{className:f.errorMessage,children:["Error: ",M.message]}),Se&&(0,t.jsxs)("div",{className:f.errorMessage,children:["Error: ",Se.message]}),(0,t.jsx)(cn,{zoom:J,setZoom:k,setZoomMode:te,resetPanZoom:xe}),(0,t.jsx)("div",{ref:D,onClick:We,className:g(f.canvasContainer,{[f.canvasImageRenderingSmooth]:o.smooth===!0}),...Ie})]})}var Ue=a(29268);function fn(e){const{cameraTopic:i,markerTopics:n,shouldSynchronize:o}=e;return i===""?(0,t.jsx)(y.Z,{fullHeight:!0,fullWidth:!0,justifyContent:"center",alignItems:"center",position:"absolute",children:(0,t.jsx)(Ue.Z,{children:"Select a topic to view images"})}):(0,t.jsx)(y.Z,{fullHeight:!0,fullWidth:!0,justifyContent:"center",alignItems:"center",position:"absolute",children:(0,t.jsxs)(Ue.Z,{children:[(0,t.jsxs)(C.Z,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Waiting for images ",n.length>0&&"and markers"," on:"]}),(0,t.jsx)(C.Z,{component:"code",variant:"inherit",display:"block",children:i}),[...n].sort().map(r=>(0,t.jsx)(C.Z,{component:"code",variant:"inherit",display:"block",children:r},r)),o&&(0,t.jsx)(C.Z,{variant:"body2",color:"text.secondary",children:"Synchronization is enabled, so all messages must have the same timestamp."})]})})}var hn=a(93004),gn=a(30650),Re=a(89820),pn=a(11701);const vn=(0,m.ZL)()(e=>({root:{display:"flex",flexDirection:"column",position:"absolute",top:0,right:0,margin:e.spacing(.75),zIndex:e.zIndex.tooltip},hidden:{visibility:"hidden"}}));var Me;(function(e){e.SELECTED_POINT="Selected Point"})(Me||(Me={}));function yn({pixelData:e}){const i=(0,pn.lk)();return(0,t.jsxs)(y.Z,{gap:1,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(C.Z,{variant:"caption",children:"Position:"}),(0,t.jsxs)(y.Z,{direction:"row",gap:1,children:[(0,t.jsxs)(C.Z,{color:"info.main",variant:"body2",children:["X:",e?.position.x]}),(0,t.jsxs)(C.Z,{color:"info.main",variant:"body2",children:["Y:",e?.position.y]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.Z,{variant:"caption",children:"Color:"}),(0,t.jsxs)(y.Z,{direction:"row",gap:1,children:[(0,t.jsxs)(C.Z,{color:"info.main",variant:"body2",children:["R:",e?.color.r]}),(0,t.jsxs)(C.Z,{color:"info.main",variant:"body2",children:["G:",e?.color.g]}),(0,t.jsxs)(C.Z,{color:"info.main",variant:"body2",children:["B:",e?.color.b]}),(0,t.jsxs)(C.Z,{color:"info.main",variant:"body2",children:["A:",e?.color.a]})]})]}),e?.marker&&(0,t.jsxs)("div",{children:[(0,t.jsx)(C.Z,{variant:"caption",children:"Marker:"}),(0,t.jsx)(gn.ZP,{data:e.marker,hideRoot:!0,invertTheme:!1,theme:{...i,tree:{margin:0}}})]})]})}function In({pixelData:e}){const i=(0,s.useRef)(null),{classes:n,cx:o}=vn(),[r,c]=(0,s.useState)();(0,s.useEffect)(()=>{c(e?Me.SELECTED_POINT:void 0)},[e]);const T=He(i);return(0,t.jsx)("div",{ref:i,className:o(n.root,{[n.hidden]:!T}),children:(0,t.jsx)(Re.ZP,{tooltip:"Inspect objects",icon:(0,t.jsx)(hn.BaF,{}),selectedTab:r,onSelectTab:c,children:(0,t.jsx)(Re.KV,{name:Me.SELECTED_POINT,children:(0,t.jsx)(Re.CW,{children:e?(0,t.jsx)(yn,{pixelData:e}):(0,t.jsx)(C.Z,{color:"secondary.main",children:"Click an object to select it."})})})})})}var Cn=a(20140),xn=a(42893),Tn=a(12294),Ze=a(63296),N=a(44668);const Mn=["sensor_msgs/CameraInfo","sensor_msgs/msg/CameraInfo","foxglove_msgs/CameraCalibration","foxglove_msgs/msg/CameraCalibration","foxglove.CameraCalibration"];function Ye(e,i){switch(i){case"sensor_msgs/CameraInfo":case"sensor_msgs/msg/CameraInfo":return e;case"foxglove_msgs/CameraCalibration":case"foxglove_msgs/msg/CameraCalibration":case"foxglove.CameraCalibration":{const n=e,o=[1,0,0,0,1,0,0,0,1],r=[1,0,0,0,0,1,0,0,0,0,1,0];return{width:n.width,height:n.height,distortion_model:n.distortion_model??"",D:n.D??[],K:n.K??o,R:n.R??o,P:n.P??r,binning_x:1,binning_y:1,roi:{x_offset:0,y_offset:0,width:0,height:0,do_rectify:!1}}}}}var En=a(667),ge=a(55708),A;(function(e){e[e.CIRCLE=0]="CIRCLE",e[e.LINE_STRIP=1]="LINE_STRIP",e[e.LINE_LIST=2]="LINE_LIST",e[e.POLYGON=3]="POLYGON",e[e.POINTS=4]="POINTS",e[e.TEXT=5]="TEXT"})(A||(A={}));var $e;(function(e){e[e.ADD=0]="ADD",e[e.REMOVE=1]="REMOVE"})($e||($e={}));const Le=["visualization_msgs/ImageMarker","visualization_msgs/msg/ImageMarker","ros.visualization_msgs.ImageMarker","foxglove_msgs/ImageMarkerArray","foxglove_msgs/msg/ImageMarkerArray","studio_msgs/ImageMarkerArray","studio_msgs/msg/ImageMarkerArray","visualization_msgs/ImageMarkerArray","visualization_msgs/msg/ImageMarkerArray","ros.visualization_msgs.ImageMarkerArray","webviz_msgs/ImageMarkerArray","foxglove_msgs/ImageAnnotations","foxglove_msgs/msg/ImageAnnotations","foxglove.ImageAnnotations"];function Sn(e){switch(e){case ge.PointsAnnotationType.UNKNOWN:case ge.PointsAnnotationType.POINTS:return"points";case ge.PointsAnnotationType.LINE_LOOP:return"polygon";case ge.PointsAnnotationType.LINE_STRIP:return"line_strip";case ge.PointsAnnotationType.LINE_LIST:return"line_list"}}function Pn(e){if(!e.circles&&!e.points||e.circles?.length===0&&e.points?.length===0)return;const i=[];for(const n of e.circles??[]){const o=typeof n.timestamp=="bigint"?(0,N.fromNanoSec)(n.timestamp):n.timestamp;i.push({type:"circle",stamp:o,fillColor:n.fill_color,outlineColor:n.outline_color,radius:n.diameter/2,thickness:n.thickness,position:n.position})}for(const n of e.points??[]){const o=Sn(n.type);if(!o)continue;const r=typeof n.timestamp=="bigint"?(0,N.fromNanoSec)(n.timestamp):n.timestamp;i.push({type:"points",stamp:r,style:o,points:n.points,outlineColors:n.outline_colors,outlineColor:(0,ee.N)(n).outline_color??{r:1,g:1,b:1,a:1},thickness:(0,ee.N)(n).thickness??1,fillColor:n.fill_color})}return i}function kn(e){return(0,En.DZ)(e.markers,i=>Ge(i))}function bn(e){switch(e){case A.LINE_LIST:return"line_list";case A.LINE_STRIP:return"line_strip";case A.POINTS:return"points";case A.POLYGON:return"polygon"}}function Ge(e){switch(e.type){case A.CIRCLE:return{type:"circle",stamp:e.header.stamp,fillColor:e.filled?e.fill_color:void 0,outlineColor:e.outline_color,radius:e.scale,thickness:1,position:e.position};case A.TEXT:return{type:"text",stamp:e.header.stamp,position:e.position,text:e.text?.data??"",textColor:e.outline_color,backgroundColor:e.filled?e.fill_color:void 0,fontSize:e.scale*12,padding:4*e.scale};case A.POINTS:return{type:"points",stamp:e.header.stamp,style:"points",points:e.points,outlineColors:e.outline_colors,outlineColor:e.outline_color,thickness:e.scale,fillColor:e.fill_color};case A.LINE_LIST:case A.LINE_STRIP:case A.POLYGON:{const i=bn(e.type);return{type:"points",stamp:e.header.stamp,style:i,points:e.points,outlineColors:e.outline_colors,outlineColor:e.outline_color,thickness:e.scale,fillColor:e.filled?e.fill_color:void 0}}}}function jn(e){return"toJSON"in e?e.toJSON():e}function Xe(e,i){const n=jn(e);switch(i){case"visualization_msgs/ImageMarker":case"visualization_msgs/msg/ImageMarker":case"ros.visualization_msgs.ImageMarker":{const o=Ge(n);if(o)return[o];break}case"foxglove_msgs/ImageMarkerArray":case"foxglove_msgs/msg/ImageMarkerArray":case"studio_msgs/ImageMarkerArray":case"studio_msgs/msg/ImageMarkerArray":case"visualization_msgs/ImageMarkerArray":case"visualization_msgs/msg/ImageMarkerArray":case"ros.visualization_msgs.ImageMarkerArray":return kn(n);case"webviz_msgs/ImageMarkerArray":break;case"foxglove_msgs/ImageAnnotations":case"foxglove_msgs/msg/ImageAnnotations":case"foxglove.ImageAnnotations":return Pn(n)}}const An=["sensor_msgs/Image","sensor_msgs/msg/Image","ros.sensor_msgs.Image","sensor_msgs/CompressedImage","sensor_msgs/msg/CompressedImage","ros.sensor_msgs.CompressedImage","foxglove.RawImage","foxglove.CompressedImage","foxglove_msgs/RawImage","foxglove_msgs/msg/RawImage","foxglove_msgs/CompressedImage","foxglove_msgs/msg/CompressedImage"];function Je(e,i){switch(i){case"foxglove_msgs/RawImage":case"foxglove_msgs/msg/RawImage":case"foxglove.RawImage":{const n=e;return{type:"raw",stamp:typeof n.timestamp=="bigint"?(0,N.fromNanoSec)(n.timestamp):n.timestamp,width:n.width,height:n.height,is_bigendian:!1,encoding:n.encoding,step:n.step,data:n.data}}case"sensor_msgs/Image":case"sensor_msgs/msg/Image":case"ros.sensor_msgs.Image":{const n=e;return{type:"raw",stamp:n.header.stamp,width:n.width,height:n.height,is_bigendian:n.is_bigendian,encoding:n.encoding,step:n.step,data:n.data}}case"sensor_msgs/CompressedImage":case"sensor_msgs/msg/CompressedImage":case"ros.sensor_msgs.CompressedImage":{const n=e;return{type:"compressed",stamp:n.header.stamp,format:n.format,data:n.data}}case"foxglove_msgs/CompressedImage":case"foxglove_msgs/msg/CompressedImage":case"foxglove.CompressedImage":{const n=e;return{type:"compressed",stamp:typeof n.timestamp=="bigint"?(0,N.fromNanoSec)(n.timestamp):n.timestamp,format:n.format,data:n.data}}}}function zn(e,i){let n;for(const o of i){const r=o.topic===e.cameraInfoTopic?Ye(o.message,o.schemaName):void 0,c=o.topic===e.imageTopic?Je(o.message,o.schemaName):void 0,T=Xe(o.message,o.schemaName);if(!r&&!c&&!T)continue;if(r&&(n??(n={}),n.cameraInfo=r),c){const g=e.tree.get(c.stamp);g?g.image=c:e.tree.set(c.stamp,{image:c,annotationsByTopic:new Map})}if(T){const g=new Map;for(const d of T){const v=(0,N.toNanoSec)(d.stamp),z=g.get(v);z?z.push(d):g.set(v,[d])}for(const[d,v]of g){const z=(0,N.fromNanoSec)(d);let M=e.tree.get(z);M||(M={image:void 0,annotationsByTopic:new Map},e.tree.set(z,M)),M.annotationsByTopic.set(o.topic,v)}}const f=Rn(e.tree,e.annotationTopics);f&&(n??(n={}),n.image=f[1].image,n.annotationsByTopic=f[1].annotationsByTopic)}return n??e}function Rn(e,i){let n;for(const o of e.entries()){const r=o[1];r.image&&r.annotationsByTopic.size===i.length&&(n=o)}if(n){let o=e.minKey();for(;o&&(0,N.isLessThan)(o,n[0]);)e.shift(),o=e.minKey()}return n}const Zn=e=>({actions:e.actions,image:e.image,cameraInfo:e.cameraInfo,annotations:[].concat(...e.annotationsByTopic.values())});function Ln(e,i){if(e.synchronize&&e.annotationTopics.length>0)return zn(e,i);let n;for(const o of i){const r=o.topic===e.cameraInfoTopic?Ye(o.message,o.schemaName):void 0,c=o.topic===e.imageTopic?Je(o.message,o.schemaName):void 0,T=e.annotationTopics.includes(o.topic)?Xe(o.message,o.schemaName):void 0;!r&&!c&&!T||(n||(n={image:e.image,cameraInfo:e.cameraInfo,annotationsByTopic:new Map(e.annotationsByTopic)}),r&&(n.cameraInfo=r),c&&(n.image=c),T&&n.annotationsByTopic.set(o.topic,T))}return n??e}function On(e){const[i]=(0,s.useState)(()=>(0,xn.M)(o=>({imageTopic:e.imageTopic,cameraInfoTopic:e.cameraInfoTopic,annotationTopics:e.annotationTopics,synchronize:e.synchronize,image:void 0,cameraInfo:void 0,annotationsByTopic:new Map,tree:new Ze.AVLTree(N.compare),actions:{setParams(r){o(c=>{if(!c.synchronize&&!r.synchronize&&c.imageTopic===r.imageTopic&&c.cameraInfoTopic===r.cameraInfoTopic){if(c.annotationTopics===r.annotationTopics)return r;const f=new Map;for(const g of r.annotationTopics){const d=c.annotationsByTopic.get(g);d&&f.set(g,d)}return{annotationsByTopic:f,...r}}return{image:void 0,cameraInfo:void 0,annotationsByTopic:new Map,tree:new Ze.AVLTree(N.compare),...r}})},clear(){o({image:void 0,cameraInfo:void 0,annotationsByTopic:new Map,tree:new Ze.AVLTree(N.compare)})},setCurrentFrame(r){o(c=>Ln(c,r))}}}))),n=(0,H.O4)(e);return(0,Cn.Z)(()=>{i.getState().actions.setParams(n)},[n]),(0,Tn.oR)(i,Zn)}var Nn=a(55433);async function wn(e,i,n){const o=document.createElement("canvas"),r=await(0,Fe.c)({canvas:o,hitmapCanvas:void 0,geometry:{flipHorizontal:n.flipHorizontal??!1,flipVertical:n.flipVertical??!1,panZoom:{x:0,y:0,scale:1},rotation:n.rotation??0,viewport:{width:1,height:1},zoomMode:"other"},imageMessage:e,rawMarkerData:{markers:[],transformMarkers:!1},options:{imageSmoothing:n.smooth,minValue:n.minValue,maxValue:n.maxValue,resizeCanvas:!0}});if(r)return await new Promise(c=>o.toBlob(T=>{if(!T)throw new Error(`Failed to create an image from ${r.width}x${r.height} canvas`);const f=i.name.replace(/^\/+/,""),g=e.stamp,d=`${f}-${g.sec}-${g.nsec}`;(0,Nn.G)([{blob:T,fileName:d}]),c()},"image/png"))}var Ee=a(9459),Dn=a(5817),Bn=a.n(Dn);function Wn(e,i,n){return{label:"Markers",children:(0,P.chain)(e).sort().partition(r=>n.includes(r)).thru(r=>r.flat()).map(r=>[r,{label:r,visible:i.includes(r)}]).fromPairs().value()}}const Vn=Bn()(Wn);function Hn({config:e,imageTopics:i,markerTopics:n,enabledMarkerTopics:o,relatedMarkerTopics:r}){return{general:{label:"General",fields:{cameraTopic:{label:"Topic",input:"select",value:e.cameraTopic,options:i.map(c=>({label:c.name,value:c.name}))},transformMarkers:{input:"boolean",label:"Transform markers",value:e.transformMarkers,help:e.transformMarkers?"Markers are being transformed by Foxglove Studio based on the camera model. Click to turn it off.":"Markers can be transformed by Foxglove Studio based on the camera model. Click to turn it on."},synchronize:{input:"boolean",label:"Synchronize timestamps",value:e.synchronize},smooth:{input:"boolean",label:"Bilinear smoothing",value:e.smooth??!1},flipHorizontal:{input:"boolean",label:"Flip horizontal",value:e.flipHorizontal??!1},flipVertical:{input:"boolean",label:"Flip vertical",value:e.flipVertical??!1},rotation:{input:"select",label:"Rotation",value:e.rotation??0,options:[{label:"0\xB0",value:0},{label:"90\xB0",value:90},{label:"180\xB0",value:180},{label:"270\xB0",value:270}]},minValue:{input:"number",label:"Min (depth images)",placeholder:"0",value:e.minValue},maxValue:{input:"number",label:"Max (depth images)",placeholder:"10000",value:e.maxValue}}},markers:Vn(n,o,r)}}const Oe=new Set(An),Ne=new Set(Le),Qe=new Set(Mn);function pe(e,i){return i.has(e.schemaName)||(e.convertibleTo?.some(n=>i.has(n))??!1)}function we(e,i){if(!i.has(e.schemaName))return e.convertibleTo?.find(n=>i.has(n))}const Fn=(0,m.ZL)()((e,i,n)=>({timestamp:{position:"absolute",margin:e.spacing(.5),right:0,bottom:0,fontFamily:ne.R.MONOSPACE,color:e.palette.common.white,zIndex:e.zIndex.appBar-1,transition:"opacity 0.1s ease-in-out",padding:e.spacing(.25,.5),userSelect:"all",textShadow:`0 1px 4px ${e.palette.common.black}`,"@media (hover: hover)":{opacity:0}},root:{[`&:hover .${n.timestamp}`]:{opacity:1}},screenshotTest:{[`.${n.timestamp}`]:{opacity:1}}}));function Kn({context:e}){const{classes:i,cx:n}=Fn(),[o,r]=(0,s.useState)(()=>()=>{}),[c,T]=(0,s.useState)([]),[f,g]=(0,s.useState)(()=>{const l=e.initialState;return{...qe,...l,pan:{x:l.pan?.x??0,y:l.pan?.y??0}}}),{cameraTopic:d,enabledMarkerTopics:v,transformMarkers:z}=f,M=(0,s.useMemo)(()=>(0,P.keyBy)(c,({name:l})=>l),[c]),w=(0,s.useMemo)(()=>M[d],[d,M]),[le,te]=(0,s.useState)(),Z=f.synchronize&&v.length>0,G=(0,s.useMemo)(()=>(0,Ee.AX)(d),[d]),D=(0,s.useMemo)(()=>G!=null?M[G]:void 0,[G,M]),ce=(0,s.useMemo)(()=>v.map(l=>M[l]),[v,M]),me=(0,s.useMemo)(()=>{const l=[];w&&pe(w,Oe)&&l.push({topic:w.name,preload:!1,convertTo:we(w,Oe)}),D&&pe(D,Qe)&&l.push({topic:D.name,preload:!1,convertTo:we(D,Qe)});for(const I of ce)I&&pe(I,Ne)&&l.push({topic:I.name,preload:!1,convertTo:we(I,Ne)});return l},[w,D,ce]),[Be,ve]=(0,s.useState)("light");(0,s.useEffect)(()=>{e.saveState(f),e.setDefaultPanelTitle(f.cameraTopic===""?void 0:f.cameraTopic)},[f,e]),(0,s.useEffect)(()=>{e.watch("topics"),e.watch("didSeek"),e.watch("currentFrame"),e.watch("colorScheme")},[e]),(0,s.useEffect)(()=>{e.subscribe(me)},[e,me]);const{image:B,annotations:de,cameraInfo:X,actions:ue}=On({imageTopic:d,cameraInfoTopic:G,annotationTopics:v,synchronize:Z});(0,s.useEffect)(()=>{e.onRender=(l,I)=>{S.unstable_batchedUpdates(()=>{l.topics&&T(l.topics),r(()=>I),(l.didSeek??!1)&&ue.clear(),l.currentFrame&&ue.setCurrentFrame(l.currentFrame),l.colorScheme&&ve(l.colorScheme)})}},[e,ue]);const k=(0,s.useMemo)(()=>c.filter(l=>pe(l,Oe)),[c]);(0,s.useEffect)(()=>{const l=(0,ee.N)(f).cameraTopic;if(l==null||l===""){const I=k[0];I&&I.name!==""&&g(L=>({...L,cameraTopic:I.name}))}},[k,f]);const oe=(0,s.useCallback)(l=>{const I=(0,Ee.A8)(l,c,Le),L=(0,Ee.Lu)(v,I);g(Q=>({...Q,cameraTopic:l,enabledMarkerTopics:L}))},[v,c]),ae=(0,s.useMemo)(()=>(0,Ee.A8)(f.cameraTopic,c,Le),[f.cameraTopic,c]),J=(0,s.useCallback)(l=>{if(l.action!=="update")return;const{path:I,value:L}=l.payload;g((0,O.ZP)(Q=>{if(I[0]==="markers"){const x=I[1]??"unknown",V=L===!0?(0,P.union)(Q.enabledMarkerTopics,[x]):(0,P.difference)(Q.enabledMarkerTopics,[x]);Q.enabledMarkerTopics=V}else(0,P.set)(Q,I.slice(1),L)})),I[1]==="cameraTopic"&&typeof L=="string"&&oe(L)},[oe]),ye=(0,s.useMemo)(()=>c.filter(l=>pe(l,Ne)).map(l=>l.name),[c]);(0,s.useEffect)(()=>{e.updatePanelSettingsEditor({actionHandler:J,nodes:Hn({config:f,imageTopics:k,markerTopics:ye,enabledMarkerTopics:v,relatedMarkerTopics:ae})})},[J,f,v,k,ye,ae,e]);const Ie=(0,s.useRef)(B);(0,s.useEffect)(()=>{Ie.current=B},[B]);const Ce=(0,s.useCallback)(async()=>{if(!Ie.current)return;const l=k.find(I=>I.name===d);l&&await wn(Ie.current,l,f)},[k,d,f]),W=(0,s.useCallback)(()=>[{type:"item",label:"Download image",onclick:Ce},{type:"divider"},{type:"item",label:"Flip horizontal",onclick:()=>g(l=>({...l,flipHorizontal:!(l.flipHorizontal??!1)}))},{type:"item",label:"Flip vertical",onclick:()=>g(l=>({...l,flipVertical:!(l.flipVertical??!1)}))},{type:"item",label:"Rotate 90\xB0",onclick:()=>g(l=>({...l,rotation:((l.rotation??0)+90)%360}))}],[Ce]),Se=(0,s.useMemo)(()=>({markers:de,transformMarkers:z,cameraInfo:X?.toJSON?.()??X}),[de,X,z]),We=(0,s.useCallback)(l=>g(I=>({...I,...l})),[g]);(0,s.useEffect)(()=>{o()},[o]);const xe=(0,s.useCallback)(()=>()=>{},[]);return(0,t.jsx)(ke.Z,{isDark:Be==="dark",children:(0,t.jsxs)(y.Z,{flex:"auto",overflow:"hidden",fullWidth:!0,fullHeight:!0,position:"relative",className:n(i.root,{[i.screenshotTest]:(0,Pe.Z)()}),children:[(0,t.jsx)($,{itemsForClickPosition:W}),(0,t.jsxs)(y.Z,{fullWidth:!0,fullHeight:!0,children:[(0,t.jsx)(un,{topic:w,image:B,rawMarkerData:Se,config:f,saveConfig:We,onStartRenderImage:xe,setActivePixelData:te}),!B&&(0,t.jsx)(fn,{cameraTopic:d,markerTopics:v,shouldSynchronize:Z}),B&&(0,t.jsx)(C.Z,{className:i.timestamp,fontFamily:ne.R.MONOSPACE,variant:"caption",align:"right",children:(0,Te.Eo)(B.stamp)})]}),(0,t.jsx)(In,{pixelData:le})]})})}const qe={cameraTopic:"",enabledMarkerTopics:[],mode:"fit",pan:{x:0,y:0},rotation:0,synchronize:!1,transformMarkers:!1,zoom:1};function Un(e,i){return S.render((0,t.jsx)(s.StrictMode,{children:(0,t.jsx)(Y.o,{onError:e,children:(0,t.jsx)(Kn,{context:i})})}),i.panelElement),()=>{S.unmountComponentAtNode(i.panelElement)}}function De(e){const i=(0,H.iY)(),n=(0,s.useMemo)(()=>Un.bind(void 0,i),[i]);return(0,t.jsx)(F._,{config:e.config,saveConfig:e.saveConfig,initPanel:n})}De.panelType="ImageViewPanel",De.defaultConfig=qe;const Yn=(0,_.Z)(De)},9459:(fe,b,a)=>{a.d(b,{A0:()=>H,A8:()=>_,AX:()=>C,KS:()=>P,Lu:()=>F,Y5:()=>s});var t=a(31953);function s(m,u,p){let h=u.width/m.width;const E=m.height*h;return p==="fit"&&E>u.height&&(h=u.height/m.height),p==="fill"&&E<u.height&&(h=u.height/m.height),p==="other"&&(h=1),h}function S(m,u){const p=m.toString(16);return"0".repeat(u-p.length)+p}function H(m){return S(m,6)}function Y(m){if(!(m.length<4||m[3]!==255))return(m[0]<<16)+(m[1]<<8)+m[2]}function _(m,u,p){const h=[],E=O(m);for(const{name:R,schemaName:$}of u)E&&R.startsWith(E+"/")&&$!=null&&p.includes($)&&h.push(R);return h.sort()}function F(m,u){return u.filter(p=>m.some(h=>p.endsWith(h.split("/").pop())))}function C(m){const u=O(m);if(u)return`${u}/camera_info`}function O(m){let u=m.split("/");return u.pop(),u=u.filter(p=>p!=="old"),u.length>1?u.join("/"):void 0}function P(m){const{markers:u,transformMarkers:p,cameraInfo:h}=m;if(u.length===0)return{markers:u,cameraModel:void 0,originalHeight:void 0,originalWidth:void 0};let E;if(p){if(!h)return;E=new t.HL(h)}return{markers:u,cameraModel:E,originalWidth:h?.width,originalHeight:h?.height}}},29176:(fe,b,a)=>{a.d(b,{Z:()=>S});var t=a(45415),s=a.n(t);function S(){return navigator.userAgent.includes("PuppeteerTestingChrome")||s()()}},43185:(fe,b,a)=>{a.d(b,{Z:()=>O});var t=a(12982),s=a.n(t),S=a(829),H=a.n(S),Y=a(45243),_=a(42146);function F(P){P.receive("sendNotification",({message:m,details:u,type:p,severity:h})=>{(0,_.ZP)(m,u,p,h)})}function C(P){F(P)}class O{constructor(m,u){this._createWorker=m,this._maxWorkerCount=u,this._workerStates=new Array(u),this._allListeners=new Set}testing_workerCount(){return this._workerStates.filter(Boolean).length}testing_getWorkerState(m){return this._workerStates.find(u=>u?.listenerIds.includes(m))}registerWorkerListener(m){if(this._allListeners.has(m))throw new Error("cannot register the same listener id twice");if(this._allListeners.add(m),this._workerStates.filter(Boolean).length<this._maxWorkerCount){const E=this._createWorker(),R=new Y.Z(E);C(R);const $=s()(this._workerStates,y=>!y);return this._workerStates[$]={worker:E,rpc:R,listenerIds:[m]},R}const h=H()(this._workerStates.filter(Boolean),E=>E?.listenerIds.length)[0];if(!h)throw new Error("no worker state");return h.listenerIds.push(m),h.rpc}unregisterWorkerListener(m){if(!this._allListeners.has(m))throw new Error("Cannot find listener to unregister");this._allListeners.delete(m);const u=s()(this._workerStates,h=>h?h.listenerIds.includes(m):!1),p=this._workerStates[u];u>=0&&p&&(p.listenerIds=p.listenerIds.filter(h=>h!==m),p.listenerIds.length===0&&(this._workerStates[u]=void 0,p.worker.terminate(),p.rpc.terminate()))}}}}]);

//# sourceMappingURL=7802.899edf5fed892ea2c0db.js.map