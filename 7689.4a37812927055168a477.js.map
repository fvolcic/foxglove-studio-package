{"version":3,"file":"7689.4a37812927055168a477.js","mappings":"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","sources":["webpack:///../../packages/studio-base/src/styles/assets/inter.css","webpack:///../../packages/studio-base/src/styles/assets/plex-mono.css","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/grammar.ne","webpack:///../../packages/den/async/LazilyInitialized.ts","webpack:///../../packages/den/async/MutexLocked.ts","webpack:///../../packages/den/async/debouncePromise.ts","webpack:///../../packages/den/async/Condvar.ts","webpack:///../../packages/den/collection/ArrayMap.ts","webpack:///../../packages/den/collection/MultiMap.ts","webpack:///../../packages/den/collection/VecQueue.ts","webpack:///../../packages/den/collection/binarySearch.ts","webpack:///../../packages/den/collection/filterMap.ts","webpack:///../../packages/den/collection/minIndexBy.ts","webpack:///../../packages/hooks/src/useRethrow.ts","webpack:///../../packages/hooks/src/useShallowMemo.ts","webpack:///../../packages/hooks/src/useVisibilityState.ts","webpack:///../../packages/hooks/src/useMustNotChange.ts","webpack:///../../packages/hooks/src/useValueChangedDebugLog.ts","webpack:///../../packages/hooks/src/useCrash.ts","webpack:///../../packages/studio-base/src/AppSetting.ts","webpack:///../../packages/studio-base/src/PanelAPI/useDataSourceInfo.ts","webpack:///../../packages/studio-base/src/PanelAPI/useMessageReducer.ts","webpack:///../../packages/studio-base/src/util/concatAndTruncate.ts","webpack:///../../packages/studio-base/src/PanelAPI/useMessagesByTopic.ts","webpack:///../../packages/studio-base/src/PanelAPI/useBlocksByTopic.ts","webpack:///../../packages/studio-base/src/PanelAPI/useConfigById.ts","webpack:///../../packages/studio-base/src/components/ReactWindowListboxAdapter.tsx","webpack:///../../packages/studio-base/src/components/Autocomplete.tsx","webpack:///../../packages/studio-base/src/components/CopyButton.tsx","webpack:///../../packages/studio-base/src/hooks/useTopicPublishFrequences.ts","webpack:///../../packages/studio-base/src/components/DirectTopicStatsUpdater.tsx","webpack:///../../packages/studio-base/src/components/EmptyPanelLayout.tsx","webpack:///../../packages/studio-base/src/components/EmptyState.tsx","webpack:///../../packages/studio-base/src/components/ErrorBoundary.tsx","webpack:///../../packages/studio-base/src/components/ErrorDisplay.tsx","webpack:///../../packages/studio-base/src/components/HoverableIconButton.tsx","webpack:///../../packages/studio-base/src/util/validators.ts","webpack:///../../packages/studio-base/src/components/JsonInput.tsx","webpack:///../../packages/studio-base/src/components/KeyListener.tsx","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/MessagePathInput.tsx","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/isTypicalFilterName.ts","webpack:///../../packages/studio-base/src/util/naturalSort.ts","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/constants.ts","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/messagePathsForDatatype.ts","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/parseRosPath.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/MessageOrderTracker.ts","webpack:///../../packages/studio-base/src/util/promiseTimeout.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/pauseFrameForPromise.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/store.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/index.tsx","webpack:///../../packages/studio-base/src/components/MosaicPathContext.ts","webpack:///../../packages/studio-base/src/components/PanelErrorBoundary.tsx","webpack:///../../packages/studio-base/src/hooks/usePanelDrag.tsx","webpack:///../../packages/studio-base/src/components/Panel.tsx","webpack:///../../packages/studio-base/src/components/PanelContext.ts","webpack:///../../packages/studio-base/src/hooks/useSynchronousMountedState.tsx","webpack:///../../packages/studio-base/src/components/PanelExtensionAdapter/renderState.ts","webpack:///../../packages/studio-base/src/components/PanelExtensionAdapter/PanelExtensionAdapter.tsx","webpack:///../../packages/studio-base/src/components/PanelRemounter.tsx","webpack:///../../packages/studio-base/src/components/UnknownPanel.tsx","webpack:///../../packages/studio-base/src/components/PanelLayout.tsx","webpack:///../../packages/studio-base/src/components/TextHighlight.tsx","webpack:///../../packages/studio-base/src/components/PanelList/index.tsx","webpack:///../../packages/studio-base/src/components/PanelRoot.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/ToolbarIconButton.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/ChangePanelMenu.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/utils.ts","webpack:///../../packages/studio-base/src/components/PanelToolbar/PanelActionsDropdown.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/PanelToolbarControls.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/index.tsx","webpack:///../../packages/studio-base/src/components/TimeBasedChart/HoverBar.tsx","webpack:///../../packages/studio-base/src/components/TimeBasedChart/VerticalBarWrapper.tsx","webpack:///../../packages/studio-base/src/context/AppConfigurationContext.ts","webpack:///../../packages/studio-base/src/hooks/selectWithUnstableIdentityWarning.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/toggleSelectedPanel.ts","webpack:///../../packages/studio-base/src/context/CurrentLayoutContext/index.ts","webpack:///../../packages/studio-base/src/context/CurrentUserContext.ts","webpack:///../../packages/studio-base/src/context/ExtensionCatalogContext.ts","webpack:///../../packages/studio-base/src/context/LayoutManagerContext.ts","webpack:///../../packages/studio-base/src/context/PanelCatalogContext.ts","webpack:///../../packages/studio-base/src/context/PanelStateContext.ts","webpack:///../../packages/studio-base/src/context/TimelineInteractionStateContext.tsx","webpack:///../../packages/studio-base/src/context/UserNodeStateContext.tsx","webpack:///../../packages/studio-base/src/context/UserProfileStorageContext.ts","webpack:///../../packages/studio-base/src/context/WorkspaceContext.ts","webpack:///../../packages/studio-base/src/hooks/useAppTimeFormat.ts","webpack:///../../packages/studio-base/src/hooks/useMemoryInfo.ts","webpack:///../../packages/studio-base/src/hooks/useAppConfigurationValue.ts","webpack:///../../packages/studio-base/src/hooks/useDeepMemo.ts","webpack:///../../packages/studio-base/src/hooks/useGlobalVariables.ts","webpack:///../../packages/studio-base/src/hooks/useGuaranteedContext.ts","webpack:///../../packages/studio-base/src/hooks/useShouldNotChangeOften.ts","webpack:///../../packages/studio-base/src/context/DialogHostIdContext.ts","webpack:///../../packages/studio-base/src/components/GlobalCss.tsx","webpack:///../../packages/studio-base/src/context/EventsContext.ts","webpack:///../../packages/studio-base/src/providers/EventsProvider.tsx","webpack:///../../packages/studio-base/src/context/StudioLogsSettingsContext.ts","webpack:///../../packages/studio-base/src/providers/StudioLogsSettingsProvider/store.ts","webpack:///../../packages/studio-base/src/providers/StudioLogsSettingsProvider/StudioLogsSettingsProvider.tsx","webpack:///../../packages/studio-base/src/providers/TimelineInteractionStateProvider.tsx","webpack:///../../packages/studio-base/src/components/SidebarContent.tsx","webpack:///../../packages/studio-base/src/components/BlockheadFilledIcon.tsx","webpack:///../../packages/studio-base/src/hooks/useConfirm.tsx","webpack:///../../packages/studio-base/src/components/AccountSettingsSidebar/AccountInfo.tsx","webpack:///../../packages/studio-base/src/components/AccountSettingsSidebar/AccountSyncGraphic.tsx","webpack:///../../packages/studio-base/src/components/AccountSettingsSidebar/SigninForm.tsx","webpack:///../../packages/studio-base/src/components/AccountSettingsSidebar/AccountSettings.tsx","webpack:///../../packages/studio-base/src/components/AppBar/constants.ts","webpack:///../../packages/studio-base/src/components/AppBar/AppBarIconButton.tsx","webpack:///../../packages/studio-base/src/components/AppBar/CustomWindowControls.tsx","webpack:///../../packages/studio-base/src/components/FoxgloveLogo.tsx","webpack:///../../packages/studio-base/src/components/MemoryUseIndicator.tsx","webpack:///../../packages/studio-base/src/services/NullAnalytics.ts","webpack:///../../packages/studio-base/src/context/AnalyticsContext.ts","webpack:///../../packages/studio-base/src/context/AppContext.ts","webpack:///../../packages/studio-base/src/services/IAnalytics.ts","webpack:///../../packages/studio-base/src/hooks/useAddPanel.ts","webpack:///../../packages/studio-base/src/components/AppBar/AddPanelMenu.tsx","webpack:///../../packages/studio-base/src/components/NotificationModal.tsx","webpack:///../../packages/studio-base/src/components/DataSourceSidebar/ProblemsList.tsx","webpack:///../../packages/studio-base/src/components/TextMiddleTruncate.tsx","webpack:///../../packages/studio-base/src/components/AppBar/DataSource.tsx","webpack:///../../packages/studio-base/src/components/AppBar/UserMenu.tsx","webpack:///../../packages/studio-base/src/components/AppBar/index.tsx","webpack:///../../packages/studio-base/src/components/HighlightedText.tsx","webpack:///../../packages/studio-base/src/components/DataSourceSidebar/EventView.tsx","webpack:///../../packages/studio-base/src/components/DataSourceSidebar/EventsList.tsx","webpack:///../../packages/studio-base/src/components/WssErrorModal.tsx","webpack:///../../packages/studio-base/src/components/DataSourceSidebar/TopicList.tsx","webpack:///../../packages/studio-base/src/components/Timestamp.tsx","webpack:///../../packages/studio-base/src/components/MultilineMiddleTruncate.tsx","webpack:///../../packages/studio-base/src/components/DataSourceInfoView.tsx","webpack:///../../packages/studio-base/src/components/DataSourceSidebar/DataSourceSidebar.tsx","webpack:///../../packages/studio-base/src/components/DropOverlay.tsx","webpack:///../../packages/studio-base/src/components/DocumentDropListener.tsx","webpack:///../../packages/studio-base/src/context/LinkHandlerContext.ts","webpack:///../../packages/studio-base/src/components/TextContent.tsx","webpack:///../../packages/studio-base/src/context/ExtensionMarketplaceContext.ts","webpack:///../../packages/studio-base/src/components/ExtensionDetails.tsx","webpack:///../../packages/studio-base/src/components/ExtensionsSettings/index.tsx","webpack:///../../packages/studio-base/src/components/LayoutBrowser/SignInPrompt.tsx","webpack:///../../packages/studio-base/src/components/LayoutBrowser/UnsavedChangesPrompt.tsx","webpack:///../../packages/studio-base/src/context/LayoutStorageDebuggingContext.ts","webpack:///../../packages/studio-base/src/hooks/useCallbackWithToast.ts","webpack:///../../packages/studio-base/src/hooks/usePrompt.tsx","webpack:///../../packages/studio-base/src/services/ILayoutStorage.ts","webpack:///../../packages/studio-base/src/util/showOpenFilePicker.tsx","webpack:///../../packages/studio-base/src/components/LayoutBrowser/LayoutRow.tsx","webpack:///../../packages/studio-base/src/components/LayoutBrowser/LayoutSection.tsx","webpack:///../../packages/studio-base/src/components/LayoutBrowser/reducer.ts","webpack:///../../packages/studio-base/src/components/LayoutBrowser/index.tsx","webpack:///../../packages/studio-base/src/components/MultiProvider.tsx","webpack:///../../packages/studio-base/src/components/OpenDialog/Snow.tsx","webpack:///../../packages/studio-base/src/context/PlayerSelectionContext.ts","webpack:///../../packages/studio-base/src/components/BlockheadIcon.tsx","webpack:///../../packages/studio-base/src/assets/database-settings.svg","webpack:///../../packages/studio-base/src/assets/panel-layout.svg","webpack:///../../packages/studio-base/src/assets/panel-settings.svg","webpack:///../../packages/studio-base/src/theme/icons.tsx","webpack:///../../packages/studio-base/src/components/BuiltinIcon.tsx","webpack:///../../packages/studio-base/src/components/OpenDialog/FormField.tsx","webpack:///../../packages/studio-base/src/components/OpenDialog/View.tsx","webpack:///../../packages/studio-base/src/components/OpenDialog/Connection.tsx","webpack:///../../packages/studio-base/src/components/FoxgloveLogoText.tsx","webpack:///../../packages/studio-base/src/components/OpenDialog/Start.tsx","webpack:///../../packages/studio-base/src/components/OpenDialog/useOpenFile.tsx","webpack:///../../packages/studio-base/src/components/OpenDialog/OpenDialog.tsx","webpack:///../../packages/studio-base/src/components/PanelSettings/ActionMenu.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorPickerControl.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorSwatch.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorPickerInput.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorGradientInput.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/NumberInput.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/Vec2Input.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/Vec3Input.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/FieldEditor.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/icons.ts","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/NodeActionsMenu.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/VisibilityToggle.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/utils.ts","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/NodeEditor.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/index.tsx","webpack:///../../packages/studio-base/src/components/ShareJsonModal.tsx","webpack:///../../packages/studio-base/src/components/PanelSettings/index.tsx","webpack:///../../packages/studio-base/src/components/CreateEventDialog.tsx","webpack:///../../packages/studio-base/src/components/EventIcon.tsx","webpack:///../../packages/studio-base/src/components/EventOutlinedIcon.tsx","webpack:///../../packages/studio-base/src/components/LoopIcon.tsx","webpack:///../../packages/studio-base/src/components/PlaybackSpeedControls.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackTimeDisplayMethod.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackTimeDisplay.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/RepeatAdapter.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/EventsOverlay.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackBarHoverTicks.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackControlsTooltipContent.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/ProgressPlot.tsx","webpack:///../../packages/den/math/utils.ts","webpack:///../../packages/studio-base/src/components/PlaybackControls/Slider.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/Scrubber.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/sharedHelpers.ts","webpack:///../../packages/studio-base/src/components/PlaybackControls/index.tsx","webpack:///../../packages/studio-base/src/components/RemountOnValueChange.tsx","webpack:///../../packages/studio-base/src/components/AppBar/HelpMenu.tsx","webpack:///../../packages/studio-base/src/components/Sidebars/NewSidebar.tsx","webpack:///../../packages/studio-base/src/components/Sidebars/TabSpacer.tsx","webpack:///../../packages/studio-base/src/components/Sidebars/index.tsx","webpack:///../../packages/studio-base/src/components/SignInFormModal.tsx","webpack:///../../packages/studio-base/src/components/StudioLogsSettings/useStudioLogsSettingsTree.ts","webpack:///../../packages/studio-base/src/components/StudioLogsSettings/StudioLogsSettings.tsx","webpack:///../../packages/studio-base/src/util/appURLState.ts","webpack:///../../packages/studio-base/src/hooks/useStateToURLSynchronization.ts","webpack:///../../packages/studio-base/src/components/URLStateSyncAdapter.tsx","webpack:///../../packages/studio-base/src/components/SyncAdapters.tsx","webpack:///../../packages/studio-base/src/components/VariablesList/Variable.tsx","webpack:///../../packages/studio-base/src/components/VariablesList/index.tsx","webpack:///../../packages/studio-base/src/OsContextSingleton.ts","webpack:///../../packages/studio-base/src/components/ExperimentalFeatureSettings.tsx","webpack:///../../packages/studio-base/src/types/LaunchPreferenceValue.ts","webpack:///../../packages/studio-base/src/components/PreferencesDialog/settings.tsx","webpack:///../../packages/studio-base/src/components/PreferencesDialog/PreferencesDialog.tsx","webpack:///../../packages/studio-base/src/components/WorkspaceDialogs.tsx","webpack:///../../packages/studio-base/src/context/NativeAppMenuContext.ts","webpack:///../../packages/studio-base/src/hooks/useCalloutDismissalBlocker.ts","webpack:///../../packages/studio-base/src/hooks/useSessionStorageValue.ts","webpack:///../../packages/studio-base/src/hooks/useDefaultWebLaunchPreference.ts","webpack:///../../packages/studio-base/src/hooks/useElectronFilesToOpen.ts","webpack:///../../packages/studio-base/src/hooks/useInitialDeepLinkState.ts","webpack:///../../packages/studio-base/src/hooks/useNativeAppMenuEvent.ts","webpack:///../../packages/studio-base/src/providers/WorkspaceContextProvider.tsx","webpack:///../../packages/studio-base/src/Workspace.tsx","webpack:///../../packages/studio-base/src/components/ColorSchemeThemeProvider.tsx","webpack:///../../packages/studio-base/src/styles/assets/inter.css?1473","webpack:///../../packages/studio-base/src/styles/assets/plex-mono.css?5d61","webpack:///../../packages/studio-base/src/components/CssBaseline.tsx","webpack:///../../packages/studio-base/src/components/DocumentTitleAdapter.tsx","webpack:///../../packages/studio-base/src/context/NativeWindowContext.ts","webpack:///../../packages/studio-base/src/hooks/useIndexedDbRecents.ts","webpack:///../../packages/studio-base/src/hooks/useWarnImmediateReRender.ts","webpack:///../../packages/studio-base/src/players/AnalyticsMetricsCollector.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/MemoizedLibGenerator.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/utils.ts","webpack:///../../packages/studio-base/src/util/basicDatatypes.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/index.ts","webpack:///../../packages/studio-base/src/components/PlayerManager.tsx","webpack:///../../packages/studio-base/src/components/SendNotificationToastAdapter.tsx","webpack:///../../packages/studio-base/src/components/StudioToastProvider.tsx","webpack:///../../packages/studio-base/src/context/LayoutStorageContext.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/defaultLayout.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/index.tsx","webpack:///../../packages/studio-base/src/providers/ExtensionCatalogProvider.tsx","webpack:///../../packages/studio-base/src/providers/ExtensionMarketplaceProvider.tsx","webpack:///../../packages/studio-base/src/context/RemoteLayoutStorageContext.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/NamespacedLayoutStorage.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/WriteThroughLayoutCache.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/compareLayouts.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/computeLayoutSyncOperations.ts","webpack:///../../packages/studio-base/src/services/migrateLegacyToNew3DPanels.ts","webpack:///../../packages/studio-base/src/services/migrateLayout.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/LayoutManager.ts","webpack:///../../packages/studio-base/src/util/delay.ts","webpack:///../../packages/studio-base/src/providers/LayoutManagerProvider.tsx","webpack:///../../packages/studio-base/src/panels/index.ts","webpack:///../../packages/studio-base/src/providers/PanelCatalogProvider.tsx","webpack:///../../packages/studio-base/src/providers/UserProfileLocalStorageProvider.tsx","webpack:///../../packages/studio-base/src/screens/LaunchPreferenceScreen.tsx","webpack:///../../packages/studio-base/src/screens/LaunchingInDesktopScreen.tsx","webpack:///../../packages/studio-base/src/screens/LaunchPreference.tsx","webpack:///../../packages/studio-base/src/App.tsx","webpack:///../../packages/studio-base/src/util/installDevtoolsFormatters.ts","webpack:///../../packages/studio-base/src/util/waitForFonts.ts","webpack:///../../packages/studio-base/src/i18n/en/preferences.ts","webpack:///../../packages/studio-base/src/i18n/en/general.ts","webpack:///../../packages/studio-base/src/i18n/en/panels.ts","webpack:///../../packages/studio-base/src/i18n/en/addPanel.ts","webpack:///../../packages/studio-base/src/i18n/en/panelSettings.ts","webpack:///../../packages/studio-base/src/i18n/en/log.ts","webpack:///../../packages/studio-base/src/i18n/en/plot.ts","webpack:///../../packages/studio-base/src/i18n/en/dataSourceInfo.ts","webpack:///../../packages/studio-base/src/i18n/en/openDialog.ts","webpack:///../../packages/studio-base/src/i18n/en/settingsEditor.ts","webpack:///../../packages/studio-base/src/i18n/en/threeDee.ts","webpack:///../../packages/studio-base/src/i18n/en/appBar.ts","webpack:///../../packages/studio-base/src/i18n/zh/preferences.ts","webpack:///../../packages/studio-base/src/i18n/zh/general.ts","webpack:///../../packages/studio-base/src/i18n/zh/panels.ts","webpack:///../../packages/studio-base/src/i18n/zh/addPanel.ts","webpack:///../../packages/studio-base/src/i18n/zh/panelSettings.ts","webpack:///../../packages/studio-base/src/i18n/zh/log.ts","webpack:///../../packages/studio-base/src/i18n/zh/plot.ts","webpack:///../../packages/studio-base/src/i18n/zh/dataSourceInfo.ts","webpack:///../../packages/studio-base/src/i18n/zh/openDialog.ts","webpack:///../../packages/studio-base/src/i18n/zh/settingsEditor.ts","webpack:///../../packages/studio-base/src/i18n/zh/threeDee.ts","webpack:///../../packages/studio-base/src/i18n/zh/appBar.ts","webpack:///../../packages/studio-base/src/i18n/index.ts","webpack:///../../packages/studio-base/src/services/IdbExtensionStorage.ts","webpack:///../../packages/studio-base/src/services/IdbExtensionLoader.ts","webpack:///../../packages/studio-base/src/players/PlayerProblemManager.ts","webpack:///../../packages/studio-base/src/util/rosDatatypesToMessageDefinition.ts","webpack:///../../packages/studio-base/src/players/FoxgloveWebSocketPlayer/JsonMessageWriter.ts","webpack:///../../packages/studio-base/src/players/FoxgloveWebSocketPlayer/WorkerSocketAdapter.ts","webpack:///../../packages/studio-base/src/players/FoxgloveWebSocketPlayer/index.ts","webpack:///../../packages/studio-base/src/dataSources/FoxgloveWebSocketDataSourceFactory.ts","webpack:///../../packages/studio-base/src/players/NoopMetricsCollector.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/IteratorCursor.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/BlockLoader.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/CachingIterableSource.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/BufferedIterableSource.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/IterablePlayer.ts","webpack:///../../packages/comlink-transfer-handlers/src/abortSignalTransferHandler.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/WorkerIterableSource.ts","webpack:///../../packages/studio-base/src/dataSources/Ros1LocalBagDataSourceFactory.ts","webpack:///../../packages/studio-base/src/players/Ros1Player.ts","webpack:///../../packages/studio-base/src/dataSources/Ros1SocketDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/Ros2LocalBagDataSourceFactory.ts","webpack:///../../packages/studio-base/src/players/Ros2Player.ts","webpack:///../../packages/studio-base/src/dataSources/Ros2SocketDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/Ros2UnavailableDataSourceFactory.tsx","webpack:///../../packages/studio-base/src/util/bagConnectionsHelper.ts","webpack:///../../packages/studio-base/src/players/RosbridgePlayer.ts","webpack:///../../packages/studio-base/src/dataSources/RosbridgeDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/UlogLocalDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/RemoteDataSourceFactory.ts","webpack:///../../packages/studio-base/src/players/VelodynePlayer.ts","webpack:///../../packages/studio-base/src/dataSources/VelodyneDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/McapLocalDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/SampleNuscenesDataSourceFactory.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/camera.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/nodeTransformerWorker/generateTypesLib.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/nodeTransformerWorker/typescript/ros.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/nodeTransformerWorker/typescript/userUtils/time.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/types.ts","webpack:///../../packages/studio-base/src/players/types.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/reducers.ts","webpack:///../../packages/studio-base/src/providers/PanelStateContextProvider.tsx","webpack:///../../packages/studio-base/src/reportError.ts","webpack:///../../packages/studio-base/src/theme/ThemeProvider.tsx","webpack:///../../packages/studio-base/src/util/Rpc.ts","webpack:///../../packages/studio-base/src/util/assertNever.ts","webpack:///../../packages/studio-base/src/util/clipboard.ts","webpack:///../../packages/studio-base/src/util/download.ts","webpack:///../../packages/studio-base/src/util/errors.ts","webpack:///../../packages/studio-base/src/util/parseFuzzyRosTime.ts","webpack:///../../packages/studio-base/src/util/formatTime.ts","webpack:///../../packages/studio-base/src/util/globalConstants.ts","webpack:///../../packages/studio-base/src/util/isDesktopApp.ts","webpack:///../../packages/studio-base/src/util/layout.ts","webpack:///../../packages/studio-base/src/util/maybeCast.ts","webpack:///../../packages/studio-base/src/util/mightActuallyBePartial.ts","webpack:///../../packages/studio-base/src/util/overwriteFetch.ts","webpack:///../../packages/studio-base/src/util/process.ts","webpack:///../../packages/studio-base/src/util/selectors.ts","webpack:///../../packages/studio-base/src/util/sendNotification.ts","webpack:///../../packages/studio-base/src/util/setImmediate.ts","webpack:///../../packages/studio-base/src/util/time.ts","webpack:///../../packages/studio-base/src/util/workers.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_GET_URL_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/getUrl.js\";\nvar ___CSS_LOADER_URL_IMPORT_0___ = new URL(\"@foxglove/studio-base/styles/assets/Inter-Italic.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_1___ = new URL(\"@foxglove/studio-base/styles/assets/Inter-MediumItalic.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_2___ = new URL(\"@foxglove/studio-base/styles/assets/Inter-SemiBoldItalic.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_3___ = new URL(\"@foxglove/studio-base/styles/assets/Inter-Regular.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_4___ = new URL(\"@foxglove/studio-base/styles/assets/Inter-Medium.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_5___ = new URL(\"@foxglove/studio-base/styles/assets/Inter-SemiBold.woff2\", import.meta.url);\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);\nvar ___CSS_LOADER_URL_REPLACEMENT_1___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_1___);\nvar ___CSS_LOADER_URL_REPLACEMENT_2___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_2___);\nvar ___CSS_LOADER_URL_REPLACEMENT_3___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_3___);\nvar ___CSS_LOADER_URL_REPLACEMENT_4___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_4___);\nvar ___CSS_LOADER_URL_REPLACEMENT_5___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_5___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"@font-face{font-family:Inter;font-style:italic;font-weight:400;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:italic;font-weight:500;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_1___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:italic;font-weight:600;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_2___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:400;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_3___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:500;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_4___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:600;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_5___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./../../packages/studio-base/src/styles/assets/inter.css\"],\"names\":[],\"mappings\":\"AAAA,WACE,iBAAA,CACA,iBAAA,CACA,eAAA,CACA,2DAAA,CAEA,wJAAA,CAGF,WACE,iBAAA,CACA,iBAAA,CACA,eAAA,CACA,2DAAA,CAEA,wJAAA,CAGF,WACE,iBAAA,CACA,iBAAA,CACA,eAAA,CACA,2DAAA,CAEA,wJAAA,CAIF,WACE,iBAAA,CACA,iBAAA,CACA,eAAA,CACA,2DAAA,CAEA,wJAAA,CAGF,WACE,iBAAA,CACA,iBAAA,CACA,eAAA,CACA,2DAAA,CAEA,wJAAA,CAGF,WACE,iBAAA,CACA,iBAAA,CACA,eAAA,CACA,2DAAA,CAEA,wJAAA\",\"sourcesContent\":[\"@font-face {\\n  font-family: \\\"Inter\\\";\\n  font-style: italic;\\n  font-weight: 400;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/Inter-Italic.woff2\\\") format(\\\"woff2\\\");\\n  /* latin */\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n@font-face {\\n  font-family: \\\"Inter\\\";\\n  font-style: italic;\\n  font-weight: 500;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/Inter-MediumItalic.woff2\\\") format(\\\"woff2\\\");\\n  /* latin */\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n@font-face {\\n  font-family: \\\"Inter\\\";\\n  font-style: italic;\\n  font-weight: 600;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/Inter-SemiBoldItalic.woff2\\\") format(\\\"woff2\\\");\\n  /* latin */\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n\\n@font-face {\\n  font-family: \\\"Inter\\\";\\n  font-style: normal;\\n  font-weight: 400;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/Inter-Regular.woff2\\\") format(\\\"woff2\\\");\\n  /* latin */\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n@font-face {\\n  font-family: \\\"Inter\\\";\\n  font-style: normal;\\n  font-weight: 500;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/Inter-Medium.woff2\\\") format(\\\"woff2\\\");\\n  /* latin */\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n@font-face {\\n  font-family: \\\"Inter\\\";\\n  font-style: normal;\\n  font-weight: 600;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/Inter-SemiBold.woff2\\\") format(\\\"woff2\\\");\\n  /* latin */\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_GET_URL_IMPORT___ from \"../../../../../node_modules/css-loader/dist/runtime/getUrl.js\";\nvar ___CSS_LOADER_URL_IMPORT_0___ = new URL(\"@foxglove/studio-base/styles/assets/PlexMono-Italic.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_1___ = new URL(\"@foxglove/studio-base/styles/assets/PlexMono-BoldItalic.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_2___ = new URL(\"@foxglove/studio-base/styles/assets/PlexMono.woff2\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_3___ = new URL(\"@foxglove/studio-base/styles/assets/PlexMono-Bold.woff2\", import.meta.url);\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);\nvar ___CSS_LOADER_URL_REPLACEMENT_1___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_1___);\nvar ___CSS_LOADER_URL_REPLACEMENT_2___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_2___);\nvar ___CSS_LOADER_URL_REPLACEMENT_3___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_3___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"@font-face{font-family:IBM Plex Mono;font-style:italic;font-weight:400;font-display:swap;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:IBM Plex Mono;font-style:italic;font-weight:600;font-display:swap;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_1___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:IBM Plex Mono;font-style:normal;font-weight:400;font-display:swap;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_2___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:IBM Plex Mono;font-style:normal;font-weight:600;font-display:swap;src:url(\" + ___CSS_LOADER_URL_REPLACEMENT_3___ + \") format(\\\"woff2\\\");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./../../packages/studio-base/src/styles/assets/plex-mono.css\"],\"names\":[],\"mappings\":\"AACA,WACE,yBAAA,CACA,iBAAA,CACA,eAAA,CACA,iBAAA,CACA,2DAAA,CACA,wJAAA,CAIF,WACE,yBAAA,CACA,iBAAA,CACA,eAAA,CACA,iBAAA,CACA,2DAAA,CACA,wJAAA,CAIF,WACE,yBAAA,CACA,iBAAA,CACA,eAAA,CACA,iBAAA,CACA,2DAAA,CACA,wJAAA,CAIF,WACE,yBAAA,CACA,iBAAA,CACA,eAAA,CACA,iBAAA,CACA,2DAAA,CACA,wJAAA\",\"sourcesContent\":[\"/* latin */\\n@font-face {\\n  font-family: \\\"IBM Plex Mono\\\";\\n  font-style: italic;\\n  font-weight: 400;\\n  font-display: swap;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/PlexMono-Italic.woff2\\\") format(\\\"woff2\\\");\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n/* latin */\\n@font-face {\\n  font-family: \\\"IBM Plex Mono\\\";\\n  font-style: italic;\\n  font-weight: 600;\\n  font-display: swap;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/PlexMono-BoldItalic.woff2\\\") format(\\\"woff2\\\");\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n/* latin */\\n@font-face {\\n  font-family: \\\"IBM Plex Mono\\\";\\n  font-style: normal;\\n  font-weight: 400;\\n  font-display: swap;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/PlexMono.woff2\\\") format(\\\"woff2\\\");\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n/* latin */\\n@font-face {\\n  font-family: \\\"IBM Plex Mono\\\";\\n  font-style: normal;\\n  font-weight: 600;\\n  font-display: swap;\\n  src: url(\\\"@foxglove/studio-base/styles/assets/PlexMono-Bold.woff2\\\") format(\\\"woff2\\\");\\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,\\n    U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Generated automatically by nearley, version unknown\n// http://github.com/Hardmath123/nearley\n(function () {\nfunction id(x) { return x[0]; }\nvar grammar = {\n    Lexer: undefined,\n    ParserRules: [\n    {\"name\": \"main$ebnf$1\", \"symbols\": [\"messagePath\"], \"postprocess\": id},\n    {\"name\": \"main$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"main$ebnf$2\", \"symbols\": [\"modifier\"], \"postprocess\": id},\n    {\"name\": \"main$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"main\", \"symbols\": [\"topicName\", \"main$ebnf$1\", \"main$ebnf$2\"], \"postprocess\": (d) => ({ topicName: d[0].value, topicNameRepr: d[0].repr, messagePath: d[1] || [], modifier: d[2] })},\n    {\"name\": \"id$ebnf$1\", \"symbols\": [/[a-zA-Z0-9_-]/]},\n    {\"name\": \"id$ebnf$1\", \"symbols\": [\"id$ebnf$1\", /[a-zA-Z0-9_-]/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"id\", \"symbols\": [\"id$ebnf$1\"], \"postprocess\": (d) => d[0].join(\"\")},\n    {\"name\": \"integer$ebnf$1\", \"symbols\": [{\"literal\":\"-\"}], \"postprocess\": id},\n    {\"name\": \"integer$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"integer$ebnf$2\", \"symbols\": [/[0-9]/]},\n    {\"name\": \"integer$ebnf$2\", \"symbols\": [\"integer$ebnf$2\", /[0-9]/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"integer\", \"symbols\": [\"integer$ebnf$1\", \"integer$ebnf$2\"], \"postprocess\": (d) => ({ value: BigInt((d[0] ?? \"\") + d[1].join(\"\")), repr: (d[0] ?? \"\") + d[1].join(\"\") })},\n    {\"name\": \"string$ebnf$1\", \"symbols\": []},\n    {\"name\": \"string$ebnf$1\", \"symbols\": [\"string$ebnf$1\", /[^']/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"string\", \"symbols\": [{\"literal\":\"'\"}, \"string$ebnf$1\", {\"literal\":\"'\"}], \"postprocess\": (d) => ({ value: d[1].join(\"\"), repr: `'${d[1].join(\"\")}'` })},\n    {\"name\": \"string$ebnf$2\", \"symbols\": []},\n    {\"name\": \"string$ebnf$2\", \"symbols\": [\"string$ebnf$2\", /[^\"]/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"string\", \"symbols\": [{\"literal\":\"\\\"\"}, \"string$ebnf$2\", {\"literal\":\"\\\"\"}], \"postprocess\": (d) => ({ value: d[1].join(\"\"), repr: `\"${d[1].join(\"\")}\"` })},\n    {\"name\": \"variable$ebnf$1\", \"symbols\": [\"id\"], \"postprocess\": id},\n    {\"name\": \"variable$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"variable\", \"symbols\": [{\"literal\":\"$\"}, \"variable$ebnf$1\"], \"postprocess\": (d, loc) => ({ value: {variableName: d[1] || \"\", startLoc: loc }, repr: `$${d[1] || \"\"}` })},\n    {\"name\": \"value\", \"symbols\": [\"integer\"], \"postprocess\": (d) => d[0]},\n    {\"name\": \"value\", \"symbols\": [\"string\"], \"postprocess\": (d) => d[0]},\n    {\"name\": \"value$string$1\", \"symbols\": [{\"literal\":\"t\"}, {\"literal\":\"r\"}, {\"literal\":\"u\"}, {\"literal\":\"e\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"value\", \"symbols\": [\"value$string$1\"], \"postprocess\": (d) => ({ value: true, repr: \"true\" })},\n    {\"name\": \"value$string$2\", \"symbols\": [{\"literal\":\"f\"}, {\"literal\":\"a\"}, {\"literal\":\"l\"}, {\"literal\":\"s\"}, {\"literal\":\"e\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"value\", \"symbols\": [\"value$string$2\"], \"postprocess\": (d) => ({ value: false, repr: \"false\" })},\n    {\"name\": \"value\", \"symbols\": [\"variable\"], \"postprocess\": (d) => d[0]},\n    {\"name\": \"topicName$ebnf$1\", \"symbols\": [\"slashID\"]},\n    {\"name\": \"topicName$ebnf$1\", \"symbols\": [\"topicName$ebnf$1\", \"slashID\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"topicName\", \"symbols\": [\"topicName$ebnf$1\"], \"postprocess\": (d) => ({ value: d[0].join(\"\"), repr: d[0].join(\"\") })},\n    {\"name\": \"topicName$ebnf$2\", \"symbols\": []},\n    {\"name\": \"topicName$ebnf$2\", \"symbols\": [\"topicName$ebnf$2\", \"slashID\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"topicName\", \"symbols\": [\"id\", \"topicName$ebnf$2\"], \"postprocess\": (d) => ({ value: d[0] + d[1].join(\"\"), repr: d[0] + d[1].join(\"\") })},\n    {\"name\": \"topicName\", \"symbols\": [\"quotedString\"], \"postprocess\": id},\n    {\"name\": \"slashID$ebnf$1\", \"symbols\": [\"id\"], \"postprocess\": id},\n    {\"name\": \"slashID$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"slashID\", \"symbols\": [{\"literal\":\"/\"}, \"slashID$ebnf$1\"], \"postprocess\": (d) => d.join(\"\")},\n    {\"name\": \"quotedString$ebnf$1\", \"symbols\": []},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1\", \"symbols\": [/[^\"\\\\]/]},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1$string$1\", \"symbols\": [{\"literal\":\"\\\\\"}, {\"literal\":\"\\\\\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1\", \"symbols\": [\"quotedString$ebnf$1$subexpression$1$string$1\"], \"postprocess\": d => \"\\\\\"},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1$string$2\", \"symbols\": [{\"literal\":\"\\\\\"}, {\"literal\":\"\\\"\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1\", \"symbols\": [\"quotedString$ebnf$1$subexpression$1$string$2\"], \"postprocess\": d => `\"`},\n    {\"name\": \"quotedString$ebnf$1\", \"symbols\": [\"quotedString$ebnf$1\", \"quotedString$ebnf$1$subexpression$1\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"quotedString\", \"symbols\": [{\"literal\":\"\\\"\"}, \"quotedString$ebnf$1\", {\"literal\":\"\\\"\"}], \"postprocess\": \n        d => ({\n          value: d[1].join(''),\n          repr: `\"${d[1].join('').replace(/[\\\\\"]/g, char => `\\\\${char}`)}\"`\n        })\n          },\n    {\"name\": \"messagePath$ebnf$1\", \"symbols\": []},\n    {\"name\": \"messagePath$ebnf$1\", \"symbols\": [\"messagePath$ebnf$1\", \"messagePathElement\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"messagePath$ebnf$2\", \"symbols\": [{\"literal\":\".\"}], \"postprocess\": id},\n    {\"name\": \"messagePath$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"messagePath\", \"symbols\": [\"messagePath$ebnf$1\", \"messagePath$ebnf$2\"], \"postprocess\": \n        (d) =>\n          d[0]\n            .reduce((acc, arr) => acc.concat(arr), [])\n            .concat(d[1] ? [{ type: \"name\", name: \"\", repr: \"\" }] : [])\n          },\n    {\"name\": \"messagePathElement$ebnf$1\", \"symbols\": [\"slice\"], \"postprocess\": id},\n    {\"name\": \"messagePathElement$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"messagePathElement$ebnf$2\", \"symbols\": [\"filter\"], \"postprocess\": id},\n    {\"name\": \"messagePathElement$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"messagePathElement\", \"symbols\": [{\"literal\":\".\"}, \"name\", \"messagePathElement$ebnf$1\", \"messagePathElement$ebnf$2\"], \"postprocess\": (d) => [d[1], d[2], d[3]].filter(x => x !== null)},\n    {\"name\": \"messagePathElement\", \"symbols\": [\"filter\"], \"postprocess\": id},\n    {\"name\": \"name\", \"symbols\": [\"id\"], \"postprocess\": (d) => ({ type: \"name\", name: d[0], repr: d[0] })},\n    {\"name\": \"name\", \"symbols\": [\"quotedString\"], \"postprocess\": (d) => ({ type: \"name\", name: d[0].value, repr: d[0].repr })},\n    {\"name\": \"sliceVal\", \"symbols\": [\"integer\"], \"postprocess\": (d) => Number(d[0].value)},\n    {\"name\": \"sliceVal\", \"symbols\": [\"variable\"], \"postprocess\": (d) => (d[0].value)},\n    {\"name\": \"slice\", \"symbols\": [{\"literal\":\"[\"}, \"sliceVal\", {\"literal\":\"]\"}], \"postprocess\": (d) => ({ type: \"slice\", start: d[1], end: d[1] })},\n    {\"name\": \"slice$ebnf$1\", \"symbols\": [\"sliceVal\"], \"postprocess\": id},\n    {\"name\": \"slice$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"slice$ebnf$2\", \"symbols\": [\"sliceVal\"], \"postprocess\": id},\n    {\"name\": \"slice$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"slice\", \"symbols\": [{\"literal\":\"[\"}, \"slice$ebnf$1\", {\"literal\":\":\"}, \"slice$ebnf$2\", {\"literal\":\"]\"}], \"postprocess\": (d) => ({ type: \"slice\", start: d[1] === null ? 0 : d[1], end: d[3] === null ? Infinity : d[3] })},\n    {\"name\": \"simplePath$ebnf$1\", \"symbols\": []},\n    {\"name\": \"simplePath$ebnf$1$subexpression$1\", \"symbols\": [{\"literal\":\".\"}, \"id\"]},\n    {\"name\": \"simplePath$ebnf$1\", \"symbols\": [\"simplePath$ebnf$1\", \"simplePath$ebnf$1$subexpression$1\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"simplePath\", \"symbols\": [\"id\", \"simplePath$ebnf$1\"], \"postprocess\": (d) => [d[0]].concat(d[1].map((d) => d[1]))},\n    {\"name\": \"filter$ebnf$1\", \"symbols\": [\"simplePath\"], \"postprocess\": id},\n    {\"name\": \"filter$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"filter\", \"symbols\": [{\"literal\":\"{\"}, \"filter$ebnf$1\", {\"literal\":\"}\"}], \"postprocess\": \n        (d, loc) => ({\n          type: \"filter\",\n          path: d[1] || [],\n          value: undefined,\n          nameLoc: loc+1,\n          valueLoc: loc+1,\n          repr: (d[1] || []).join(\".\"),\n        })\n                    },\n    {\"name\": \"filter$ebnf$2\", \"symbols\": [\"simplePath\"], \"postprocess\": id},\n    {\"name\": \"filter$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"filter$string$1\", \"symbols\": [{\"literal\":\"=\"}, {\"literal\":\"=\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"filter\", \"symbols\": [{\"literal\":\"{\"}, \"filter$ebnf$2\", \"filter$string$1\", \"value\", {\"literal\":\"}\"}], \"postprocess\": \n        (d, loc) => ({\n          type: \"filter\",\n          path: d[1] || [],\n          value: d[3].value,\n          nameLoc: loc+1,\n          valueLoc: loc+1+(d[1] || []).join(\".\").length+d[2].length,\n          repr: `${(d[1] || []).join(\".\")}==${d[3].repr}`,\n        })\n                    },\n    {\"name\": \"modifier$string$1\", \"symbols\": [{\"literal\":\".\"}, {\"literal\":\"@\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"modifier$ebnf$1\", \"symbols\": [\"id\"], \"postprocess\": id},\n    {\"name\": \"modifier$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"modifier\", \"symbols\": [\"modifier$string$1\", \"modifier$ebnf$1\"], \"postprocess\": (d) => d[1] || \"\"}\n]\n  , ParserStart: \"main\"\n}\nif (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {\n   module.exports = grammar;\n} else {\n   window.grammar = grammar;\n}\n})();\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Holds a value generated from a calling a given async function. The function is called at most\n * once and is not called until the first `get()` of the LazilyInitialized object.\n */\nexport default class LazilyInitialized<T> {\n  // The promise and compute function are held separately so the function can be garbage collected\n  // when it is no longer needed.\n  private state: { promise: Promise<T> } | { promise?: undefined; compute: () => Promise<T> };\n\n  public constructor(compute: () => Promise<T>) {\n    this.state = { compute };\n  }\n\n  public async get(): Promise<T> {\n    if (this.state.promise) {\n      return await this.state.promise;\n    }\n    const promise = this.state.compute();\n    this.state = { promise };\n    return await promise;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Mutex } from \"async-mutex\";\n\n/**\n * A wrapper around an object that ensures all accesses are guarded by a mutex lock.\n *\n * This is less race-prone than using an async-mutex directly because it requires all external\n * access to be protected by the mutex.\n */\nexport default class MutexLocked<T> {\n  private mutex = new Mutex();\n  public constructor(private value: T) {}\n\n  public async runExclusive<Result>(body: (value: T) => Promise<Result>): Promise<Result> {\n    return await this.mutex.runExclusive(async () => await body(this.value));\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\ntype DebouncedFn<Args extends unknown[]> = ((...args: Args) => void) & {\n  // the currently executing promise, if any\n  currentPromise?: Promise<void>;\n};\n\n// debouncePromise returns a function which wraps calls to `fn`.\n// The returned debounceFn ensures that only one `fn` call is executing at a time.\n// If debounceFn is called while `fn` is still executing, it will queue the call until the\n// current invocation is complete.\n// If debounceFn is called multiple times while `fn` is still executing, then only the last\n// call's arguments will be saved for the next execution of `fn`.\nexport default function debouncePromise<Args extends unknown[]>(\n  fn: (...args: Args) => Promise<void>,\n): DebouncedFn<Args> {\n  // Whether we are currently waiting for a promise returned by `fn` to resolve.\n  let calling = false;\n  // Whether another call to the debounced function was made while a call was in progress.\n  let callPending: Args | undefined;\n\n  const debouncedFn: DebouncedFn<Args> = (...args: Args) => {\n    if (calling) {\n      callPending = args;\n    } else {\n      start(args);\n    }\n  };\n\n  function start(args: Args) {\n    calling = true;\n    callPending = undefined;\n\n    debouncedFn.currentPromise = fn(...args).finally(() => {\n      calling = false;\n      debouncedFn.currentPromise = undefined;\n      if (callPending) {\n        start(callPending);\n      }\n    });\n  }\n\n  return debouncedFn;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Condvar provides a condition variable interface for async code\n *\n * Callers can wait on the condition variable and other callers can notify any\n * waiters. An example use case could be a producer/consumer queue where the consumer\n * waits for the producer to notify it that there are items to consume.\n *\n * See: https://en.wikipedia.org/wiki/Monitor_(synchronization)#Condition_variables_2\n */\nclass Condvar {\n  private waitQueue: Array<() => void> = [];\n\n  /**\n   * Wait on a notification.\n   *\n   * @return a promise which resolves when notified.\n   *\n   * ```\n   * await condvar.wait();\n   * ```\n   */\n  public async wait(): Promise<void> {\n    await new Promise<void>((resolve) => {\n      this.waitQueue.push(resolve);\n    });\n  }\n\n  /**\n   * Notify one wait.\n   */\n  public notifyOne(): void {\n    const item = this.waitQueue.shift();\n    item?.();\n  }\n\n  /**\n   * Notify all waiting.\n   */\n  public notifyAll(): void {\n    for (const item of this.waitQueue) {\n      item();\n    }\n    this.waitQueue.length = 0;\n  }\n}\n\nexport { Condvar };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * A list of values with type `V` sorted by numeric keys of type `K`\n * (either number or BigInt). Keys are unique, so setting a value with the same\n * key as an existing entry is a replacement operation.\n */\nexport class ArrayMap<K, V> {\n  private _list: [K, V][] = [];\n\n  // eslint-disable-next-line no-restricted-syntax\n  public get size(): number {\n    return this._list.length;\n  }\n\n  public clear(): void {\n    this._list.length = 0;\n  }\n\n  /** Retrieve the key/value tuple at the given index, if it exists. */\n  public at(index: number): [K, V] | undefined {\n    return this._list[index];\n  }\n\n  /**\n   * Store a key/value tuple in the sorted list. If the key already exists, the\n   * previous entry is overwritten.\n   */\n  public set(key: K, value: V): void {\n    const index = this.binarySearch(key);\n    if (index >= 0) {\n      this._list[index]![1] = value;\n    } else {\n      const greaterThanIndex = ~index;\n      const newEntry: [K, V] = [key, value];\n      if (greaterThanIndex >= this._list.length) {\n        this._list.push(newEntry);\n      } else {\n        this._list.splice(greaterThanIndex, 0, newEntry);\n      }\n    }\n  }\n\n  /** Removes the first element and returns it, if available. */\n  public shift(): [K, V] | undefined {\n    return this._list.shift();\n  }\n\n  /** Removes the last element and returns it, if available. */\n  public pop(): [K, V] | undefined {\n    return this._list.pop();\n  }\n\n  /** Removes the element with the given key, if it exists */\n  public remove(key: K): void {\n    const index = this.binarySearch(key);\n    if (index >= 0) {\n      this._list.splice(index, 1);\n    }\n  }\n\n  /** Removes all elements with keys greater than the given key. */\n  public removeAfter(key: K): void {\n    const index = this.binarySearch(key);\n    const greaterThanIndex = index >= 0 ? index + 1 : ~index;\n    this._list.length = greaterThanIndex;\n  }\n\n  /** Removes all elements with keys less than the given key. */\n  public removeBefore(key: K): void {\n    const index = this.binarySearch(key);\n    const lessThanIndex = index >= 0 ? index : ~index;\n    this._list.splice(0, lessThanIndex);\n  }\n\n  /** Access the first key/value tuple in the list, without modifying the list. */\n  public minEntry(): [K, V] | undefined {\n    return this._list[0];\n  }\n\n  /** Access the last key/value tuple in the list, without modifying the list. */\n  public maxEntry(): [K, V] | undefined {\n    return this._list[this._list.length - 1];\n  }\n\n  /** Access the first key in the list, without modifying the list. */\n  public minKey(): K | undefined {\n    return this._list[0]?.[0];\n  }\n\n  /** Access the last key in the list, without modifying the list. */\n  public maxKey(): K | undefined {\n    return this._list[this._list.length - 1]?.[0];\n  }\n\n  /**\n   * Performs a binary search on the sorted list to find the index of the entry\n   * with the given key.\n   * @param key Key to search for.\n   * @returns The index of the key/value tuple if an exact match is found;\n   * otherwise, a negative number. If the key is not found and the key is less\n   * than one or more keys in the list, the negative number returned is the\n   * bitwise complement of the index of the first element with a larger key. If\n   * the key is not found and is greater than all keys in the list, the negative\n   * number returned is the bitwise complement of the index of the last element\n   * plus 1.\n   */\n  public binarySearch(key: K): number {\n    const list = this._list;\n    if (list.length === 0) {\n      return -1;\n    }\n\n    let left = 0;\n    let right = list.length - 1;\n\n    // Quick checks to see if key is outside the bounds of the list\n    if (key < list[left]![0]) {\n      return ~left;\n    } else if (key > list[right]![0]) {\n      return ~(right + 1);\n    }\n\n    while (left <= right) {\n      const mid = (left + right) >> 1;\n      const midKey = list[mid]![0];\n\n      if (midKey === key) {\n        return mid;\n      } else if (key < midKey) {\n        right = mid - 1;\n      } else {\n        left = mid + 1;\n      }\n    }\n\n    return ~left;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * A map that allows multiple values for a single key.\n */\nexport class MultiMap<TKey, TValue> {\n  #map = new Map<TKey, TValue[]>();\n\n  public get(key: TKey): TValue[] | undefined {\n    return this.#map.get(key);\n  }\n\n  public set(key: TKey, value: TValue): void {\n    const values = this.#map.get(key);\n    if (values == undefined) {\n      this.#map.set(key, [value]);\n    } else if (!values.includes(value)) {\n      values.push(value);\n    }\n  }\n\n  public delete(key: TKey, value: TValue): void {\n    const values = this.#map.get(key);\n    if (values != undefined) {\n      const index = values.indexOf(value);\n      if (index >= 0) {\n        values.splice(index, 1);\n        if (values.length === 0) {\n          this.#map.delete(key);\n        }\n      }\n    }\n  }\n\n  public deleteAll(key: TKey): void {\n    this.#map.delete(key);\n  }\n\n  public clear(): void {\n    this.#map.clear();\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * VecQueue provides an interface for a FIFO queue backed by a growing circular buffer.\n *\n * `enqueue` inserts items at the end of the queue (possibly growing the underlying buffer)\n * `dequeue` removes items from the front of the queue\n */\nexport class VecQueue<T> {\n  private readPos = 0;\n  private writePos = 0;\n  private buffer: Array<T | undefined> = new Array(4);\n\n  /**\n   * Add an item at the end of the queue. If the queue is full the underlying buffer is grown.\n   * @param item the item to insert into the queue\n   */\n  public enqueue(item: T): void {\n    // When the write position is past the buffer end, we need to take one of two actions:\n    // 1. If read position is at 0, we grow the array and write to the end\n    // 2. Otherwise, we wrap write to the front and continue writing\n    if (this.writePos >= this.buffer.length) {\n      // Read head is at the start, we will write at the end\n      if (this.readPos === 0) {\n        this.addCapacity();\n      } else {\n        this.writePos = this.writePos % this.buffer.length;\n      }\n    }\n\n    // Read is only 1 away from write, so once the item is written our write head would be at the read head\n    // we can't allow that so we need to add capacity\n    if (this.readPos - this.writePos === 1) {\n      this.addCapacity();\n    }\n\n    // write to position and increment\n    this.buffer[this.writePos] = item;\n    this.writePos++;\n  }\n\n  /**\n   * Remove an item from the front of the queue and return it.\n   * @returns the first item in the queue or undefined if the queue is empty\n   */\n  public dequeue(): T | undefined {\n    if (this.readPos === this.writePos) {\n      return undefined;\n    }\n\n    // Read position may have incremented from a previous read\n    // and we need to maybe wrap it to our size\n    if (this.readPos >= this.buffer.length) {\n      this.readPos = this.readPos % this.buffer.length;\n    }\n\n    const item = this.buffer[this.readPos];\n    this.buffer[this.readPos] = undefined;\n    this.readPos += 1;\n    return item;\n  }\n\n  /**\n   * @returns the number of items in the queue\n   */\n  public size(): number {\n    if (this.writePos >= this.readPos) {\n      return this.writePos - this.readPos;\n    }\n\n    return this.buffer.length - this.readPos + this.writePos;\n  }\n\n  /**\n   * @returns the capacity of the underlying circular buffer\n   */\n  public capacity(): number {\n    return this.buffer.length;\n  }\n\n  /**\n   * Clear the queue.\n   */\n  public clear(): void {\n    this.buffer.length = 0;\n    this.writePos = 0;\n    this.readPos = 0;\n  }\n\n  private addCapacity() {\n    const oldLen = this.buffer.length;\n    this.buffer.length = this.buffer.length * 2;\n\n    // if the read head is before write, then there's no change to index management and write can continue at end\n    // if the read head is ahead of write, then we can un-wrap the write bytes\n    if (this.readPos <= this.writePos) {\n      return;\n    }\n\n    const newLen = this.buffer.length;\n\n    // if writePos is past half it is cheaper to move the read elements\n    if (this.writePos >= oldLen / 2) {\n      const oldCount = oldLen - this.readPos;\n      // move the read elements to the end giving us the most room to write\n      const offset = newLen - oldCount;\n      for (let i = 0; i < oldCount; ++i) {\n        this.buffer[offset + i] = this.buffer[this.readPos + i];\n        this.buffer[this.readPos + i] = undefined;\n      }\n      this.readPos = offset;\n    } else {\n      // copy all the elements from start to writePos - 1 to the end of the extended buffer\n      for (let i = 0; i < this.writePos; ++i) {\n        this.buffer[oldLen + i] = this.buffer[i];\n        this.buffer[i] = undefined;\n      }\n\n      this.writePos = oldLen + this.writePos;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Performs a binary search on a sorted array of tuples to find the index of the entry with the given key.\n *\n * Copied from @foxglove/den/collection ArrayMap\n *\n * @param key Key to search for.\n * @returns The index of the key/value tuple if an exact match is found; otherwise, a negative\n * number. If the key is not found and the key is less than one or more keys in the list, the\n * negative number returned is the bitwise complement of the index of the first element with a\n * larger key. If the key is not found and is greater than all keys in the list, the negative\n * number returned is the bitwise complement of the index of the last element plus 1.\n */\nfunction sortedIndexByTuple<T>(items: [bigint, T][], key: bigint): number {\n  const list = items;\n  if (list.length === 0) {\n    return -1;\n  }\n\n  let left = 0;\n  let right = list.length - 1;\n\n  while (left <= right) {\n    const mid = (left + right) >> 1;\n    const midKey = list[mid]![0];\n\n    if (midKey === key) {\n      return mid;\n    } else if (key < midKey) {\n      right = mid - 1;\n    } else {\n      left = mid + 1;\n    }\n  }\n\n  return ~left;\n}\n\nexport { sortedIndexByTuple };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n/**\n * filterMap creates a new array populated with the results of calling a provided function on every\n * element in the calling array. Results which resolve to a javascript \"false\" value are discarded\n * from the array.\n *\n * This is a more efficient version of [...values].map(mapFn).filter(Boolean) that avoids two\n * iterations of the array.\n */\nexport default function filterMap<T, U>(\n  values: Iterable<T>,\n  mapFn: (arg0: T, arg1: number) => U | undefined,\n): U[] {\n  const results: Array<U> = [];\n  let index = 0;\n  for (const item of values) {\n    const mappedItem = mapFn(item, index++);\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    if (mappedItem) {\n      results.push(mappedItem);\n    }\n  }\n  return results;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * minIndexBy scans a collection and returns the index of the smallest item\n *\n * minIndexBy iterates the collection and calls compare on each item of the collection. If an item\n * compares smaller than another, then its index becomes the smallest index. iteration continues\n * until the end of the collection. The index is then returned.\n *\n * @param collection the collection to scan\n * @param compare function used to compare two items in the collection. A value of < 0 means a < b.\n * @returns the index of the smallest item in the collection or -1 if the collection is empty\n */\nfunction minIndexBy<T>(collection: Array<T>, compare: (itemA: T, itemB: T) => number): number {\n  if (collection.length === 0) {\n    return -1;\n  }\n\n  let minIdx = 0;\n  let minItem = collection[0]!;\n\n  for (let i = 1; i < collection.length; ++i) {\n    const item = collection[i]!;\n    if (compare(item, minItem) < 0) {\n      minIdx = i;\n      minItem = item;\n    }\n  }\n\n  return minIdx;\n}\n\nexport { minIndexBy };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useState } from \"react\";\n\ntype Fn<A extends unknown[], R> = (...args: A) => R;\n\n/**\n * React error boundaries do not catch errors from user event handlers (clicks, etc).\n * This hook wraps a function which may throw, and re-throws the error within a render context.\n * This allows react error boundaries to capture the error.\n *\n * see: https://github.com/facebook/react/issues/11409\n * @param fn function to wrap in a try/catch\n * @returns wrapped fn with the same signature as fn\n */\nexport default function useRethrow<Args extends unknown[], Ret>(\n  fn: Fn<Args, Ret>,\n): Fn<Args, Ret | void> {\n  const [_, setError] = useState(undefined);\n  return useCallback(\n    (...args: Args): Ret | void => {\n      try {\n        return fn(...args);\n      } catch (err) {\n        // throwing within a setError happens within a react render context\n        setError(() => {\n          throw err;\n        });\n      }\n    },\n    [fn],\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useRef } from \"react\";\nimport shallowequal from \"shallowequal\";\n\n/** Continues to return the same instance as long as shallow equality is maintained. */\nexport default function useShallowMemo<T>(value: T): T {\n  const ref = useRef(value);\n  if (shallowequal(value, ref.current)) {\n    return ref.current;\n  }\n  ref.current = value;\n  return value;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useState, useEffect } from \"react\";\n\n/** Returns the value of `document.visibilityState` and tracks changes. */\nexport default function useVisibilityState(): DocumentVisibilityState {\n  const [visibility, setVisibility] = useState(document.visibilityState);\n  useEffect(() => {\n    // Update if state changed between the initial call and this effect\n    setVisibility(document.visibilityState);\n\n    const listener = () => setVisibility(document.visibilityState);\n    document.addEventListener(\"visibilitychange\", listener);\n    return () => document.removeEventListener(\"visibilitychange\", listener);\n  }, []);\n  return visibility;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useRef } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\nconst useMustNotChangeImpl = (value: unknown): void => {\n  const valueRef = useRef<unknown | undefined>(value);\n  if (valueRef.current !== value) {\n    log.error(\"Value must not change\", valueRef.current);\n  }\n  valueRef.current = value;\n};\n\nconst noOpImpl = () => {};\n\n/**\n * useMustNotChange throws if the value provided as the first argument ever changes.\n *\n * Note: In production builds this hook is a no-op.\n *\n */\nconst useMustNotChange = process.env.NODE_ENV !== \"development\" ? noOpImpl : useMustNotChangeImpl;\n\nexport default useMustNotChange;\n\n// for tests\nexport { useMustNotChangeImpl };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useRef, useLayoutEffect } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\nconst noOpImpl = () => {};\n\nfunction useValueChangedDebugLogImpl(value: unknown, msg: string): void {\n  const prevValue = useRef<unknown>(value);\n  if (prevValue.current !== value) {\n    log.debug(`value changed: ${msg}`);\n  }\n  useLayoutEffect(() => {\n    prevValue.current = value;\n  });\n}\n\n/**\n * useValueChangedDebugLog logs `msg` if `value` changes\n *\n * Note: In production builds this hook is a no-op.\n */\nconst useValueChangedDebugLog =\n  process.env.NODE_ENV !== \"development\" && process.env.NODE_ENV !== \"test\"\n    ? noOpImpl\n    : useValueChangedDebugLogImpl;\n\nexport default useValueChangedDebugLog;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useReducer } from \"react\";\n\n// Throwing in a reducer call will make the error catchable by an error boundary.\nfunction reducer(_: unknown, err: Error) {\n  throw err;\n}\n\n/**\n * useCrash returns a function you can call with an Error instance and it will re-throw the instance\n * within the react loop allowing a react error boundary to handle the error.\n *\n * See: https://reactjs.org/docs/error-boundaries.html#how-about-event-handlers\n */\nexport function useCrash(): (err: Error) => void {\n  const [_, dispatch] = useReducer(reducer, undefined);\n  return dispatch;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport enum AppSetting {\n  // General\n  COLOR_SCHEME = \"colorScheme\",\n  TIMEZONE = \"timezone\",\n  TIME_FORMAT = \"time.format\",\n  MESSAGE_RATE = \"messageRate\",\n  UPDATES_ENABLED = \"updates.enabled\",\n  LANGUAGE = \"language\",\n\n  // ROS\n  ROS_PACKAGE_PATH = \"ros.ros_package_path\",\n\n  // Privacy\n  TELEMETRY_ENABLED = \"telemetry.telemetryEnabled\",\n  CRASH_REPORTING_ENABLED = \"telemetry.crashReportingEnabled\",\n\n  // Experimental features\n  SHOW_DEBUG_PANELS = \"showDebugPanels\",\n  ENABLE_LEGACY_PLOT_PANEL = \"enableLegacyPlotPanel\",\n  ENABLE_NEW_TOPNAV = \"enableNewTopNav\",\n  ENABLE_ROS2_NATIVE_DATA_SOURCE = \"enableRos2NativeDataSource\",\n  ENABLE_NEW_IMAGE_PANEL = \"enableNewImagePanel\",\n\n  // Miscellaneous\n  HIDE_SIGN_IN_PROMPT = \"hideSignInPrompt\",\n  LAUNCH_PREFERENCE = \"launchPreference\",\n  SHOW_OPEN_DIALOG_ON_STARTUP = \"ui.open-dialog-startup\",\n\n  // Dev only\n  ENABLE_LAYOUT_DEBUGGING = \"enableLayoutDebugging\",\n  ENABLE_MEMORY_USE_INDICATOR = \"dev.memory-use-indicator\",\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useMemo } from \"react\";\n\nimport { Time } from \"@foxglove/studio\";\nimport {\n  useMessagePipeline,\n  MessagePipelineContext,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\nfunction selectDatatypes(ctx: MessagePipelineContext) {\n  return ctx.datatypes;\n}\n\nfunction selectTopics(ctx: MessagePipelineContext) {\n  return ctx.sortedTopics;\n}\n\nfunction selectStartTime(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData?.startTime;\n}\n\nfunction selectCapabilities(ctx: MessagePipelineContext) {\n  return ctx.playerState.capabilities;\n}\n\nfunction selectPlayerId(ctx: MessagePipelineContext) {\n  return ctx.playerState.playerId;\n}\n\n// Metadata about the source of data currently being displayed.\n// This is not expected to change often, usually when changing data sources.\nexport type DataSourceInfo = {\n  topics: readonly Topic[];\n  datatypes: RosDatatypes;\n  capabilities: string[];\n  startTime?: Time; // Only `startTime`, since `endTime` can change rapidly when connected to a live system.\n  playerId: string;\n};\n\n/**\n * Data source info\" encapsulates **rarely-changing** metadata about the source from which\n * Foxglove Studio is loading data.\n *\n * A data source might be a local file, a remote file, or a streaming source.\n */\nexport function useDataSourceInfo(): DataSourceInfo {\n  const datatypes = useMessagePipeline(selectDatatypes);\n  const topics = useMessagePipeline(selectTopics);\n  const startTime = useMessagePipeline(selectStartTime);\n  const capabilities = useMessagePipeline(selectCapabilities);\n  const playerId = useMessagePipeline(selectPlayerId);\n\n  // we want the returned object to have a stable identity\n  return useMemo<DataSourceInfo>(() => {\n    return {\n      topics,\n      datatypes,\n      capabilities,\n      startTime,\n      playerId,\n    };\n  }, [capabilities, datatypes, playerId, startTime, topics]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useRef, useMemo, useState, useEffect, useCallback } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport Log from \"@foxglove/log\";\nimport {\n  useMessagePipeline,\n  MessagePipelineContext,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport useShouldNotChangeOften from \"@foxglove/studio-base/hooks/useShouldNotChangeOften\";\nimport {\n  MessageEvent,\n  PlayerStateActiveData,\n  SubscribePayload,\n  SubscriptionPreloadType,\n} from \"@foxglove/studio-base/players/types\";\n\nconst log = Log.getLogger(__filename);\n\ntype MessageReducer<T> = (arg0: T, message: MessageEvent<unknown>) => T;\ntype MessagesReducer<T> = (arg0: T, messages: readonly MessageEvent<unknown>[]) => T;\n\ntype Params<T> = {\n  topics: readonly string[];\n  preloadType?: SubscriptionPreloadType;\n\n  // Functions called when the reducers change and for each newly received message.\n  // The object is assumed to be immutable, so in order to trigger a re-render, the reducers must\n  // return a new object.\n  restore: (arg: T | undefined) => T;\n  addMessage?: MessageReducer<T>;\n  addMessages?: MessagesReducer<T>;\n};\n\nfunction selectSetSubscriptions(ctx: MessagePipelineContext) {\n  return ctx.setSubscriptions;\n}\n\nexport function useMessageReducer<T>(props: Params<T>): T {\n  const [id] = useState(() => uuidv4());\n  const { restore, addMessage, addMessages, preloadType = \"partial\" } = props;\n\n  // only one of the add message callbacks should be provided\n  if ([props.addMessage, props.addMessages].filter(Boolean).length !== 1) {\n    throw new Error(\n      \"useMessageReducer must be provided with exactly one of addMessage or addMessages\",\n    );\n  }\n\n  useShouldNotChangeOften(props.restore, () =>\n    log.warn(\n      \"useMessageReducer restore() is changing frequently. \" +\n        \"restore() will be called each time it changes, so a new function \" +\n        \"shouldn't be created on each render. (If you're using Hooks, try useCallback.)\",\n    ),\n  );\n  useShouldNotChangeOften(props.addMessage, () =>\n    log.warn(\n      \"useMessageReducer addMessage() is changing frequently. \" +\n        \"addMessage() will be called each time it changes, so a new function \" +\n        \"shouldn't be created on each render. (If you're using Hooks, try useCallback.)\",\n    ),\n  );\n  useShouldNotChangeOften(props.addMessages, () =>\n    log.warn(\n      \"useMessageReducer addMessages() is changing frequently. \" +\n        \"addMessages() will be called each time it changes, so a new function \" +\n        \"shouldn't be created on each render. (If you're using Hooks, try useCallback.)\",\n    ),\n  );\n\n  const requestedTopics = useShallowMemo(props.topics);\n\n  const subscriptions = useMemo<SubscribePayload[]>(() => {\n    return requestedTopics.map((topic) => ({ topic, preloadType }));\n  }, [preloadType, requestedTopics]);\n\n  const setSubscriptions = useMessagePipeline(selectSetSubscriptions);\n  useEffect(() => setSubscriptions(id, subscriptions), [id, setSubscriptions, subscriptions]);\n  useEffect(() => {\n    return () => {\n      setSubscriptions(id, []);\n    };\n  }, [id, setSubscriptions]);\n\n  const state = useRef<\n    | Readonly<{\n        messageEvents: PlayerStateActiveData[\"messages\"] | undefined;\n        lastSeekTime: number | undefined;\n        reducedValue: T;\n        restore: typeof restore;\n        addMessage: typeof addMessage;\n        addMessages: typeof addMessages;\n      }>\n    | undefined\n  >();\n\n  return useMessagePipeline(\n    useCallback(\n      // To compute the reduced value from new messages:\n      // - Call restore() to initialize state, if lastSeekTime has changed, or if reducers have changed\n      // - Call addMessage() or addMessages() if any new messages of interest have arrived\n      // - Otherwise, return the previous reducedValue so that we don't trigger an unnecessary render.\n      function selectReducedMessages(ctx: MessagePipelineContext): T {\n        const messageEvents = ctx.messageEventsBySubscriberId.get(id);\n        const lastSeekTime = ctx.playerState.activeData?.lastSeekTime;\n\n        let newReducedValue: T;\n        if (!state.current || lastSeekTime !== state.current.lastSeekTime) {\n          newReducedValue = restore(undefined);\n        } else if (\n          restore !== state.current.restore ||\n          addMessage !== state.current.addMessage ||\n          addMessages !== state.current.addMessages\n        ) {\n          newReducedValue = restore(state.current.reducedValue);\n        } else {\n          newReducedValue = state.current.reducedValue;\n        }\n\n        if (\n          messageEvents &&\n          messageEvents.length > 0 &&\n          messageEvents !== state.current?.messageEvents\n        ) {\n          if (addMessages) {\n            if (messageEvents.length > 0) {\n              newReducedValue = addMessages(newReducedValue, messageEvents);\n            }\n          } else if (addMessage) {\n            for (const messageEvent of messageEvents) {\n              newReducedValue = addMessage(newReducedValue, messageEvent);\n            }\n          }\n        }\n\n        state.current = {\n          messageEvents,\n          lastSeekTime,\n          reducedValue: newReducedValue,\n          restore,\n          addMessage,\n          addMessages,\n        };\n\n        return state.current.reducedValue;\n      },\n      [id, addMessage, addMessages, restore],\n    ),\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nexport default function concatAndTruncate<T>(\n  array1: readonly T[],\n  array2: readonly T[],\n  limit: number,\n): T[] {\n  const toTakeFromArray1 = limit - array2.length;\n  const ret = toTakeFromArray1 <= 0 ? [] : array1.slice(-toTakeFromArray1);\n  const toTakeFromArray2 = limit - ret.length;\n  for (let i = Math.max(0, array2.length - toTakeFromArray2); i < array2.length; ++i) {\n    ret.push(array2[i] as T);\n  }\n  return ret;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { groupBy } from \"lodash\";\nimport { useCallback } from \"react\";\n\nimport useDeepMemo from \"@foxglove/studio-base/hooks/useDeepMemo\";\nimport { MessageEvent } from \"@foxglove/studio-base/players/types\";\nimport concatAndTruncate from \"@foxglove/studio-base/util/concatAndTruncate\";\n\nimport { useMessageReducer } from \"./useMessageReducer\";\n\n// Topic types that are not known at compile time\ntype UnknownMessageEventsByTopic = Record<string, readonly MessageEvent<unknown>[]>;\n\n/**\n * useMessagesByTopic makes it easy to request some messages on some topics.\n *\n * Using this hook will cause the panel to re-render when new messages arrive on the requested topics.\n * - During file playback the panel will re-render when the file is playing or when the user is scrubbing.\n * - During live playback the panel will re-render when new messages arrive.\n */\nexport function useMessagesByTopic(params: {\n  topics: readonly string[];\n  historySize: number;\n}): Record<string, readonly MessageEvent<unknown>[]> {\n  const { historySize, topics } = params;\n  const requestedTopics = useDeepMemo(topics);\n\n  const addMessages = useCallback(\n    (\n      prevMessagesByTopic: UnknownMessageEventsByTopic,\n      messages: readonly MessageEvent<unknown>[],\n    ) => {\n      const newMessagesByTopic = groupBy(messages, \"topic\");\n      const ret: UnknownMessageEventsByTopic = { ...prevMessagesByTopic };\n      Object.entries(newMessagesByTopic).forEach(([topic, newMessages]) => {\n        const retTopic = ret[topic];\n        if (retTopic) {\n          ret[topic] = concatAndTruncate(retTopic, newMessages, historySize);\n        }\n      });\n      return ret;\n    },\n    [historySize],\n  );\n\n  const restore = useCallback(\n    (prevMessagesByTopic?: UnknownMessageEventsByTopic) => {\n      const newMessagesByTopic: UnknownMessageEventsByTopic = {};\n      // When changing topics, we try to keep as many messages around from the previous set of\n      // topics as possible.\n      for (const topic of requestedTopics) {\n        const prevMessages = prevMessagesByTopic?.[topic];\n        newMessagesByTopic[topic] = prevMessages?.slice(-historySize) ?? [];\n      }\n      return newMessagesByTopic;\n    },\n    [requestedTopics, historySize],\n  );\n\n  return useMessageReducer({\n    topics: requestedTopics,\n    restore,\n    addMessages,\n  });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport memoizeWeak from \"memoize-weak\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport {\n  useMessagePipeline,\n  MessagePipelineContext,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport {\n  SubscribePayload,\n  MessageEvent,\n  MessageBlock as PlayerMessageBlock,\n} from \"@foxglove/studio-base/players/types\";\n\nexport type MessageBlock = {\n  readonly [topicName: string]: readonly MessageEvent<unknown>[];\n};\n\n// Memoization probably won't speed up the filtering appreciably, but preserves return identity.\n// That said, MessageBlock identity will change when the set of topics changes, so consumers should\n// prefer to use the identity of topic-block message arrays where possible.\nconst filterBlockByTopics = memoizeWeak(\n  (block: PlayerMessageBlock | undefined, topics: readonly string[]): MessageBlock => {\n    if (!block) {\n      // For our purposes, a missing MemoryCacheBlock just means \"no topics have been cached for\n      // this block\". This is semantically different to an empty array per topic, but not different\n      // to a MemoryCacheBlock with no per-topic arrays.\n      return {};\n    }\n    const ret: Record<string, readonly MessageEvent<unknown>[]> = {};\n    for (const topic of topics) {\n      // Don't include an empty array when the data has not been cached for this topic for this\n      // block. The missing entry means \"we don't know the message for this topic in this block\", as\n      // opposed to \"we know there are no messages for this topic in this block\".\n      const blockMessages = block.messagesByTopic[topic];\n      if (blockMessages) {\n        ret[topic] = blockMessages;\n      }\n    }\n    return ret;\n  },\n);\n\nconst useSubscribeToTopicsForBlocks = (topics: readonly string[]) => {\n  const [id] = useState(() => uuidv4());\n\n  const setSubscriptions = useMessagePipeline(\n    useCallback(\n      ({ setSubscriptions: pipelineSetSubscriptions }: MessagePipelineContext) =>\n        pipelineSetSubscriptions,\n      [],\n    ),\n  );\n  const subscriptions: SubscribePayload[] = useMemo(() => {\n    return topics.map((topic) => ({ topic, preloadType: \"full\" }));\n  }, [topics]);\n  useEffect(() => setSubscriptions(id, subscriptions), [id, setSubscriptions, subscriptions]);\n\n  useEffect(() => {\n    return () => {\n      setSubscriptions(id, []);\n    };\n  }, [id, setSubscriptions]);\n};\n\n// A note: for the moment,\n//  - not all players provide blocks, and\n//  - topics for nodes are not available in blocks when blocks _are_ provided,\n// so all consumers need a \"regular playback\" pipeline fallback for now.\n//\n// Semantics of blocks:\n//   - Missing topics have not been cached.\n//   - Adjacent elements are contiguous\n//   - Each block represents the same duration of time\n//   - The number of blocks is consistent for the data source\n//   - Blocks are stored in increasing order of time\nexport function useBlocksByTopic(topics: readonly string[]): readonly MessageBlock[] {\n  const requestedTopics = useShallowMemo(topics);\n\n  useSubscribeToTopicsForBlocks(requestedTopics);\n\n  const allBlocks = useMessagePipeline<readonly (PlayerMessageBlock | undefined)[] | undefined>(\n    useCallback((ctx) => ctx.playerState.progress.messageCache?.blocks, []),\n  );\n\n  const blocks = useMemo(() => {\n    if (!allBlocks) {\n      return [];\n    }\n    return allBlocks.map((block) => filterBlockByTopics(block, requestedTopics));\n  }, [allBlocks, requestedTopics]);\n\n  return blocks;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\nimport { DeepPartial } from \"ts-essentials\";\n\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { SaveConfig } from \"@foxglove/studio-base/types/panels\";\nimport { maybeCast } from \"@foxglove/studio-base/util/maybeCast\";\n\n/**\n * Like `useConfig`, but for a specific panel id. This generally shouldn't be used by panels\n * directly, but is for use in internal code that's running outside of regular context providers.\n */\nexport default function useConfigById<Config extends Record<string, unknown>>(\n  panelId: string | undefined,\n): [Config | undefined, SaveConfig<Config>] {\n  const { getCurrentLayoutState, savePanelConfigs } = useCurrentLayoutActions();\n\n  const configSelector = useCallback(\n    (state: DeepPartial<LayoutState>) => {\n      if (panelId == undefined) {\n        return undefined;\n      }\n      return maybeCast<Config>(state.selectedLayout?.data?.configById?.[panelId]);\n    },\n    [panelId],\n  );\n\n  const config = useCurrentLayoutSelector(configSelector);\n\n  const saveConfig: SaveConfig<Config> = useCallback(\n    (newConfig) => {\n      if (panelId == undefined) {\n        return;\n      }\n\n      if (typeof newConfig === \"function\") {\n        // We use a getter here instead of referring directly to the config object\n        // so that this callback is stable across config changes.\n        const currentConfig = getCurrentLayoutState().selectedLayout?.data?.configById[panelId] as\n          | undefined\n          | Config;\n        if (currentConfig) {\n          savePanelConfigs({\n            configs: [{ id: panelId, config: newConfig(currentConfig) }],\n          });\n        }\n      } else {\n        savePanelConfigs({\n          configs: [{ id: panelId, config: newConfig }],\n        });\n      }\n    },\n    [getCurrentLayoutState, panelId, savePanelConfigs],\n  );\n\n  return [config, saveConfig];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography } from \"@mui/material\";\nimport { clamp } from \"lodash\";\nimport { FixedSizeList, ListChildComponentProps } from \"react-window\";\n\nconst Constants = Object.freeze({\n  LISTBOX_PADDING: 8,\n  ROW_HEIGHT: 26,\n});\n\nfunction renderRow(props: ListChildComponentProps) {\n  const { data, index, style } = props;\n  const dataSet = data[index];\n  const inlineStyle = {\n    ...style,\n    top: (style.top as number) + Constants.LISTBOX_PADDING,\n  };\n\n  return (\n    <Typography component=\"li\" noWrap style={inlineStyle}>\n      {dataSet}\n    </Typography>\n  );\n}\n\nconst OuterElementContext = React.createContext({});\n\nconst OuterElementType = React.forwardRef<HTMLDivElement>((props, ref) => {\n  const outerProps = React.useContext(OuterElementContext);\n  return <div ref={ref} {...props} {...outerProps} />;\n});\nOuterElementType.displayName = \"OuterElement\";\n\n/**\n * React-window adapter for a virtualized list, used in autocomplete.\n */\nexport const ReactWindowListboxAdapter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLElement>\n>(function ListboxComponent(props, ref) {\n  const { children, ...other } = props;\n  const itemData: React.ReactChild[] = [];\n  (children as React.ReactChild[]).forEach(\n    (item: React.ReactChild & { children?: React.ReactChild[] }) => {\n      itemData.push(item);\n      itemData.push(...(item.children ?? []));\n    },\n  );\n\n  const totalHeight =\n    2 * Constants.LISTBOX_PADDING + Constants.ROW_HEIGHT * clamp(itemData.length, 16);\n\n  return (\n    <div ref={ref}>\n      <OuterElementContext.Provider value={other}>\n        <FixedSizeList\n          height={totalHeight}\n          itemCount={itemData.length}\n          itemData={itemData}\n          itemSize={Constants.ROW_HEIGHT}\n          outerElementType={OuterElementType}\n          width=\"100%\"\n        >\n          {renderRow}\n        </FixedSizeList>\n      </OuterElementContext.Provider>\n    </div>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport {\n  alpha,\n  Autocomplete as MuiAutocomplete,\n  MenuItem,\n  TextField,\n  useTheme,\n} from \"@mui/material\";\nimport { Fzf, FzfResultItem } from \"fzf\";\nimport * as React from \"react\";\nimport {\n  CSSProperties,\n  SyntheticEvent,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { ReactWindowListboxAdapter } from \"@foxglove/studio-base/components/ReactWindowListboxAdapter\";\n\nconst MAX_FZF_MATCHES = 200;\n\ntype AutocompleteProps<T> = {\n  autoSize?: boolean;\n  disableAutoSelect?: boolean;\n  disabled?: boolean;\n  filterText?: string;\n  getItemText?: (item: T) => string;\n  getItemValue?: (item: T) => string;\n  hasError?: boolean;\n  inputStyle?: CSSProperties;\n  items: readonly T[];\n  menuStyle?: CSSProperties;\n  minWidth?: number;\n  onBlur?: () => void;\n  onChange?: (event: React.SyntheticEvent<Element>, text: string) => void;\n  onSelect: (value: string | T, autocomplete: IAutocomplete) => void;\n  placeholder?: string;\n  readOnly?: boolean;\n  selectedItem?: T;\n  selectOnFocus?: boolean;\n  sortWhenFiltering?: boolean;\n  value?: string;\n};\n\nexport interface IAutocomplete {\n  setSelectionRange(selectionStart: number, selectionEnd: number): void;\n  focus(): void;\n  blur(): void;\n}\n\nconst useStyles = makeStyles()((theme) => {\n  const prefersDarkMode = theme.palette.mode === \"dark\";\n  const inputBackgroundColor = prefersDarkMode\n    ? \"rgba(255, 255, 255, 0.09)\"\n    : \"rgba(0, 0, 0, 0.06)\";\n\n  return {\n    root: {\n      \".MuiInputBase-root.MuiInputBase-sizeSmall\": {\n        backgroundColor: \"transparent\",\n        paddingInline: 0,\n        \"&:focus-within\": {\n          backgroundColor: inputBackgroundColor,\n        },\n      },\n    },\n    inputError: {\n      input: {\n        color: theme.palette.error.main,\n      },\n    },\n    item: {\n      padding: 6,\n      cursor: \"pointer\",\n      minHeight: \"100%\",\n      lineHeight: \"calc(100% - 10px)\",\n      overflowWrap: \"break-word\",\n      color: theme.palette.text.primary,\n      whiteSpace: \"pre\",\n    },\n    itemSelected: {\n      backgroundColor: alpha(\n        theme.palette.primary.main,\n        theme.palette.action.selectedOpacity + theme.palette.action.hoverOpacity,\n      ),\n    },\n    itemHighlighted: {\n      backgroundColor: theme.palette.action.hover,\n    },\n  };\n});\n\nfunction defaultGetText(name: string): (item: unknown) => string {\n  return function (item: unknown) {\n    if (typeof item === \"string\") {\n      return item;\n    } else if (\n      item != undefined &&\n      typeof item === \"object\" &&\n      typeof (item as { value?: string }).value === \"string\"\n    ) {\n      return (item as { value: string }).value;\n    }\n    throw new Error(`you need to provide an implementation of ${name}`);\n  };\n}\n\nconst EMPTY_SET = new Set<number>();\n\nfunction itemToFzfResult<T>(item: T): FzfResultItem<T> {\n  return {\n    item,\n    score: 0,\n    positions: EMPTY_SET,\n    start: 0,\n    end: 0,\n  };\n}\n\nconst HighlightChars = (props: { str: string; indices: Set<number> }) => {\n  const theme = useTheme();\n  const chars = props.str.split(\"\");\n\n  const nodes = chars.map((char, i) => {\n    if (props.indices.has(i)) {\n      return (\n        <b key={i} style={{ color: theme.palette.info.main }}>\n          {char}\n        </b>\n      );\n    } else {\n      return (\n        <span key={i} style={{ whiteSpace: \"pre\" }}>\n          {char}\n        </span>\n      );\n    }\n  });\n\n  return <>{nodes}</>;\n};\n\n/**\n * <Autocomplete> is a Studio-specific wrapper of MUI autocomplete with support\n * for things like multiple autocompletes that seamlessly transition into each\n * other, e.g. when building more complex strings like in the Plot panel.\n */\nexport default React.forwardRef(function Autocomplete<T = unknown>(\n  props: AutocompleteProps<T>,\n  ref: React.ForwardedRef<IAutocomplete>,\n): JSX.Element {\n  const inputRef = useRef<HTMLInputElement>(ReactNull);\n\n  const { classes, cx } = useStyles();\n\n  const [stateValue, setValue] = useState<string | undefined>(undefined);\n\n  const getItemText = useMemo(\n    () => props.getItemText ?? defaultGetText(\"getItemText\"),\n    [props.getItemText],\n  );\n\n  const getItemValue = useMemo(\n    () => props.getItemValue ?? defaultGetText(\"getItemValue\"),\n    [props.getItemValue],\n  );\n\n  // Props\n  const {\n    selectedItem,\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    value = stateValue ?? (selectedItem ? getItemText(selectedItem) : undefined),\n    disabled,\n    filterText = value ?? \"\",\n    items,\n    onBlur: onBlurCallback,\n    onChange: onChangeCallback,\n    onSelect: onSelectCallback,\n    placeholder,\n    readOnly,\n    selectOnFocus,\n    sortWhenFiltering = true,\n  }: AutocompleteProps<T> = props;\n\n  const fzfUnfiltered = useMemo(() => {\n    return items.map((item) => itemToFzfResult(item));\n  }, [items]);\n\n  const fzf = useMemo(() => {\n    // @ts-expect-error Fzf selector TS type seems to be wrong?\n    return new Fzf(items, {\n      fuzzy: \"v2\",\n      sort: sortWhenFiltering,\n      limit: MAX_FZF_MATCHES,\n      selector: getItemText,\n    });\n  }, [getItemText, items, sortWhenFiltering]);\n\n  const autocompleteItems: FzfResultItem<T>[] = useMemo(() => {\n    return filterText ? fzf.find(filterText) : fzfUnfiltered;\n  }, [filterText, fzf, fzfUnfiltered]);\n\n  const hasError = Boolean(props.hasError ?? (autocompleteItems.length === 0 && value?.length));\n\n  const selectedItemValue = selectedItem != undefined ? getItemValue(selectedItem) : undefined;\n  const setSelectionRange = useCallback((selectionStart: number, selectionEnd: number): void => {\n    inputRef.current?.focus();\n    inputRef.current?.setSelectionRange(selectionStart, selectionEnd);\n  }, []);\n\n  const focus = useCallback(() => {\n    inputRef.current?.focus();\n  }, []);\n\n  const blur = useCallback(() => {\n    inputRef.current?.blur();\n    onBlurCallback?.();\n  }, [onBlurCallback]);\n\n  // Give callers an opportunity to control autocomplete\n  useImperativeHandle(ref, () => ({ setSelectionRange, focus, blur }), [\n    setSelectionRange,\n    focus,\n    blur,\n  ]);\n\n  const onChange = useCallback(\n    (_event: ReactNull | React.SyntheticEvent<Element>, newValue: string): void => {\n      if (onChangeCallback) {\n        if (_event) {\n          onChangeCallback(_event, newValue);\n        }\n      } else {\n        setValue(newValue);\n      }\n    },\n    [onChangeCallback],\n  );\n\n  // To allow multiple completions in sequence, it's up to the parent component\n  // to manually blur the input to finish a completion.\n  const onSelect = useCallback(\n    (\n      _event: SyntheticEvent<Element>,\n      selectedValue: ReactNull | string | FzfResultItem<T>,\n    ): void => {\n      if (selectedValue != undefined && typeof selectedValue !== \"string\") {\n        setValue(undefined);\n        onSelectCallback(selectedValue.item, { setSelectionRange, focus, blur });\n      }\n    },\n    [onSelectCallback, blur, focus, setSelectionRange],\n  );\n\n  // Don't filter out options here because we assume that the parent\n  // component has already filtered them. This allows completing fragments.\n  const filterOptions = useCallback((options: FzfResultItem<T>[]) => options, []);\n\n  return (\n    <MuiAutocomplete\n      className={classes.root}\n      clearIcon={<ClearIcon fontSize=\"small\" />}\n      componentsProps={{\n        clearIndicator: { size: \"small\" },\n        paper: { elevation: 8 },\n      }}\n      disableCloseOnSelect\n      disabled={disabled}\n      freeSolo\n      fullWidth\n      getOptionLabel={(item: string | FzfResultItem<T>) => {\n        if (typeof item === \"string\") {\n          return item;\n        }\n        return getItemValue(item.item);\n      }}\n      filterOptions={filterOptions}\n      ListboxComponent={ReactWindowListboxAdapter}\n      onChange={onSelect}\n      onInputChange={onChange}\n      openOnFocus\n      options={autocompleteItems}\n      readOnly={readOnly}\n      renderInput={(params) => (\n        <TextField\n          {...params}\n          variant=\"filled\"\n          inputRef={inputRef}\n          placeholder={placeholder}\n          className={cx({ [classes.inputError]: hasError })}\n          size=\"small\"\n        />\n      )}\n      renderOption={(optProps, item: FzfResultItem<T>, { selected }) => {\n        const itemValue = getItemValue(item.item);\n        return (\n          <MenuItem\n            dense\n            {...optProps}\n            key={itemValue}\n            component=\"span\"\n            data-highlighted={selected}\n            data-test-auto-item\n            className={cx(classes.item, {\n              [classes.itemHighlighted]: selected,\n              [classes.itemSelected]:\n                selectedItemValue != undefined && itemValue === selectedItemValue,\n            })}\n          >\n            <HighlightChars str={getItemText(item.item)} indices={item.positions} />\n          </MenuItem>\n        );\n      }}\n      selectOnFocus={selectOnFocus}\n      size=\"small\"\n      value={value ?? ReactNull}\n    />\n  );\n}) as <T>(props: AutocompleteProps<T> & React.RefAttributes<IAutocomplete>) => JSX.Element; // https://stackoverflow.com/a/58473012/23649\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport CopyAllIcon from \"@mui/icons-material/CopyAll\";\nimport {\n  Button,\n  ButtonProps,\n  IconButton,\n  IconButtonProps,\n  SvgIconProps,\n  Tooltip,\n  Typography,\n} from \"@mui/material\";\nimport { useCallback, useState, PropsWithChildren } from \"react\";\n\nimport clipboard from \"@foxglove/studio-base/util/clipboard\";\n\nexport default function CopyButton(\n  props: PropsWithChildren<{\n    getText: () => string;\n    size?: \"small\" | \"medium\" | \"large\";\n    iconSize?: SvgIconProps[\"fontSize\"];\n    color?: ButtonProps[\"color\"] | IconButtonProps[\"color\"];\n    className?: string;\n    edge?: IconButtonProps[\"edge\"];\n  }>,\n): JSX.Element {\n  const {\n    children,\n    className,\n    color = \"primary\",\n    edge,\n    size = \"medium\",\n    iconSize = \"medium\",\n    getText,\n  } = props;\n  const [copied, setCopied] = useState(false);\n\n  const handleCopy = useCallback(() => {\n    clipboard\n      .copy(getText())\n      .then(() => {\n        setCopied(true);\n        setTimeout(() => setCopied(false), 1500);\n      })\n      .catch((err) => console.warn(err));\n  }, [getText]);\n\n  if (children == undefined) {\n    return (\n      <Tooltip arrow title={copied ? \"Copied\" : \"Copy to clipboard\"}>\n        <IconButton\n          edge={edge}\n          className={className}\n          size={size}\n          onClick={handleCopy}\n          color={copied ? \"success\" : color}\n        >\n          {copied ? <CheckIcon fontSize={iconSize} /> : <CopyAllIcon fontSize={iconSize} />}\n        </IconButton>\n      </Tooltip>\n    );\n  }\n\n  return (\n    <Button\n      size={size}\n      color=\"inherit\"\n      className={className}\n      onClick={handleCopy}\n      startIcon={\n        copied ? (\n          <CheckIcon fontSize={iconSize} color=\"success\" />\n        ) : (\n          <CopyAllIcon fontSize={iconSize} color=\"primary\" />\n        )\n      }\n    >\n      <Typography color={copied ? \"text.primary\" : color} variant=\"body2\">\n        {children}\n      </Typography>\n    </Button>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useMemo, useRef } from \"react\";\nimport { DeepReadonly } from \"ts-essentials\";\n\nimport { areEqual, fromMillis, Time, toSec } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { subtractTimes } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/typescript/userUtils/time\";\nimport { PlayerCapabilities, TopicStats } from \"@foxglove/studio-base/players/types\";\n\nconst EMPTY_TOPIC_STATS = new Map<string, TopicStats>();\n\n// Empirically this seems to strike a good balance between stable values\n// and reasonably quick reactions to change.\nfunction smoothValues(oldValue: undefined | number, newValue: number): number {\n  return 0.7 * (oldValue ?? newValue) + 0.3 * newValue;\n}\n\nfunction calculateStaticItemFrequency(\n  numMessages: number,\n  firstMessageTime: undefined | Time,\n  lastMessageTime: undefined | Time,\n  duration: Time,\n): undefined | number {\n  // Message count but no timestamps, use the full connection duration\n  if (firstMessageTime == undefined || lastMessageTime == undefined) {\n    const durationSec = toSec(duration);\n    if (durationSec > 0) {\n      return numMessages / durationSec;\n    } else {\n      return undefined;\n    }\n  }\n\n  // Not enough messages or time span to calculate a frequency\n  if (numMessages < 2 || areEqual(firstMessageTime, lastMessageTime)) {\n    return undefined;\n  }\n\n  const topicDurationSec = toSec(subtractTimes(lastMessageTime, firstMessageTime));\n  if (topicDurationSec > 0) {\n    return (numMessages - 1) / topicDurationSec;\n  } else {\n    return undefined;\n  }\n}\n\nfunction calculateLiveItemFrequency(numMessages: number, duration: Time) {\n  const durationSec = toSec(duration);\n\n  return durationSec > 0 ? numMessages / durationSec : undefined;\n}\n\nconst selectCurrentTime = ({ playerState }: MessagePipelineContext) =>\n  playerState.activeData?.currentTime;\nconst selectStartTime = ({ playerState }: MessagePipelineContext) =>\n  playerState.activeData?.startTime;\nconst selectEndTime = ({ playerState }: MessagePipelineContext) => playerState.activeData?.endTime;\nconst selectTopicStats = (ctx: MessagePipelineContext) =>\n  ctx.playerState.activeData?.topicStats ?? EMPTY_TOPIC_STATS;\nconst selectPlayerCapabilities = (ctx: MessagePipelineContext) => ctx.playerState.capabilities;\n\ntype StatSample = {\n  time: Time;\n  count: number;\n  frequency: undefined | number;\n};\n\ntype FrequenciesByTopic = Record<string, undefined | number>;\nconst EMPTY_FREQUENCIES: FrequenciesByTopic = {};\n\n/**\n * Encapsulates logic for directly updating topic stats DOM elements, bypassing\n * react for performance. To use this component mount it directly under your component\n * containing topics you want to update. Tag each topic stat field with data-topic\n * and data-topic-stat attributes.\n *\n * @property interval - the interval, in frames, between updates.\n */\nexport function useTopicPublishFrequencies(): DeepReadonly<FrequenciesByTopic> {\n  const playerCurrentTime = useMessagePipeline(selectCurrentTime);\n  const startTime = useMessagePipeline(selectStartTime);\n  const endTime = useMessagePipeline(selectEndTime);\n  const topicStats = useMessagePipeline(selectTopicStats);\n  const playerCapabilities = useMessagePipeline(selectPlayerCapabilities);\n  const duration = useMemo(\n    () => (endTime && startTime ? subtractTimes(endTime, startTime) : { sec: 0, nsec: 0 }),\n    [endTime, startTime],\n  );\n\n  const samplesByTopic = useRef<Record<string, StatSample>>({});\n\n  const playerIsStaticSource = useMemo(\n    () => playerCapabilities.includes(PlayerCapabilities.playbackControl),\n    [playerCapabilities],\n  );\n\n  const frequencies = useMemo(() => {\n    if (!playerCurrentTime) {\n      return EMPTY_FREQUENCIES;\n    }\n    const currentTime = fromMillis(Date.now());\n\n    const result: FrequenciesByTopic = {};\n    for (const [topic, stat] of topicStats) {\n      if (playerIsStaticSource) {\n        // For a static source we calculate frequency across all messages.\n        const frequency = calculateStaticItemFrequency(\n          stat.numMessages,\n          stat.firstMessageTime,\n          stat.lastMessageTime,\n          duration,\n        );\n        result[topic] = frequency;\n      } else {\n        // For a live source we calculate a running average of frequency.\n        const sample = samplesByTopic.current[topic];\n        if (sample == undefined) {\n          samplesByTopic.current[topic] = {\n            time: currentTime,\n            count: stat.numMessages,\n            frequency: undefined,\n          };\n        } else {\n          const messageDelta = stat.numMessages - sample.count;\n          if (messageDelta > 0) {\n            const timeDelta = subtractTimes(currentTime, sample.time);\n            const newFrequency = calculateLiveItemFrequency(messageDelta, timeDelta);\n            if (newFrequency != undefined) {\n              const smoothedFrequency = smoothValues(sample.frequency, newFrequency);\n              sample.frequency = smoothedFrequency;\n              sample.count = stat.numMessages;\n              sample.time = currentTime;\n            }\n          }\n          result[topic] = sample.frequency;\n        }\n      }\n    }\n\n    return result;\n  }, [playerCurrentTime, duration, playerIsStaticSource, topicStats]);\n\n  return frequencies;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef } from \"react\";\nimport { useLatest } from \"react-use\";\n\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useTopicPublishFrequencies } from \"@foxglove/studio-base/hooks/useTopicPublishFrequences\";\nimport { PlayerCapabilities, TopicStats } from \"@foxglove/studio-base/players/types\";\n\nconst EM_DASH = \"\\u2014\";\nconst EMPTY_TOPIC_STATS = new Map<string, TopicStats>();\n\nconst selectTopicStats = (ctx: MessagePipelineContext) =>\n  ctx.playerState.activeData?.topicStats ?? EMPTY_TOPIC_STATS;\nconst selectPlayerId = (ctx: MessagePipelineContext) => ctx.playerState.playerId;\nconst selectPlayerCapabilities = (ctx: MessagePipelineContext) => ctx.playerState.capabilities;\n\ntype StatSample = {\n  time: Time;\n  count: number;\n  frequency: undefined | number;\n};\n\n/**\n * Encapsulates logic for directly updating topic stats DOM elements, bypassing\n * react for performance. To use this component mount it directly under your component\n * containing topics you want to update. Tag each topic stat field with data-topic\n * and data-topic-stat attributes.\n *\n * @property interval - the interval, in frames, between updates.\n */\nexport function DirectTopicStatsUpdater({ interval = 1 }: { interval?: number }): JSX.Element {\n  const topicStats = useMessagePipeline(selectTopicStats);\n  const playerCapabilities = useMessagePipeline(selectPlayerCapabilities);\n  const playerId = useMessagePipeline(selectPlayerId);\n\n  const latestStats = useLatest(topicStats);\n  const updateCount = useRef(0);\n  const rootRef = useRef<HTMLDivElement>(ReactNull);\n  const samplesByTopic = useRef<Record<string, StatSample>>({});\n\n  const frequenciesByTopic = useTopicPublishFrequencies();\n  const latestFrequenciesByTopic = useLatest(frequenciesByTopic);\n\n  const playerIsStaticSource = useMemo(\n    () => playerCapabilities.includes(PlayerCapabilities.playbackControl),\n    [playerCapabilities],\n  );\n\n  const updateStats = useCallback(() => {\n    if (!rootRef.current) {\n      return;\n    }\n\n    rootRef.current.parentElement?.querySelectorAll(\"[data-topic]\").forEach((field) => {\n      if (!(field instanceof HTMLElement) || !field.dataset.topic) {\n        return;\n      }\n\n      const topic = field.dataset.topic;\n      const stat = latestStats.current.get(topic);\n      if (field.dataset.topicStat === \"count\") {\n        if (stat) {\n          field.innerText = stat.numMessages.toLocaleString();\n        } else {\n          field.innerText = EM_DASH;\n        }\n      }\n\n      if (field.dataset.topicStat === \"frequency\") {\n        const frequency = latestFrequenciesByTopic.current[topic];\n        field.innerText = frequency != undefined ? `${frequency.toFixed(2)} Hz` : EM_DASH;\n      }\n    });\n  }, [latestFrequenciesByTopic, latestStats]);\n\n  useEffect(() => {\n    if (updateCount.current++ % interval === 0) {\n      updateStats();\n    }\n  }, [updateStats, interval, topicStats, playerIsStaticSource]);\n\n  // Clear previous samples on player change.\n  useEffect(() => {\n    void playerId;\n    samplesByTopic.current = {};\n  }, [playerId]);\n\n  useLayoutEffect(() => {\n    updateStats();\n  }, [updateStats]);\n\n  return <div ref={rootRef} style={{ display: \"none\" }} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Link, Typography, styled as muiStyled } from \"@mui/material\";\nimport { useCallback } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport { useTranslation } from \"react-i18next\";\nimport { MosaicDragType } from \"react-mosaic-component\";\n\nimport PanelList, { PanelSelection } from \"@foxglove/studio-base/components/PanelList\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { MosaicDropResult } from \"@foxglove/studio-base/types/panels\";\nimport { getPanelIdForType } from \"@foxglove/studio-base/util/layout\";\n\ntype Props = {\n  tabId?: string;\n};\n\nconst Root = muiStyled(\"div\")(({ theme }) => ({\n  backgroundColor: theme.palette.background.paper,\n  width: \"100%\",\n  height: \"100%\",\n  overflowY: \"auto\",\n}));\n\nconst DropTarget = muiStyled(\"div\", {\n  shouldForwardProp: (prop) => prop !== \"isOver\",\n})<{\n  isOver: boolean;\n}>(({ isOver, theme }) => ({\n  width: \"100%\",\n  height: \"100%\",\n  minHeight: 0,\n\n  ...(isOver && {\n    \"&:after\": {\n      content: \"''\",\n      borderColor: `1px solid ${theme.palette.action.selected}`,\n      backgroundColor: theme.palette.action.focus,\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n      left: 0,\n      bottom: 0,\n      zIndex: theme.zIndex.appBar,\n    },\n  }),\n}));\n\nexport const EmptyPanelLayout = ({ tabId }: Props): JSX.Element => {\n  const { addPanel } = useCurrentLayoutActions();\n  const { t } = useTranslation(\"addPanel\");\n\n  const [{ isOver }, drop] = useDrop<unknown, MosaicDropResult, { isOver: boolean }>({\n    accept: MosaicDragType.WINDOW,\n    drop: () => {\n      return { tabId };\n    },\n    collect: (monitor) => ({\n      isOver: monitor.isOver(),\n    }),\n  });\n\n  const onPanelSelect = useCallback(\n    ({ type, config, relatedConfigs }: PanelSelection) => {\n      const id = getPanelIdForType(type);\n      addPanel({ tabId, id, config, relatedConfigs });\n    },\n    [addPanel, tabId],\n  );\n\n  return (\n    <DropTarget isOver={isOver} ref={drop} data-testid=\"empty-drop-target\">\n      <Root>\n        <Stack paddingBottom={2}>\n          <Typography variant=\"body2\" paddingX={2} paddingTop={2}>\n            {t(\"selectPanelToAddToLayout\")}{\" \"}\n            <Link color=\"primary\" target=\"_blank\" href=\"https://foxglove.dev/docs/studio/layouts\">\n              {t(\"learnMore\", { ns: \"general\" })}\n            </Link>\n          </Typography>\n          <PanelList mode=\"grid\" onPanelSelect={onPanelSelect} />\n        </Stack>\n      </Root>\n    </DropTarget>\n  );\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Container, Typography } from \"@mui/material\";\nimport { PropsWithChildren } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    backgroundColor: theme.palette.background.default,\n    display: \"flex\",\n    flexDirection: \"column\",\n    flex: \"auto\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n\n    code: {\n      color: theme.palette.primary.main,\n      background: \"transparent\",\n      padding: 0,\n    },\n  },\n}));\n\nexport default function EmptyState({ children }: PropsWithChildren<unknown>): JSX.Element {\n  const { classes } = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <Container maxWidth={false}>\n        <Typography variant=\"body2\" color=\"text.secondary\" lineHeight={1.4} align=\"center\">\n          {children}\n        </Typography>\n      </Container>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link, Button, Typography } from \"@mui/material\";\nimport { Component, ErrorInfo, PropsWithChildren, ReactNode } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { AppError } from \"@foxglove/studio-base/util/errors\";\n\nimport ErrorDisplay from \"./ErrorDisplay\";\n\ntype Props = {\n  actions?: JSX.Element;\n  showErrorDetails?: boolean;\n  hideErrorSourceLocations?: boolean;\n};\n\ntype State = {\n  currentError: { error: Error; errorInfo: ErrorInfo } | undefined;\n};\n\nexport default class ErrorBoundary extends Component<PropsWithChildren<Props>, State> {\n  public override state: State = {\n    currentError: undefined,\n  };\n\n  public override componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    reportError(new AppError(error, errorInfo));\n    this.setState({ currentError: { error, errorInfo } });\n  }\n\n  public override render(): ReactNode {\n    if (this.state.currentError) {\n      const actions = this.props.actions ?? (\n        <Stack\n          fullHeight\n          flex=\"auto\"\n          alignItems=\"flex-end\"\n          justifyContent=\"flex-end\"\n          direction=\"row\"\n        >\n          <Button\n            variant=\"outlined\"\n            color=\"secondary\"\n            onClick={() => this.setState({ currentError: undefined })}\n          >\n            Dismiss\n          </Button>\n        </Stack>\n      );\n      return (\n        <ErrorDisplay\n          showErrorDetails={this.props.showErrorDetails}\n          hideErrorSourceLocations={this.props.hideErrorSourceLocations}\n          error={this.state.currentError.error}\n          errorInfo={this.state.currentError.errorInfo}\n          content={\n            <Typography>\n              Something went wrong.{\" \"}\n              <Link color=\"inherit\" onClick={() => this.setState({ currentError: undefined })}>\n                Dismiss this error\n              </Link>{\" \"}\n              to continue using the app. If the issue persists, try restarting the app.\n            </Typography>\n          }\n          actions={actions}\n        />\n      );\n    }\n    return this.props.children;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography, Link, Divider } from \"@mui/material\";\nimport { ErrorInfo, useMemo, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nconst useStyles = makeStyles()((theme) => ({\n  grid: {\n    display: \"grid\",\n    gridTemplateRows: \"auto 1fr auto\",\n    height: \"100%\",\n    padding: theme.spacing(2),\n    overflowY: \"auto\",\n  },\n  errorDetailStack: {\n    fontSize: theme.typography.body2.fontSize,\n    lineHeight: \"1.3em\",\n    paddingLeft: theme.spacing(2),\n  },\n  errorDetailContainer: {\n    overflowY: \"auto\",\n    background: theme.palette.background.paper,\n    padding: theme.spacing(1),\n    minHeight: theme.spacing(10),\n  },\n  actions: {\n    flex: \"auto\",\n    paddingTop: theme.spacing(2),\n    textAlign: \"right\",\n  },\n}));\n/**\n * Remove source locations (which often include file hashes) so storybook screenshots can be\n * deterministic.\n */\nfunction sanitizeStack(stack: string) {\n  return stack.replace(/\\s+\\(.+\\)$/gm, \"\").replace(/\\s+https?:\\/\\/.+$/gm, \"\");\n}\n\nfunction ErrorStacktrace({\n  stack,\n  hideSourceLocations,\n}: {\n  stack: string;\n  hideSourceLocations: boolean;\n}) {\n  const { classes } = useStyles();\n  const lines = (hideSourceLocations ? sanitizeStack(stack) : stack)\n    .trim()\n    .replace(/^\\s*at /gm, \"\")\n    .split(\"\\n\")\n    .map((line) => line.trim());\n  return (\n    <pre className={classes.errorDetailStack}>\n      {lines.map((line, i) => {\n        const match = /^(.+)\\s(\\(.+$)/.exec(line);\n        if (!match) {\n          return line + \"\\n\";\n        }\n        return (\n          <span key={i}>\n            <span>{match[1]} </span>\n            <span>{match[2]}</span>\n            {\"\\n\"}\n          </span>\n        );\n      })}\n    </pre>\n  );\n}\n\ntype ErrorDisplayProps = {\n  title?: string;\n  error?: Error;\n  errorInfo?: ErrorInfo;\n  content?: JSX.Element;\n  actions?: JSX.Element;\n  showErrorDetails?: boolean;\n  hideErrorSourceLocations?: boolean;\n};\n\nfunction ErrorDisplay(props: ErrorDisplayProps): JSX.Element {\n  const { classes } = useStyles();\n  const { error, errorInfo, hideErrorSourceLocations = false } = props;\n\n  const [showErrorDetails, setShowErrorDetails] = useState(props.showErrorDetails ?? false);\n\n  const errorDetails = useMemo(() => {\n    if (!showErrorDetails) {\n      return ReactNull;\n    }\n\n    let stackWithoutMessage = error?.stack ?? \"\";\n    const errorString = error?.toString() ?? \"\";\n    if (stackWithoutMessage.startsWith(errorString)) {\n      stackWithoutMessage = stackWithoutMessage.substring(errorString.length);\n    }\n\n    return (\n      <div>\n        <Typography fontWeight=\"bold\">Error stack:</Typography>\n        <ErrorStacktrace\n          stack={stackWithoutMessage}\n          hideSourceLocations={hideErrorSourceLocations}\n        />\n        {errorInfo && (\n          <>\n            <Typography fontWeight=\"bold\">Component stack:</Typography>\n            <ErrorStacktrace\n              stack={errorInfo.componentStack}\n              hideSourceLocations={hideErrorSourceLocations}\n            />\n          </>\n        )}\n      </div>\n    );\n  }, [error, errorInfo, hideErrorSourceLocations, showErrorDetails]);\n\n  return (\n    <div className={classes.grid}>\n      <Stack gap={2} paddingBottom={2}>\n        <Stack>\n          <Typography variant=\"h4\" gutterBottom>\n            {props.title ?? \"The app encountered an unexpected error\"}\n          </Typography>\n          <Typography variant=\"body1\">{props.content}</Typography>\n        </Stack>\n        <Divider />\n        <Typography variant=\"subtitle2\" component=\"code\" fontWeight=\"bold\">\n          {error?.message}\n        </Typography>\n        <Link color=\"secondary\" onClick={() => setShowErrorDetails(!showErrorDetails)}>\n          {showErrorDetails ? \"Hide\" : \"Show\"} details\n        </Link>\n      </Stack>\n      {errorDetails && <div className={classes.errorDetailContainer}>{errorDetails}</div>}\n      {!errorDetails && <div />}\n      <div className={classes.actions}>{props.actions}</div>\n    </div>\n  );\n}\n\nexport default ErrorDisplay;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IconButton, IconButtonProps } from \"@mui/material\";\nimport { forwardRef, useCallback, useEffect, useState } from \"react\";\n\ntype Props = {\n  icon: React.ReactNode;\n  activeIcon?: React.ReactNode;\n  color?: IconButtonProps[\"color\"];\n  activeColor?: IconButtonProps[\"color\"];\n} & Omit<IconButtonProps, \"children\" | \"color\">;\n\nconst HoverableIconButton = forwardRef<HTMLButtonElement, Props>((props, ref) => {\n  const { icon, activeIcon, color, activeColor, onMouseLeave, onMouseEnter, ...rest } = props;\n\n  const [hovered, setHovered] = useState(false);\n\n  const handleMouseEnter = useCallback(\n    (event) => {\n      if (onMouseEnter != undefined) {\n        onMouseEnter(event);\n      }\n      if (props.disabled === true) {\n        return;\n      }\n      setHovered(true);\n    },\n    [onMouseEnter, props.disabled],\n  );\n\n  const handleMouseLeave = useCallback(\n    (event) => {\n      if (onMouseLeave != undefined) {\n        onMouseLeave(event);\n      }\n      setHovered(false);\n    },\n    [onMouseLeave],\n  );\n\n  useEffect(() => {\n    if (props.disabled === true) {\n      setHovered(false);\n    }\n  }, [props.disabled]);\n\n  return (\n    <IconButton\n      ref={ref}\n      {...rest}\n      component=\"button\"\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n      color={activeColor != undefined ? (hovered ? activeColor : color) : color}\n    >\n      {activeIcon != undefined ? (hovered ? activeIcon : icon) : icon}\n    </IconButton>\n  );\n});\n\nHoverableIconButton.displayName = \"HoverableIconButton\";\n\nexport default HoverableIconButton;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nexport type ValidationResult =\n  | string\n  | {\n      [fieldName: string]: string;\n    };\n\nexport const validationErrorToString = (validationResult: ValidationResult): string =>\n  typeof validationResult === \"string\"\n    ? validationResult\n    : Object.keys(validationResult)\n        .map((key) => `${key}: ${validationResult[key]}`)\n        .join(\", \");\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport { Typography } from \"@mui/material\";\nimport CodeEditor from \"@uiw/react-textarea-code-editor\";\nimport { isEqual } from \"lodash\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\nimport { validationErrorToString, ValidationResult } from \"@foxglove/studio-base/util/validators\";\n\nconst { useState, useCallback, useRef, useLayoutEffect, useEffect } = React;\n\nconst useStyles = makeStyles()((theme) => ({\n  editor: {\n    backgroundColor: \"transparent !important\",\n    font: \"inherit !important\",\n    fontFamily: `${fonts.MONOSPACE} !important`,\n    overflow: \"auto\",\n  },\n  error: {\n    \"*\": {\n      color: `${theme.palette.error.main} !important`,\n    },\n  },\n}));\n\ntype Value = unknown;\ntype OnChange = (obj: unknown) => void;\ntype ParseAndStringifyFn = {\n  stringify: (obj: unknown) => string;\n  parse: (val: string) => unknown;\n};\nexport type BaseProps = {\n  dataTestId?: string;\n  dataValidator?: (data: unknown) => ValidationResult | undefined;\n  onChange?: OnChange;\n  onError?: (err: string) => void;\n  readOnly?: boolean;\n  maxHeight?: number;\n  value: Value;\n};\n\n/**\n * Handles value change, data validation, and data stringifying/parsing.\n * Any external value change will cause the input string to change and trigger new validations.\n * Only valid internal value change will call onChange. Any data processing and validation error will trigger onError.\n */\nfunction ValidatedInputBase({\n  dataTestId,\n  dataValidator = () => undefined,\n  onChange,\n  onError,\n  parse,\n  readOnly = false,\n  maxHeight,\n  stringify,\n  value,\n}: BaseProps & ParseAndStringifyFn): JSX.Element {\n  const { classes, cx } = useStyles();\n  const [error, setError] = useState<string>(\"\");\n  const [inputStr, setInputStr] = useState<string>(\"\");\n  const prevIncomingVal = useRef<unknown>(\"\");\n  const inputRef = useRef<HTMLTextAreaElement>(ReactNull);\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n\n  // validate the input string, and setError or call onChange if needed\n  const memorizedInputValidation = useCallback(\n    (newInputVal: string, onChangeFcn?: OnChange) => {\n      let newVal;\n      let newError: string | undefined;\n      // parse the empty string directly as empty array or object for validation and onChange callback\n      if (newInputVal.trim() === \"\") {\n        newVal = Array.isArray(value) ? [] : {};\n      } else {\n        try {\n          newVal = parse(newInputVal);\n        } catch (e) {\n          newError = e.message;\n        }\n      }\n\n      if (newError != undefined) {\n        setError(newError);\n        return;\n      }\n      setError(\"\"); // clear the previous error\n      const validationResult = dataValidator(newVal);\n      if (validationResult != undefined) {\n        setError(validationErrorToString(validationResult));\n        return;\n      }\n      if (onChangeFcn) {\n        onChangeFcn(newVal);\n      }\n    },\n    [dataValidator, parse, value],\n  );\n\n  /**\n   * when not in editing mode whenever the incoming value changes\n   * we'll compare the new value with prevIncomingVal and reset local state values if they are different\n   */\n  useLayoutEffect(() => {\n    if (!isEditing && value !== prevIncomingVal.current) {\n      if (isEqual(value, prevIncomingVal.current)) {\n        return;\n      }\n      let newVal = \"\";\n      let newError: string | undefined;\n      try {\n        newVal = stringify(value);\n      } catch (e) {\n        newError = `Error stringifying the new value, using \"\" as default. ${e.message}`;\n      }\n      setInputStr(newVal);\n      prevIncomingVal.current = value;\n      if (newError != undefined) {\n        setError(newError);\n        return;\n      }\n      // try to validate if successfully stringified the new value\n      memorizedInputValidation(newVal);\n    }\n  }, [value, stringify, memorizedInputValidation, isEditing]);\n\n  const handleChange = useCallback(\n    (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      const val = e.currentTarget.value;\n      if (!isEditing) {\n        setIsEditing(true);\n      }\n      setInputStr(val);\n      memorizedInputValidation(val, onChange);\n    },\n    [isEditing, memorizedInputValidation, onChange],\n  );\n\n  useEffect(() => {\n    if (onError && error.length > 0) {\n      onError(error);\n    }\n  }, [error, onError]);\n\n  // scroll to the bottom when the text gets too long\n  useLayoutEffect(\n    () => {\n      if (!isEditing) {\n        const inputElem = inputRef.current;\n        if (inputElem) {\n          inputElem.scrollTop = inputElem.scrollHeight;\n        }\n      }\n    },\n    [isEditing, inputStr], // update whenever inputStr changes\n  );\n\n  return (\n    <>\n      <CodeEditor\n        className={cx(classes.editor, { [classes.error]: error.length > 0 })}\n        readOnly={readOnly}\n        data-testid={dataTestId ?? `validated-input-${JSON.stringify(inputStr)}`}\n        ref={inputRef}\n        value={inputStr}\n        onChange={handleChange}\n        language=\"json\"\n        onBlur={() => setIsEditing(false)}\n        padding={12}\n        style={{ maxHeight: maxHeight ?? 300 }}\n      />\n      {error.length > 0 && (\n        <Stack direction=\"row\" alignItems=\"center\" gap={0.25} padding={0.5}>\n          <ErrorIcon fontSize=\"inherit\" color=\"error\" />\n          <Typography variant=\"caption\" color=\"error.main\">\n            {error}\n          </Typography>\n        </Stack>\n      )}\n    </>\n  );\n}\n\nexport default function JsonInput(props: BaseProps): JSX.Element {\n  function stringify(val: unknown) {\n    if (val === '\"\"') {\n      return val;\n    }\n\n    return JSON.stringify(val, undefined, 2) ?? \"\";\n  }\n\n  return (\n    <Stack style={{ maxHeight: 800 }} overflowY=\"auto\">\n      <ValidatedInputBase parse={JSON.parse} stringify={stringify} {...props} />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { ReactElement, useCallback, useEffect, useRef } from \"react\";\n\n// Invoke handler for matching key.\n// By default, preventDefault() is invoked on the event. Return false to allow the default.\ntype KeyHandlers = Record<string, (event: KeyboardEvent) => void | boolean | undefined>;\n\ntype Props = {\n  global?: boolean;\n  keyDownHandlers?: KeyHandlers;\n  keyPressHandlers?: KeyHandlers;\n  keyUpHandlers?: KeyHandlers;\n};\n\nfunction callHandlers(handlers: KeyHandlers | undefined, event: KeyboardEvent): void {\n  if (!handlers) {\n    return;\n  }\n\n  if (typeof handlers[event.key] === \"function\") {\n    let preventDefault = true;\n    try {\n      preventDefault = handlers[event.key]?.(event) ?? true;\n    } finally {\n      if (preventDefault) {\n        event.preventDefault();\n      }\n    }\n  }\n}\n\nexport default function KeyListener(props: Props): ReactElement {\n  const element = useRef<HTMLDivElement>(ReactNull);\n\n  const handleEvent = useCallback(\n    (event: Event) => {\n      if (!(event instanceof KeyboardEvent)) {\n        return;\n      }\n      const { target, type } = event;\n      if (\n        target instanceof HTMLInputElement ||\n        target instanceof HTMLTextAreaElement ||\n        (target instanceof HTMLElement && target.isContentEditable)\n      ) {\n        // The user is typing in an editable field; ignore the event.\n        return;\n      }\n\n      switch (type) {\n        case \"keydown\":\n          callHandlers(props.keyDownHandlers, event);\n          break;\n        case \"keypress\":\n          callHandlers(props.keyPressHandlers, event);\n          break;\n        case \"keyup\":\n          callHandlers(props.keyUpHandlers, event);\n          break;\n        default:\n          break;\n      }\n    },\n    [props.keyDownHandlers, props.keyPressHandlers, props.keyUpHandlers],\n  );\n\n  useEffect(() => {\n    const target = props.global === true ? document : element.current?.parentElement;\n\n    target?.addEventListener(\"keydown\", handleEvent);\n    target?.addEventListener(\"keypress\", handleEvent);\n    target?.addEventListener(\"keyup\", handleEvent);\n\n    return () => {\n      target?.removeEventListener(\"keydown\", handleEvent);\n      target?.removeEventListener(\"keypress\", handleEvent);\n      target?.removeEventListener(\"keyup\", handleEvent);\n    };\n  }, [handleEvent, props.global]);\n\n  return <div style={{ display: \"none\" }} ref={element} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Stack } from \"@mui/material\";\nimport { flatten, flatMap, partition } from \"lodash\";\nimport { CSSProperties, useCallback, useMemo } from \"react\";\n\nimport { MessageDefinitionField } from \"@foxglove/message-definition\";\nimport * as PanelAPI from \"@foxglove/studio-base/PanelAPI\";\nimport Autocomplete, { IAutocomplete } from \"@foxglove/studio-base/components/Autocomplete\";\nimport useGlobalVariables, {\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { getTopicsByTopicName } from \"@foxglove/studio-base/util/selectors\";\n\nimport { RosPath, RosPrimitive } from \"./constants\";\nimport {\n  traverseStructure,\n  messagePathStructures,\n  messagePathsForDatatype,\n  validTerminatingStructureItem,\n  StructureTraversalResult,\n} from \"./messagePathsForDatatype\";\nimport parseRosPath, { quoteFieldNameIfNeeded, quoteTopicNameIfNeeded } from \"./parseRosPath\";\n\n// To show an input field with an autocomplete so the user can enter message paths, use:\n//\n//  <MessagePathInput path={this.state.path} onChange={path => this.setState({ path })} />\n//\n// To limit the autocomplete items to only certain types of values, you can use\n//\n//  <MessagePathInput types={[\"message\", \"array\", \"primitives\"]} />\n//\n// Or use actual ROS primitive types:\n//\n//  <MessagePathInput types={[\"uint16\", \"float64\"]} />\n//\n// If you are rendering many input fields, you might want to use `<MessagePathInput index={5}>`,\n// which gets passed down to `<MessagePathInput onChange>` as the second parameter, so you can\n// avoid creating anonymous functions on every render (which will prevent the component from\n// rendering unnecessarily).\n\n// Get a list of Message Path strings for all of the fields (recursively) in a list of topics\nfunction getFieldPaths(\n  topics: readonly Topic[],\n  datatypes: RosDatatypes,\n): Map<string, MessageDefinitionField> {\n  const output = new Map<string, MessageDefinitionField>();\n  for (const topic of topics) {\n    if (topic.schemaName == undefined) {\n      continue;\n    }\n    addFieldPathsForType(\n      quoteTopicNameIfNeeded(topic.name),\n      topic.schemaName,\n      datatypes,\n      [],\n      output,\n    );\n  }\n  return output;\n}\n\nfunction addFieldPathsForType(\n  curPath: string,\n  typeName: string,\n  datatypes: RosDatatypes,\n  seenTypes: string[],\n  output: Map<string, MessageDefinitionField>,\n): void {\n  const msgdef = datatypes.get(typeName);\n  if (msgdef) {\n    for (const field of msgdef.definitions) {\n      if (seenTypes.includes(field.type)) {\n        continue;\n      }\n      if (field.isConstant !== true) {\n        const fieldPath = `${curPath}.${quoteFieldNameIfNeeded(field.name)}`;\n        output.set(fieldPath, field);\n        if (field.isComplex === true) {\n          addFieldPathsForType(\n            fieldPath,\n            field.type,\n            datatypes,\n            [...seenTypes, field.type],\n            output,\n          );\n        }\n      }\n    }\n  }\n}\n\nexport function tryToSetDefaultGlobalVar(\n  variableName: string,\n  setGlobalVariables: (arg0: GlobalVariables) => void,\n): boolean {\n  const defaultGlobalVars = new Map<string, GlobalVariables>();\n  const defaultVar = defaultGlobalVars.get(variableName);\n  if (defaultVar) {\n    setGlobalVariables({ [variableName]: defaultVar });\n    return true;\n  }\n  return false;\n}\n\nexport function getFirstInvalidVariableFromRosPath(\n  rosPath: RosPath,\n  globalVariables: GlobalVariables,\n  setGlobalVariables: (arg0: GlobalVariables) => void,\n): { variableName: string; loc: number } | undefined {\n  const { messagePath } = rosPath;\n  const globalVars = Object.keys(globalVariables);\n  return flatMap(messagePath, (path) => {\n    const messagePathParts = [];\n    if (\n      path.type === \"filter\" &&\n      typeof path.value === \"object\" &&\n      !globalVars.includes(path.value.variableName)\n    ) {\n      const [variableName, loc] = [path.value.variableName, path.valueLoc];\n      messagePathParts.push({ variableName, loc });\n    } else if (path.type === \"slice\") {\n      if (typeof path.start === \"object\" && !globalVars.includes(path.start.variableName)) {\n        const [variableName, loc] = [path.start.variableName, path.start.startLoc];\n        messagePathParts.push({ variableName, loc });\n      }\n      if (typeof path.end === \"object\" && !globalVars.includes(path.end.variableName)) {\n        const [variableName, loc] = [path.end.variableName, path.end.startLoc];\n        messagePathParts.push({ variableName, loc });\n      }\n    }\n    return messagePathParts;\n  }).filter(({ variableName }) => !tryToSetDefaultGlobalVar(variableName, setGlobalVariables))[0];\n}\n\nfunction getExamplePrimitive(primitiveType: RosPrimitive) {\n  switch (primitiveType) {\n    case \"string\":\n      return '\"\"';\n    case \"bool\":\n      return \"true\";\n    case \"float32\":\n    case \"float64\":\n    case \"uint8\":\n    case \"uint16\":\n    case \"uint32\":\n    case \"uint64\":\n    case \"int8\":\n    case \"int16\":\n    case \"int32\":\n    case \"int64\":\n      return \"0\";\n    case \"json\":\n      return \"\";\n  }\n}\n\ntype MessagePathInputBaseProps = {\n  supportsMathModifiers?: boolean;\n  path: string; // A path of the form `/topic.some_field[:]{id==42}.x`\n  index?: number; // Optional index field which gets passed to `onChange` (so you don't have to create anonymous functions)\n  onChange: (value: string, index?: number) => void;\n  validTypes?: readonly string[]; // Valid types, like \"message\", \"array\", or \"primitive\", or a ROS primitive like \"float64\"\n  noMultiSlices?: boolean; // Don't suggest slices with multiple values `[:]`, only single values like `[0]`.\n  autoSize?: boolean;\n  placeholder?: string;\n  inputStyle?: CSSProperties;\n  disabled?: boolean;\n  disableAutocomplete?: boolean; // Treat this as a normal input, with no autocomplete.\n  readOnly?: boolean;\n  prioritizedDatatype?: string;\n};\n\nexport default React.memo<MessagePathInputBaseProps>(function MessagePathInput(\n  props: MessagePathInputBaseProps,\n) {\n  const { globalVariables, setGlobalVariables } = useGlobalVariables();\n  const { datatypes, topics } = PanelAPI.useDataSourceInfo();\n\n  const {\n    supportsMathModifiers,\n    path,\n    prioritizedDatatype,\n    validTypes,\n    autoSize,\n    placeholder,\n    noMultiSlices,\n    inputStyle,\n    disableAutocomplete = false,\n  } = props;\n\n  const topicFields = useMemo(() => getFieldPaths(topics, datatypes), [datatypes, topics]);\n\n  const onChangeProp = props.onChange;\n  const onChange = useCallback(\n    (event: React.SyntheticEvent<Element>, rawValue: string) => {\n      // When typing a \"{\" character, also  insert a \"}\", so you get an\n      // autocomplete window immediately for selecting a filter name.\n      let value = rawValue;\n      if ((event.nativeEvent as InputEvent).data === \"{\") {\n        const target = event.target as HTMLInputElement;\n        const newCursorPosition = target.selectionEnd ?? 0;\n        value = `${value.slice(0, newCursorPosition)}}${value.slice(newCursorPosition)}`;\n        setImmediate(() => target.setSelectionRange(newCursorPosition, newCursorPosition));\n      }\n      onChangeProp(value, props.index);\n    },\n    [onChangeProp, props.index],\n  );\n\n  const onSelect = useCallback(\n    (\n      rawValue: string,\n      autocomplete: IAutocomplete,\n      autocompleteType: (\"topicName\" | \"messagePath\" | \"globalVariables\") | undefined,\n      autocompleteRange: { start: number; end: number },\n    ) => {\n      const completeStart = path.slice(0, autocompleteRange.start);\n      const completeEnd = path.slice(autocompleteRange.end);\n\n      // Check if accepting this completion would result in a path to a non-complex field.\n      const completedPath = completeStart + rawValue + completeEnd;\n      const completedField = topicFields.get(completedPath);\n      const isSimpleField = completedField != undefined && completedField.isComplex !== true;\n\n      // If we're dealing with a topic name, and we cannot validly end in a message type,\n      // add a \".\" so the user can keep typing to autocomplete the message path.\n      const messageIsValidType = validTypes == undefined || validTypes.includes(\"message\");\n      const keepGoingAfterTopicName =\n        autocompleteType === \"topicName\" && !messageIsValidType && !isSimpleField;\n      const value = keepGoingAfterTopicName ? rawValue + \".\" : rawValue;\n\n      onChangeProp(completeStart + value + completeEnd, props.index);\n\n      // We want to continue typing if we're dealing with a topic name,\n      // or if we just autocompleted something with a filter (because we might want to\n      // edit that filter), or if the autocomplete already has a filter (because we might\n      // have just autocompleted a name inside that filter).\n      if (keepGoingAfterTopicName || value.includes(\"{\") || path.includes(\"{\")) {\n        const newCursorPosition = autocompleteRange.start + value.length;\n        setImmediate(() => autocomplete.setSelectionRange(newCursorPosition, newCursorPosition));\n      } else {\n        autocomplete.blur();\n      }\n    },\n    [onChangeProp, path, props.index, topicFields, validTypes],\n  );\n\n  const rosPath = useMemo(() => parseRosPath(path), [path]);\n\n  const topic = useMemo(() => {\n    if (!rosPath) {\n      return undefined;\n    }\n\n    const { topicName } = rosPath;\n    return topics.find(({ name }) => name === topicName);\n  }, [rosPath, topics]);\n\n  const messagePathStructuresForDataype = useMemo(\n    () => messagePathStructures(datatypes),\n    [datatypes],\n  );\n\n  const structureTraversalResult = useMemo((): StructureTraversalResult | undefined => {\n    if (!topic || !rosPath?.messagePath) {\n      return undefined;\n    }\n    if (topic.schemaName == undefined) {\n      return {\n        valid: true,\n        msgPathPart: undefined,\n        structureItem: {\n          structureType: \"message\",\n          nextByName: {},\n          datatype: \"\",\n        },\n      };\n    }\n\n    return traverseStructure(\n      messagePathStructuresForDataype[topic.schemaName],\n      rosPath.messagePath,\n    );\n  }, [messagePathStructuresForDataype, rosPath?.messagePath, topic]);\n\n  const invalidGlobalVariablesVariable = useMemo(() => {\n    if (!rosPath) {\n      return undefined;\n    }\n    return getFirstInvalidVariableFromRosPath(rosPath, globalVariables, setGlobalVariables);\n  }, [globalVariables, rosPath, setGlobalVariables]);\n\n  const topicNamesAutocompleteItems = useMemo(\n    () => topics.map(({ name }) => quoteTopicNameIfNeeded(name)),\n    [topics],\n  );\n\n  const topicNamesAndFieldsAutocompleteItems = useMemo(\n    () => topicNamesAutocompleteItems.concat(Array.from(topicFields.keys())),\n    [topicFields, topicNamesAutocompleteItems],\n  );\n\n  const autocompleteType = useMemo(() => {\n    if (!rosPath) {\n      return \"topicName\";\n    } else if (!topic) {\n      return \"topicName\";\n    } else if (\n      structureTraversalResult == undefined ||\n      !structureTraversalResult.valid ||\n      !validTerminatingStructureItem(structureTraversalResult.structureItem, validTypes)\n    ) {\n      return \"messagePath\";\n    }\n\n    if (invalidGlobalVariablesVariable) {\n      return \"globalVariables\";\n    }\n\n    return undefined;\n  }, [invalidGlobalVariablesVariable, structureTraversalResult, validTypes, rosPath, topic]);\n\n  const { autocompleteItems, autocompleteFilterText, autocompleteRange } = useMemo(() => {\n    if (disableAutocomplete) {\n      return {\n        autocompleteItems: [],\n        autocompleteFilterText: \"\",\n        autocompleteRange: { start: 0, end: Infinity },\n      };\n    } else if (autocompleteType === \"topicName\") {\n      // If the path is empty, return topic names only to show the full list of topics. Otherwise,\n      // use the full set of topic names and field paths to autocomplete\n      return {\n        autocompleteItems: path\n          ? topicNamesAndFieldsAutocompleteItems\n          : topicNamesAutocompleteItems,\n        autocompleteFilterText: path,\n        autocompleteRange: { start: 0, end: Infinity },\n      };\n    } else if (autocompleteType === \"messagePath\" && topic && rosPath) {\n      if (\n        structureTraversalResult &&\n        !structureTraversalResult.valid &&\n        structureTraversalResult.msgPathPart?.type === \"filter\" &&\n        structureTraversalResult.structureItem?.structureType === \"message\"\n      ) {\n        const { msgPathPart } = structureTraversalResult;\n\n        const items: string[] = [];\n\n        // Provide filter suggestions for primitive values, since they're the only kinds of values\n        // that can be filtered on.\n        for (const name of Object.keys(structureTraversalResult.structureItem.nextByName)) {\n          const item = structureTraversalResult.structureItem.nextByName[name];\n          if (item?.structureType === \"primitive\") {\n            items.push(`${name}==${getExamplePrimitive(item.primitiveType)}`);\n          }\n        }\n\n        const filterText = msgPathPart.path.join(\".\");\n\n        return {\n          autocompleteItems: items,\n          autocompleteFilterText: filterText,\n          autocompleteRange: {\n            start: msgPathPart.nameLoc,\n            end: msgPathPart.nameLoc + filterText.length,\n          },\n        };\n      } else {\n        // Exclude any initial filters (\"/topic{foo=='bar'}\") from the range that will be replaced\n        // when the user chooses a new message path.\n        const initialFilterLength =\n          rosPath.messagePath[0]?.type === \"filter\" ? rosPath.messagePath[0].repr.length + 2 : 0;\n\n        return {\n          autocompleteItems:\n            topic.schemaName == undefined\n              ? []\n              : messagePathsForDatatype(topic.schemaName, datatypes, {\n                  validTypes,\n                  noMultiSlices,\n                  messagePath: rosPath.messagePath,\n                }).filter(\n                  // .header.seq is pretty useless but shows up everryyywhere.\n                  (msgPath) => msgPath !== \"\" && !msgPath.endsWith(\".header.seq\"),\n                ),\n\n          autocompleteRange: {\n            start: rosPath.topicNameRepr.length + initialFilterLength,\n            end: Infinity,\n          },\n          // Filter out filters (hah!) in a pretty crude way, so autocomplete still works\n          // when already having specified a filter and you want to see what other object\n          // names you can complete it with. Kind of an edge case, and this doesn't work\n          // ideally (because it will remove your existing filter if you actually select\n          // the autocomplete item), but it's easy to do for now, and nice to have.\n          autocompleteFilterText: path\n            .substring(rosPath.topicNameRepr.length)\n            .replace(/\\{[^}]*\\}/g, \"\"),\n        };\n      }\n    } else if (invalidGlobalVariablesVariable) {\n      return {\n        autocompleteItems: Object.keys(globalVariables).map((key) => `$${key}`),\n        autocompleteRange: {\n          start: invalidGlobalVariablesVariable.loc,\n          end:\n            invalidGlobalVariablesVariable.loc +\n            invalidGlobalVariablesVariable.variableName.length +\n            1,\n        },\n        autocompleteFilterText: invalidGlobalVariablesVariable.variableName,\n      };\n    }\n\n    return {\n      autocompleteItems: [],\n      autocompleteFilterText: \"\",\n      autocompleteRange: { start: 0, end: Infinity },\n    };\n  }, [\n    disableAutocomplete,\n    autocompleteType,\n    topic,\n    rosPath,\n    invalidGlobalVariablesVariable,\n    path,\n    topicNamesAutocompleteItems,\n    topicNamesAndFieldsAutocompleteItems,\n    structureTraversalResult,\n    datatypes,\n    validTypes,\n    noMultiSlices,\n    globalVariables,\n  ]);\n\n  const orderedAutocompleteItems = useMemo(() => {\n    if (prioritizedDatatype == undefined) {\n      return autocompleteItems;\n    }\n\n    return flatten(\n      partition(\n        autocompleteItems,\n        (item) => getTopicsByTopicName(topics)[item]?.schemaName === prioritizedDatatype,\n      ),\n    );\n  }, [autocompleteItems, prioritizedDatatype, topics]);\n\n  const usesUnsupportedMathModifier =\n    (supportsMathModifiers == undefined || !supportsMathModifiers) && path.includes(\".@\");\n\n  const hasError =\n    usesUnsupportedMathModifier ||\n    (autocompleteType != undefined && !disableAutocomplete && path.length > 0);\n\n  return (\n    <Stack\n      direction=\"row\"\n      justifyContent=\"space-between\"\n      alignItems=\"center\"\n      flexGrow={1}\n      flexShrink={0}\n      spacing={0.25}\n    >\n      <Autocomplete\n        items={orderedAutocompleteItems}\n        disabled={props.disabled}\n        readOnly={props.readOnly}\n        filterText={autocompleteFilterText}\n        value={path}\n        onChange={onChange}\n        onSelect={(value, autocomplete) =>\n          onSelect(value, autocomplete, autocompleteType, autocompleteRange)\n        }\n        hasError={hasError}\n        placeholder={\n          placeholder != undefined && placeholder !== \"\" ? placeholder : \"/some/topic.msgs[0].field\"\n        }\n        autoSize={autoSize}\n        inputStyle={inputStyle} // Disable autoselect since people often construct complex queries, and it's very annoying\n        // to have the entire input selected whenever you want to make a change to a part it.\n        disableAutoSelect\n      />\n    </Stack>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nexport const TypicalFilterNames = [\"id\", \"_id\", \"ID\", \"Id\"];\n\nexport function isTypicalFilterName(name: string): boolean {\n  return /^id$|_id$|I[dD]$/.test(name);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport natsort from \"natsort\";\n\nconst sortFn = natsort({ insensitive: true });\n\ntype StringOrNumberFields<T> = T extends Record<string, unknown>\n  ? { [K in keyof T]: T[K] extends string | number ? K : never }[keyof T]\n  : never;\n\nfunction naturalSort(): typeof sortFn;\nfunction naturalSort<T, K extends StringOrNumberFields<T>>(key: K): (a: T, b: T) => number;\nfunction naturalSort<T, K extends StringOrNumberFields<T>>(key?: K): unknown {\n  return key == undefined\n    ? sortFn\n    : (a: T, b: T) =>\n        sortFn(a[key] as unknown as string | number, b[key] as unknown as string | number);\n}\n\nexport default naturalSort;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nconst RosPrimitives = {\n  bool: undefined,\n  int8: undefined,\n  uint8: undefined,\n  int16: undefined,\n  uint16: undefined,\n  int32: undefined,\n  uint32: undefined,\n  int64: undefined,\n  uint64: undefined,\n  float32: undefined,\n  float64: undefined,\n  string: undefined,\n  json: undefined,\n};\n\nexport type RosPrimitive = keyof typeof RosPrimitives;\nexport const rosPrimitives = Object.keys(RosPrimitives) as RosPrimitive[];\n\nexport type MessagePathFilter = {\n  type: \"filter\";\n  path: string[];\n  value?: number | string | bigint | { variableName: string; startLoc: number };\n  nameLoc: number;\n  valueLoc: number;\n  repr: string; // the original string representation of the filter\n};\n\n// A parsed version of paths.\nexport type MessagePathPart =\n  | {\n      type: \"name\";\n      /** Referenced field name */\n      name: string;\n      /**\n       * Original spelling of the field name in the input message path (for accurate reproduction in\n       * autocomplete and string length)\n       */\n      repr: string;\n    }\n  | {\n      type: \"slice\";\n      start: number | { variableName: string; startLoc: number };\n      end: number | { variableName: string; startLoc: number };\n    }\n  | MessagePathFilter;\n\nexport type RosPath = {\n  /** Referenced topic name */\n  topicName: string;\n  /**\n   * Original spelling of the topic name in the input message path (for accurate reproduction in\n   * autocomplete and string length)\n   */\n  topicNameRepr: string;\n  messagePath: MessagePathPart[];\n  modifier?: string;\n};\n\n// \"Structure items\" are a more useful version of `datatypes`. They can be\n// easily traversed to either validate message paths or generate message paths.\nexport type MessagePathStructureItemMessage = {\n  structureType: \"message\";\n  nextByName: {\n    [key: string]: MessagePathStructureItem;\n  };\n  datatype: string;\n};\ntype MessagePathStructureItemArray = {\n  structureType: \"array\";\n  next: MessagePathStructureItem;\n  datatype: string;\n};\ntype MessagePathStructureItemPrimitive = {\n  structureType: \"primitive\";\n  primitiveType: RosPrimitive;\n  datatype: string;\n};\nexport type MessagePathStructureItem =\n  | MessagePathStructureItemMessage\n  | MessagePathStructureItemArray\n  | MessagePathStructureItemPrimitive;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { memoize } from \"lodash\";\nimport memoizeWeak from \"memoize-weak\";\n\nimport { MessagePathFilter } from \"@foxglove/studio-base/components/MessagePathSyntax/constants\";\nimport { isTypicalFilterName } from \"@foxglove/studio-base/components/MessagePathSyntax/isTypicalFilterName\";\nimport { quoteFieldNameIfNeeded } from \"@foxglove/studio-base/components/MessagePathSyntax/parseRosPath\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { assertNever } from \"@foxglove/studio-base/util/assertNever\";\nimport naturalSort from \"@foxglove/studio-base/util/naturalSort\";\n\nimport {\n  MessagePathPart,\n  rosPrimitives,\n  RosPrimitive,\n  MessagePathStructureItem,\n  MessagePathStructureItemMessage,\n} from \"./constants\";\n\nconst STRUCTURE_ITEM_INTEGER_TYPES = [\n  \"int8\",\n  \"uint8\",\n  \"int16\",\n  \"uint16\",\n  \"int32\",\n  \"uint32\",\n  \"int64\",\n  \"uint64\",\n];\n\nfunction isRosPrimitive(type: string): type is RosPrimitive {\n  return rosPrimitives.includes(type as RosPrimitive);\n}\n\nfunction structureItemIsIntegerPrimitive(item: MessagePathStructureItem) {\n  return (\n    item.structureType === \"primitive\" && STRUCTURE_ITEM_INTEGER_TYPES.includes(item.primitiveType)\n  );\n}\n\n// Generate an easily navigable flat structure given some `datatypes`. We cache\n// this loosely as `datatypes` don't change after the player has connected.\n// The structure looks something like this:\n//\n// {\n//   \"/datatype/name\": {\n//     structureType: \"message\",\n//     nextByName: {\n//       \"some-sub-field\": {\n//         structureType: \"primitive\",\n//         primitiveType: \"uint8\",\n//       }\n//       \"some-boolean-array-sub-field\": {\n//         structureType: \"array\",\n//         next: {\n//           structureType: \"primitive\",\n//           primitiveType: \"bool\"\n//         }\n//       }\n//     }\n//   }\n// }\nlet lastDatatypes: RosDatatypes | undefined;\nlet lastStructures: Record<string, MessagePathStructureItemMessage> | undefined;\nexport function messagePathStructures(\n  datatypes: RosDatatypes,\n): Record<string, MessagePathStructureItemMessage> {\n  if (lastDatatypes === datatypes && lastStructures) {\n    return lastStructures;\n  }\n\n  lastDatatypes = undefined;\n  const structureFor = memoize(\n    (datatype: string, seenDatatypes: string[]): MessagePathStructureItemMessage => {\n      const nextByName: Record<string, MessagePathStructureItem> = {};\n      const rosDatatype = datatypes.get(datatype);\n      if (!rosDatatype) {\n        // \"time\" and \"duration\" are considered \"built-in\" types in ROS\n        // If we can't find a datatype in our datatypes list we fall-back to our hard-coded versions\n        if (datatype === \"time\" || datatype === \"duration\") {\n          return {\n            structureType: \"message\",\n            nextByName: {\n              sec: {\n                structureType: \"primitive\",\n                primitiveType: \"uint32\",\n                datatype: \"\",\n              },\n              nsec: {\n                structureType: \"primitive\",\n                primitiveType: \"uint32\",\n                datatype: \"\",\n              },\n            },\n            datatype,\n          };\n        }\n\n        throw new Error(`datatype not found: \"${datatype}\"`);\n      }\n      rosDatatype.definitions.forEach((msgField) => {\n        if (msgField.isConstant === true) {\n          return;\n        }\n\n        if (seenDatatypes.includes(msgField.type)) {\n          return;\n        }\n\n        const next: MessagePathStructureItem = isRosPrimitive(msgField.type)\n          ? {\n              structureType: \"primitive\",\n              primitiveType: msgField.type,\n              datatype,\n            }\n          : structureFor(msgField.type, [...seenDatatypes, msgField.type]);\n\n        if (msgField.isArray === true) {\n          nextByName[msgField.name] = { structureType: \"array\", next, datatype };\n        } else {\n          nextByName[msgField.name] = next;\n        }\n      });\n      return { structureType: \"message\", nextByName, datatype };\n    },\n  );\n\n  lastStructures = {};\n  for (const [datatype] of datatypes) {\n    lastStructures[datatype] = structureFor(datatype, []);\n  }\n  lastDatatypes = datatypes; // Set at the very end, in case there's an error earlier.\n  return lastStructures;\n}\n\nexport function validTerminatingStructureItem(\n  structureItem?: MessagePathStructureItem,\n  validTypes?: readonly string[],\n): boolean {\n  return (\n    !!structureItem &&\n    (!validTypes ||\n      validTypes.includes(structureItem.structureType) ||\n      validTypes.includes(structureItem.datatype) ||\n      (structureItem.structureType === \"primitive\" &&\n        validTypes.includes(structureItem.primitiveType)))\n  );\n}\n\n// Given a datatype, the array of datatypes, and a list of valid types,\n// list out all valid strings for the `messagePath` part of the path (sorted).\nexport function messagePathsForDatatype(\n  datatype: string,\n  datatypes: RosDatatypes,\n  {\n    validTypes,\n    noMultiSlices,\n    messagePath = [],\n  }: {\n    validTypes?: readonly string[];\n    noMultiSlices?: boolean;\n    messagePath?: MessagePathPart[];\n  } = {},\n): string[] {\n  let clonedMessagePath = [...messagePath];\n  const messagePaths: string[] = [];\n  function traverse(structureItem: MessagePathStructureItem, builtString: string) {\n    if (validTerminatingStructureItem(structureItem, validTypes)) {\n      messagePaths.push(builtString);\n    }\n    if (structureItem.structureType === \"message\") {\n      for (const [name, item] of Object.entries(structureItem.nextByName)) {\n        traverse(item, `${builtString}.${quoteFieldNameIfNeeded(name)}`);\n      }\n    } else if (structureItem.structureType === \"array\") {\n      if (structureItem.next.structureType === \"message\") {\n        // When we have an array of messages, you probably want to filter on\n        // some field, like `/topic.object{some_id=123}`. If we can't find a\n        // typical filter name, fall back to `/topic.object[0]`.\n        const typicalFilterItem = Object.entries(structureItem.next.nextByName).find(([name]) =>\n          isTypicalFilterName(name),\n        );\n        if (typicalFilterItem) {\n          const [typicalFilterName, typicalFilterValue] = typicalFilterItem;\n\n          // Find matching filter from clonedMessagePath\n          const matchingFilterPart = clonedMessagePath.find(\n            (pathPart): pathPart is MessagePathFilter =>\n              pathPart.type === \"filter\" && pathPart.path[0] === typicalFilterName,\n          );\n\n          // Format the displayed filter value\n          if (matchingFilterPart) {\n            // Remove the matching filter from clonedMessagePath, for future searches\n            clonedMessagePath = clonedMessagePath.filter(\n              (pathPart) => pathPart !== matchingFilterPart,\n            );\n            traverse(\n              structureItem.next,\n              `${builtString}[:]{${typicalFilterName}==${\n                typeof matchingFilterPart.value === \"object\"\n                  ? `$${matchingFilterPart.value.variableName}`\n                  : matchingFilterPart.value\n              }}`,\n            );\n          } else if (structureItemIsIntegerPrimitive(typicalFilterValue)) {\n            traverse(structureItem.next, `${builtString}[:]{${typicalFilterName}==0}`);\n          } else {\n            traverse(structureItem.next, `${builtString}[0]`);\n          }\n        } else {\n          traverse(structureItem.next, `${builtString}[0]`);\n        }\n      } else if (noMultiSlices !== true) {\n        // When dealing with an array of primitives, you likely just want a\n        // scatter plot (if we can do multi-slices).\n        traverse(structureItem.next, `${builtString}[:]`);\n      } else {\n        traverse(structureItem.next, `${builtString}[0]`);\n      }\n    }\n  }\n  const structureItem = messagePathStructures(datatypes)[datatype];\n  if (structureItem != undefined) {\n    traverse(structureItem, \"\");\n  }\n  return messagePaths.sort(naturalSort());\n}\n\nexport type StructureTraversalResult = {\n  valid: boolean;\n  msgPathPart?: MessagePathPart;\n  structureItem?: MessagePathStructureItem;\n};\n\n// Traverse down the structure given a `messagePath`. Return if the path\n// is valid, given the structure, `validTypes`, and `noMultiSlices`.\n//\n// We return the `msgPathPart` that was invalid to determine what sort\n// of autocomplete we should show.\n//\n// We use memoizeWeak because it works with multiple arguments (lodash's memoize\n// does not) and does not hold onto objects as strongly (it uses WeakMap).\nexport const traverseStructure = memoizeWeak(\n  (\n    initialStructureItem: MessagePathStructureItem | undefined,\n    messagePath: MessagePathPart[],\n  ): StructureTraversalResult => {\n    let structureItem = initialStructureItem;\n    if (!structureItem) {\n      return { valid: false, msgPathPart: undefined, structureItem: undefined };\n    }\n    for (const msgPathPart of messagePath) {\n      if (!structureItem) {\n        return { valid: false, msgPathPart, structureItem };\n      }\n      if (\"primitiveType\" in structureItem && structureItem.primitiveType === \"json\") {\n        // No need to continue validating if we're dealing with JSON. We\n        // essentially treat all nested values as valid.\n        continue;\n      } else if (msgPathPart.type === \"name\") {\n        if (structureItem.structureType !== \"message\") {\n          return { valid: false, msgPathPart, structureItem };\n        }\n        const next: MessagePathStructureItem | undefined =\n          structureItem.nextByName[msgPathPart.name];\n        const nextStructureIsJson: boolean =\n          next != undefined && next.structureType === \"primitive\" && next.primitiveType === \"json\";\n        structureItem = !nextStructureIsJson\n          ? next\n          : {\n              structureType: \"primitive\",\n              primitiveType: \"json\",\n              datatype: next ? next.datatype : \"\",\n            };\n      } else if (msgPathPart.type === \"slice\") {\n        if (structureItem.structureType !== \"array\") {\n          return { valid: false, msgPathPart, structureItem };\n        }\n        structureItem = structureItem.next;\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      } else if (msgPathPart.type === \"filter\") {\n        if (\n          structureItem.structureType !== \"message\" ||\n          msgPathPart.path.length === 0 ||\n          msgPathPart.value == undefined\n        ) {\n          return { valid: false, msgPathPart, structureItem };\n        }\n        let currentItem: MessagePathStructureItem | undefined = structureItem;\n        for (const name of msgPathPart.path) {\n          if (currentItem.structureType !== \"message\") {\n            return { valid: false, msgPathPart, structureItem };\n          }\n          currentItem = currentItem.nextByName[name];\n          if (currentItem == undefined) {\n            return { valid: false, msgPathPart, structureItem };\n          }\n        }\n      } else {\n        assertNever(\n          msgPathPart,\n          `Invalid msgPathPart.type: ${(msgPathPart as MessagePathPart).type}`,\n        );\n      }\n    }\n    return { valid: true, msgPathPart: undefined, structureItem };\n  },\n);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { memoize, uniq } from \"lodash\";\nimport { Parser, Grammar } from \"nearley\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\n\nimport { RosPath } from \"./constants\";\nimport grammar from \"./grammar.ne\";\n\nconst grammarObj = Grammar.fromCompiled(grammar);\n\n/** Wrap topic name in double quotes if it contains special characters */\nexport function quoteTopicNameIfNeeded(name: string): string {\n  // Pattern should match `slashID` in grammar.ne\n  if (name.match(/^[a-zA-Z0-9_/-]+$/)) {\n    return name;\n  }\n  return `\"${name.replace(/[\\\\\"]/g, (char) => `\\\\${char}`)}\"`;\n}\n\n/** Wrap field name in double quotes if it contains special characters */\nexport function quoteFieldNameIfNeeded(name: string): string {\n  // Pattern should match `id` in grammar.ne\n  if (name.match(/^[a-zA-Z0-9_-]+$/)) {\n    return name;\n  }\n  return `\"${name.replace(/[\\\\\"]/g, (char) => `\\\\${char}`)}\"`;\n}\n\nconst parseRosPath = memoize((path: string): RosPath | undefined => {\n  // Need to create a new Parser object for every new string to parse (should be cheap).\n  const parser = new Parser(grammarObj);\n  try {\n    return parser.feed(path).results[0];\n  } catch (_) {\n    return undefined;\n  }\n});\nexport default parseRosPath;\n\nexport function getTopicsFromPaths(paths: string[]): string[] {\n  return uniq(\n    filterMap(paths, (path) => {\n      const rosPath = parseRosPath(path);\n      return rosPath ? rosPath.topicName : undefined;\n    }),\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport Logger from \"@foxglove/log\";\nimport { Time, isLessThan, subtract as subtractTimes, toSec } from \"@foxglove/rostime\";\nimport { PlayerState, MessageEvent, PlayerProblem } from \"@foxglove/studio-base/players/types\";\nimport { formatFrame } from \"@foxglove/studio-base/util/time\";\n\nconst DRIFT_THRESHOLD_SEC = 1; // Maximum amount of drift allowed.\nconst WAIT_FOR_SEEK_SEC = 1; // How long we wait for a change in `lastSeekTime` before warning.\n\nconst log = Logger.getLogger(__filename);\n\n// Logs a warning when there is a significant difference (more than `DRIFT_THRESHOLD_SEC`) between\n// a message's timestamp and `player.currentTime` OR when messages went back in time,\n// except when `player.lastSeekTime` changes, in which case panels should be clearing out their stored data.\n//\n// This is to ensure that other mechanisms that we have in place for either discarding old messages\n// or forcing an update of `player.lastSeekTime` are working properly.\nclass MessageOrderTracker {\n  private lastMessages: readonly MessageEvent<unknown>[] = [];\n  private lastCurrentTime?: Time;\n  private lastMessageTime?: Time;\n  private lastMessageTopic?: string;\n  private lastLastSeekTime?: number;\n  private warningTimeout?: ReturnType<typeof setTimeout>;\n\n  /**\n   * Set this to `true` to debug out-of-order messages. It is disabled by default in production\n   * because logging messages to the console prevents them from getting garbage-collected as long as\n   * the console is not cleared.\n   */\n  private trackIncorrectMessages = false;\n\n  private incorrectMessages: MessageEvent<unknown>[] = [];\n\n  public update(playerState: PlayerState): PlayerProblem[] {\n    if (!playerState.activeData) {\n      return [];\n    }\n\n    const problems: PlayerProblem[] = [];\n\n    const { messages, currentTime, lastSeekTime } = playerState.activeData;\n    let didSeek = false;\n\n    if (this.lastLastSeekTime !== lastSeekTime) {\n      this.lastLastSeekTime = lastSeekTime;\n      if (this.warningTimeout) {\n        clearTimeout(this.warningTimeout);\n        this.warningTimeout = undefined;\n        this.incorrectMessages = [];\n      }\n      this.warningTimeout = this.lastMessageTime = this.lastCurrentTime = undefined;\n      this.lastMessages = [];\n      didSeek = true;\n    }\n    if (this.lastMessages !== messages || this.lastCurrentTime !== currentTime) {\n      this.lastMessages = messages;\n      this.lastCurrentTime = currentTime;\n      for (const message of messages) {\n        const messageTime = message.receiveTime;\n\n        // The first emit after a seek occurs from a backfill. This backfill might produce messages\n        // much older than the seek time.\n        if (!didSeek) {\n          const currentTimeDrift = Math.abs(toSec(subtractTimes(messageTime, currentTime)));\n          if (currentTimeDrift > DRIFT_THRESHOLD_SEC) {\n            if (this.trackIncorrectMessages) {\n              this.incorrectMessages.push(message);\n            }\n            if (!this.warningTimeout) {\n              this.warningTimeout = setTimeout(() => {\n                // timeout has fired, we need to clear so a new timeout registers if there are more messages\n                this.warningTimeout = undefined;\n                // reset incorrect message queue before posting warning so we never keep\n                // incorrectMessages around. The browser console will keep messages in memory when\n                // logged, so disable logging of messages unless explicitly enabled.\n                const info = {\n                  currentTime,\n                  lastSeekTime,\n                  messageTime,\n                  incorrectMessages: this.trackIncorrectMessages\n                    ? this.incorrectMessages\n                    : \"not being tracked\",\n                };\n                this.incorrectMessages = [];\n                log.warn(\n                  `Message receiveTime very different from player.currentTime; without updating lastSeekTime`,\n                  info,\n                );\n              }, WAIT_FOR_SEEK_SEC * 1000);\n            }\n          }\n        }\n\n        if (\n          this.lastMessageTime &&\n          this.lastMessageTopic != undefined &&\n          isLessThan(messageTime, this.lastMessageTime)\n        ) {\n          const formattedTime = formatFrame(messageTime);\n          const lastMessageTime = formatFrame(this.lastMessageTime);\n          const errorMessage =\n            `Processed a message on ${message.topic} at ${formattedTime} which is earlier than ` +\n            `last processed message on ${this.lastMessageTopic} at ${lastMessageTime}.`;\n\n          problems.push({\n            severity: \"warn\",\n            message: \"Data went back in time\",\n            error: new Error(errorMessage),\n          });\n        }\n        this.lastMessageTopic = message.topic;\n        this.lastMessageTime = messageTime;\n      }\n    }\n\n    return problems;\n  }\n}\n\nexport default MessageOrderTracker;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nasync function promiseTimeout<T>(\n  promise: Promise<T>,\n  ms = 30000,\n  reason = \"unknown reason\",\n): Promise<T> {\n  let id: ReturnType<typeof setTimeout> | undefined;\n  return await Promise.race([\n    promise.then((result) => {\n      if (id != undefined) {\n        clearTimeout(id);\n      }\n      return result;\n    }),\n    new Promise<T>((_resolve, reject) => {\n      id = setTimeout(() => reject(new Error(`Promise timed out after ${ms}ms: ${reason} `)), ms);\n    }),\n  ]);\n}\n\nexport default promiseTimeout;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport promiseTimeout from \"@foxglove/studio-base/util/promiseTimeout\";\nimport sendNotification from \"@foxglove/studio-base/util/sendNotification\";\n\nexport type FramePromise = { name: string; promise: Promise<void> };\n\n// Wait longer before erroring if there's no user waiting (in automated run)\nexport const MAX_PROMISE_TIMEOUT_TIME_MS = 5000;\n\nexport async function pauseFrameForPromises(promises: FramePromise[]): Promise<void> {\n  try {\n    await promiseTimeout(\n      Promise.all(promises.map(async ({ promise }) => await promise)),\n      MAX_PROMISE_TIMEOUT_TIME_MS,\n    );\n  } catch (error) {\n    // An async render task failed to finish in time; some panels may display data from the wrong frame.\n    const isTimeoutError = (error as Error).message.includes(\"Promise timed out\");\n    if (!isTimeoutError) {\n      sendNotification(\"Player \", error, \"app\", \"error\");\n      return;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { flatten } from \"lodash\";\nimport { MutableRefObject } from \"react\";\nimport shallowequal from \"shallowequal\";\nimport { createStore, StoreApi } from \"zustand\";\n\nimport { Condvar } from \"@foxglove/den/async\";\nimport { MessageEvent } from \"@foxglove/studio\";\nimport {\n  AdvertiseOptions,\n  Player,\n  PlayerCapabilities,\n  PlayerPresence,\n  PlayerState,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\nimport { assertNever } from \"@foxglove/studio-base/util/assertNever\";\n\nimport { FramePromise } from \"./pauseFrameForPromise\";\nimport { MessagePipelineContext } from \"./types\";\n\nexport function defaultPlayerState(): PlayerState {\n  return {\n    presence: PlayerPresence.NOT_PRESENT,\n    progress: {},\n    capabilities: [],\n    profile: undefined,\n    playerId: \"\",\n    activeData: undefined,\n  };\n}\n\nexport type MessagePipelineInternalState = {\n  dispatch: (action: MessagePipelineStateAction) => void;\n\n  player?: Player;\n\n  /** used to keep track of whether we need to update public.startPlayback/playUntil/etc. */\n  lastCapabilities: string[];\n\n  subscriptionsById: Map<string, SubscribePayload[]>;\n  publishersById: { [key: string]: AdvertiseOptions[] };\n  allPublishers: AdvertiseOptions[];\n  subscriberIdsByTopic: Map<string, string[]>;\n  newTopicsBySubscriberId: Map<string, Set<string>>;\n  lastMessageEventByTopic: Map<string, MessageEvent<unknown>>;\n  /** Function to call when react render has completed with the latest state */\n  renderDone?: () => void;\n\n  /** Part of the state that is exposed to consumers via useMessagePipeline */\n  public: MessagePipelineContext;\n};\n\ntype UpdateSubscriberAction = {\n  type: \"update-subscriber\";\n  id: string;\n  payloads: SubscribePayload[];\n};\ntype UpdatePlayerStateAction = {\n  type: \"update-player-state\";\n  playerState: PlayerState;\n  renderDone?: () => void;\n};\n\nexport type MessagePipelineStateAction =\n  | UpdateSubscriberAction\n  | UpdatePlayerStateAction\n  | { type: \"set-player\"; player: Player | undefined }\n  | { type: \"set-publishers\"; id: string; payloads: AdvertiseOptions[] };\n\nexport function createMessagePipelineStore({\n  promisesToWaitForRef,\n  initialPlayer,\n}: {\n  promisesToWaitForRef: MutableRefObject<FramePromise[]>;\n  initialPlayer: Player | undefined;\n}): StoreApi<MessagePipelineInternalState> {\n  return createStore((set, get) => ({\n    player: initialPlayer,\n    dispatch(action) {\n      set((state) => reducer(state, action));\n    },\n    publishersById: {},\n    allPublishers: [],\n    subscriptionsById: new Map(),\n    subscriberIdsByTopic: new Map(),\n    newTopicsBySubscriberId: new Map(),\n    lastMessageEventByTopic: new Map(),\n    lastCapabilities: [],\n\n    public: {\n      playerState: defaultPlayerState(),\n      messageEventsBySubscriberId: new Map(),\n      subscriptions: [],\n      sortedTopics: [],\n      datatypes: new Map(),\n      setSubscriptions(id, payloads) {\n        get().dispatch({ type: \"update-subscriber\", id, payloads });\n      },\n      setPublishers(id, payloads) {\n        get().dispatch({ type: \"set-publishers\", id, payloads });\n        get().player?.setPublishers(get().allPublishers);\n      },\n      setParameter(key, value) {\n        get().player?.setParameter(key, value);\n      },\n      publish(payload) {\n        get().player?.publish(payload);\n      },\n      async callService(service, request) {\n        const player = get().player;\n        if (player) {\n          return await player.callService(service, request);\n        }\n        throw new Error(\"callService called when player is not present\");\n      },\n      startPlayback: undefined,\n      playUntil: undefined,\n      pausePlayback: undefined,\n      setPlaybackSpeed: undefined,\n      seekPlayback: undefined,\n\n      pauseFrame(name: string) {\n        const condvar = new Condvar();\n        promisesToWaitForRef.current.push({ name, promise: condvar.wait() });\n        return () => {\n          condvar.notifyAll();\n        };\n      },\n    },\n  }));\n}\n// Update state with a subscriber. Any new topics for the subscriber are tracked in newTopicsBySubscriberId\n// to receive the last message on their newly subscribed topics.\nfunction updateSubscriberAction(\n  prevState: MessagePipelineInternalState,\n  action: UpdateSubscriberAction,\n): MessagePipelineInternalState {\n  const previousSubscriptionsById = prevState.subscriptionsById;\n  const newTopicsBySubscriberId = new Map(prevState.newTopicsBySubscriberId);\n\n  // Record any _new_ topics for this subscriber into newTopicsBySubscriberId\n  const newTopics = newTopicsBySubscriberId.get(action.id);\n  if (!newTopics) {\n    const actionTopics = action.payloads.map((sub) => sub.topic);\n    newTopicsBySubscriberId.set(action.id, new Set(actionTopics));\n  } else {\n    const previousSubscription = previousSubscriptionsById.get(action.id);\n    const prevTopics = new Set(previousSubscription?.map((sub) => sub.topic) ?? []);\n    for (const { topic: newTopic } of action.payloads) {\n      if (!prevTopics.has(newTopic)) {\n        newTopics.add(newTopic);\n      }\n    }\n  }\n\n  const newSubscriptionsById = new Map(previousSubscriptionsById);\n\n  if (action.payloads.length === 0) {\n    // When a subscription id has no topics we removed it from our map\n    newSubscriptionsById.delete(action.id);\n  } else {\n    newSubscriptionsById.set(action.id, action.payloads);\n  }\n\n  const subscriberIdsByTopic = new Map<string, string[]>();\n\n  const subscriptions: SubscribePayload[] = [];\n\n  // make a map of topics to subscriber ids\n  for (const [id, subs] of newSubscriptionsById) {\n    for (const subscription of subs) {\n      const topic = subscription.topic;\n\n      const ids = subscriberIdsByTopic.get(topic) ?? [];\n      ids.push(id);\n      subscriberIdsByTopic.set(topic, ids);\n      subscriptions.push(subscription);\n    }\n  }\n\n  return {\n    ...prevState,\n    subscriptionsById: newSubscriptionsById,\n    subscriberIdsByTopic,\n    newTopicsBySubscriberId,\n    public: {\n      ...prevState.public,\n      subscriptions,\n    },\n  };\n}\n// Update with a player state.\n// Put messages from the player state into messagesBySubscriberId. Any new topic subscribers, receive\n// the last message on a topic.\nfunction updatePlayerStateAction(\n  prevState: MessagePipelineInternalState,\n  action: UpdatePlayerStateAction,\n): MessagePipelineInternalState {\n  const messages = action.playerState.activeData?.messages;\n\n  const seenTopics = new Set<string>();\n\n  // We need a new set of message arrays for each subscriber since downstream users rely\n  // on object instance reference checks to determine if there are new messages\n  const messagesBySubscriberId = new Map<string, MessageEvent<unknown>[]>();\n\n  const subsById = prevState.subscriptionsById;\n  const subscriberIdsByTopic = prevState.subscriberIdsByTopic;\n\n  const lastMessageEventByTopic = prevState.lastMessageEventByTopic;\n  const newTopicsBySubscriberId = new Map(prevState.newTopicsBySubscriberId);\n\n  // Put messages into per-subscriber queues\n  if (messages && messages !== prevState.public.playerState.activeData?.messages) {\n    for (const messageEvent of messages) {\n      // Save the last message on every topic to send the last message\n      // to newly subscribed panels.\n      lastMessageEventByTopic.set(messageEvent.topic, messageEvent);\n\n      seenTopics.add(messageEvent.topic);\n      const ids = subscriberIdsByTopic.get(messageEvent.topic);\n      if (!ids) {\n        continue;\n      }\n\n      for (const id of ids) {\n        let subscriberMessageEvents = messagesBySubscriberId.get(id);\n        if (!subscriberMessageEvents) {\n          subscriberMessageEvents = [];\n          messagesBySubscriberId.set(id, subscriberMessageEvents);\n        }\n        subscriberMessageEvents.push(messageEvent);\n      }\n    }\n  }\n\n  // Inject the last message on a topic to all new subscribers of the topic\n  for (const id of subsById.keys()) {\n    const newTopics = newTopicsBySubscriberId.get(id);\n    if (!newTopics) {\n      continue;\n    }\n    for (const topic of newTopics) {\n      // If we had a message for this topic in the regular set of messages, we don't need to inject\n      // another message.\n      if (seenTopics.has(topic)) {\n        continue;\n      }\n      const msgEvent = lastMessageEventByTopic.get(topic);\n      if (msgEvent) {\n        const subscriberMessageEvents = messagesBySubscriberId.get(id) ?? [];\n        // the injected message is older than any new messages\n        subscriberMessageEvents.unshift(msgEvent);\n        messagesBySubscriberId.set(id, subscriberMessageEvents);\n      }\n    }\n    // We've processed all new subscriber topics into message queues\n    newTopics.clear();\n  }\n\n  const newPublicState = {\n    ...prevState.public,\n    playerState: action.playerState,\n    messageEventsBySubscriberId: messagesBySubscriberId,\n  };\n\n  const topics = action.playerState.activeData?.topics;\n  if (topics !== prevState.public.playerState.activeData?.topics) {\n    newPublicState.sortedTopics = topics\n      ? [...topics].sort((a, b) => a.name.localeCompare(b.name))\n      : [];\n  }\n  if (\n    action.playerState.activeData?.datatypes !== prevState.public.playerState.activeData?.datatypes\n  ) {\n    newPublicState.datatypes = action.playerState.activeData?.datatypes ?? new Map();\n  }\n\n  const capabilities = action.playerState.capabilities;\n  const player = prevState.player;\n  if (player && !shallowequal(capabilities, prevState.lastCapabilities)) {\n    newPublicState.startPlayback = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.startPlayback?.bind(player)\n      : undefined;\n    newPublicState.playUntil = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.playUntil?.bind(player)\n      : undefined;\n    newPublicState.pausePlayback = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.pausePlayback?.bind(player)\n      : undefined;\n    newPublicState.setPlaybackSpeed = capabilities.includes(PlayerCapabilities.setSpeed)\n      ? player.setPlaybackSpeed?.bind(player)\n      : undefined;\n    newPublicState.seekPlayback = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.seekPlayback?.bind(player)\n      : undefined;\n  }\n\n  return {\n    ...prevState,\n    newTopicsBySubscriberId,\n    renderDone: action.renderDone,\n    public: newPublicState,\n    lastCapabilities: capabilities,\n  };\n}\n\nexport function reducer(\n  prevState: MessagePipelineInternalState,\n  action: MessagePipelineStateAction,\n): MessagePipelineInternalState {\n  switch (action.type) {\n    case \"update-player-state\":\n      return updatePlayerStateAction(prevState, action);\n    case \"update-subscriber\":\n      return updateSubscriberAction(prevState, action);\n\n    case \"set-publishers\": {\n      const newPublishersById = { ...prevState.publishersById, [action.id]: action.payloads };\n\n      return {\n        ...prevState,\n        publishersById: newPublishersById,\n        allPublishers: flatten(Object.values(newPublishersById)),\n      };\n    }\n\n    case \"set-player\":\n      if (action.player === prevState.player) {\n        return prevState;\n      }\n      return {\n        ...prevState,\n        player: action.player,\n        lastCapabilities: [],\n        lastMessageEventByTopic: new Map(),\n        public: {\n          ...prevState.public,\n          sortedTopics: [],\n          datatypes: new Map(),\n          messageEventsBySubscriberId: new Map(),\n          startPlayback: undefined,\n          pausePlayback: undefined,\n          playUntil: undefined,\n          setPlaybackSpeed: undefined,\n          seekPlayback: undefined,\n        },\n      };\n  }\n\n  assertNever(\n    action,\n    `Unhandled message pipeline action type ${(action as MessagePipelineStateAction).type}`,\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { debounce } from \"lodash\";\nimport {\n  createContext,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\nimport {\n  Player,\n  PlayerProblem,\n  PlayerState,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\n\nimport MessageOrderTracker from \"./MessageOrderTracker\";\nimport { pauseFrameForPromises, FramePromise } from \"./pauseFrameForPromise\";\nimport {\n  MessagePipelineInternalState,\n  createMessagePipelineStore,\n  MessagePipelineStateAction,\n  defaultPlayerState,\n} from \"./store\";\nimport { MessagePipelineContext } from \"./types\";\n\nexport type { MessagePipelineContext };\n\n// exported only for MockMessagePipelineProvider\nexport const ContextInternal = createContext<StoreApi<MessagePipelineInternalState> | undefined>(\n  undefined,\n);\n\n/**\n * useMessagePipelineGetter returns a function to access the current message pipeline context.\n * Commonly used in places where you want to access a value from the latest pipeline in a useCallback hook\n * but don't want the callback dependencies invalidated on ever change.\n *\n * @returns a function to return the current MessagePipelineContext\n */\nexport function useMessagePipelineGetter(): () => MessagePipelineContext {\n  const store = useGuaranteedContext(ContextInternal);\n  return useCallback(() => store.getState().public, [store]);\n}\n\nexport function useMessagePipeline<T>(selector: (arg0: MessagePipelineContext) => T): T {\n  const store = useGuaranteedContext(ContextInternal);\n  return useStore(\n    store,\n    useCallback((state) => selector(state.public), [selector]),\n  );\n}\n\ntype ProviderProps = {\n  children: React.ReactNode;\n\n  // Represents either the lack of a player, a player that is currently being constructed, or a\n  // valid player. MessagePipelineProvider is not responsible for building players, but it is\n  // responsible for providing player state information downstream in a context -- so this\n  // information is passed in and merged with other player state.\n  player?: Player;\n\n  globalVariables: GlobalVariables;\n};\n\nconst selectRenderDone = (state: MessagePipelineInternalState) => state.renderDone;\nconst selectSubscriptions = (state: MessagePipelineInternalState) => state.public.subscriptions;\n\nexport function MessagePipelineProvider({\n  children,\n  player,\n  globalVariables,\n}: ProviderProps): React.ReactElement {\n  const promisesToWaitForRef = useRef<FramePromise[]>([]);\n  const [store] = useState(() =>\n    createMessagePipelineStore({ promisesToWaitForRef, initialPlayer: player }),\n  );\n  useEffect(() => {\n    store.getState().dispatch({ type: \"set-player\", player });\n    player?.setPublishers(store.getState().allPublishers);\n  }, [player, store]);\n\n  const subscriptions = useStore(store, selectSubscriptions);\n\n  // Debounce the subscription updates for players. This batches multiple subscribe calls\n  // into one update for the player which avoids fetching data that will be immediately discarded.\n  //\n  // The delay of 0ms is intentional as we only want to give one timeout cycle to batch updates\n  const debouncedPlayerSetSubscriptions = useMemo(() => {\n    return debounce((subs: SubscribePayload[]) => {\n      player?.setSubscriptions(subs);\n    });\n  }, [player]);\n\n  // when unmounting or changing the debounce function cancel any pending debounce\n  useEffect(() => {\n    return () => {\n      debouncedPlayerSetSubscriptions.cancel();\n    };\n  }, [debouncedPlayerSetSubscriptions]);\n\n  useEffect(\n    () => debouncedPlayerSetSubscriptions(subscriptions),\n    [debouncedPlayerSetSubscriptions, subscriptions],\n  );\n\n  // Slow down the message pipeline framerate to the given FPS if it is set to less than 60\n  const [messageRate] = useAppConfigurationValue<number>(AppSetting.MESSAGE_RATE);\n\n  // Tell listener the layout has completed\n  const renderDone = useStore(store, selectRenderDone);\n  useLayoutEffect(() => {\n    renderDone?.();\n  }, [renderDone]);\n\n  const msPerFrameRef = useRef<number>(16);\n  msPerFrameRef.current = 1000 / (messageRate ?? 60);\n\n  const dispatch = store.getState().dispatch;\n  useEffect(() => {\n    if (!player) {\n      // When there is no player, set the player state to the default to go back to a state where we\n      // indicate the player is not present.\n      dispatch({\n        type: \"update-player-state\",\n        playerState: defaultPlayerState(),\n        renderDone: undefined,\n      });\n      return;\n    }\n\n    const { listener, cleanupListener } = createPlayerListener({\n      msPerFrameRef,\n      promisesToWaitForRef,\n      dispatch,\n    });\n    player.setListener(listener);\n    return () => {\n      cleanupListener();\n      player.close();\n      dispatch({\n        type: \"update-player-state\",\n        playerState: defaultPlayerState(),\n        renderDone: undefined,\n      });\n    };\n  }, [player, dispatch]);\n\n  useEffect(() => {\n    player?.setGlobalVariables(globalVariables);\n  }, [player, globalVariables]);\n\n  return <ContextInternal.Provider value={store}>{children}</ContextInternal.Provider>;\n}\n\n// Given a PlayerState and a PlayerProblem array, add the problems to any existing player problems\nfunction concatProblems(origState: PlayerState, problems: PlayerProblem[]): PlayerState {\n  if (problems.length === 0) {\n    return origState;\n  }\n\n  return {\n    ...origState,\n    problems: problems.concat(origState.problems ?? []),\n  };\n}\n\n/**\n * The creation of the player listener is extracted as a separate function to prevent memory leaks.\n * When multiple closures are created inside of an outer function, V8 allocates one \"context\" object\n * to be shared by all the inner closures, holding the shared variables they access. As long as any\n * of the inner closures are still alive, the context and **all** the shared variables stay alive.\n *\n * In the case of MessagePipelineProvider, when the `listener` closure was created directly inside\n * the useEffect above, it would end up retaining a shared context that also retained the player\n * `state` variable returned by `usePlayerState()`, even though the listener closure didn't actually\n * use it. In particular, each time a new player was created in the useEffect, this caused it to\n * retain the old player's state (via the listener closure), creating a \"linked list\" effect that\n * caused the last state produced by each player (and therefore also its preloaded message blocks)\n * to be retained indefinitely as new data sources were swapped in.\n *\n * To avoid this problem, we extract the closure creation into a module-level function where it\n * won't see variables from outer scopes that are potentially retained in the shared context due to\n * their use in other closures.\n *\n * This type of leak is discussed at:\n * - https://bugs.chromium.org/p/chromium/issues/detail?id=315190\n * - http://point.davidglasser.net/2013/06/27/surprising-javascript-memory-leak.html\n * - https://stackoverflow.com/questions/53985411/understanding-javascript-closure-variable-capture-in-v8\n */\nfunction createPlayerListener(args: {\n  msPerFrameRef: React.MutableRefObject<number>;\n  promisesToWaitForRef: React.MutableRefObject<FramePromise[]>;\n  dispatch: (action: MessagePipelineStateAction) => void;\n}): {\n  listener: (state: PlayerState) => Promise<void>;\n  cleanupListener: () => void;\n} {\n  const { msPerFrameRef, promisesToWaitForRef, dispatch: updateState } = args;\n  const messageOrderTracker = new MessageOrderTracker();\n  let closed = false;\n  let resolveFn: undefined | (() => void);\n  const listener = async (listenerPlayerState: PlayerState) => {\n    if (closed) {\n      return;\n    }\n\n    if (resolveFn) {\n      throw new Error(\"New playerState was emitted before last playerState was rendered.\");\n    }\n\n    // check for any out-of-order or out-of-sync messages\n    const problems = messageOrderTracker.update(listenerPlayerState);\n    const newPlayerState = concatProblems(listenerPlayerState, problems);\n\n    const promise = new Promise<void>((resolve) => {\n      resolveFn = () => {\n        resolveFn = undefined;\n        resolve();\n      };\n    });\n\n    // Track when we start the state update. This will pair when layout effect calls renderDone.\n    const start = Date.now();\n\n    // Render done is invoked by a layout effect once the component has rendered.\n    // After the component renders, we kick off an animation frame to give panels one\n    // animation frame to invoke pause.\n    let called = false;\n    function renderDone() {\n      if (called) {\n        return;\n      }\n      called = true;\n\n      // Compute how much time remains before this frame is done\n      const delta = Date.now() - start;\n      const frameTime = Math.max(0, msPerFrameRef.current - delta);\n\n      // Panels have the remaining frame time to invoke pause\n      setTimeout(async () => {\n        if (closed) {\n          return;\n        }\n\n        const promisesToWaitFor = promisesToWaitForRef.current;\n        if (promisesToWaitFor.length > 0) {\n          promisesToWaitForRef.current = [];\n          await pauseFrameForPromises(promisesToWaitFor);\n        }\n\n        if (!resolveFn) {\n          return;\n        }\n        resolveFn();\n      }, frameTime);\n    }\n\n    updateState({\n      type: \"update-player-state\",\n      playerState: newPlayerState,\n      renderDone,\n    });\n\n    return await promise;\n  };\n  return {\n    listener,\n    cleanupListener() {\n      closed = true;\n      resolveFn = undefined;\n    },\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { MosaicPath } from \"react-mosaic-component\";\n\n/**\n * Exposes the mosaic path at which a panel is located. Unlike calling\n * `mosaicWindowActions.getPath()` during render, subscribing to this context will trigger a\n * re-render when the path changes.\n */\nexport const MosaicPathContext = createContext<MosaicPath | undefined>(undefined);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Box, Button, Link, Stack } from \"@mui/material\";\nimport { Component, ErrorInfo, PropsWithChildren, ReactNode } from \"react\";\n\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { AppError } from \"@foxglove/studio-base/util/errors\";\n\nimport ErrorDisplay from \"./ErrorDisplay\";\n\ntype Props = {\n  showErrorDetails?: boolean;\n  hideErrorSourceLocations?: boolean;\n  onResetPanel: () => void;\n  onRemovePanel: () => void;\n};\n\ntype State = {\n  currentError: { error: Error; errorInfo: ErrorInfo } | undefined;\n};\n\nexport default class PanelErrorBoundary extends Component<PropsWithChildren<Props>, State> {\n  public override state: State = {\n    currentError: undefined,\n  };\n\n  public override componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    reportError(new AppError(error, errorInfo));\n    this.setState({ currentError: { error, errorInfo } });\n  }\n\n  public override render(): ReactNode {\n    if (this.state.currentError) {\n      return (\n        <ErrorDisplay\n          title=\"This panel encountered an unexpected error\"\n          error={this.state.currentError.error}\n          errorInfo={this.state.currentError.errorInfo}\n          showErrorDetails={this.props.showErrorDetails}\n          hideErrorSourceLocations={this.props.hideErrorSourceLocations}\n          content={\n            <p>\n              Something went wrong in this panel.{\" \"}\n              <Link color=\"inherit\" onClick={() => this.setState({ currentError: undefined })}>\n                Dismiss this error\n              </Link>{\" \"}\n              to continue using this panel. If the issue persists, try resetting the panel.\n            </p>\n          }\n          actions={\n            <>\n              <Stack direction=\"row\" spacing={1}>\n                <Box flexGrow={1} />\n                <Button\n                  variant=\"text\"\n                  title=\"Remove this panel from the layout\"\n                  color=\"error\"\n                  onClick={this.props.onRemovePanel}\n                >\n                  Remove Panel\n                </Button>\n                <Button\n                  variant=\"outlined\"\n                  title=\"Reset panel settings to default values\"\n                  color=\"error\"\n                  onClick={() => {\n                    this.setState({ currentError: undefined });\n                    this.props.onResetPanel();\n                  }}\n                >\n                  Reset Panel\n                </Button>\n                <Button\n                  variant=\"outlined\"\n                  color=\"secondary\"\n                  onClick={() => this.setState({ currentError: undefined })}\n                >\n                  Dismiss\n                </Button>\n              </Stack>\n            </>\n          }\n        />\n      );\n    }\n    return this.props.children;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { defer } from \"lodash\";\nimport { useContext } from \"react\";\nimport { useDrag, ConnectDragSource, ConnectDragPreview } from \"react-dnd\";\nimport { MosaicDragType, MosaicNode, MosaicWindowContext } from \"react-mosaic-component\";\n\nimport {\n  useCurrentLayoutActions,\n  usePanelMosaicId,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { MosaicDropResult, SavedProps } from \"@foxglove/studio-base/types/panels\";\n\ntype PanelDragObject = {\n  deferredHide: number;\n  originalLayout: MosaicNode<string> | undefined;\n  originalConfigById: SavedProps;\n};\n\n// Hook to integrate mosaic drag functionality into any other component\nexport default function usePanelDrag(props: {\n  tabId?: string;\n  panelId?: string;\n  onDragStart?: () => void;\n  onDragEnd?: () => void;\n}): [ConnectDragSource, ConnectDragPreview] {\n  const { tabId: sourceTabId, panelId, onDragStart, onDragEnd } = props;\n  const { mosaicWindowActions } = useContext(MosaicWindowContext);\n\n  const mosaicId = usePanelMosaicId();\n\n  const { getCurrentLayoutState: getCurrentLayout, startDrag, endDrag } = useCurrentLayoutActions();\n\n  const [, connectDragSource, connectDragPreview] = useDrag<\n    PanelDragObject,\n    MosaicDropResult,\n    never\n  >({\n    type: MosaicDragType.WINDOW,\n    item: () => {\n      if (onDragStart) {\n        onDragStart();\n      }\n\n      const { selectedLayout } = getCurrentLayout();\n      if (!selectedLayout?.data) {\n        // eslint-disable-next-line no-restricted-syntax\n        return null;\n      }\n\n      const { layout: originalLayout, configById: originalConfigById } = selectedLayout.data;\n\n      // The defer is necessary as the element must be present on start for HTML DnD to not cry\n      const path = mosaicWindowActions.getPath();\n      const deferredHide = defer(() => {\n        startDrag({ path, sourceTabId });\n      });\n      return { mosaicId, deferredHide, originalLayout, originalConfigById };\n    },\n    end: (item, monitor) => {\n      if (onDragEnd) {\n        onDragEnd();\n      }\n      if (item.originalLayout == undefined) {\n        return;\n      }\n\n      // If the hide call hasn't happened yet, cancel it\n      window.clearTimeout(item.deferredHide);\n      const ownPath = mosaicWindowActions.getPath();\n      const dropResult = monitor.getDropResult() ?? {};\n      const { position, path: destinationPath, tabId: targetTabId } = dropResult;\n      if (panelId == undefined) {\n        return;\n      }\n\n      endDrag({\n        originalLayout: item.originalLayout,\n        originalSavedProps: item.originalConfigById,\n        panelId,\n        sourceTabId,\n        targetTabId,\n        position,\n        destinationPath,\n        ownPath,\n      });\n    },\n  });\n\n  return [connectDragSource, connectDragPreview];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport BorderAllIcon from \"@mui/icons-material/BorderAll\";\nimport DeleteForeverOutlinedIcon from \"@mui/icons-material/DeleteForeverOutlined\";\nimport LibraryAddOutlinedIcon from \"@mui/icons-material/LibraryAddOutlined\";\nimport TabIcon from \"@mui/icons-material/Tab\";\nimport { Button, styled as muiStyled, useTheme } from \"@mui/material\";\nimport { last } from \"lodash\";\nimport React, {\n  ComponentType,\n  CSSProperties,\n  MouseEventHandler,\n  Profiler,\n  useCallback,\n  useContext,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  getNodeAtPath,\n  getOtherBranch,\n  MosaicContext,\n  MosaicNode,\n  MosaicWindowActions,\n  MosaicWindowContext,\n  updateTree,\n} from \"react-mosaic-component\";\nimport { Transition } from \"react-transition-group\";\nimport { useMountedState } from \"react-use\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport { useConfigById } from \"@foxglove/studio-base/PanelAPI\";\nimport KeyListener from \"@foxglove/studio-base/components/KeyListener\";\nimport { MosaicPathContext } from \"@foxglove/studio-base/components/MosaicPathContext\";\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport PanelErrorBoundary from \"@foxglove/studio-base/components/PanelErrorBoundary\";\nimport { PanelRoot, PANEL_ROOT_CLASS_NAME } from \"@foxglove/studio-base/components/PanelRoot\";\nimport {\n  useCurrentLayoutActions,\n  useSelectedPanels,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport {\n  useWorkspaceStore,\n  WorkspaceStoreSelectors,\n} from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport usePanelDrag from \"@foxglove/studio-base/hooks/usePanelDrag\";\nimport { TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport { OpenSiblingPanel, PanelConfig, SaveConfig } from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\nimport {\n  getPanelIdForType,\n  getPanelTypeFromId,\n  getPathFromNode,\n  updateTabPanelLayout,\n} from \"@foxglove/studio-base/util/layout\";\n\nconst ActionsOverlay = muiStyled(\"div\")(({ theme }) => ({\n  cursor: \"pointer\",\n  position: \"absolute\",\n  top: 0,\n  left: 0,\n  right: 0,\n  bottom: 0,\n  zIndex: 100000, // highest level within panel\n  backgroundColor: theme.palette.background.paper,\n  display: \"flex\",\n  alignItems: \"center\",\n  alignContent: \"center\",\n  justifyContent: \"center\",\n  flexDirection: \"column\",\n  flexWrap: \"wrap\",\n  visibility: \"hidden\",\n  pointerEvents: \"none\",\n\n  [`.${PANEL_ROOT_CLASS_NAME}:hover > &`]: {\n    visibility: \"visible\",\n    pointerEvents: \"auto\",\n  },\n  // for screenshot tests\n  \".hoverForScreenshot &\": {\n    visible: \"visible\",\n    pointerEvents: \"auto\",\n  },\n}));\n\nconst PerfInfo = muiStyled(\"div\")({\n  position: \"absolute\",\n  whiteSpace: \"pre-line\",\n  bottom: 2,\n  left: 2,\n  fontSize: 9,\n  opacity: 0.7,\n  userSelect: \"none\",\n  mixBlendMode: \"difference\",\n});\n\nconst Container = muiStyled(\"div\", {\n  shouldForwardProp: (prop) => prop !== \"direction\",\n})<{\n  direction?: CSSProperties[\"flexDirection\"];\n}>(({ direction = \"column\", theme }) => ({\n  padding: theme.spacing(2),\n  maxWidth: 300,\n  margin: \"auto\",\n  display: \"flex\",\n  flexDirection: direction,\n  gap: theme.spacing(1),\n}));\n\nconst StyledButton = muiStyled(Button)(({ theme }) => ({\n  flexDirection: \"column\",\n  alignItems: \"center\",\n  textAlign: \"center\",\n  whiteSpace: \"nowrap\",\n  padding: theme.spacing(1, 2),\n  width: \"50%\",\n  flex: \"auto\",\n\n  \".MuiButton-startIcon\": {\n    margin: 0,\n  },\n}));\n\ntype Props<Config> = {\n  childId?: string;\n  overrideConfig?: Config;\n  tabId?: string;\n};\n\nexport interface PanelStatics<Config> {\n  panelType: string;\n  defaultConfig: Config;\n}\n\n// Like React.ComponentType<P>, but without restrictions on the constructor return type.\ntype ComponentConstructorType<P> = { displayName?: string } & (\n  | { new (props: P): React.Component<unknown, unknown> }\n  | { (props: P): React.ReactElement<unknown> | ReactNull }\n);\n\n// HOC that wraps panel in an error boundary and flex box.\n// Gives panel a `config` and `saveConfig`.\n//   export default Panel(MyPanelComponent)\n//\n// `config` comes from the current layout, but in stories / tests you can pass in your own:\n//   `<MyPanel config={…} />`\nexport default function Panel<\n  Config extends PanelConfig,\n  PanelProps extends { config: Config; saveConfig: SaveConfig<Config> },\n>(\n  PanelComponent: ComponentConstructorType<PanelProps> & PanelStatics<Config>,\n): ComponentType<Props<Config> & Omit<PanelProps, \"config\" | \"saveConfig\">> & PanelStatics<Config> {\n  function ConnectedPanel(props: Props<Config>) {\n    const { childId, overrideConfig, tabId, ...otherProps } = props;\n    const theme = useTheme();\n    const isMounted = useMountedState();\n\n    const { mosaicActions } = useContext(MosaicContext);\n    const { mosaicWindowActions }: { mosaicWindowActions: MosaicWindowActions } =\n      useContext(MosaicWindowContext);\n\n    const {\n      selectedPanelIds,\n      setSelectedPanelIds,\n      selectAllPanels,\n      togglePanelSelected,\n      getSelectedPanelIds,\n    } = useSelectedPanels();\n\n    const isSelected = useMemo(\n      () => childId != undefined && selectedPanelIds.includes(childId),\n      [childId, selectedPanelIds],\n    );\n    const numSelectedPanelsIfSelected = useMemo(\n      () => (isSelected ? selectedPanelIds.length : 0),\n      [isSelected, selectedPanelIds],\n    );\n\n    const {\n      savePanelConfigs,\n      updatePanelConfigs,\n      createTabPanel,\n      closePanel,\n      swapPanel,\n      getCurrentLayoutState,\n    } = useCurrentLayoutActions();\n\n    const [quickActionsKeyPressed, setQuickActionsKeyPressed] = useState(false);\n    const [fullscreen, setFullscreen] = useState(false);\n    const [fullscreenSourceRect, setFullscreenSourceRect] = useState<DOMRect | undefined>(\n      undefined,\n    );\n    const [hasFullscreenDescendant, _setHasFullscreenDescendant] = useState(false);\n    const panelRootRef = useRef<HTMLDivElement>(ReactNull);\n    const panelCatalog = usePanelCatalog();\n\n    const mosaicPath = useContext(MosaicPathContext);\n    const isTopLevelPanel =\n      mosaicPath != undefined && mosaicPath.length === 0 && tabId == undefined;\n\n    // There may be a parent panel (when a panel is in a tab).\n    const parentPanelContext = useContext(PanelContext);\n\n    const type = PanelComponent.panelType;\n    const title = useMemo(\n      () => panelCatalog.getPanelByType(type)?.title ?? \"\",\n      [panelCatalog, type],\n    );\n\n    const defaultConfig = PanelComponent.defaultConfig;\n    const [savedConfig, saveConfig] = useConfigById<Config>(childId);\n\n    const resetPanel = useCallback(() => {\n      saveConfig(defaultConfig);\n    }, [defaultConfig, saveConfig]);\n\n    // PanelSettings needs useConfigById to return a complete config. If there is no saved config\n    // (or it is an empty object), or if keys have been added to the default config since it was\n    // previously saved, we save the default config provided by the panel. This typically happens\n    // when a new panel is added and the layout does not yet have a config. Even if this effect gets\n    // run more than once, we only need to save the default config once.\n    //\n    // An empty object can occur when swapping a panel\n    const savedDefaultConfig = useRef(false);\n    useLayoutEffect(() => {\n      if (savedDefaultConfig.current) {\n        return;\n      }\n\n      if (!savedConfig || Object.keys(savedConfig).length === 0) {\n        savedDefaultConfig.current = true;\n        saveConfig(defaultConfig);\n      } else if (\n        Object.entries(defaultConfig).some(\n          ([key, value]) => value != undefined && !(key in savedConfig),\n        )\n      ) {\n        savedDefaultConfig.current = true;\n        saveConfig({ ...defaultConfig, ...savedConfig });\n      }\n    }, [defaultConfig, saveConfig, savedConfig]);\n\n    const panelComponentConfig = useMemo(\n      () => ({ ...defaultConfig, ...savedConfig, ...overrideConfig }),\n      [savedConfig, defaultConfig, overrideConfig],\n    );\n\n    // Open a panel next to the current panel, of the specified `panelType`.\n    // If such a panel already exists, we update it with the new props.\n    const openSiblingPanel = useCallback<OpenSiblingPanel>(\n      async ({ panelType, siblingConfigCreator, updateIfExists }) => {\n        const panelsState = getCurrentLayoutState().selectedLayout?.data;\n        if (!panelsState) {\n          return;\n        }\n\n        let siblingDefaultConfig: PanelConfig = {};\n\n        // If we can lookup the sibling panel type, try to load the default config from the panel module\n        const siblingPanelInfo = panelCatalog.getPanelByType(panelType);\n        if (siblingPanelInfo) {\n          const siblingModule = await siblingPanelInfo.module();\n          if (!isMounted()) {\n            return;\n          }\n\n          siblingDefaultConfig = siblingModule.default.defaultConfig;\n        }\n\n        const ownPath = mosaicWindowActions.getPath();\n\n        // Try to find a sibling panel and update it with the `siblingConfig`\n        if (updateIfExists) {\n          const lastNode = last(ownPath);\n          const siblingPathEnd = lastNode != undefined ? getOtherBranch(lastNode) : \"second\";\n          const siblingPath = ownPath.slice(0, -1).concat(siblingPathEnd);\n          const siblingId = getNodeAtPath(mosaicActions.getRoot(), siblingPath);\n          if (typeof siblingId === \"string\" && getPanelTypeFromId(siblingId) === panelType) {\n            const siblingConfig: PanelConfig = {\n              ...siblingDefaultConfig,\n              ...panelsState.configById[siblingId],\n            };\n            savePanelConfigs({\n              configs: [\n                {\n                  id: siblingId,\n                  config: siblingConfigCreator(siblingConfig),\n                  defaultConfig: siblingDefaultConfig,\n                },\n              ],\n            });\n            return;\n          }\n        }\n\n        // Otherwise, open new panel\n        const newPanelPath = ownPath.concat(\"second\");\n        const newPanelConfig = siblingConfigCreator(siblingDefaultConfig);\n        void mosaicWindowActions\n          .split({ type: panelType, panelConfig: newPanelConfig })\n          .then(() => {\n            const newPanelId = getNodeAtPath(mosaicActions.getRoot(), newPanelPath) as string;\n            savePanelConfigs({\n              configs: [\n                {\n                  id: newPanelId,\n                  config: newPanelConfig,\n                  defaultConfig: siblingDefaultConfig,\n                },\n              ],\n            });\n          });\n      },\n      [\n        getCurrentLayoutState,\n        isMounted,\n        mosaicActions,\n        mosaicWindowActions,\n        panelCatalog,\n        savePanelConfigs,\n      ],\n    );\n\n    const replacePanel = useCallback(\n      (newPanelType: string, config: Record<string, unknown>) => {\n        if (childId == undefined) {\n          return;\n        }\n        swapPanel({\n          tabId,\n          originalId: childId,\n          type: newPanelType,\n          root: mosaicActions.getRoot() as MosaicNode<string>,\n          path: mosaicWindowActions.getPath(),\n          config,\n        });\n      },\n      [childId, mosaicActions, mosaicWindowActions, swapPanel, tabId],\n    );\n\n    const panelSettingsOpen = useWorkspaceStore(WorkspaceStoreSelectors.selectPanelSettingsOpen);\n\n    const onPanelRootClick: MouseEventHandler<HTMLDivElement> = useCallback(\n      (e) => {\n        if (childId == undefined) {\n          return;\n        }\n        if (panelSettingsOpen) {\n          // Allow clicking with no modifiers to select a panel (and deselect others) when panel settings are open\n          e.stopPropagation(); // select the deepest clicked panel, not parent tab panels\n          setSelectedPanelIds([childId]);\n        } else if (e.metaKey || e.shiftKey || isSelected) {\n          e.stopPropagation(); // select the deepest clicked panel, not parent tab panels\n          togglePanelSelected(childId, tabId);\n        }\n      },\n      [childId, tabId, togglePanelSelected, isSelected, setSelectedPanelIds, panelSettingsOpen],\n    );\n\n    const groupPanels = useCallback(() => {\n      const layout = getCurrentLayoutState().selectedLayout?.data?.layout;\n      if (layout == undefined) {\n        return;\n      }\n      createTabPanel({\n        idToReplace: childId,\n        layout,\n        idsToRemove: getSelectedPanelIds(),\n        singleTab: true,\n      });\n    }, [getCurrentLayoutState, getSelectedPanelIds, createTabPanel, childId]);\n\n    const createTabs = useCallback(() => {\n      const layout = getCurrentLayoutState().selectedLayout?.data?.layout;\n      if (layout == undefined) {\n        return;\n      }\n      createTabPanel({\n        idToReplace: childId,\n        layout,\n        idsToRemove: getSelectedPanelIds(),\n        singleTab: false,\n      });\n    }, [getCurrentLayoutState, getSelectedPanelIds, createTabPanel, childId]);\n\n    const removePanel = useCallback(() => {\n      closePanel({\n        path: mosaicWindowActions.getPath(),\n        root: mosaicActions.getRoot() as MosaicNode<string>,\n        tabId,\n      });\n    }, [closePanel, mosaicActions, mosaicWindowActions, tabId]);\n\n    const splitPanel = useCallback(() => {\n      const savedProps = getCurrentLayoutState().selectedLayout?.data?.configById;\n      if (!savedProps) {\n        return;\n      }\n      const tabSavedProps = tabId != undefined ? (savedProps[tabId] as TabPanelConfig) : undefined;\n      if (tabId != undefined && tabSavedProps != undefined && childId != undefined) {\n        const newId = getPanelIdForType(PanelComponent.panelType);\n        const activeTabLayout = tabSavedProps.tabs[tabSavedProps.activeTabIdx]?.layout;\n        if (activeTabLayout == undefined) {\n          return;\n        }\n        const pathToPanelInTab = getPathFromNode(childId, activeTabLayout);\n        const newTabLayout = updateTree(activeTabLayout, [\n          {\n            path: pathToPanelInTab,\n            spec: { $set: { first: childId, second: newId, direction: \"row\" } },\n          },\n        ]);\n        const newTabConfig = updateTabPanelLayout(newTabLayout, tabSavedProps);\n        savePanelConfigs({\n          configs: [\n            { id: tabId, config: newTabConfig },\n            { id: newId, config: panelComponentConfig },\n          ],\n        });\n      } else {\n        void mosaicWindowActions.split({ type: PanelComponent.panelType });\n      }\n    }, [\n      childId,\n      getCurrentLayoutState,\n      mosaicWindowActions,\n      panelComponentConfig,\n      savePanelConfigs,\n      tabId,\n    ]);\n\n    const { enterFullscreen, exitFullscreen } = useMemo(\n      () => ({\n        enterFullscreen: () => {\n          setFullscreenSourceRect(panelRootRef.current?.getBoundingClientRect());\n          setFullscreen(true);\n\n          // When entering fullscreen for a panel within a tab, we need to adjust the ancestor\n          // tab(s)'s z-index to have our panel properly overlay other panels outside the tab.\n          parentPanelContext?.setHasFullscreenDescendant(true);\n        },\n        exitFullscreen: () => {\n          // Don't clear fullscreenSourceRect or hasFullscreenDescendant, they are needed during the exit transition\n          setFullscreen(false);\n        },\n      }),\n      [parentPanelContext],\n    );\n\n    const setHasFullscreenDescendant = useCallback(\n      // eslint-disable-next-line @foxglove/no-boolean-parameters\n      (value: boolean) => {\n        _setHasFullscreenDescendant(value);\n        parentPanelContext?.setHasFullscreenDescendant(value);\n      },\n      [parentPanelContext],\n    );\n\n    // We use two separate sets of key handlers because the panel context and exitFullScreen\n    // change often and invalidate our key handlers during user interactions.\n    const { keyUpHandlers, keyDownHandlers } = useMemo(\n      () => ({\n        keyUpHandlers: {\n          \"`\": () => setQuickActionsKeyPressed(false),\n          \"~\": () => setQuickActionsKeyPressed(false),\n        },\n        keyDownHandlers: {\n          a: (e: KeyboardEvent) => {\n            e.preventDefault();\n            if (e.metaKey) {\n              selectAllPanels();\n            }\n          },\n          \"`\": () => setQuickActionsKeyPressed(true),\n          \"~\": () => setQuickActionsKeyPressed(true),\n        },\n      }),\n      [selectAllPanels],\n    );\n\n    const fullScreenKeyHandlers = useMemo(\n      () => ({\n        Escape: () => exitFullscreen(),\n      }),\n      [exitFullscreen],\n    );\n\n    const otherPanelProps = useShallowMemo(otherProps);\n    const childProps = useMemo(\n      // We have to lie to TypeScript with \"as PanelProps\" because the \"PanelProps extends {...}\"\n      // constraint technically allows the panel to require the types of config/saveConfig be more\n      // specific types that aren't satisfied by the functions we pass in\n      () => ({ config: panelComponentConfig, saveConfig, ...otherPanelProps } as PanelProps),\n      [otherPanelProps, panelComponentConfig, saveConfig],\n    );\n    const child = useMemo(() => <PanelComponent {...childProps} />, [childProps]);\n\n    const renderCount = useRef(0);\n\n    const perfInfo = useRef<HTMLDivElement>(ReactNull);\n    const quickActionsOverlayRef = useRef<HTMLDivElement>(ReactNull);\n    const onDragStart = useCallback(() => {\n      // Temporarily hide the overlay so that the panel can be shown as the drag preview image --\n      // even though the overlay is a sibling rather than a child, Chrome still includes it in the\n      // preview if it is visible. Changing the appearance in the next React render cycle is not\n      // enough; it actually needs to happen during the dragstart event.\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=1203107\n      const overlay = quickActionsOverlayRef.current;\n      if (overlay) {\n        overlay.style.opacity = \"0\";\n        setTimeout(() => (overlay.style.opacity = \"1\"), 0);\n      }\n    }, []);\n    const dragSpec = { tabId, panelId: childId, onDragStart };\n    const [connectOverlayDragSource, connectOverlayDragPreview] = usePanelDrag(dragSpec);\n    const [connectToolbarDragHandle, connectToolbarDragPreview] = usePanelDrag(dragSpec);\n\n    return (\n      <Profiler\n        id={childId ?? \"$unknown_id\"}\n        onRender={(\n          _id,\n          _phase,\n          actualDuration,\n          _baseDuration,\n          _startTime,\n          _commitTime,\n          _interactions,\n        ) => {\n          if (perfInfo.current) {\n            perfInfo.current.innerText = `${++renderCount.current}\\n${actualDuration.toFixed(1)}ms`;\n          }\n        }}\n      >\n        <PanelContext.Provider\n          value={{\n            type,\n            id: childId ?? \"$unknown_id\",\n            title,\n            config: panelComponentConfig,\n            saveConfig: saveConfig as SaveConfig<PanelConfig>,\n            updatePanelConfigs,\n            openSiblingPanel,\n            replacePanel,\n            enterFullscreen,\n            exitFullscreen,\n            setHasFullscreenDescendant,\n            isFullscreen: fullscreen,\n            tabId,\n            // disallow dragging the root panel in a layout\n            connectToolbarDragHandle: isTopLevelPanel ? undefined : connectToolbarDragHandle,\n          }}\n        >\n          <KeyListener global keyUpHandlers={keyUpHandlers} keyDownHandlers={keyDownHandlers} />\n          {fullscreen && <KeyListener global keyDownHandlers={fullScreenKeyHandlers} />}\n          <Transition\n            in={fullscreen}\n            onExited={() => setHasFullscreenDescendant(false)}\n            nodeRef={panelRootRef}\n            timeout={{\n              // match to transition duration inside PanelRoot\n              exit: theme.transitions.duration.shorter,\n            }}\n          >\n            {(fullscreenState) => (\n              <PanelRoot\n                onClick={onPanelRootClick}\n                hasFullscreenDescendant={hasFullscreenDescendant}\n                fullscreenState={fullscreenState}\n                sourceRect={fullscreenSourceRect}\n                selected={isSelected}\n                data-testid={`panel-mouseenter-container ${childId ?? \"\"}`}\n                ref={(el) => {\n                  panelRootRef.current = el;\n                  // disallow dragging the root panel in a layout\n                  if (!isTopLevelPanel) {\n                    connectOverlayDragPreview(el);\n                    connectToolbarDragPreview(el);\n                  }\n                }}\n              >\n                {isSelected && !fullscreen && numSelectedPanelsIfSelected > 1 && (\n                  <ActionsOverlay>\n                    <Container>\n                      <Button\n                        fullWidth\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<TabIcon fontSize=\"large\" />}\n                        onClick={groupPanels}\n                      >\n                        Group in tab\n                      </Button>\n                      <Button\n                        fullWidth\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<LibraryAddOutlinedIcon fontSize=\"large\" />}\n                        onClick={createTabs}\n                      >\n                        Create {numSelectedPanelsIfSelected} tabs\n                      </Button>\n                    </Container>\n                  </ActionsOverlay>\n                )}\n                {type !== TAB_PANEL_TYPE && quickActionsKeyPressed && !fullscreen && (\n                  <ActionsOverlay\n                    ref={(el) => {\n                      quickActionsOverlayRef.current = el;\n                      // disallow dragging the root panel in a layout\n                      if (!isTopLevelPanel) {\n                        connectOverlayDragSource(el);\n                      }\n                    }}\n                  >\n                    <Container direction=\"row\">\n                      <StyledButton\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<DeleteForeverOutlinedIcon fontSize=\"large\" />}\n                        onClick={(event) => {\n                          event.stopPropagation();\n                          removePanel();\n                        }}\n                      >\n                        Remove\n                      </StyledButton>\n                      <StyledButton\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<BorderAllIcon fontSize=\"large\" />}\n                        onClick={splitPanel}\n                      >\n                        Split\n                      </StyledButton>\n                    </Container>\n                  </ActionsOverlay>\n                )}\n                <PanelErrorBoundary onRemovePanel={removePanel} onResetPanel={resetPanel}>\n                  <React.StrictMode>{child}</React.StrictMode>\n                </PanelErrorBoundary>\n                {process.env.NODE_ENV !== \"production\" && <PerfInfo ref={perfInfo} />}\n              </PanelRoot>\n            )}\n          </Transition>\n        </PanelContext.Provider>\n      </Profiler>\n    );\n  }\n\n  return Object.assign(React.memo(ConnectedPanel), {\n    defaultConfig: PanelComponent.defaultConfig,\n    panelType: PanelComponent.panelType,\n    displayName: `Panel(${PanelComponent.displayName ?? PanelComponent.name})`,\n  });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { SaveConfig, PanelConfig, OpenSiblingPanel } from \"@foxglove/studio-base/types/panels\";\n\nexport type PanelContextType<T> = {\n  type: string;\n  id: string;\n  title: string;\n  tabId?: string;\n\n  config: PanelConfig;\n  saveConfig: SaveConfig<T>;\n\n  updatePanelConfigs: (panelType: string, updateConfig: (config: T) => T) => void;\n  openSiblingPanel: OpenSiblingPanel;\n  replacePanel: (panelType: string, config: Record<string, unknown>) => void;\n\n  enterFullscreen: () => void;\n  exitFullscreen: () => void;\n  isFullscreen: boolean;\n\n  /** Used to adjust z-index settings on parent panels when children are fullscreen */\n  // eslint-disable-next-line @foxglove/no-boolean-parameters\n  setHasFullscreenDescendant: (hasFullscreenDescendant: boolean) => void;\n\n  connectToolbarDragHandle?: (el: Element | ReactNull) => void;\n};\n\n// Context used for components to know which panel they are inside\nconst PanelContext = React.createContext<PanelContextType<PanelConfig> | undefined>(undefined);\nPanelContext.displayName = \"PanelContext\";\n\nexport function usePanelContext(): PanelContextType<PanelConfig> {\n  const context = React.useContext(PanelContext);\n  if (!context) {\n    throw new Error(\"Tried to use PanelContext outside a <PanelContext.Provider />\");\n  }\n  return context;\n}\n\nexport default PanelContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useLayoutEffect, useRef } from \"react\";\n\n/**\n * Registers and unregisters mounted state during useLayoutEffect instead of useEffect.\n *\n * If you're using useLayoutEffect in your component and want to track your component's\n * mounted state you need to use this instead of useMountedState.\n */\nexport function useSynchronousMountedState(): () => boolean {\n  const mountedRef = useRef<boolean>(false);\n  const get = useCallback(() => {\n    return mountedRef.current;\n  }, []);\n\n  useLayoutEffect(() => {\n    mountedRef.current = true;\n\n    return () => {\n      mountedRef.current = false;\n    };\n  }, []);\n\n  return get;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { compare, toSec } from \"@foxglove/rostime\";\nimport {\n  AppSettingValue,\n  MessageEvent,\n  ParameterValue,\n  RegisterMessageConverterArgs,\n  RenderState,\n  Subscription,\n  Topic,\n} from \"@foxglove/studio\";\nimport {\n  EMPTY_GLOBAL_VARIABLES,\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { PlayerState, Topic as PlayerTopic } from \"@foxglove/studio-base/players/types\";\nimport { HoverValue } from \"@foxglove/studio-base/types/hoverValue\";\n\nconst EmptyParameters = new Map<string, ParameterValue>();\n\ntype BuilderRenderStateInput = {\n  appSettings: Map<string, AppSettingValue> | undefined;\n  colorScheme: RenderState[\"colorScheme\"] | undefined;\n  currentFrame: MessageEvent<unknown>[] | undefined;\n  globalVariables: GlobalVariables;\n  hoverValue: HoverValue | undefined;\n  messageConverters?: RegisterMessageConverterArgs<unknown>[];\n  playerState: PlayerState | undefined;\n  sharedPanelState: Record<string, unknown> | undefined;\n  sortedTopics: readonly PlayerTopic[];\n  subscriptions: Subscription[];\n  watchedFields: Set<string>;\n};\n\ntype BuildRenderStateFn = (input: BuilderRenderStateInput) => Readonly<RenderState> | undefined;\n\n// Branded string to ensure that users go through the `converterKey` function to compute a lookup key\ntype ConverterKey = string & { __brand: \"ConverterKey\" };\n\n// Create a string lookup key from a message event\n//\n// The string key uses a newline delimeter to avoid producting the same key for topic/schema name\n// values that might concatenate to the same string. i.e. \"topic\" \"schema\" and \"topics\" \"chema\".\nfunction converterKey(topic: string, schema: string): ConverterKey {\n  return (topic + \"\\n\" + schema) as ConverterKey;\n}\n\n/**\n * initRenderStateBuilder creates a function that transforms render state input into a new\n * RenderState\n *\n * This function tracks previous input to determine what parts of the existing render state to\n * update or whether there are any updates\n *\n * @returns a function that accepts render state input and returns a new RenderState to render or\n * undefined if there's no update for rendering\n */\nfunction initRenderStateBuilder(): BuildRenderStateFn {\n  let prevVariables: GlobalVariables = EMPTY_GLOBAL_VARIABLES;\n  let prevBlocks: unknown;\n  let prevSeekTime: number | undefined;\n  let prevSubscriptions: BuilderRenderStateInput[\"subscriptions\"];\n  let prevSortedTopics: BuilderRenderStateInput[\"sortedTopics\"] | undefined;\n  let prevMessageConverters: BuilderRenderStateInput[\"messageConverters\"] | undefined;\n  let prevSharedPanelState: BuilderRenderStateInput[\"sharedPanelState\"];\n  let prevCurrentFrame: RenderState[\"currentFrame\"];\n\n  // Topics which we are subscribed without a conversion, these are topics we want to receive the\n  // original message\n  const unconvertedSubscriptionTopics: Set<string> = new Set();\n\n  // When a subscription with a convertTo exists, we lookup a converter which can produce the\n  // desired output message schema and store it in this map. The keys for the map are `topic + input\n  // schema`.\n  //\n  // This allows the runtime message event handler logic which builds currentFrame and allFrames to\n  // lookup whether the incoming message event has converters to run by looking up the topic +\n  // schema of the message event in this map.\n  const topicSchemaConverters: Map<ConverterKey, RegisterMessageConverterArgs<unknown>[]> =\n    new Map();\n\n  const prevRenderState: RenderState = {};\n\n  return function buildRenderState(input: BuilderRenderStateInput) {\n    const {\n      appSettings,\n      colorScheme,\n      currentFrame,\n      globalVariables,\n      hoverValue,\n      messageConverters,\n      playerState,\n      sharedPanelState,\n      sortedTopics,\n      subscriptions,\n      watchedFields,\n    } = input;\n\n    // Should render indicates whether any fields of render state are updated\n    let shouldRender = false;\n\n    // Hoisted active data to shorten some of the code below that repeatedly uses active data\n    const activeData = playerState?.activeData;\n\n    // The render state starts with the previous render state and changes are applied as detected\n    const renderState: RenderState = prevRenderState;\n\n    // If the player has loaded all the blocks, the blocks reference won't change so our message\n    // pipeline handler for allFrames won't create a new set of all frames for the newly\n    // subscribed topic. To ensure a new set of allFrames with the newly subscribed topic is\n    // created, we unset the blocks ref which will force re-creating allFrames.\n    if (subscriptions !== prevSubscriptions) {\n      prevBlocks = undefined;\n    }\n\n    // If topics, message converters, or subscriptions change, recalculate the\n    if (\n      prevSubscriptions !== subscriptions ||\n      prevSortedTopics !== sortedTopics ||\n      prevMessageConverters !== messageConverters\n    ) {\n      // reset which topics have subscriptions and which need converting\n      unconvertedSubscriptionTopics.clear();\n      topicSchemaConverters.clear();\n\n      // Bin the subscriptions into two sets: those which want a conversion and those that do not.\n      //\n      // For the subscriptions that want a conversion, if the topic schemaName matches the requested\n      // convertTo, then we don't need to do a conversion.\n      for (const subscription of subscriptions) {\n        if (!subscription.convertTo) {\n          unconvertedSubscriptionTopics.add(subscription.topic);\n          continue;\n        }\n\n        // If the convertTo is the same as the original schema for the topic then we don't need to\n        // perform a conversion.\n        const noConversion = sortedTopics.find(\n          (topic) =>\n            topic.name === subscription.topic && topic.schemaName === subscription.convertTo,\n        );\n        if (noConversion) {\n          unconvertedSubscriptionTopics.add(noConversion.name);\n          continue;\n        }\n\n        // Since we don't have an existing topic with out destination schema we need to find\n        // a converter that will convert from the topic to the desired schema\n        const subscriberTopic = sortedTopics.find((topic) => topic.name === subscription.topic);\n        if (!subscriberTopic) {\n          continue;\n        }\n\n        const key = converterKey(subscription.topic, subscriberTopic.schemaName ?? \"<no-schema>\");\n        let existingConverters = topicSchemaConverters.get(key);\n\n        // We've already stored a converter for this topic to convertTo\n        const haveConverter = existingConverters?.find(\n          (conv) => conv.toSchemaName === subscription.convertTo,\n        );\n        if (haveConverter) {\n          continue;\n        }\n\n        // Find a converter that can go from the original topic schema to the target schema\n        // Note: We only support one converter per unique from/to pair so this _find_ only needs to\n        //       find one converter rather than multiple converters.\n        const converter = messageConverters?.find(\n          (conv) =>\n            conv.fromSchemaName === subscriberTopic.schemaName &&\n            conv.toSchemaName === subscription.convertTo,\n        );\n\n        if (converter) {\n          existingConverters ??= [];\n          existingConverters.push(converter);\n          topicSchemaConverters.set(key, existingConverters);\n        }\n      }\n    }\n\n    if (watchedFields.has(\"didSeek\")) {\n      const didSeek = prevSeekTime !== activeData?.lastSeekTime;\n      if (didSeek !== renderState.didSeek) {\n        renderState.didSeek = didSeek;\n        shouldRender = true;\n      }\n      prevSeekTime = activeData?.lastSeekTime;\n    }\n\n    if (watchedFields.has(\"parameters\")) {\n      const parameters = activeData?.parameters ?? EmptyParameters;\n      if (parameters !== renderState.parameters) {\n        shouldRender = true;\n        renderState.parameters = parameters;\n      }\n    }\n\n    if (watchedFields.has(\"sharedPanelState\")) {\n      if (sharedPanelState !== prevSharedPanelState) {\n        shouldRender = true;\n        prevSharedPanelState = sharedPanelState;\n        renderState.sharedPanelState = sharedPanelState;\n      }\n    }\n\n    if (watchedFields.has(\"variables\")) {\n      if (globalVariables !== prevVariables) {\n        shouldRender = true;\n        prevVariables = globalVariables;\n        renderState.variables = new Map(Object.entries(globalVariables));\n      }\n    }\n\n    if (watchedFields.has(\"topics\")) {\n      if (sortedTopics !== prevSortedTopics || prevMessageConverters !== messageConverters) {\n        shouldRender = true;\n\n        const topics = sortedTopics.map<Topic>((topic) => {\n          const newTopic: Topic = {\n            name: topic.name,\n            datatype: topic.schemaName ?? \"\",\n            schemaName: topic.schemaName ?? \"\",\n          };\n\n          if (messageConverters) {\n            const convertibleTo: string[] = [];\n\n            // find any converters that can convert _from_ the schema name of the topic\n            // the _to_ names of the converter become additional schema names for the topic entry\n            for (const converter of messageConverters) {\n              if (converter.fromSchemaName === topic.schemaName) {\n                if (!convertibleTo.includes(converter.toSchemaName)) {\n                  convertibleTo.push(converter.toSchemaName);\n                }\n              }\n            }\n\n            if (convertibleTo.length > 0) {\n              newTopic.convertibleTo = convertibleTo;\n            }\n          }\n\n          return newTopic;\n        });\n\n        renderState.topics = topics;\n        prevSortedTopics = sortedTopics;\n      }\n    }\n\n    if (watchedFields.has(\"currentFrame\")) {\n      if (prevCurrentFrame !== currentFrame) {\n        prevCurrentFrame = currentFrame;\n        shouldRender = true;\n\n        if (currentFrame) {\n          const postProcessedFrame: MessageEvent<unknown>[] = [];\n\n          for (const messageEvent of currentFrame) {\n            if (unconvertedSubscriptionTopics.has(messageEvent.topic)) {\n              postProcessedFrame.push(messageEvent);\n            }\n\n            // Get the converters that need to be run for this message event\n            // See the comment for topicSchemaConverters on the use of the key\n            const converters = topicSchemaConverters.get(\n              converterKey(messageEvent.topic, messageEvent.schemaName),\n            );\n            if (converters) {\n              for (const converter of converters) {\n                const convertedMessage = converter.converter(messageEvent.message);\n                postProcessedFrame.push({\n                  topic: messageEvent.topic,\n                  schemaName: converter.toSchemaName,\n                  receiveTime: messageEvent.receiveTime,\n                  message: convertedMessage,\n                  originalMessageEvent: messageEvent,\n                  sizeInBytes: messageEvent.sizeInBytes,\n                });\n              }\n            }\n          }\n\n          renderState.currentFrame = postProcessedFrame;\n        } else {\n          renderState.currentFrame = undefined;\n        }\n      }\n    }\n\n    if (watchedFields.has(\"allFrames\")) {\n      // see comment for prevBlocksRef on why extended message store updates are gated this way\n      const newBlocks = playerState?.progress.messageCache?.blocks;\n      if (newBlocks && prevBlocks !== newBlocks) {\n        shouldRender = true;\n        const frames: MessageEvent<unknown>[] = (renderState.allFrames = []);\n        // only populate allFrames with topics that the panel wants to preload\n        const topicsToPreloadForPanel = Array.from(\n          new Set<string>(\n            filterMap(subscriptions, (sub) => (sub.preload === true ? sub.topic : undefined)),\n          ),\n        );\n\n        for (const block of newBlocks) {\n          if (!block) {\n            continue;\n          }\n\n          // Given that messagesByTopic should be in order by receiveTime\n          // We need to combine all of the messages into a single array and sorted by receive time\n          forEachSortedArrays(\n            topicsToPreloadForPanel.map((topic) => block.messagesByTopic[topic] ?? []),\n            (a, b) => compare(a.receiveTime, b.receiveTime),\n            (messageEvent) => {\n              // Message blocks may contain topics that we are not subscribed to so we need to filter those out.\n              // We use the topicNoConversions and topicConversions to determine if we should include the message event\n\n              if (unconvertedSubscriptionTopics.has(messageEvent.topic)) {\n                frames.push(messageEvent);\n              }\n\n              // Get the converters available for this topic and schema\n              const converters = topicSchemaConverters.get(\n                converterKey(messageEvent.topic, messageEvent.schemaName),\n              );\n              if (converters) {\n                for (const converter of converters) {\n                  const convertedMessage = converter.converter(messageEvent.message);\n                  frames.push({\n                    topic: messageEvent.topic,\n                    schemaName: converter.toSchemaName,\n                    receiveTime: messageEvent.receiveTime,\n                    message: convertedMessage,\n                    originalMessageEvent: messageEvent,\n                    sizeInBytes: messageEvent.sizeInBytes,\n                  });\n                }\n              }\n            },\n          );\n        }\n      }\n      prevBlocks = newBlocks;\n    }\n\n    if (watchedFields.has(\"currentTime\")) {\n      if (renderState.currentTime !== activeData?.currentTime) {\n        renderState.currentTime = activeData?.currentTime;\n        shouldRender = true;\n      }\n    }\n\n    if (watchedFields.has(\"startTime\")) {\n      if (renderState.startTime !== activeData?.startTime) {\n        renderState.startTime = activeData?.startTime;\n        shouldRender = true;\n      }\n    }\n\n    if (watchedFields.has(\"endTime\")) {\n      if (renderState.endTime !== activeData?.endTime) {\n        renderState.endTime = activeData?.endTime;\n        shouldRender = true;\n      }\n    }\n\n    if (watchedFields.has(\"previewTime\")) {\n      const startTime = activeData?.startTime;\n\n      if (startTime != undefined && hoverValue != undefined) {\n        const stamp = toSec(startTime) + hoverValue.value;\n        if (stamp !== renderState.previewTime) {\n          shouldRender = true;\n        }\n        renderState.previewTime = stamp;\n      } else {\n        if (renderState.previewTime != undefined) {\n          shouldRender = true;\n        }\n        renderState.previewTime = undefined;\n      }\n    }\n\n    if (watchedFields.has(\"colorScheme\")) {\n      if (colorScheme !== renderState.colorScheme) {\n        shouldRender = true;\n        renderState.colorScheme = colorScheme;\n      }\n    }\n\n    if (watchedFields.has(\"appSettings\")) {\n      if (renderState.appSettings !== appSettings) {\n        shouldRender = true;\n        renderState.appSettings = appSettings;\n      }\n    }\n\n    // Update the prev fields with the latest values at the end of all the watch steps\n    // Several of the watch steps depend on the comparison against prev and new values\n    prevSubscriptions = subscriptions;\n    prevMessageConverters = messageConverters;\n\n    if (!shouldRender) {\n      return undefined;\n    }\n\n    return renderState;\n  };\n}\n\nexport { initRenderStateBuilder };\n\n/**\n * Function to iterate and call function over multiple sorted arrays in sorted order across all items in all arrays.\n * Time complexity is O(t*n) where t is the number of arrays and n is the total number of items in all arrays.\n * Space complexity is O(t) where t is the number of arrays.\n * @param arrays - sorted arrays to iterate over\n * @param compareFn - function called to compare items in arrays. Returns a positive value if left is larger than right,\n *  a negative value if right is larger than left, or zero if both are equal\n * @param forEach - callback to be executed on all items in the arrays to iterate over in sorted order across all arrays\n */\nexport function forEachSortedArrays<Item>(\n  arrays: Item[][],\n  compareFn: (a: Item, b: Item) => number,\n  forEach: (item: Item) => void,\n): void {\n  const cursors: number[] = Array(arrays.length).fill(0);\n  if (arrays.length === 0) {\n    return;\n  }\n  for (;;) {\n    let minCursorIndex = undefined;\n    for (let i = 0; i < cursors.length; i++) {\n      const cursor = cursors[i]!;\n      const array = arrays[i]!;\n      if (cursor >= array.length) {\n        continue;\n      }\n      const item = array[cursor]!;\n      if (minCursorIndex == undefined) {\n        minCursorIndex = i;\n      } else {\n        const minItem = arrays[minCursorIndex]![cursors[minCursorIndex]!]!;\n        if (compareFn(item, minItem) < 0) {\n          minCursorIndex = i;\n        }\n      }\n    }\n    if (minCursorIndex == undefined) {\n      break;\n    }\n    const minItem = arrays[minCursorIndex]![cursors[minCursorIndex]!];\n    if (minItem != undefined) {\n      forEach(minItem);\n      cursors[minCursorIndex]++;\n    } else {\n      break;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useTheme } from \"@mui/material\";\nimport { CSSProperties, useEffect, useLayoutEffect, useMemo, useRef, useState } from \"react\";\nimport { useLatest } from \"react-use\";\nimport { v4 as uuid } from \"uuid\";\n\nimport { useValueChangedDebugLog } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { fromSec, toSec } from \"@foxglove/rostime\";\nimport {\n  AppSettingValue,\n  ExtensionPanelRegistration,\n  PanelExtensionContext,\n  ParameterValue,\n  RenderState,\n  SettingsTree,\n  Subscription,\n  VariableValue,\n} from \"@foxglove/studio\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n  useMessagePipelineGetter,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { usePanelContext } from \"@foxglove/studio-base/components/PanelContext\";\nimport PanelToolbar from \"@foxglove/studio-base/components/PanelToolbar\";\nimport { useAppConfiguration } from \"@foxglove/studio-base/context/AppConfigurationContext\";\nimport {\n  ExtensionCatalog,\n  useExtensionCatalog,\n} from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport {\n  useClearHoverValue,\n  useHoverValue,\n  useSetHoverValue,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport useGlobalVariables from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { useSynchronousMountedState } from \"@foxglove/studio-base/hooks/useSynchronousMountedState\";\nimport {\n  AdvertiseOptions,\n  PlayerCapabilities,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\nimport {\n  usePanelSettingsTreeUpdate,\n  useSharedPanelState,\n  useDefaultPanelTitle,\n} from \"@foxglove/studio-base/providers/PanelStateContextProvider\";\nimport { PanelConfig, SaveConfig } from \"@foxglove/studio-base/types/panels\";\nimport { assertNever } from \"@foxglove/studio-base/util/assertNever\";\n\nimport { initRenderStateBuilder } from \"./renderState\";\n\nconst log = Logger.getLogger(__filename);\n\ntype PanelExtensionAdapterProps = {\n  /** function that initializes the panel extension */\n  initPanel: ExtensionPanelRegistration[\"initPanel\"];\n\n  config: unknown;\n  saveConfig: SaveConfig<unknown>;\n};\n\nfunction selectContext(ctx: MessagePipelineContext) {\n  return ctx;\n}\n\nfunction selectInstalledMessageConverters(state: ExtensionCatalog) {\n  return state.installedMessageConverters;\n}\n\ntype RenderFn = NonNullable<PanelExtensionContext[\"onRender\"]>;\n/**\n * PanelExtensionAdapter renders a panel extension via initPanel\n *\n * The adapter creates a PanelExtensionContext and invokes initPanel using the context.\n */\nfunction PanelExtensionAdapter(props: PanelExtensionAdapterProps): JSX.Element {\n  const { initPanel, config, saveConfig } = props;\n\n  // Unlike the react data flow, the config is only provided to the panel once on setup.\n  // The panel is meant to manage the config and call saveConfig on its own.\n  //\n  // We store the config in a ref to avoid re-initializing the panel when the react config\n  // changes.\n  const initialState = useLatest(config);\n\n  const messagePipelineContext = useMessagePipeline(selectContext);\n\n  const { playerState, pauseFrame, setSubscriptions, seekPlayback, sortedTopics } =\n    messagePipelineContext;\n\n  const { capabilities, profile: dataSourceProfile } = playerState;\n\n  const { openSiblingPanel } = usePanelContext();\n\n  const [panelId] = useState(() => uuid());\n  const isMounted = useSynchronousMountedState();\n  const [error, setError] = useState<Error | undefined>();\n  const [watchedFields, setWatchedFields] = useState(new Set<keyof RenderState>());\n  const messageConverters = useExtensionCatalog(selectInstalledMessageConverters);\n\n  const [localSubscriptions, setLocalSubscriptions] = useState<Subscription[]>([]);\n\n  const [appSettings, setAppSettings] = useState(new Map<string, AppSettingValue>());\n  const [subscribedAppSettings, setSubscribedAppSettings] = useState<string[]>([]);\n\n  const [renderFn, setRenderFn] = useState<RenderFn | undefined>();\n  const isPanelInitializedRef = useRef(false);\n\n  const [slowRender, setSlowRender] = useState(false);\n  const [, setDefaultPanelTitle] = useDefaultPanelTitle();\n\n  const { globalVariables, setGlobalVariables } = useGlobalVariables();\n\n  const hoverValue = useHoverValue({\n    componentId: `PanelExtensionAdapter:${panelId}`,\n    isTimestampScale: true,\n  });\n  const setHoverValue = useSetHoverValue();\n  const clearHoverValue = useClearHoverValue();\n\n  // track the advertisements requested by the panel context\n  // topic -> advertisement\n  const advertisementsRef = useRef(new Map<string, AdvertiseOptions>());\n\n  const {\n    palette: { mode: colorScheme },\n  } = useTheme();\n\n  const appConfiguration = useAppConfiguration();\n\n  // The panel extension context exposes methods on the message pipeline. We don't want\n  // the extension context to be re-created when the message pipeline changes since it only\n  // needs to act on the latest version of the message pipeline.\n  //\n  // This getter allows the extension context to remain stable through pipeline changes\n  const getMessagePipelineContext = useMessagePipelineGetter();\n\n  // initRenderStateBuilder render produces a function which computes the latest render state from a set of inputs\n  // Spiritually its like a reducer\n  const [buildRenderState, setBuildRenderState] = useState(() => initRenderStateBuilder());\n\n  const [sharedPanelState, setSharedPanelState] = useSharedPanelState();\n\n  // Register handlers to update the app settings we subscribe to\n  useEffect(() => {\n    const handlers = new Map<string, (newValue: AppSettingValue) => void>();\n\n    for (const key of subscribedAppSettings) {\n      const handler = (newValue: AppSettingValue) => {\n        setAppSettings((old) => {\n          old.set(key, newValue);\n          return new Map(old);\n        });\n      };\n      handlers.set(key, handler);\n      appConfiguration.addChangeListener(key, handler);\n    }\n\n    const newAppSettings = new Map<string, AppSettingValue>();\n    for (const key of subscribedAppSettings) {\n      newAppSettings.set(key, appConfiguration.get(key));\n    }\n\n    setAppSettings(newAppSettings);\n\n    return () => {\n      for (const [key, handler] of handlers.entries()) {\n        appConfiguration.removeChangeListener(key, handler);\n      }\n    };\n  }, [appConfiguration, subscribedAppSettings]);\n\n  const messageEvents = useMemo(\n    () => messagePipelineContext.messageEventsBySubscriberId.get(panelId),\n    [messagePipelineContext.messageEventsBySubscriberId, panelId],\n  );\n\n  // The rendering ref is set when we've begin rendering the frame (calling the panel's render\n  // function)\n  //\n  // If another update arrives before the panel finishes rendering, we will update the\n  // slowRenderState to indicate that the panel could not keep up with rendering relative to\n  // updates.\n  const renderingRef = useRef<boolean>(false);\n  useLayoutEffect(() => {\n    /**\n     * We need to check that the panel has been initialized because the renderFn function is being\n     * called between the initPanel's useLayoutEffect cleanup and initPanel being called\n     * again even if setRenderFn(undefined) is called in the cleanup function. This causes\n     * the old renderFn to be called in this effect and pauseFrame to happen, but it is never\n     * resumed, thus causing a 5 second delay in all panels in the layout to be loaded.\n     */\n    if (!renderFn || !isPanelInitializedRef.current) {\n      return;\n    }\n\n    const renderState = buildRenderState({\n      appSettings,\n      colorScheme,\n      currentFrame: messageEvents,\n      globalVariables,\n      hoverValue,\n      messageConverters,\n      playerState,\n      sharedPanelState,\n      sortedTopics,\n      subscriptions: localSubscriptions,\n      watchedFields,\n    });\n\n    if (!renderState) {\n      return;\n    }\n\n    if (renderingRef.current) {\n      setSlowRender(true);\n      return;\n    }\n\n    setSlowRender(false);\n    const resumeFrame = pauseFrame(panelId);\n\n    // tell the panel to render and lockout future renders until rendering is complete\n    renderingRef.current = true;\n    try {\n      setError(undefined);\n      let doneCalled = false;\n      renderFn(renderState, () => {\n        // ignore any additional done calls from the panel\n        if (doneCalled) {\n          log.warn(`${panelId} called render done function twice`);\n          return;\n        }\n        doneCalled = true;\n        resumeFrame();\n        renderingRef.current = false;\n      });\n    } catch (err) {\n      setError(err);\n    }\n  }, [\n    appSettings,\n    buildRenderState,\n    colorScheme,\n    globalVariables,\n    hoverValue,\n    localSubscriptions,\n    messageConverters,\n    messageEvents,\n    panelId,\n    pauseFrame,\n    playerState,\n    renderFn,\n    sharedPanelState,\n    sortedTopics,\n    watchedFields,\n  ]);\n\n  const updatePanelSettingsTree = usePanelSettingsTreeUpdate();\n\n  type PartialPanelExtensionContext = Omit<PanelExtensionContext, \"panelElement\">;\n  const partialExtensionContext = useMemo<PartialPanelExtensionContext>(() => {\n    const layout: PanelExtensionContext[\"layout\"] = {\n      addPanel({ position, type, updateIfExists, getState }) {\n        if (!isMounted()) {\n          return;\n        }\n        switch (position) {\n          case \"sibling\":\n            openSiblingPanel({\n              panelType: type,\n              updateIfExists,\n              siblingConfigCreator: (existingConfig) => getState(existingConfig) as PanelConfig,\n            });\n            return;\n          default:\n            assertNever(position, `Unsupported position for addPanel: ${position}`);\n        }\n      },\n    };\n\n    return {\n      initialState: initialState.current,\n\n      saveState: (state) => {\n        if (!isMounted()) {\n          return;\n        }\n        saveConfig(state);\n      },\n\n      layout,\n\n      seekPlayback: seekPlayback\n        ? (stamp: number) => {\n            if (!isMounted()) {\n              return;\n            }\n            seekPlayback(fromSec(stamp));\n          }\n        : undefined,\n\n      dataSourceProfile,\n\n      setParameter: (name: string, value: ParameterValue) => {\n        if (!isMounted()) {\n          return;\n        }\n        getMessagePipelineContext().setParameter(name, value);\n      },\n\n      setVariable: (name: string, value: VariableValue) => {\n        if (!isMounted()) {\n          return;\n        }\n        setGlobalVariables({ [name]: value });\n      },\n\n      setPreviewTime: (stamp: number | undefined) => {\n        if (!isMounted()) {\n          return;\n        }\n        if (stamp == undefined) {\n          clearHoverValue(\"PanelExtensionAdatper\");\n        } else {\n          const ctx = getMessagePipelineContext();\n          const startTime = ctx.playerState.activeData?.startTime;\n          // if we don't have a start time we cannot correctly set the playback seconds hover value\n          // this hover value needs seconds from start\n          if (!startTime) {\n            return;\n          }\n          const secondsFromStart = stamp - toSec(startTime);\n          setHoverValue({\n            type: \"PLAYBACK_SECONDS\",\n            componentId: \"PanelExtensionAdatper\",\n            value: secondsFromStart,\n          });\n        }\n      },\n\n      setSharedPanelState,\n\n      watch: (field: keyof RenderState) => {\n        if (!isMounted()) {\n          return;\n        }\n        setWatchedFields((old) => {\n          if (old.has(field)) {\n            // In React 18 we noticed that this setter function would be called in an infinite loop\n            // even though watch() was not called repeatedly. Adding this early return of the old\n            // value fixed the issue.\n            return old;\n          }\n          const newWatchedFields = new Set(old);\n          newWatchedFields.add(field);\n          return newWatchedFields;\n        });\n      },\n\n      subscribe: (topics: ReadonlyArray<string | Subscription>) => {\n        if (!isMounted()) {\n          return;\n        }\n        const subscribePayloads = topics.map<SubscribePayload>((item) => {\n          if (typeof item === \"string\") {\n            // For backwards compatability with the topic-string-array api `subscribe([\"/topic\"])`\n            // results in a topic subscription with full preloading\n            return { topic: item, preloadType: \"full\" };\n          }\n\n          return {\n            topic: item.topic,\n            convertTo: item.convertTo,\n            preloadType: item.preload === true ? \"full\" : \"partial\",\n          };\n        });\n\n        // ExtensionPanel-Facing subscription type\n        const localSubs = topics.map<Subscription>((item) => {\n          if (typeof item === \"string\") {\n            return { topic: item, preload: true };\n          }\n\n          return item;\n        });\n\n        setLocalSubscriptions(localSubs);\n        setSubscriptions(panelId, subscribePayloads);\n      },\n\n      advertise: capabilities.includes(PlayerCapabilities.advertise)\n        ? (topic: string, datatype: string, options) => {\n            if (!isMounted()) {\n              return;\n            }\n            const payload: AdvertiseOptions = {\n              topic,\n              schemaName: datatype,\n              options,\n            };\n            advertisementsRef.current.set(topic, payload);\n\n            getMessagePipelineContext().setPublishers(\n              panelId,\n              Array.from(advertisementsRef.current.values()),\n            );\n          }\n        : undefined,\n\n      unadvertise: capabilities.includes(PlayerCapabilities.advertise)\n        ? (topic: string) => {\n            if (!isMounted()) {\n              return;\n            }\n            advertisementsRef.current.delete(topic);\n            getMessagePipelineContext().setPublishers(\n              panelId,\n              Array.from(advertisementsRef.current.values()),\n            );\n          }\n        : undefined,\n\n      publish: capabilities.includes(PlayerCapabilities.advertise)\n        ? (topic, message) => {\n            if (!isMounted()) {\n              return;\n            }\n            getMessagePipelineContext().publish({\n              topic,\n              msg: message as Record<string, unknown>,\n            });\n          }\n        : undefined,\n\n      callService: capabilities.includes(PlayerCapabilities.callServices)\n        ? async (service, request): Promise<unknown> => {\n            if (!isMounted()) {\n              throw new Error(\"Service call after panel was unmounted\");\n            }\n            return await getMessagePipelineContext().callService(service, request);\n          }\n        : undefined,\n\n      unsubscribeAll: () => {\n        if (!isMounted()) {\n          return;\n        }\n        setLocalSubscriptions([]);\n        setSubscriptions(panelId, []);\n      },\n\n      subscribeAppSettings: (settings: string[]) => {\n        if (!isMounted()) {\n          return;\n        }\n        setSubscribedAppSettings(settings);\n      },\n\n      updatePanelSettingsEditor: (settings: SettingsTree) => {\n        if (!isMounted()) {\n          return;\n        }\n        updatePanelSettingsTree(settings);\n      },\n\n      setDefaultPanelTitle: (title: string) => {\n        if (!isMounted()) {\n          return;\n        }\n        setDefaultPanelTitle(title);\n      },\n    };\n  }, [\n    capabilities,\n    clearHoverValue,\n    dataSourceProfile,\n    getMessagePipelineContext,\n    initialState,\n    isMounted,\n    openSiblingPanel,\n    panelId,\n    saveConfig,\n    seekPlayback,\n    setDefaultPanelTitle,\n    setGlobalVariables,\n    setHoverValue,\n    setSharedPanelState,\n    setSubscriptions,\n    updatePanelSettingsTree,\n  ]);\n\n  const panelContainerRef = useRef<HTMLDivElement>(ReactNull);\n\n  useValueChangedDebugLog(initPanel, \"initPanel\");\n  useValueChangedDebugLog(panelId, \"panelId\");\n  useValueChangedDebugLog(partialExtensionContext, \"partialExtensionContext\");\n\n  // Manage extension lifecycle by calling initPanel() when the panel context changes.\n  //\n  // If we useEffect here instead of useLayoutEffect, the prevRenderState can get polluted with data\n  // from a previous panel instance.\n  useLayoutEffect(() => {\n    if (!panelContainerRef.current) {\n      throw new Error(\"Expected panel container to be mounted\");\n    }\n\n    // Reset local state when the panel element is mounted or changes\n    setRenderFn(undefined);\n    renderingRef.current = false;\n    setSlowRender(false);\n\n    setBuildRenderState(() => initRenderStateBuilder());\n\n    const panelElement = document.createElement(\"div\");\n    panelElement.style.width = \"100%\";\n    panelElement.style.height = \"100%\";\n    panelElement.style.overflow = \"hidden\";\n    panelContainerRef.current.appendChild(panelElement);\n\n    log.info(`Init panel ${panelId}`);\n    const onUnmount = initPanel({\n      panelElement,\n      ...partialExtensionContext,\n\n      // eslint-disable-next-line no-restricted-syntax\n      set onRender(renderFunction: RenderFn | undefined) {\n        setRenderFn(() => renderFunction);\n      },\n    });\n    isPanelInitializedRef.current = true;\n\n    return () => {\n      if (onUnmount) {\n        onUnmount();\n      }\n      isPanelInitializedRef.current = false;\n      panelElement.remove();\n      getMessagePipelineContext().setSubscriptions(panelId, []);\n      getMessagePipelineContext().setPublishers(panelId, []);\n    };\n  }, [initPanel, panelId, partialExtensionContext, getMessagePipelineContext]);\n\n  const style: CSSProperties = {};\n  if (slowRender) {\n    style.borderColor = \"orange\";\n    style.borderWidth = \"1px\";\n    style.borderStyle = \"solid\";\n  }\n\n  if (error) {\n    throw error;\n  }\n\n  return (\n    <div\n      style={{\n        alignItems: \"stretch\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        height: \"100%\",\n        overflow: \"hidden\",\n        width: \"100%\",\n        zIndex: 0,\n        ...style,\n      }}\n    >\n      <PanelToolbar />\n      <div style={{ flex: 1, overflow: \"hidden\" }} ref={panelContainerRef} />\n    </div>\n  );\n}\n\nexport default PanelExtensionAdapter;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Fragment, ReactNode, useCallback } from \"react\";\n\nimport {\n  PanelStateStore,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\n\n/**\n * Wrapper component used to force-remount the panel when key properties like the tabId\n * or settings sequence number change.\n */\nexport function PanelRemounter({\n  children,\n  id,\n  tabId,\n}: {\n  children: ReactNode;\n  id: string;\n  tabId: undefined | string;\n}): JSX.Element {\n  const selector = useCallback((store: PanelStateStore) => store.sequenceNumbers[id] ?? 0, [id]);\n  const sequenceNumber = usePanelStateStore(selector);\n\n  return <Fragment key={`${id}${tabId ?? \"\"}${sequenceNumber}`}>{children}</Fragment>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport withPanel from \"@foxglove/studio-base/components/Panel\";\nimport PanelToolbar from \"@foxglove/studio-base/components/PanelToolbar\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { SaveConfig } from \"@foxglove/studio-base/types/panels\";\n\n// Since the unknown panel never saves its config, the config fields here are used with `overrideConfig`\n// to the connected Panel component (returned from withPanel).\n//\n// The _type_ config option should be the type of the missing panel.\ntype Props = {\n  config: { type: string; id: string };\n  saveConfig: SaveConfig<unknown>;\n};\n\nfunction UnconnectedUnknownPanel(props: Props) {\n  const { config, saveConfig: _ } = props;\n\n  return (\n    <Stack flex=\"auto\" alignItems=\"center\" justifyContent=\"center\" data-testid={config.id}>\n      <PanelToolbar isUnknownPanel />\n      <EmptyState>Unknown panel type: {config.type}.</EmptyState>\n    </Stack>\n  );\n}\nUnconnectedUnknownPanel.panelType = \"unknown\";\nUnconnectedUnknownPanel.defaultConfig = {};\n\n/**\n * An UnknownPanel stands in for missing panels. When a panel referenced in a layout is not\n * available (maybe the extension was un-installed), this panel is shown instead.\n */\nexport const UnknownPanel = withPanel(UnconnectedUnknownPanel);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { CircularProgress, Link, styled as muiStyled, Typography } from \"@mui/material\";\nimport React, { PropsWithChildren, Suspense, useCallback, useMemo } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport {\n  MosaicDragType,\n  MosaicNode,\n  MosaicPath,\n  MosaicWindow,\n  MosaicWithoutDragDropContext,\n} from \"react-mosaic-component\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { EmptyPanelLayout } from \"@foxglove/studio-base/components/EmptyPanelLayout\";\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n  usePanelMosaicId,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { defaultPlaybackConfig } from \"@foxglove/studio-base/providers/CurrentLayoutProvider/reducers\";\nimport { MosaicDropResult, PanelConfig } from \"@foxglove/studio-base/types/panels\";\nimport { getPanelIdForType, getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nimport ErrorBoundary from \"./ErrorBoundary\";\nimport { MosaicPathContext } from \"./MosaicPathContext\";\nimport { PanelRemounter } from \"./PanelRemounter\";\nimport { UnknownPanel } from \"./UnknownPanel\";\n\nimport \"react-mosaic-component/react-mosaic-component.css\";\n\ntype Props = {\n  layout?: MosaicNode<string>;\n  onChange: (panels: MosaicNode<string> | undefined) => void;\n  tabId?: string;\n};\n\n// CSS hack to disable the first level of drop targets inside a Tab's own mosaic window (that would\n// place the dropped item as a sibling of the Tab), as well as the \"root drop targets\" inside the\n// nested mosaic (that would place the dropped item as a direct child of the Tab). Makes it easier\n// to drop panels into a tab layout.\nconst HideTopLevelDropTargets = muiStyled(\"div\")`\n  margin: 0;\n\n  .mosaic-root + .drop-target-container {\n    display: none !important;\n  }\n  & > .mosaic-window > .drop-target-container {\n    display: none !important;\n  }\n`;\n\n// This wrapper makes the tabId available in the drop result when something is dropped into a nested\n// drop target. This allows a panel to know which mosaic it was dropped in regardless of nesting\n// level.\nfunction TabMosaicWrapper({ tabId, children }: PropsWithChildren<{ tabId?: string }>) {\n  const [, drop] = useDrop<unknown, MosaicDropResult, never>({\n    accept: MosaicDragType.WINDOW,\n    drop: (_item, monitor) => {\n      const nestedDropResult = monitor.getDropResult<MosaicDropResult>();\n      if (nestedDropResult) {\n        // The drop result may already have a tabId if it was dropped in a more deeply-nested Tab\n        // mosaic. Provide our tabId only if there wasn't one already.\n        return { tabId, ...nestedDropResult };\n      }\n      return undefined;\n    },\n  });\n  return (\n    <HideTopLevelDropTargets className=\"mosaic-tile\" ref={drop}>\n      {children}\n    </HideTopLevelDropTargets>\n  );\n}\n\nexport function UnconnectedPanelLayout(props: Props): React.ReactElement {\n  const { savePanelConfigs } = useCurrentLayoutActions();\n  const mosaicId = usePanelMosaicId();\n  const { layout, onChange, tabId } = props;\n  const createTile = useCallback(\n    (config?: { type?: string; panelConfig?: PanelConfig }) => {\n      const defaultPanelType = \"RosOut\";\n      const type = config?.type ? config.type : defaultPanelType;\n      const id = getPanelIdForType(type);\n      if (config?.panelConfig) {\n        savePanelConfigs({ configs: [{ id, config: config.panelConfig }] });\n      }\n      return id;\n    },\n    [savePanelConfigs],\n  );\n\n  const panelCatalog = usePanelCatalog();\n\n  const panelComponents = useMemo(\n    () =>\n      new Map(\n        panelCatalog.getPanels().map((panelInfo) => [panelInfo.type, React.lazy(panelInfo.module)]),\n      ),\n    [panelCatalog],\n  );\n\n  const renderTile = useCallback(\n    (id: string | Record<string, never> | undefined, path: MosaicPath) => {\n      // `id` is usually a string. But when `layout` is empty, `id` will be an empty object, in which case we don't need to render Tile\n      if (id == undefined || typeof id !== \"string\") {\n        return <></>;\n      }\n      const type = getPanelTypeFromId(id);\n\n      let panel: JSX.Element;\n      const PanelComponent = panelComponents.get(type);\n      if (PanelComponent) {\n        panel = <PanelComponent childId={id} tabId={tabId} />;\n      } else {\n        // If we haven't found a panel of the given type, render the panel selector\n        panel = <UnknownPanel childId={id} tabId={tabId} overrideConfig={{ type, id }} />;\n      }\n\n      const mosaicWindow = (\n        <MosaicWindow\n          title=\"\"\n          key={id}\n          path={path}\n          createNode={createTile}\n          renderPreview={() => undefined as unknown as JSX.Element}\n        >\n          <Suspense\n            fallback={\n              <EmptyState>\n                <CircularProgress size={28} />\n              </EmptyState>\n            }\n          >\n            <MosaicPathContext.Provider value={path}>\n              <PanelRemounter id={id} tabId={tabId}>\n                {panel}\n              </PanelRemounter>\n            </MosaicPathContext.Provider>\n          </Suspense>\n        </MosaicWindow>\n      );\n      if (type === \"Tab\") {\n        return <TabMosaicWrapper tabId={id}>{mosaicWindow}</TabMosaicWrapper>;\n      }\n      return mosaicWindow;\n    },\n    [panelComponents, createTile, tabId],\n  );\n\n  const bodyToRender = useMemo(\n    () =>\n      layout != undefined ? (\n        <MosaicWithoutDragDropContext\n          renderTile={renderTile}\n          className=\"mosaic-foxglove-theme\" // prevent the default mosaic theme from being applied\n          resize={{ minimumPaneSizePercentage: 2 }}\n          value={layout}\n          onChange={(newLayout) => onChange(newLayout ?? undefined)}\n          mosaicId={mosaicId}\n        />\n      ) : (\n        <EmptyPanelLayout tabId={tabId} />\n      ),\n    [layout, mosaicId, onChange, renderTile, tabId],\n  );\n\n  return <ErrorBoundary>{bodyToRender}</ErrorBoundary>;\n}\n\nfunction LoadingState(): JSX.Element {\n  return (\n    <EmptyState>\n      <CircularProgress size={28} />\n    </EmptyState>\n  );\n}\n\nconst selectedLayoutLoadingSelector = (state: LayoutState) => state.selectedLayout?.loading;\nconst selectedLayoutExistsSelector = (state: LayoutState) =>\n  state.selectedLayout?.data != undefined;\nconst selectedLayoutMosaicSelector = (state: LayoutState) => state.selectedLayout?.data?.layout;\n\nexport default function PanelLayout(): JSX.Element {\n  const { changePanelLayout, setSelectedLayoutId } = useCurrentLayoutActions();\n  const { openLayoutBrowser } = useWorkspaceActions();\n  const layoutManager = useLayoutManager();\n  const layoutExists = useCurrentLayoutSelector(selectedLayoutExistsSelector);\n  const layoutLoading = useCurrentLayoutSelector(selectedLayoutLoadingSelector);\n  const mosaicLayout = useCurrentLayoutSelector(selectedLayoutMosaicSelector);\n  const registeredExtensions = useExtensionCatalog((state) => state.installedExtensions);\n  const [enableNewTopNav = false] = useAppConfigurationValue<boolean>(AppSetting.ENABLE_NEW_TOPNAV);\n\n  const createNewLayout = async () => {\n    const layoutData: Omit<LayoutData, \"name\" | \"id\"> = {\n      configById: {},\n      globalVariables: {},\n      userNodes: {},\n      playbackConfig: defaultPlaybackConfig,\n    };\n\n    const layout = await layoutManager.saveNewLayout({\n      name: \"Default\",\n      data: layoutData,\n      permission: \"CREATOR_WRITE\",\n    });\n    setSelectedLayoutId(layout.id);\n\n    if (!enableNewTopNav) {\n      openLayoutBrowser();\n    }\n  };\n\n  const selectExistingLayout = async () => {\n    if (!enableNewTopNav) {\n      const layouts = await layoutManager.getLayouts();\n      if (layouts[0]) {\n        setSelectedLayoutId(layouts[0].id);\n      }\n    }\n    openLayoutBrowser();\n  };\n\n  const onChange = useCallback(\n    (newLayout: MosaicNode<string> | undefined) => {\n      if (newLayout != undefined) {\n        changePanelLayout({ layout: newLayout });\n      }\n    },\n    [changePanelLayout],\n  );\n\n  if (registeredExtensions == undefined) {\n    return <LoadingState />;\n  }\n\n  if (layoutExists) {\n    return <UnconnectedPanelLayout layout={mosaicLayout} onChange={onChange} />;\n  }\n\n  if (layoutLoading === true) {\n    return <LoadingState />;\n  }\n\n  return (\n    <EmptyState>\n      <Typography display=\"block\" variant=\"body1\" color=\"text.primary\">\n        You don&apos;t currently have a layout selected.\n      </Typography>\n      <Link onClick={selectExistingLayout} underline=\"hover\" color=\"primary\" variant=\"body1\">\n        Select an existing layout\n      </Link>{\" \"}\n      <Typography display=\"inline-flex\" variant=\"body1\" color=\"text.primary\">\n        or\n      </Typography>{\" \"}\n      <Link onClick={createNewLayout} underline=\"hover\" color=\"primary\" variant=\"body1\">\n        Create a new layout\n      </Link>\n    </EmptyState>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { styled as muiStyled } from \"@mui/material\";\nimport fuzzySort from \"fuzzysort\";\n\nconst STextHighlight = muiStyled(\"span\")(\n  ({ theme }) => `\n  .TextHighlight-highlight {\n    color: ${theme.palette.primary.main};\n    font-weight: bold;\n  }\n`,\n);\n\ntype Props = {\n  targetStr: string;\n  searchText?: string;\n};\n\nexport default function TextHighlight({ targetStr = \"\", searchText = \"\" }: Props): JSX.Element {\n  if (searchText.length === 0) {\n    return <>{targetStr}</>;\n  }\n\n  const match = fuzzySort.single(searchText, targetStr);\n\n  const result = match\n    ? fuzzySort.highlight(match, \"<span class='TextHighlight-highlight'>\", \"</span>\")\n    : undefined;\n\n  return (\n    <STextHighlight>\n      {result != undefined && result.length > 0 ? (\n        <span dangerouslySetInnerHTML={{ __html: result }} />\n      ) : (\n        targetStr\n      )}\n    </STextHighlight>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { ReOrderDotsVertical16Filled } from \"@fluentui/react-icons\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport {\n  Card,\n  CardActionArea,\n  CardContent,\n  CardMedia,\n  Container,\n  Fade,\n  IconButton,\n  List,\n  ListItem,\n  ListItemButton,\n  ListItemText,\n  TextField,\n  Tooltip,\n  Typography,\n} from \"@mui/material\";\nimport fuzzySort from \"fuzzysort\";\nimport { countBy, isEmpty } from \"lodash\";\nimport { forwardRef, useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useDrag } from \"react-dnd\";\nimport { useTranslation } from \"react-i18next\";\nimport { MosaicDragType, MosaicPath } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextHighlight from \"@foxglove/studio-base/components/TextHighlight\";\nimport {\n  useCurrentLayoutActions,\n  usePanelMosaicId,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { PanelInfo, usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\nimport {\n  PanelConfig,\n  MosaicDropTargetPosition,\n  SavedProps,\n  MosaicDropResult,\n} from \"@foxglove/studio-base/types/panels\";\nimport { mightActuallyBePartial } from \"@foxglove/studio-base/util/mightActuallyBePartial\";\n\nconst useStyles = makeStyles<void, \"dragIcon\">()((theme, _params, classes) => {\n  return {\n    fullHeight: {\n      height: \"100%\",\n    },\n    imagePlaceholder: {\n      paddingBottom: `${(200 / 280) * 100}%`,\n      backgroundColor: theme.palette.background.default,\n    },\n    cardContent: {\n      flex: \"auto\",\n    },\n    listItemButton: {\n      cursor: \"grab\",\n\n      [`&:not(:hover) .${classes.dragIcon}`]: {\n        visibility: \"hidden\",\n      },\n    },\n    dragIcon: {\n      cursor: \"grab\",\n      marginRight: theme.spacing(-1),\n      color: theme.palette.text.disabled,\n    },\n    grid: {\n      display: \"grid !important\",\n      gridTemplateColumns: \"repeat(auto-fill, minmax(240px, 1fr))\",\n      gap: theme.spacing(2),\n    },\n    toolbar: {\n      position: \"sticky\",\n      top: -0.5, // yep that's a half pixel to avoid a gap between the appbar and panel top\n      zIndex: 100,\n      display: \"flex\",\n      padding: theme.spacing(1.5),\n      justifyContent: \"stretch\",\n      backgroundImage: `linear-gradient(to top, transparent, ${\n        theme.palette.background.paper\n      } ${theme.spacing(1.5)}) !important`,\n    },\n    toolbarGrid: {\n      padding: theme.spacing(2),\n    },\n  };\n});\n\ntype DropDescription = {\n  type: string;\n  config?: PanelConfig;\n  relatedConfigs?: SavedProps;\n  position?: MosaicDropTargetPosition;\n  path?: MosaicPath;\n  tabId?: string;\n};\n\ntype PanelItemProps = {\n  mode?: \"grid\" | \"list\";\n  panel: {\n    type: string;\n    title: string;\n    description?: string;\n    config?: PanelConfig;\n    relatedConfigs?: SavedProps;\n    thumbnail?: string;\n    extensionNamespace?: ExtensionNamespace;\n  };\n  searchQuery: string;\n  checked?: boolean;\n  highlighted?: boolean;\n  onClick: () => void;\n  mosaicId: string;\n  onDragStart?: () => void;\n  onDrop: (arg0: DropDescription) => void;\n};\n\nfunction blurActiveElement() {\n  // Clear focus from the panel menu button so that spacebar doesn't trigger\n  // more panel additions.\n  if (document.activeElement instanceof HTMLElement) {\n    document.activeElement.blur();\n  }\n}\n\nfunction DraggablePanelItem({\n  mode = \"list\",\n  searchQuery,\n  panel,\n  onClick,\n  onDragStart,\n  onDrop,\n  checked = false,\n  highlighted = false,\n  mosaicId,\n}: PanelItemProps) {\n  const { classes } = useStyles();\n  const scrollRef = useRef<HTMLElement>(ReactNull);\n  const [, connectDragSource] = useDrag<unknown, MosaicDropResult, never>({\n    type: MosaicDragType.WINDOW,\n    // mosaicId is needed for react-mosaic to accept the drop\n    item: () => {\n      onDragStart?.();\n      return { mosaicId };\n    },\n    options: { dropEffect: \"copy\" },\n    end: (_item, monitor) => {\n      const dropResult = monitor.getDropResult() ?? {};\n      const { position, path, tabId } = dropResult;\n      // dropping outside mosaic does nothing. If we have a tabId, but no\n      // position or path, we're dragging into an empty tab.\n      if ((position == undefined || path == undefined) && tabId == undefined) {\n        // when dragging a panel into an empty layout treat it link clicking the panel\n        // mosaic doesn't give us a position or path to invoke onDrop\n        onClick();\n        return;\n      }\n      const { type, config, relatedConfigs } = panel;\n      onDrop({ type, config, relatedConfigs, position, path, tabId });\n    },\n  });\n\n  useEffect(() => {\n    if (highlighted && scrollRef.current) {\n      const highlightedItem = scrollRef.current.getBoundingClientRect();\n      const scrollContainer = scrollRef.current.parentElement?.parentElement?.parentElement;\n      if (scrollContainer) {\n        const scrollContainerToTop = scrollContainer.getBoundingClientRect().top;\n\n        const isInView =\n          highlightedItem.top >= 0 &&\n          highlightedItem.top >= scrollContainerToTop &&\n          highlightedItem.top + 50 <= window.innerHeight;\n\n        if (!isInView) {\n          scrollRef.current.scrollIntoView();\n        }\n      }\n    }\n  }, [highlighted]);\n\n  const mergedRef = useCallback(\n    (el: HTMLElement | ReactNull) => {\n      connectDragSource(el);\n      scrollRef.current = el;\n    },\n    [connectDragSource, scrollRef],\n  );\n\n  const targetString = panel.extensionNamespace\n    ? `${panel.title} [${panel.extensionNamespace}]`\n    : panel.title;\n\n  const onClickWithStopPropagation = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      onClick();\n    },\n    [onClick],\n  );\n\n  switch (mode) {\n    case \"grid\":\n      return (\n        <Card className={classes.fullHeight}>\n          <CardActionArea\n            ref={mergedRef}\n            onClick={onClickWithStopPropagation}\n            className={classes.fullHeight}\n          >\n            <Stack fullHeight>\n              {panel.thumbnail != undefined ? (\n                <CardMedia component=\"img\" image={panel.thumbnail} alt={panel.title} />\n              ) : (\n                <div className={classes.imagePlaceholder} />\n              )}\n              <CardContent className={classes.cardContent}>\n                <Typography variant=\"subtitle2\" gutterBottom>\n                  <span data-testid={`panel-menu-item ${panel.title}`}>\n                    <TextHighlight targetStr={targetString} searchText={searchQuery} />\n                  </span>\n                </Typography>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  <TextHighlight targetStr={panel.description ?? \"\"} searchText={searchQuery} />\n                </Typography>\n              </CardContent>\n            </Stack>\n          </CardActionArea>\n        </Card>\n      );\n\n    case \"list\":\n      return (\n        <Tooltip\n          placement=\"right\"\n          enterDelay={500}\n          leaveDelay={0}\n          TransitionComponent={Fade}\n          title={\n            <Stack paddingTop={0.25} style={{ width: 200 }}>\n              {panel.thumbnail != undefined && <img src={panel.thumbnail} alt={panel.title} />}\n              <Stack padding={1} gap={0.5}>\n                <Typography variant=\"body2\" fontWeight=\"bold\">\n                  {panel.title}\n                </Typography>\n                <Typography variant=\"body2\" style={{ opacity: 0.6 }}>\n                  {panel.description}\n                </Typography>\n              </Stack>\n            </Stack>\n          }\n        >\n          <ListItem disableGutters disablePadding>\n            <ListItemButton\n              selected={highlighted}\n              className={classes.listItemButton}\n              disabled={checked}\n              ref={mergedRef}\n              onClick={onClickWithStopPropagation}\n            >\n              <ListItemText\n                primary={\n                  <span data-testid={`panel-menu-item ${panel.title}`}>\n                    <TextHighlight targetStr={targetString} searchText={searchQuery} />\n                  </span>\n                }\n                primaryTypographyProps={{ fontWeight: checked ? \"bold\" : undefined }}\n              />\n              <ReOrderDotsVertical16Filled className={classes.dragIcon} />\n            </ListItemButton>\n          </ListItem>\n        </Tooltip>\n      );\n  }\n}\n\nexport type PanelSelection = {\n  type: string;\n  config?: PanelConfig;\n  relatedConfigs?: {\n    [panelId: string]: PanelConfig;\n  };\n};\n\ntype Props = {\n  mode?: \"grid\" | \"list\";\n  onPanelSelect: (arg0: PanelSelection) => void;\n  onDragStart?: () => void;\n  selectedPanelType?: string;\n};\n\n// sanity checks to help panel authors debug issues\nfunction verifyPanels(panels: readonly PanelInfo[]) {\n  const panelTypes: Map<string, PanelInfo> = new Map();\n  for (const panel of panels) {\n    const { title, type, config } = mightActuallyBePartial(panel);\n    const dispName = title ?? type ?? \"<unnamed>\";\n    if (type == undefined || type.length === 0) {\n      throw new Error(`Panel component ${title} must declare a unique \\`static panelType\\``);\n    }\n    const existingPanel = mightActuallyBePartial(panelTypes.get(type));\n    if (existingPanel) {\n      const bothHaveEmptyConfigs = isEmpty(existingPanel.config) && isEmpty(config);\n      if (bothHaveEmptyConfigs) {\n        const otherDisplayName = existingPanel.title ?? existingPanel.type ?? \"<unnamed>\";\n        throw new Error(\n          `Two components have the same panelType ('${type}') and no preset configs: ${otherDisplayName} and ${dispName}`,\n        );\n      }\n    }\n    panelTypes.set(type, panel);\n  }\n}\n\nconst PanelList = forwardRef<HTMLDivElement, Props>((props: Props, ref) => {\n  const { mode, onDragStart, onPanelSelect, selectedPanelType } = props;\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [highlightedPanelIdx, setHighlightedPanelIdx] = useState<number | undefined>();\n  const { classes, cx } = useStyles();\n  const { t } = useTranslation(\"addPanel\");\n\n  const { dropPanel } = useCurrentLayoutActions();\n  const mosaicId = usePanelMosaicId();\n\n  // Update panel layout when a panel menu item is dropped;\n  // actual operations to change layout supplied by react-mosaic-component\n  const onPanelMenuItemDrop = useCallback(\n    ({ config, relatedConfigs, type, position, path, tabId }: DropDescription) => {\n      dropPanel({\n        newPanelType: type,\n        destinationPath: path,\n        position,\n        tabId,\n        config,\n        relatedConfigs,\n      });\n      blurActiveElement();\n    },\n    [dropPanel],\n  );\n\n  const handleSearchChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    const query = event.target.value;\n    setSearchQuery(query);\n\n    // When there is a search query, automatically highlight the first (0th) item.\n    // When the user erases the query, remove the highlight.\n    setHighlightedPanelIdx(query ? 0 : undefined);\n  }, []);\n\n  const panelCatalog = usePanelCatalog();\n\n  const namespacedPanels = useMemo(() => {\n    // Remove namespace if panel title is unique.\n    const panels = panelCatalog.getPanels();\n    const countByTitle = countBy(panels, (panel) => panel.title);\n    return panels.map((panel) => {\n      if ((countByTitle[panel.title] ?? 0) > 1) {\n        return panel;\n      } else {\n        return { ...panel, namespace: undefined };\n      }\n    });\n  }, [panelCatalog]);\n\n  const { allRegularPanels, allPreconfiguredPanels } = useMemo(() => {\n    const panels = namespacedPanels;\n    const regular = panels.filter((panel) => !panel.config);\n    const preconfigured = panels.filter((panel) => panel.config);\n    const sortByTitle = (a: PanelInfo, b: PanelInfo) =>\n      a.title.localeCompare(b.title, undefined, { ignorePunctuation: true, sensitivity: \"base\" });\n\n    return {\n      allRegularPanels: [...regular].sort(sortByTitle),\n      allPreconfiguredPanels: [...preconfigured].sort(sortByTitle),\n    };\n  }, [namespacedPanels]);\n\n  useEffect(() => {\n    verifyPanels([...allRegularPanels, ...allPreconfiguredPanels]);\n  }, [allRegularPanels, allPreconfiguredPanels]);\n\n  const getFilteredPanels = useCallback(\n    (panels: PanelInfo[]) => {\n      return searchQuery.length > 0\n        ? fuzzySort\n            .go(searchQuery, panels, {\n              keys: [\"title\", \"description\"],\n              // Weigh title matches more heavily than description matches.\n              scoreFn: (a) => Math.max(a[0] ? a[0].score : -1000, a[1] ? a[1].score - 100 : -1000),\n              threshold: -900,\n            })\n            .map((searchResult) => searchResult.obj)\n        : panels;\n    },\n    [searchQuery],\n  );\n\n  const { filteredRegularPanels, filteredPreconfiguredPanels } = useMemo(\n    () => ({\n      filteredRegularPanels: getFilteredPanels(allRegularPanels),\n      filteredPreconfiguredPanels: getFilteredPanels(allPreconfiguredPanels),\n    }),\n    [getFilteredPanels, allRegularPanels, allPreconfiguredPanels],\n  );\n\n  const allFilteredPanels = useMemo(\n    () => [...filteredPreconfiguredPanels, ...filteredRegularPanels],\n    [filteredPreconfiguredPanels, filteredRegularPanels],\n  );\n\n  const highlightedPanel = useMemo(() => {\n    return highlightedPanelIdx != undefined ? allFilteredPanels[highlightedPanelIdx] : undefined;\n  }, [allFilteredPanels, highlightedPanelIdx]);\n\n  const noResults = allFilteredPanels.length === 0;\n\n  const onKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      // Prevent key down events from triggering the parent menu, if any.\n      if (e.key !== \"Escape\") {\n        e.stopPropagation();\n      }\n\n      if (mode === \"grid\") {\n        return;\n      }\n      if (e.key === \"ArrowDown\") {\n        setHighlightedPanelIdx((existing) => {\n          if (existing == undefined) {\n            return 0;\n          }\n          return (existing + 1) % allFilteredPanels.length;\n        });\n      } else if (e.key === \"ArrowUp\") {\n        setHighlightedPanelIdx((existing) => {\n          // nothing to highlight if there are no entries\n          if (allFilteredPanels.length <= 0) {\n            return undefined;\n          }\n\n          if (existing == undefined) {\n            return allFilteredPanels.length - 1;\n          }\n          return (existing - 1 + allFilteredPanels.length) % allFilteredPanels.length;\n        });\n      } else if (e.key === \"Enter\" && highlightedPanel) {\n        onPanelSelect({\n          type: highlightedPanel.type,\n          config: highlightedPanel.config,\n          relatedConfigs: highlightedPanel.relatedConfigs,\n        });\n      }\n    },\n    [allFilteredPanels.length, highlightedPanel, mode, onPanelSelect],\n  );\n\n  const displayPanelListItem = useCallback(\n    (panelInfo: PanelInfo) => {\n      const { title, type, config, relatedConfigs } = panelInfo;\n      return (\n        <DraggablePanelItem\n          mode={mode}\n          key={`${type}-${title}`}\n          mosaicId={mosaicId}\n          panel={panelInfo}\n          onDragStart={onDragStart}\n          onDrop={onPanelMenuItemDrop}\n          onClick={() => {\n            onPanelSelect({ type, config, relatedConfigs });\n            blurActiveElement();\n          }}\n          checked={type === selectedPanelType}\n          highlighted={highlightedPanel?.title === title}\n          searchQuery={searchQuery}\n        />\n      );\n    },\n    [\n      highlightedPanel?.title,\n      mode,\n      mosaicId,\n      onDragStart,\n      onPanelMenuItemDrop,\n      onPanelSelect,\n      searchQuery,\n      selectedPanelType,\n    ],\n  );\n\n  return (\n    <div className={classes.fullHeight} ref={ref}>\n      <div\n        className={cx(classes.toolbar, {\n          [classes.toolbarGrid]: mode === \"grid\",\n        })}\n      >\n        <TextField\n          fullWidth\n          placeholder={t(\"searchPanels\")}\n          value={searchQuery}\n          onChange={handleSearchChange}\n          onKeyDown={onKeyDown}\n          onBlur={() => setHighlightedPanelIdx(undefined)}\n          autoFocus\n          InputProps={{\n            startAdornment: <SearchIcon fontSize=\"small\" color=\"primary\" />,\n            endAdornment: searchQuery && (\n              <IconButton size=\"small\" edge=\"end\" onClick={() => setSearchQuery(\"\")}>\n                <CloseIcon fontSize=\"small\" />\n              </IconButton>\n            ),\n          }}\n        />\n      </div>\n      {mode === \"grid\" ? (\n        <Container className={classes.grid} maxWidth={false}>\n          {allFilteredPanels.map(displayPanelListItem)}\n        </Container>\n      ) : (\n        <List dense disablePadding>\n          {allFilteredPanels.map(displayPanelListItem)}\n        </List>\n      )}\n      {noResults && (\n        <Stack alignItems=\"center\" justifyContent=\"center\" paddingX={1} paddingY={2}>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            {t(\"noPanelsMatchSearchCriteria\")}\n          </Typography>\n        </Stack>\n      )}\n    </div>\n  );\n});\nPanelList.displayName = \"Panel List\";\n\nexport default PanelList;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { alpha } from \"@mui/material\";\nimport { forwardRef, HTMLAttributes, PropsWithChildren } from \"react\";\nimport { TransitionStatus } from \"react-transition-group\";\nimport { makeStyles } from \"tss-react/mui\";\n\nexport const PANEL_ROOT_CLASS_NAME = \"FoxglovePanelRoot-root\";\n\ntype PanelRootProps = {\n  fullscreenState: TransitionStatus;\n  selected: boolean;\n  sourceRect: DOMRectReadOnly | undefined;\n  hasFullscreenDescendant: boolean;\n} & HTMLAttributes<HTMLDivElement>;\n\nexport const usePanelRootStyles = makeStyles<\n  Omit<PanelRootProps, \"fullscreenState\" | \"selected\">\n>()((theme, props) => {\n  const { palette, transitions } = theme;\n  const { sourceRect, hasFullscreenDescendant } = props;\n  const duration = transitions.duration.shorter;\n\n  return {\n    root: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      flex: \"1 1 auto\",\n      overflow: \"hidden\",\n      backgroundColor: palette.background.default,\n      border: `0px solid ${alpha(palette.primary.main, 0.67)}`,\n      transition: transitions.create(\"border-width\", {\n        duration, // match to timeout duration inside Panel component\n      }),\n\n      \"::after\": {\n        content: \"''\",\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        inset: 1,\n        opacity: 0,\n        border: `1px solid ${palette.primary.main}`,\n        position: \"absolute\",\n        pointerEvents: \"none\",\n        transition: \"opacity 0.05s ease-out\",\n        zIndex: 10000 + 1,\n      },\n    },\n    rootSelected: {\n      \"::after\": {\n        opacity: 1,\n        transition: \"opacity 0.125s ease-out\",\n      },\n    },\n    entering: {\n      position: \"fixed\",\n      top: sourceRect?.top ?? 0,\n      left: sourceRect?.left ?? 0,\n      right: sourceRect ? window.innerWidth - sourceRect.right : 0,\n      bottom: sourceRect ? window.innerHeight - sourceRect.bottom : 0,\n      zIndex: 10000,\n    },\n    entered: {\n      borderWidth: 4,\n      position: \"fixed\",\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 77, // match PlaybackBar height\n      zIndex: 10000,\n      transition: transitions.create([\"border-width\", \"top\", \"right\", \"bottom\", \"left\"], {\n        duration, // match to timeout duration inside Panel component\n      }),\n    },\n    exiting: {\n      position: \"fixed\",\n      top: sourceRect?.top ?? 0,\n      left: sourceRect?.left ?? 0,\n      right: sourceRect ? window.innerWidth - sourceRect.right : 0,\n      bottom: sourceRect ? window.innerHeight - sourceRect.bottom : 0,\n      zIndex: 10000,\n      transition: transitions.create([\"border-width\", \"top\", \"right\", \"bottom\", \"left\"], {\n        duration, // match to timeout duration inside Panel component\n      }),\n    },\n    exited: {\n      position: \"relative\",\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      // \"z-index: 1\" makes panel drag & drop work more reliably (see\n      // https://github.com/foxglove/studio/pull/3355), but it also makes fullscreen panels get\n      // overlapped by other parts of the panel layout. So we turn it back to auto when a\n      // descendant is fullscreen.\n      zIndex: hasFullscreenDescendant ? \"auto\" : 1,\n    },\n  };\n});\n\nexport const PanelRoot = forwardRef<HTMLDivElement, PropsWithChildren<PanelRootProps>>(\n  function PanelRoot(props, ref): JSX.Element {\n    const { fullscreenState, selected, sourceRect, hasFullscreenDescendant, className, ...rest } =\n      props;\n    const { classes, cx } = usePanelRootStyles({ sourceRect, hasFullscreenDescendant });\n\n    const classNames = cx(PANEL_ROOT_CLASS_NAME, className, classes.root, {\n      [classes.entering]: fullscreenState === \"entering\",\n      [classes.entered]: fullscreenState === \"entered\",\n      [classes.exiting]: fullscreenState === \"exiting\",\n      [classes.exited]: fullscreenState === \"exited\",\n      [classes.rootSelected]: selected,\n    });\n\n    return (\n      <div ref={ref} className={classNames} {...rest}>\n        {props.children}\n      </div>\n    );\n  },\n);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IconButton, IconButtonProps, styled as muiStyled } from \"@mui/material\";\nimport { ForwardedRef, forwardRef } from \"react\";\n\nconst StyledIconButton = muiStyled(IconButton, {\n  shouldForwardProp: (prop) => prop !== \"subMenuActive\",\n})<{ subMenuActive: boolean }>(({ subMenuActive, theme }) => ({\n  padding: theme.spacing(0.375),\n  fontSize: \"0.875rem\",\n\n  ...(subMenuActive && {\n    visibility: \"visible\",\n  }),\n  \".MuiSvgIcon-root, svg:not(.MuiSvgIcon-root)\": {\n    height: \"1em\",\n    width: \"1em\",\n    fontSize: \"inherit\",\n  },\n}));\n\nexport default forwardRef(function ToolbarIconButton(\n  props: {\n    subMenuActive?: boolean;\n    title?: string;\n  } & Partial<IconButtonProps>,\n  ref: ForwardedRef<HTMLButtonElement>,\n): React.ReactElement {\n  return (\n    <StyledIconButton\n      ref={ref}\n      subMenuActive={props.subMenuActive === true}\n      aria-label={props.title}\n      {...props}\n    />\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ClickAwayListener, Grow, Paper, Popper } from \"@mui/material\";\nimport { useCallback, useContext } from \"react\";\nimport { MosaicContext, MosaicNode, MosaicWindowContext } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport PanelList, { PanelSelection } from \"@foxglove/studio-base/components/PanelList\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\nconst useStyles = makeStyles()((theme) => ({\n  paper: {\n    maxHeight: `calc(100vh - ${theme.spacing(12)})`,\n    overflow: \"auto\",\n\n    // Add iOS momentum scrolling for iOS < 13.0\n    WebkitOverflowScrolling: \"touch\",\n  },\n}));\n\nexport default function ChangePanelMenu({\n  tabId,\n  anchorEl,\n  onClose,\n}: {\n  tabId?: string;\n  anchorEl?: HTMLElement;\n  onClose: () => void;\n}): JSX.Element {\n  const { classes } = useStyles();\n  const panelContext = useContext(PanelContext);\n  const { mosaicActions } = useContext(MosaicContext);\n  const { mosaicWindowActions } = useContext(MosaicWindowContext);\n  const { swapPanel } = useCurrentLayoutActions();\n  const open = Boolean(anchorEl);\n\n  const handleSwap = useCallback(\n    (id?: string) =>\n      ({ type, config, relatedConfigs }: PanelSelection) => {\n        // Reselecting current panel type is a no-op.\n        if (type === panelContext?.type) {\n          onClose();\n          return;\n        }\n\n        swapPanel({\n          tabId,\n          originalId: id ?? \"\",\n          type,\n          root: mosaicActions.getRoot() as MosaicNode<string>,\n          path: mosaicWindowActions.getPath(),\n          config: config ?? {},\n          relatedConfigs,\n        });\n      },\n    [onClose, mosaicActions, mosaicWindowActions, panelContext?.type, swapPanel, tabId],\n  );\n\n  // https://github.com/mui/material-ui/issues/35287#issuecomment-1332327752\n  const fixMui35287 = {} as { onResize: undefined; onResizeCapture: undefined };\n\n  return (\n    <Popper\n      {...fixMui35287}\n      id=\"change-panel-menu\"\n      open={open}\n      role={undefined}\n      anchorEl={anchorEl}\n      transition\n      placement=\"right-start\"\n      style={{ zIndex: 10000 }}\n      popperOptions={{\n        modifiers: [\n          {\n            name: \"flip\",\n            options: { fallbackPlacements: [\"right-start\", \"left-start\"] },\n          },\n        ],\n      }}\n    >\n      {({ TransitionProps, placement }) => (\n        <Grow\n          {...TransitionProps}\n          style={{\n            transformOrigin: placement === \"right-start\" ? \"top left\" : \"top right\",\n          }}\n        >\n          <Paper elevation={8} className={classes.paper}>\n            <ClickAwayListener onClickAway={onClose}>\n              <PanelList\n                selectedPanelType={panelContext?.type}\n                onPanelSelect={handleSwap(panelContext?.id)}\n              />\n            </ClickAwayListener>\n          </Paper>\n        </Grow>\n      )}\n    </Popper>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { getNodeAtPath, MosaicRootActions, MosaicWindowActions } from \"react-mosaic-component\";\nimport { MosaicKey } from \"react-mosaic-component/lib/types\";\n\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nexport function getPanelTypeFromMosaic(\n  mosaicWindowActions?: MosaicWindowActions,\n  mosaicActions?: MosaicRootActions<MosaicKey>,\n): string | undefined {\n  if (!mosaicWindowActions || !mosaicActions) {\n    return undefined;\n  }\n  const node = getNodeAtPath(mosaicActions.getRoot(), mosaicWindowActions.getPath());\n  if (typeof node !== \"string\") {\n    throw new Error(`Used getPanelTypeFromMosaic on non-leaf node: ${JSON.stringify(node)}`);\n  }\n  const type = getPanelTypeFromId(node);\n\n  return type;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport {\n  Delete20Regular,\n  FullScreenMaximize20Regular,\n  ShapeSubtract20Regular,\n  SplitHorizontal20Regular,\n  SplitVertical20Regular,\n} from \"@fluentui/react-icons\";\nimport ChevronRightIcon from \"@mui/icons-material/ChevronRight\";\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport { Divider, Menu, MenuItem } from \"@mui/material\";\nimport { MouseEvent, useCallback, useContext, useMemo, useRef, useState } from \"react\";\nimport { MosaicContext, MosaicNode, MosaicWindowContext } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport ChangePanelMenu from \"@foxglove/studio-base/components/PanelToolbar/ChangePanelMenu\";\nimport ToolbarIconButton from \"@foxglove/studio-base/components/PanelToolbar/ToolbarIconButton\";\nimport { getPanelTypeFromMosaic } from \"@foxglove/studio-base/components/PanelToolbar/utils\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\ntype Props = {\n  isUnknownPanel: boolean;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  error: { color: theme.palette.error.main },\n  icon: {\n    marginRight: theme.spacing(-1),\n  },\n  menuItem: {\n    display: \"flex\",\n    gap: theme.spacing(1),\n    alignItems: \"center\",\n\n    \".root-span\": {\n      display: \"flex\",\n      marginLeft: theme.spacing(-0.25),\n    },\n    \"&.Mui-selected\": {\n      backgroundColor: theme.palette.action.hover,\n\n      \"&:hover\": {\n        backgroundColor: theme.palette.action.hover,\n      },\n    },\n  },\n}));\n\nexport function PanelActionsDropdown({ isUnknownPanel }: Props): JSX.Element {\n  const { classes, cx } = useStyles();\n  const [menuAnchorEl, setMenuAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const [subMenuAnchorEl, setSubmenuAnchorEl] = useState<undefined | HTMLElement>(undefined);\n\n  const menuOpen = Boolean(menuAnchorEl);\n  const submenuOpen = Boolean(subMenuAnchorEl);\n\n  const panelContext = useContext(PanelContext);\n  const tabId = panelContext?.tabId;\n  const { mosaicActions } = useContext(MosaicContext);\n  const { mosaicWindowActions } = useContext(MosaicWindowContext);\n  const {\n    getCurrentLayoutState: getCurrentLayout,\n    closePanel,\n    splitPanel,\n  } = useCurrentLayoutActions();\n  const getPanelType = useCallback(\n    () => getPanelTypeFromMosaic(mosaicWindowActions, mosaicActions),\n    [mosaicActions, mosaicWindowActions],\n  );\n\n  const handleMenuClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setSubmenuAnchorEl(undefined);\n    setMenuAnchorEl(event.currentTarget);\n  };\n\n  const handleMenuClose = () => {\n    setSubmenuAnchorEl(undefined);\n    setMenuAnchorEl(undefined);\n  };\n\n  const handleSubmenuClick = (event: MouseEvent<HTMLElement>) => {\n    if (subMenuAnchorEl !== event.currentTarget) {\n      setSubmenuAnchorEl(event.currentTarget);\n    }\n    setMenuAnchorEl(undefined);\n  };\n\n  const handleSubmenuClose = useCallback(() => {\n    setSubmenuAnchorEl(undefined);\n  }, []);\n\n  const handleSubmenuMouseEnter = (event: MouseEvent<HTMLElement>) => {\n    setSubmenuAnchorEl(event.currentTarget);\n  };\n\n  const close = useCallback(() => {\n    closePanel({\n      tabId,\n      root: mosaicActions.getRoot() as MosaicNode<string>,\n      path: mosaicWindowActions.getPath(),\n    });\n    handleMenuClose();\n  }, [closePanel, mosaicActions, mosaicWindowActions, tabId]);\n\n  const split = useCallback(\n    (id: string | undefined, direction: \"row\" | \"column\") => {\n      const type = getPanelType();\n      if (id == undefined || type == undefined) {\n        throw new Error(\"Trying to split unknown panel!\");\n      }\n\n      const config = getCurrentLayout().selectedLayout?.data?.configById[id] ?? {};\n      splitPanel({\n        id,\n        tabId,\n        direction,\n        root: mosaicActions.getRoot() as MosaicNode<string>,\n        path: mosaicWindowActions.getPath(),\n        config,\n      });\n      handleMenuClose();\n    },\n    [getCurrentLayout, getPanelType, mosaicActions, mosaicWindowActions, splitPanel, tabId],\n  );\n\n  const enterFullscreen = useCallback(() => {\n    panelContext?.enterFullscreen();\n    handleMenuClose();\n  }, [panelContext]);\n\n  const menuItems = useMemo(() => {\n    const items = [];\n\n    if (!isUnknownPanel) {\n      items.push(\n        {\n          key: \"hsplit\",\n          text: \"Split horizontal\",\n          icon: <SplitHorizontal20Regular />,\n          onClick: () => split(panelContext?.id, \"column\"),\n        },\n        {\n          key: \"vsplit\",\n          text: \"Split vertical\",\n          icon: <SplitVertical20Regular />,\n          onClick: () => split(panelContext?.id, \"row\"),\n        },\n      );\n    }\n\n    if (panelContext?.isFullscreen !== true) {\n      items.push({\n        key: \"enter-fullscreen\",\n        text: \"Fullscreen\",\n        icon: <FullScreenMaximize20Regular />,\n        onClick: enterFullscreen,\n        \"data-testid\": \"panel-menu-fullscreen\",\n      });\n    }\n\n    items.push({ key: \"divider\", type: \"divider\" });\n\n    items.push({\n      key: \"remove\",\n      text: \"Remove panel\",\n      icon: <Delete20Regular />,\n      onClick: close,\n      \"data-testid\": \"panel-menu-remove\",\n      className: classes.error,\n    });\n\n    return items;\n  }, [\n    classes.error,\n    close,\n    enterFullscreen,\n    isUnknownPanel,\n    panelContext?.id,\n    panelContext?.isFullscreen,\n    split,\n  ]);\n\n  const buttonRef = useRef<HTMLDivElement>(ReactNull);\n  const type = getPanelType();\n\n  if (type == undefined) {\n    return <></>;\n  }\n\n  return (\n    <div ref={buttonRef}>\n      <ToolbarIconButton\n        id=\"panel-menu-button\"\n        aria-controls={menuOpen ? \"panel-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={menuOpen ? \"true\" : undefined}\n        onClick={handleMenuClick}\n        data-testid=\"panel-menu\"\n        title=\"More\"\n      >\n        <MoreVertIcon />\n      </ToolbarIconButton>\n      <Menu\n        id=\"panel-menu\"\n        anchorEl={menuAnchorEl}\n        open={menuOpen}\n        onClose={handleMenuClose}\n        anchorOrigin={{ vertical: \"bottom\", horizontal: \"left\" }}\n        MenuListProps={{\n          \"aria-labelledby\": \"panel-menu-button\",\n          dense: true,\n        }}\n      >\n        <MenuItem\n          className={classes.menuItem}\n          selected={submenuOpen}\n          id=\"change-panel-button\"\n          aria-controls={submenuOpen ? \"change-panel-menu\" : undefined}\n          aria-haspopup=\"true\"\n          aria-expanded={submenuOpen ? \"true\" : undefined}\n          onClick={handleSubmenuClick}\n          onMouseEnter={handleSubmenuMouseEnter}\n        >\n          <ShapeSubtract20Regular />\n          Change panel\n          <ChevronRightIcon className={classes.icon} fontSize=\"small\" />\n        </MenuItem>\n        <ChangePanelMenu anchorEl={subMenuAnchorEl} onClose={handleSubmenuClose} tabId={tabId} />\n        <Divider variant=\"middle\" />\n        {menuItems.map((item, idx) =>\n          item.type === \"divider\" ? (\n            <Divider key={`divider-${idx}`} variant=\"middle\" />\n          ) : (\n            <MenuItem\n              key={item.key}\n              onClick={(event) => {\n                event.stopPropagation();\n                item.onClick?.();\n              }}\n              onMouseEnter={() => setSubmenuAnchorEl(undefined)}\n              className={cx(classes.menuItem, item.className)}\n              data-testid={item[\"data-testid\"]}\n            >\n              {item.icon}\n              {item.text}\n            </MenuItem>\n          ),\n        )}\n      </Menu>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport SettingsIcon from \"@mui/icons-material/Settings\";\nimport { IconButton, Tooltip } from \"@mui/material\";\nimport produce from \"immer\";\nimport { forwardRef, useCallback, useContext, useEffect, useMemo } from \"react\";\nimport { useAsyncFn } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport ToolbarIconButton from \"@foxglove/studio-base/components/PanelToolbar/ToolbarIconButton\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useSelectedPanels } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport PanelCatalogContext from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport {\n  PanelStateStore,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { UserProfileStorageContext } from \"@foxglove/studio-base/context/UserProfileStorageContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/WorkspaceContext\";\n\nimport { PanelActionsDropdown } from \"./PanelActionsDropdown\";\n\ntype PanelToolbarControlsProps = {\n  additionalIcons?: React.ReactNode;\n  isUnknownPanel: boolean;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  popper: {\n    zIndex: theme.zIndex.modal - 1,\n    // Hide the tooltip when behind a modal dialog\n    \"body:has(> .MuiModal-root) &\": {\n      visibility: \"hidden\",\n    },\n    \".MuiModal-root ~ &\": {\n      visibility: \"hidden\",\n    },\n  },\n  tooltip: {\n    padding: theme.spacing(1, 1.5),\n    boxShadow: theme.shadows[8],\n    fontSize: theme.typography.body2.fontSize,\n    lineHeight: theme.typography.body2.lineHeight,\n    marginTop: `${theme.spacing(1)} !important`,\n  },\n}));\n\nconst PanelToolbarControlsComponent = forwardRef<HTMLDivElement, PanelToolbarControlsProps>(\n  (props, ref) => {\n    const { additionalIcons, isUnknownPanel } = props;\n    const { id: panelId, type: panelType } = useContext(PanelContext) ?? {};\n    const panelCatalog = useContext(PanelCatalogContext);\n    const { setSelectedPanelIds } = useSelectedPanels();\n    const { openPanelSettings } = useWorkspaceActions();\n    const { classes } = useStyles();\n\n    const hasSettingsSelector = useCallback(\n      (store: PanelStateStore) => (panelId ? store.settingsTrees[panelId] != undefined : false),\n      [panelId],\n    );\n\n    const panelInfo = useMemo(\n      () => (panelType != undefined ? panelCatalog?.getPanelByType(panelType) : undefined),\n      [panelCatalog, panelType],\n    );\n\n    const hasSettings = usePanelStateStore(hasSettingsSelector);\n\n    const userProfileStorage = useContext(UserProfileStorageContext);\n    const [{ value: settingsOnboardingTooltip }, loadOnboardingState] =\n      useAsyncFn(async (): Promise<string | undefined> => {\n        if (panelType == undefined || userProfileStorage == undefined || !hasSettings) {\n          return undefined;\n        }\n        const tooltip = panelCatalog?.getPanelByType(panelType)?.settingsOnboardingTooltip;\n        if (tooltip == undefined) {\n          return undefined;\n        }\n        const { onboarding } = await userProfileStorage.getUserProfile();\n        const { settingsTooltipShownForPanelTypes = [] } = onboarding ?? {};\n        if (settingsTooltipShownForPanelTypes.includes(panelType)) {\n          return undefined;\n        }\n        return tooltip;\n      }, [hasSettings, panelCatalog, panelType, userProfileStorage]);\n\n    useEffect(() => {\n      void loadOnboardingState();\n    }, [loadOnboardingState]);\n\n    const onDismissTooltip = useCallback(async () => {\n      if (panelType && userProfileStorage) {\n        await userProfileStorage.setUserProfile((profile) =>\n          produce(profile, (draft) => {\n            draft.onboarding ??= { settingsTooltipShownForPanelTypes: [] };\n            if (draft.onboarding.settingsTooltipShownForPanelTypes?.includes(panelType) !== true) {\n              draft.onboarding.settingsTooltipShownForPanelTypes?.push(panelType);\n            }\n          }),\n        );\n        await loadOnboardingState();\n      }\n    }, [loadOnboardingState, panelType, userProfileStorage]);\n\n    const openSettings = useCallback(async () => {\n      if (panelId) {\n        setSelectedPanelIds([panelId]);\n        openPanelSettings();\n      }\n      await onDismissTooltip();\n    }, [panelId, onDismissTooltip, setSelectedPanelIds, openPanelSettings]);\n\n    let settingsButton = (\n      <ToolbarIconButton\n        title={settingsOnboardingTooltip ? undefined : \"Settings\"}\n        onClick={openSettings}\n      >\n        <SettingsIcon />\n      </ToolbarIconButton>\n    );\n\n    // Show the settings button so that panel title is editable, unless we have a custom\n    // toolbar in which case the title wouldn't be visible.\n    const showSettingsButton = panelInfo?.hasCustomToolbar !== true || hasSettings;\n\n    if (settingsOnboardingTooltip) {\n      settingsButton = (\n        <Tooltip\n          open\n          classes={{ popper: classes.popper, tooltip: classes.tooltip }}\n          title={\n            <Stack direction=\"row\" alignItems=\"center\" style={{ maxWidth: 190 }}>\n              <span>{settingsOnboardingTooltip}</span>\n              <IconButton\n                aria-label=\"Dismiss\"\n                role=\"button\"\n                size=\"small\"\n                color=\"inherit\"\n                onClick={(event) => {\n                  event.stopPropagation();\n                  void onDismissTooltip();\n                }}\n              >\n                <CloseIcon fontSize=\"small\" />\n              </IconButton>\n            </Stack>\n          }\n          arrow\n          TransitionProps={{ in: true }}\n          PopperProps={{\n            modifiers: [\n              {\n                name: \"preventOverflow\",\n                options: { altAxis: true, padding: 4 },\n              },\n            ],\n          }}\n        >\n          {settingsButton}\n        </Tooltip>\n      );\n    }\n\n    return (\n      <Stack direction=\"row\" alignItems=\"center\" paddingLeft={1} ref={ref}>\n        {additionalIcons}\n        {showSettingsButton && settingsButton}\n        <PanelActionsDropdown isUnknownPanel={isUnknownPanel} />\n      </Stack>\n    );\n  },\n);\n\nPanelToolbarControlsComponent.displayName = \"PanelToolbarControls\";\n\n// Keep controls, which don't change often, in a pure component in order to avoid re-rendering the\n// whole PanelToolbar when only children change.\nexport const PanelToolbarControls = React.memo(PanelToolbarControlsComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport FullscreenExitIcon from \"@mui/icons-material/FullscreenExit\";\nimport { Typography } from \"@mui/material\";\nimport { useContext, useMemo, CSSProperties } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport ToolbarIconButton from \"@foxglove/studio-base/components/PanelToolbar/ToolbarIconButton\";\nimport { useDefaultPanelTitle } from \"@foxglove/studio-base/providers/PanelStateContextProvider\";\nimport { PANEL_TITLE_CONFIG_KEY } from \"@foxglove/studio-base/util/layout\";\n\nimport { PanelToolbarControls } from \"./PanelToolbarControls\";\n\nexport const PANEL_TOOLBAR_MIN_HEIGHT = 30;\n\ntype Props = {\n  additionalIcons?: React.ReactNode;\n  backgroundColor?: CSSProperties[\"backgroundColor\"];\n  children?: React.ReactNode;\n  className?: string;\n  isUnknownPanel?: boolean;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    transition: \"transform 80ms ease-in-out, opacity 80ms ease-in-out\",\n    cursor: \"auto\",\n    flex: \"0 0 auto\",\n    alignItems: \"center\",\n    justifyContent: \"flex-end\",\n    padding: theme.spacing(0.25, 0.75),\n    display: \"flex\",\n    minHeight: PANEL_TOOLBAR_MIN_HEIGHT,\n    backgroundColor: theme.palette.background.paper,\n    width: \"100%\",\n    left: 0,\n    zIndex: theme.zIndex.appBar,\n  },\n}));\n\n// Panel toolbar should be added to any panel that's part of the\n// react-mosaic layout.  It adds a drag handle, remove/replace controls\n// and has a place to add custom controls via it's children property\nexport default React.memo<Props>(function PanelToolbar({\n  additionalIcons,\n  backgroundColor,\n  children,\n  className,\n  isUnknownPanel = false,\n}: Props) {\n  const { classes, cx } = useStyles();\n  const {\n    isFullscreen,\n    exitFullscreen,\n    config: { [PANEL_TITLE_CONFIG_KEY]: customTitle = undefined } = {},\n  } = useContext(PanelContext) ?? {};\n\n  const panelContext = useContext(PanelContext);\n\n  // Help-shown state must be hoisted outside the controls container so the modal can remain visible\n  // when the panel is no longer hovered.\n  const additionalIconsWithHelp = useMemo(() => {\n    return (\n      <>\n        {additionalIcons}\n        {isFullscreen === true && (\n          <ToolbarIconButton\n            value=\"exit-fullscreen\"\n            title=\"Exit fullscreen\"\n            onClick={exitFullscreen}\n          >\n            <FullscreenExitIcon />\n          </ToolbarIconButton>\n        )}\n      </>\n    );\n  }, [additionalIcons, isFullscreen, exitFullscreen]);\n\n  // If we have children then we limit the drag area to the controls. Otherwise the entire\n  // toolbar is draggable.\n  const rootDragRef =\n    isUnknownPanel || children != undefined ? undefined : panelContext?.connectToolbarDragHandle;\n\n  const controlsDragRef =\n    isUnknownPanel || children == undefined ? undefined : panelContext?.connectToolbarDragHandle;\n\n  const [defaultPanelTitle] = useDefaultPanelTitle();\n  const customPanelTitle =\n    customTitle != undefined && typeof customTitle === \"string\" && customTitle.length > 0\n      ? customTitle\n      : defaultPanelTitle;\n\n  const title = customPanelTitle ?? panelContext?.title;\n  return (\n    <header\n      className={cx(classes.root, className)}\n      data-testid=\"mosaic-drag-handle\"\n      ref={rootDragRef}\n      style={{ backgroundColor, cursor: rootDragRef != undefined ? \"grab\" : \"auto\" }}\n    >\n      {children ??\n        (title && (\n          <Typography noWrap variant=\"body2\" color=\"text.secondary\" flex=\"auto\">\n            {title}\n          </Typography>\n        ))}\n      <PanelToolbarControls\n        additionalIcons={additionalIconsWithHelp}\n        isUnknownPanel={!!isUnknownPanel}\n        ref={controlsDragRef}\n      />\n    </header>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { RpcScales } from \"@foxglove/studio-base/components/Chart/types\";\nimport { useHoverValue } from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\n\nimport { VerticalBarWrapper } from \"./VerticalBarWrapper\";\n\ntype Props = {\n  scales?: RpcScales;\n  componentId: string;\n  isTimestampScale: boolean;\n};\n\nexport default React.memo<React.PropsWithChildren<Props>>(function HoverBar({\n  children,\n  componentId,\n  isTimestampScale,\n  scales,\n}) {\n  const hoverValue = useHoverValue({ componentId, isTimestampScale });\n\n  return (\n    <VerticalBarWrapper scales={scales} xValue={hoverValue?.value}>\n      {children}\n    </VerticalBarWrapper>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { CSSProperties, useMemo } from \"react\";\nimport { withStyles } from \"tss-react/mui\";\n\nimport { RpcScales } from \"@foxglove/studio-base/components/Chart/types\";\n\nexport const Wrapper = withStyles(\"div\", () => ({\n  root: {\n    top: 0,\n    bottom: 0,\n    position: \"absolute\",\n    pointerEvents: \"none\",\n    willChange: \"transform\",\n    visibility: \"hidden\",\n  },\n}));\n\ntype VerticalBarWrapperProps = {\n  scales?: RpcScales;\n  xValue?: number;\n};\n\nexport function VerticalBarWrapper({\n  children,\n  scales,\n  xValue,\n}: React.PropsWithChildren<VerticalBarWrapperProps>): JSX.Element {\n  const positionX = useMemo(() => {\n    const xScale = scales?.x;\n    if (!xScale || xValue == undefined) {\n      return;\n    }\n\n    const pixels = xScale.pixelMax - xScale.pixelMin;\n    const range = xScale.max - xScale.min;\n\n    if (pixels === 0 || range === 0) {\n      return;\n    }\n\n    const pos = (xValue - xScale.min) / (range / pixels) + xScale.pixelMin;\n    // don't show hoverbar if it falls outsize our boundary\n    if (pos < xScale.pixelMin || pos > xScale.pixelMax) {\n      return;\n    }\n    return pos;\n  }, [scales?.x, xValue]);\n\n  const style = useMemo((): CSSProperties => {\n    if (positionX == undefined || isNaN(positionX)) {\n      return { visibility: \"hidden\", transform: undefined };\n    }\n    return { visibility: \"visible\", transform: `translateX(${positionX}px)` };\n  }, [positionX]);\n\n  return <Wrapper style={style}>{children}</Wrapper>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\n// individual app configuration values are basic primitive types\nexport type AppConfigurationValue = string | number | boolean | undefined;\n\nexport type ChangeHandler = (newValue: AppConfigurationValue) => void;\n\n// Exposes an interface for reading and writing user-configurable options and other persistent application state.\nexport interface IAppConfiguration {\n  // get the current value for the key\n  get(key: string): AppConfigurationValue;\n  // set key to value - This returns a promise to track the progress for setting the value\n  set(key: string, value: AppConfigurationValue): Promise<void>;\n  // register a change handler for a particular key\n  addChangeListener(key: string, cb: ChangeHandler): void;\n  // remove a change handler on a given key\n  removeChangeListener(key: string, cb: ChangeHandler): void;\n}\n\nconst AppConfigurationContext = createContext<IAppConfiguration | undefined>(undefined);\nAppConfigurationContext.displayName = \"AppConfigurationContext\";\n\nexport function useAppConfiguration(): IAppConfiguration {\n  const storage = useContext(AppConfigurationContext);\n  if (!storage) {\n    throw new Error(\"An AppConfigurationContext provider is required to useAppConfiguration\");\n  }\n  return storage;\n}\n\nexport default AppConfigurationContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport Log from \"@foxglove/log\";\n\nconst log = Log.getLogger(__filename);\n\nexport function selectWithUnstableIdentityWarning<T, U>(value: T, selector: (value: T) => U): U {\n  const result = selector(value);\n  if (process.env.NODE_ENV === \"development\") {\n    const secondResult = selector(value);\n    if (result !== secondResult) {\n      log.warn(`Selector ${selector.toString()} produced different values for the same input.\n  This will cause unecesessery re-renders of your component.`);\n    }\n    return secondResult;\n  }\n  return result;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { without, xor } from \"lodash\";\n\nimport { TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport { SavedProps } from \"@foxglove/studio-base/types/panels\";\nimport {\n  getAllPanelIds,\n  getParentTabPanelByPanelId,\n  isTabPanel,\n} from \"@foxglove/studio-base/util/layout\";\n\nexport default function toggleSelectedPanel(\n  panelId: string,\n  containingTabId: string | undefined,\n  configById: SavedProps,\n  selectedPanelIds: readonly string[],\n): string[] {\n  const panelIdsToDeselect = [];\n\n  // If we selected a Tab panel, deselect its children\n  const savedConfig = configById[panelId];\n  if (isTabPanel(panelId) && savedConfig) {\n    const { activeTabIdx, tabs } = savedConfig as TabPanelConfig;\n    const activeTabLayout = tabs[activeTabIdx]?.layout;\n    if (activeTabLayout != undefined) {\n      const childrenPanelIds = getAllPanelIds(activeTabLayout, configById);\n      panelIdsToDeselect.push(...childrenPanelIds);\n    }\n  }\n\n  // If we selected a child, deselect all parent Tab panels\n  const parentTabPanelByPanelId = getParentTabPanelByPanelId(configById);\n  let nextParentId = containingTabId;\n  const parentTabPanelIds = [];\n  while (nextParentId != undefined) {\n    parentTabPanelIds.push(nextParentId);\n    nextParentId = parentTabPanelByPanelId[nextParentId];\n  }\n  panelIdsToDeselect.push(...parentTabPanelIds);\n\n  const nextSelectedPanelIds = xor(selectedPanelIds, [panelId]);\n  const nextValidSelectedPanelIds = without(nextSelectedPanelIds, ...panelIdsToDeselect);\n  return nextValidSelectedPanelIds;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useCallback, useLayoutEffect, useReducer, useRef, useState } from \"react\";\nimport { getLeaves } from \"react-mosaic-component\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { VariableValue } from \"@foxglove/studio\";\nimport { selectWithUnstableIdentityWarning } from \"@foxglove/studio-base/hooks/selectWithUnstableIdentityWarning\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\nimport useShouldNotChangeOften from \"@foxglove/studio-base/hooks/useShouldNotChangeOften\";\nimport toggleSelectedPanel from \"@foxglove/studio-base/providers/CurrentLayoutProvider/toggleSelectedPanel\";\nimport { LayoutID } from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport { PanelConfig, PlaybackConfig, UserNodes } from \"@foxglove/studio-base/types/panels\";\n\nimport {\n  LayoutData,\n  AddPanelPayload,\n  ChangePanelLayoutPayload,\n  ClosePanelPayload,\n  CreateTabPanelPayload,\n  DropPanelPayload,\n  EndDragPayload,\n  MoveTabPayload,\n  SaveConfigsPayload,\n  SplitPanelPayload,\n  StartDragPayload,\n  SwapPanelPayload,\n} from \"./actions\";\n\nexport type LayoutState = Readonly<{\n  selectedLayout:\n    | {\n        id: LayoutID;\n        loading?: boolean;\n        data: LayoutData | undefined;\n        name?: string;\n      }\n    | undefined;\n}>;\n\n/**\n * Encapsulates the mosaic layout, user nodes, and playback settings (everything considered to be\n * part of a saved \"layout\") used by the current workspace.\n */\nexport interface ICurrentLayout {\n  addLayoutStateListener: (listener: (_: LayoutState) => void) => void;\n  removeLayoutStateListener: (listener: (_: LayoutState) => void) => void;\n  addSelectedPanelIdsListener: (listener: (_: readonly string[]) => void) => void;\n  removeSelectedPanelIdsListener: (listener: (_: readonly string[]) => void) => void;\n\n  /**\n   * We use the same mosaicId for all mosaics (at the top level and within tabs) to support\n   * dragging and dropping between them.\n   */\n  mosaicId: string;\n\n  getSelectedPanelIds: () => readonly string[];\n  setSelectedPanelIds: (\n    _: readonly string[] | ((prevState: readonly string[]) => readonly string[]),\n  ) => void;\n\n  actions: {\n    /**\n     * Returns the current state - useful for click handlers and callbacks that read the state\n     * asynchronously and don't want to update every time the state changes.\n     */\n    getCurrentLayoutState: () => LayoutState;\n\n    setSelectedLayoutId: (id: LayoutID | undefined) => void;\n\n    savePanelConfigs: (payload: SaveConfigsPayload) => void;\n    updatePanelConfigs: (panelType: string, updater: (config: PanelConfig) => PanelConfig) => void;\n    createTabPanel: (payload: CreateTabPanelPayload) => void;\n    changePanelLayout: (payload: ChangePanelLayoutPayload) => void;\n    overwriteGlobalVariables: (payload: Record<string, VariableValue>) => void;\n    setGlobalVariables: (payload: Record<string, VariableValue>) => void;\n    setUserNodes: (payload: Partial<UserNodes>) => void;\n    setPlaybackConfig: (payload: Partial<PlaybackConfig>) => void;\n    closePanel: (payload: ClosePanelPayload) => void;\n    splitPanel: (payload: SplitPanelPayload) => void;\n    swapPanel: (payload: SwapPanelPayload) => void;\n    moveTab: (payload: MoveTabPayload) => void;\n    addPanel: (payload: AddPanelPayload) => void;\n    dropPanel: (payload: DropPanelPayload) => void;\n    startDrag: (payload: StartDragPayload) => void;\n    endDrag: (payload: EndDragPayload) => void;\n  };\n}\n\nexport type CurrentLayoutActions = ICurrentLayout[\"actions\"];\n\nexport type SelectedPanelActions = {\n  getSelectedPanelIds: () => readonly string[];\n  selectedPanelIds: readonly string[];\n  setSelectedPanelIds: (\n    _: readonly string[] | ((prevState: readonly string[]) => string[]),\n  ) => void;\n  selectAllPanels: () => void;\n  togglePanelSelected: (panelId: string, containingTabId: string | undefined) => void;\n};\n\nconst log = Logger.getLogger(__filename);\n\nconst CurrentLayoutContext = createContext<ICurrentLayout | undefined>(undefined);\nCurrentLayoutContext.displayName = \"CurrentLayoutContext\";\n\nexport function usePanelMosaicId(): string {\n  return useGuaranteedContext(CurrentLayoutContext).mosaicId;\n}\nexport function useCurrentLayoutActions(): CurrentLayoutActions {\n  return useGuaranteedContext(CurrentLayoutContext).actions;\n}\nexport function useCurrentLayoutSelector<T>(selector: (layoutState: LayoutState) => T): T {\n  const currentLayout = useGuaranteedContext(CurrentLayoutContext);\n  const [_, forceUpdate] = useReducer((x: number) => x + 1, 0);\n\n  // Catch locations using unstable function selectors\n  useShouldNotChangeOften(selector, () =>\n    log.warn(\n      \"useCurrentLayoutSelector is changing frequently. Rewrite your selector as a stable function.\",\n    ),\n  );\n\n  const state = useRef<{ value: T; selector: typeof selector } | undefined>(undefined);\n  if (!state.current || selector !== state.current.selector) {\n    state.current = {\n      value: selectWithUnstableIdentityWarning(\n        currentLayout.actions.getCurrentLayoutState(),\n        selector,\n      ),\n      selector,\n    };\n  }\n  useLayoutEffect(() => {\n    let mounted = true;\n    const listener = (layoutState: LayoutState) => {\n      // Note: Our removeLayoutStateListener is is too late if the layout state listeners are already\n      // being invoked. Our component might become unmounted during the state listener invocation\n      if (!mounted) {\n        return;\n      }\n      const newValue = selectWithUnstableIdentityWarning(layoutState, selector);\n      if (newValue === state.current?.value) {\n        return;\n      }\n      state.current = {\n        value: newValue,\n        selector,\n      };\n      forceUpdate();\n    };\n    // Update if necessary, i.e. if the state has changed between render and this effect\n    listener(currentLayout.actions.getCurrentLayoutState());\n    currentLayout.addLayoutStateListener(listener);\n    return () => {\n      mounted = false;\n      currentLayout.removeLayoutStateListener(listener);\n    };\n  }, [currentLayout, selector]);\n\n  return state.current.value;\n}\nexport function useSelectedPanels(): SelectedPanelActions {\n  const currentLayout = useGuaranteedContext(CurrentLayoutContext);\n  const [selectedPanelIds, setSelectedPanelIdsState] = useState(() =>\n    currentLayout.getSelectedPanelIds(),\n  );\n  useLayoutEffect(() => {\n    const listener = (newIds: readonly string[]) => setSelectedPanelIdsState(newIds);\n    currentLayout.addSelectedPanelIdsListener(listener);\n    return () => currentLayout.removeSelectedPanelIdsListener(listener);\n  }, [currentLayout]);\n\n  const setSelectedPanelIds = useGuaranteedContext(CurrentLayoutContext).setSelectedPanelIds;\n  const getSelectedPanelIds = useGuaranteedContext(CurrentLayoutContext).getSelectedPanelIds;\n  const { getCurrentLayoutState: getCurrentLayout } = useCurrentLayoutActions();\n\n  const selectAllPanels = useCallback(() => {\n    // eslint-disable-next-line no-restricted-syntax\n    const panelIds = getLeaves(getCurrentLayout().selectedLayout?.data?.layout ?? null);\n    setSelectedPanelIds(panelIds);\n  }, [getCurrentLayout, setSelectedPanelIds]);\n\n  const togglePanelSelected = useCallback(\n    (panelId: string, containingTabId: string | undefined) => {\n      setSelectedPanelIds((selectedIds) => {\n        const { selectedLayout } = getCurrentLayout();\n        if (!selectedLayout?.data) {\n          return selectedIds;\n        }\n        return toggleSelectedPanel(\n          panelId,\n          containingTabId,\n          selectedLayout.data.configById,\n          selectedIds,\n        );\n      });\n    },\n    [setSelectedPanelIds, getCurrentLayout],\n  );\n\n  return useShallowMemo({\n    getSelectedPanelIds,\n    selectedPanelIds,\n    setSelectedPanelIds,\n    selectAllPanels,\n    togglePanelSelected,\n  });\n}\n\nexport default CurrentLayoutContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nexport type User = {\n  id: string;\n  avatarImageUrl?: string | null; // eslint-disable-line no-restricted-syntax\n  email: string;\n  orgId: string;\n  orgDisplayName: string | null; // eslint-disable-line no-restricted-syntax\n  orgSlug: string;\n  orgPaid: boolean | null; // eslint-disable-line no-restricted-syntax\n  org: {\n    id: string;\n    slug: string;\n    displayName: string;\n    isEnterprise: boolean;\n    allowsUploads: boolean;\n    supportsEdgeSites: boolean;\n  };\n};\n\nexport interface CurrentUser {\n  currentUser: User | undefined;\n  signIn?: () => void;\n  signOut?: () => Promise<void>;\n}\n\nconst CurrentUserContext = createContext<CurrentUser>({\n  currentUser: undefined,\n});\nCurrentUserContext.displayName = \"CurrentUserContext\";\n\nexport function useCurrentUser(): CurrentUser {\n  return useContext(CurrentUserContext);\n}\n\nexport type UserType =\n  | \"unauthenticated\"\n  | \"authenticated-free\"\n  | \"authenticated-team\"\n  | \"authenticated-enterprise\";\n\nexport function useCurrentUserType(): UserType {\n  const user = useCurrentUser();\n  if (user.currentUser == undefined) {\n    return \"unauthenticated\";\n  }\n\n  if (user.currentUser.org.isEnterprise) {\n    return \"authenticated-enterprise\";\n  }\n\n  if (user.currentUser.orgPaid === true) {\n    return \"authenticated-team\";\n  }\n\n  return \"authenticated-free\";\n}\n\n// ts-prune-ignore-next\nexport default CurrentUserContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { ExtensionPanelRegistration, RegisterMessageConverterArgs } from \"@foxglove/studio\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\nimport { ExtensionInfo, ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nexport type RegisteredPanel = {\n  extensionName: string;\n  extensionNamespace?: ExtensionNamespace;\n  registration: ExtensionPanelRegistration;\n};\n\nexport type ExtensionCatalog = {\n  downloadExtension: (url: string) => Promise<Uint8Array>;\n  installExtension: (\n    namespace: ExtensionNamespace,\n    foxeFileData: Uint8Array,\n  ) => Promise<ExtensionInfo>;\n  refreshExtensions: () => Promise<void>;\n  uninstallExtension: (namespace: ExtensionNamespace, id: string) => Promise<void>;\n\n  installedExtensions: undefined | ExtensionInfo[];\n  installedPanels: undefined | Record<string, RegisteredPanel>;\n  installedMessageConverters: undefined | RegisterMessageConverterArgs<unknown>[];\n};\n\nexport const ExtensionCatalogContext = createContext<undefined | StoreApi<ExtensionCatalog>>(\n  undefined,\n);\n\nexport function useExtensionCatalog<T>(\n  selector: (registry: ExtensionCatalog) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(ExtensionCatalogContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { ILayoutManager } from \"@foxglove/studio-base/services/ILayoutManager\";\n\nconst LayoutManagerContext = createContext<ILayoutManager | undefined>(undefined);\nLayoutManagerContext.displayName = \"LayoutManagerContext\";\n\nexport function useLayoutManager(): ILayoutManager {\n  const ctx = useContext(LayoutManagerContext);\n  if (ctx == undefined) {\n    throw new Error(\"A LayoutManager provider is required to useLayoutManager\");\n  }\n  return ctx;\n}\n\nexport default LayoutManagerContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ComponentType, createContext, useContext } from \"react\";\n\nimport { PanelStatics } from \"@foxglove/studio-base/components/Panel\";\nimport { ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\nimport { PanelConfig } from \"@foxglove/studio-base/types/panels\";\n\nexport type PanelComponent = ComponentType<{ childId?: string; tabId?: string }> &\n  PanelStatics<PanelConfig>;\n\nexport type PanelInfo = {\n  title: string;\n  type: string;\n  description?: string;\n  thumbnail?: string;\n  help?: React.ReactNode;\n\n  /** Set this to true if a panel has custom toolbar items and so cannot be renamed. */\n  hasCustomToolbar?: boolean;\n\n  /**\n   * Tooltip to show on the settings button to help new users find the panel settings. Shown on\n   * panels of this type across the whole app until the settings button is clicked.\n   */\n  settingsOnboardingTooltip?: string;\n\n  /**\n   * The panel module is a function to load the panel.\n   * This is to support our lazy built-in panels\n   */\n  module: () => Promise<{ default: PanelComponent }>;\n  config?: PanelConfig;\n  relatedConfigs?: { [panelId: string]: PanelConfig };\n  preconfigured?: boolean;\n  extensionNamespace?: ExtensionNamespace;\n};\n\n/** PanelCatalog describes the interface for getting available panels */\nexport interface PanelCatalog {\n  /** get a list of the available panels */\n  getPanels(): readonly PanelInfo[];\n\n  /** Get panel information for a specific panel type (i.e. 3d, map, image, etc) */\n  getPanelByType(type: string): PanelInfo | undefined;\n}\n\nconst PanelCatalogContext = createContext<PanelCatalog | undefined>(undefined);\nPanelCatalogContext.displayName = \"PanelCatalogContext\";\n\nexport function usePanelCatalog(): PanelCatalog {\n  const panelCatalog = useContext(PanelCatalogContext);\n  if (!panelCatalog) {\n    throw new Error(\"A PanelCatalogContext provider is required to usePanelCatalog\");\n  }\n\n  return panelCatalog;\n}\n\nexport default PanelCatalogContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { useStore, StoreApi } from \"zustand\";\n\nimport { RenderState, SettingsTree } from \"@foxglove/studio\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\n\nexport type ImmutableSettingsTree = DeepReadonly<SettingsTree>;\n\nexport type SharedPanelState = RenderState[\"sharedPanelState\"];\n\ntype PanelType = string;\n\nexport type PanelStateStore = {\n  /**\n   * Used for forcing remounts on panels to make panels reload their saved configs. This is necessary\n   * because panels are free to ignore updates to their config in the layout and maintain their own\n   * internal state but we need some way of overriding this and forcing the panel to remount.\n   */\n  sequenceNumbers: Record<string, number>;\n\n  /**\n   * Per-panel settings UI trees.\n   */\n  settingsTrees: Record<string, ImmutableSettingsTree | undefined>;\n\n  /** Per-panel default titles. */\n  defaultTitles: Record<string, string | undefined>;\n\n  /**\n   * Transient state shared between panels, keyed by panel type.\n   */\n  sharedPanelState: Record<PanelType, SharedPanelState>;\n\n  /**\n   * Increments the sequence number for the panel, forcing a remount.\n   */\n  incrementSequenceNumber: (panelId: string) => void;\n\n  /**\n   * Updates the settings UI for the given panel.\n   */\n  updateSettingsTree: (panelId: string, settingsTree: ImmutableSettingsTree | undefined) => void;\n\n  /** Updates the default title for the given panel. */\n  updateDefaultTitle: (panelId: string, title: string | undefined) => void;\n\n  /**\n   * Update the transient state associated with a particular panel type.\n   */\n  updateSharedPanelState: (type: PanelType, data: SharedPanelState) => void;\n};\n\nexport const PanelStateContext = createContext<undefined | StoreApi<PanelStateStore>>(undefined);\n\nexport function usePanelStateStore<T>(\n  selector: (store: PanelStateStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(PanelStateContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { createContext, useCallback } from \"react\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { TimelinePositionedEvent } from \"@foxglove/studio-base/context/EventsContext\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\nimport type { HoverValue } from \"@foxglove/studio-base/types/hoverValue\";\n\n/**\n * Represents the global bounds to which synced plots conform, including the id of the\n * component that set those bounds.\n */\nexport type SyncBounds = {\n  min: number;\n  max: number;\n  sourceId: string;\n  userInteraction: boolean;\n};\n\n/**\n * The TimelineInteractionStateStore manages state related to dynamic user interactions with data in the app.\n * Things like the hovered time value and global bounds for plots are managed here.\n */\nexport type TimelineInteractionStateStore = DeepReadonly<{\n  /** The events overlapping the current hover time, if any. */\n  eventsAtHoverValue: Record<string, TimelinePositionedEvent>;\n\n  /** Shared time bounds for synced plots, if any. */\n  globalBounds: undefined | SyncBounds;\n\n  /** The event directly hovered over by the user, if any. */\n  hoveredEvent: undefined | TimelinePositionedEvent;\n\n  /** The point in time hovered over by the user. */\n  hoverValue: undefined | HoverValue;\n\n  /** Clears the current hover value. */\n  clearHoverValue: (componentId: string) => void;\n\n  /** Sets the events overlapping the current hover time. */\n  setEventsAtHoverValue: (events: TimelinePositionedEvent[]) => void;\n\n  /** Sets new global bounds. */\n  setGlobalBounds: (\n    newBounds:\n      | undefined\n      | SyncBounds\n      | ((oldValue: undefined | SyncBounds) => undefined | SyncBounds),\n  ) => void;\n\n  /** Sets or clears the directly hovered event. */\n  setHoveredEvent: (hoveredEvent: undefined | TimelinePositionedEvent) => void;\n\n  /** Sets the new hover value. */\n  setHoverValue: (value: HoverValue) => void;\n}>;\n\nexport const TimelineInteractionStateContext = createContext<\n  undefined | StoreApi<TimelineInteractionStateStore>\n>(undefined);\nconst selectClearHoverValue = (store: TimelineInteractionStateStore) => store.clearHoverValue;\n\nexport function useClearHoverValue(): TimelineInteractionStateStore[\"clearHoverValue\"] {\n  return useTimelineInteractionState(selectClearHoverValue);\n}\n\nconst selectSetHoverValue = (store: TimelineInteractionStateStore) => {\n  return store.setHoverValue;\n};\n\nexport function useSetHoverValue(): TimelineInteractionStateStore[\"setHoverValue\"] {\n  return useTimelineInteractionState(selectSetHoverValue);\n}\n\n/**\n * Encapsulates logic for selecting the current hover value depending\n * on which component registered the hover value.\n */\nexport function useHoverValue(args?: {\n  componentId: string;\n  isTimestampScale: boolean;\n}): HoverValue | undefined {\n  const hasArgs = !!args;\n  const componentId = args?.componentId;\n  const isTimestampScale = args?.isTimestampScale ?? false;\n\n  const selector = useCallback(\n    (store: TimelineInteractionStateStore) => {\n      if (!hasArgs) {\n        // Raw form -- user needs to check that the value should be shown.\n        return store.hoverValue;\n      }\n      if (store.hoverValue == undefined) {\n        return undefined;\n      }\n      if (store.hoverValue.type === \"PLAYBACK_SECONDS\" && isTimestampScale) {\n        // Always show playback-time hover values for timestamp-based charts.\n        return store.hoverValue;\n      }\n      // Otherwise just show hover bars when hovering over the panel itself.\n      return store.hoverValue.componentId === componentId ? store.hoverValue : undefined;\n    },\n    [hasArgs, componentId, isTimestampScale],\n  );\n\n  return useTimelineInteractionState(selector);\n}\n\n/**\n * This hook wraps all access to the interaction state store. Pass selectors\n * to access parts of the store.\n */\nexport function useTimelineInteractionState<T>(\n  selector: (store: TimelineInteractionStateStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(TimelineInteractionStateContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useCallback, useState } from \"react\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\nimport { generateEmptyTypesLib } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/generateTypesLib\";\nimport { ros_lib_dts } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/typescript/ros\";\nimport { Diagnostic, UserNodeLog } from \"@foxglove/studio-base/players/UserNodePlayer/types\";\n\ntype UserNodeState = {\n  rosLib: string;\n  typesLib: string;\n  nodeStates: {\n    [nodeId: string]: {\n      diagnostics: readonly Diagnostic[];\n      logs: readonly UserNodeLog[];\n    };\n  };\n};\n\nexport const UserNodeStateContext = createContext<\n  | {\n      state: UserNodeState;\n      setUserNodeDiagnostics: (nodeId: string, diagnostics: readonly Diagnostic[]) => void;\n      addUserNodeLogs: (nodeId: string, logs: readonly UserNodeLog[]) => void;\n      clearUserNodeLogs: (nodeId: string) => void;\n      setUserNodeRosLib: (rosLib: string) => void;\n      setUserNodeTypesLib: (lib: string) => void;\n    }\n  | undefined\n>(undefined);\nUserNodeStateContext.displayName = \"UserNodeStateContext\";\n\nexport function UserNodeStateProvider({ children }: React.PropsWithChildren<unknown>): JSX.Element {\n  const [state, setState] = useState<UserNodeState>({\n    rosLib: ros_lib_dts,\n    typesLib: generateEmptyTypesLib(),\n    nodeStates: {},\n  });\n\n  const setUserNodeDiagnostics = useCallback(\n    (nodeId: string, diagnostics: readonly Diagnostic[]) => {\n      setState((prevState) => ({\n        ...prevState,\n        nodeStates: {\n          ...prevState.nodeStates,\n          [nodeId]: {\n            logs: [],\n            ...prevState.nodeStates[nodeId],\n            diagnostics, // replace diagnostics\n          },\n        },\n      }));\n    },\n    [],\n  );\n\n  const addUserNodeLogs = useCallback((nodeId: string, logs: readonly UserNodeLog[]) => {\n    setState((prevState) => ({\n      ...prevState,\n      nodeStates: {\n        ...prevState.nodeStates,\n        [nodeId]: {\n          diagnostics: [],\n          ...prevState.nodeStates[nodeId],\n          logs: (prevState.nodeStates[nodeId]?.logs ?? []).concat(logs), // add logs\n        },\n      },\n    }));\n  }, []);\n\n  const clearUserNodeLogs = useCallback((nodeId: string) => {\n    setState((prevState) => ({\n      ...prevState,\n      nodeStates: {\n        ...prevState.nodeStates,\n        [nodeId]: {\n          diagnostics: [],\n          ...prevState.nodeStates[nodeId],\n          logs: [], // clear logs\n        },\n      },\n    }));\n  }, []);\n\n  const setUserNodeRosLib = useCallback((rosLib: string) => {\n    setState((prevState) => ({ ...prevState, rosLib }));\n  }, []);\n\n  const setUserNodeTypesLib = useCallback((typesLib: string) => {\n    setState((prevState) => ({ ...prevState, typesLib }));\n  }, []);\n\n  const value = useShallowMemo({\n    state,\n    setUserNodeDiagnostics,\n    addUserNodeLogs,\n    clearUserNodeLogs,\n    setUserNodeRosLib,\n    setUserNodeTypesLib,\n  });\n\n  return <UserNodeStateContext.Provider value={value}>{children}</UserNodeStateContext.Provider>;\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function useUserNodeState() {\n  return useGuaranteedContext(UserNodeStateContext, \"UserNodeStateContext\");\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { LayoutID } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\nexport type UserProfile = {\n  /** The id of the layout the user is currently working with. */\n  currentLayoutId?: LayoutID;\n  /** Onboarding flow status */\n  onboarding?: {\n    /** List of panel types for which the settings tooltip has been shown */\n    settingsTooltipShownForPanelTypes?: string[];\n  };\n};\n\nexport type UserProfileStorage = {\n  getUserProfile: () => Promise<UserProfile>;\n  setUserProfile: (data: UserProfile | ((profile: UserProfile) => UserProfile)) => Promise<void>;\n};\n\nexport const UserProfileStorageContext = createContext<UserProfileStorage | undefined>(undefined);\nUserProfileStorageContext.displayName = \"UserProfileStorageContext\";\n\nexport function useUserProfileStorage(): UserProfileStorage {\n  const storage = useContext(UserProfileStorageContext);\n  if (storage == undefined) {\n    throw new Error(\"A UserProfileStorage provider is required to useUserProfileStorage\");\n  }\n\n  return storage;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, Dispatch, SetStateAction, useMemo, useState } from \"react\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { PreferencesDialogTab } from \"@foxglove/studio-base/components/PreferencesDialog/PreferencesDialog\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nexport type SidebarItemKey =\n  | \"account\"\n  | \"add-panel\"\n  | \"connection\"\n  | \"extensions\"\n  | \"help\"\n  | \"layouts\"\n  | \"panel-settings\"\n  | \"preferences\"\n  | \"studio-logs-settings\"\n  | \"variables\";\n\nconst LeftSidebarItemKeys = [\"panel-settings\", \"topics\"] as const;\nexport type LeftSidebarItemKey = (typeof LeftSidebarItemKeys)[number];\n\nconst RightSidebarItemKeys = [\"events\", \"variables\", \"studio-logs-settings\"] as const;\nexport type RightSidebarItemKey = (typeof RightSidebarItemKeys)[number];\n\nexport type WorkspaceContextStore = DeepReadonly<{\n  leftSidebarOpen: boolean;\n  rightSidebarOpen: boolean;\n  leftSidebarItem: undefined | LeftSidebarItemKey;\n  leftSidebarSize: undefined | number;\n  rightSidebarItem: undefined | RightSidebarItemKey;\n  rightSidebarSize: undefined | number;\n  prefsDialogState: {\n    initialTab: undefined | PreferencesDialogTab;\n    open: boolean;\n  };\n  sidebarItem: undefined | SidebarItemKey;\n}>;\n\nexport const WorkspaceContext = createContext<undefined | StoreApi<WorkspaceContextStore>>(\n  undefined,\n);\n\nWorkspaceContext.displayName = \"WorkspaceContext\";\n\nexport const WorkspaceStoreSelectors = {\n  selectPanelSettingsOpen: (store: WorkspaceContextStore): boolean => {\n    return (\n      store.sidebarItem === \"panel-settings\" ||\n      (store.leftSidebarOpen && store.leftSidebarItem === \"panel-settings\")\n    );\n  },\n};\n\n/**\n * Fetches values from the workspace store.\n */\nexport function useWorkspaceStore<T>(\n  selector: (store: WorkspaceContextStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(WorkspaceContext);\n  return useStore(context, selector, equalityFn);\n}\n\nexport type WorkspaceActions = {\n  openAccountSettings: () => void;\n  openPanelSettings: () => void;\n  openLayoutBrowser: () => void;\n  prefsDialogActions: {\n    close: () => void;\n    open: (initialTab?: PreferencesDialogTab) => void;\n  };\n  selectSidebarItem: (selectedSidebarItem: undefined | SidebarItemKey) => void;\n  selectLeftSidebarItem: (item: undefined | LeftSidebarItemKey) => void;\n  selectRightSidebarItem: (item: undefined | RightSidebarItemKey) => void;\n  setLeftSidebarOpen: Dispatch<SetStateAction<boolean>>;\n  setLeftSidebarSize: (size: undefined | number) => void;\n  setRightSidebarOpen: Dispatch<SetStateAction<boolean>>;\n  setRightSidebarSize: (size: undefined | number) => void;\n};\n\nfunction setterValue<T>(action: SetStateAction<T>, value: T): T {\n  if (action instanceof Function) {\n    return action(value);\n  }\n\n  return action;\n}\n\n/**\n * Provides various actions to manipulate the workspace state.\n */\nexport function useWorkspaceActions(): WorkspaceActions {\n  const { setState: set } = useGuaranteedContext(WorkspaceContext);\n\n  const { signIn } = useCurrentUser();\n  const supportsAccountSettings = signIn != undefined;\n\n  const [currentEnableNewTopNav = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_NEW_TOPNAV,\n  );\n  const [initialEnableNewTopNav] = useState(currentEnableNewTopNav);\n  const enableNewTopNav = isDesktopApp() ? initialEnableNewTopNav : currentEnableNewTopNav;\n\n  return useMemo(() => {\n    return {\n      openAccountSettings: () => supportsAccountSettings && set({ sidebarItem: \"account\" }),\n\n      openPanelSettings: () =>\n        enableNewTopNav\n          ? set({ leftSidebarItem: \"panel-settings\", leftSidebarOpen: true })\n          : set({ sidebarItem: \"panel-settings\" }),\n\n      openLayoutBrowser: () => set({ sidebarItem: \"layouts\" }),\n\n      prefsDialogActions: {\n        close: () => set({ prefsDialogState: { open: false, initialTab: undefined } }),\n        open: (initialTab?: PreferencesDialogTab) => {\n          set({ prefsDialogState: { open: true, initialTab } });\n        },\n      },\n\n      selectSidebarItem: (selectedSidebarItem: undefined | SidebarItemKey) => {\n        if (selectedSidebarItem === \"preferences\") {\n          set({ prefsDialogState: { open: true, initialTab: undefined } });\n        } else {\n          set({ sidebarItem: selectedSidebarItem });\n        }\n      },\n\n      selectLeftSidebarItem: (selectedLeftSidebarItem: undefined | LeftSidebarItemKey) => {\n        set({\n          leftSidebarItem: selectedLeftSidebarItem,\n          leftSidebarOpen: selectedLeftSidebarItem != undefined,\n        });\n      },\n\n      selectRightSidebarItem: (selectedRightSidebarItem: undefined | RightSidebarItemKey) => {\n        set({\n          rightSidebarItem: selectedRightSidebarItem,\n          rightSidebarOpen: selectedRightSidebarItem != undefined,\n        });\n      },\n\n      setLeftSidebarOpen: (setter: SetStateAction<boolean>) => {\n        set((oldValue) => {\n          const leftSidebarOpen = setterValue(setter, oldValue.leftSidebarOpen);\n          if (leftSidebarOpen) {\n            const oldItem = LeftSidebarItemKeys.find((item) => item === oldValue.leftSidebarItem);\n            return {\n              leftSidebarOpen,\n              leftSidebarItem: oldItem ?? \"panel-settings\",\n            };\n          } else {\n            return { leftSidebarOpen: false };\n          }\n        });\n      },\n\n      setLeftSidebarSize: (leftSidebarSize: undefined | number) => set({ leftSidebarSize }),\n\n      setRightSidebarOpen: (setter: SetStateAction<boolean>) => {\n        set((oldValue) => {\n          const rightSidebarOpen = setterValue(setter, oldValue.rightSidebarOpen);\n          const oldItem = RightSidebarItemKeys.find((item) => item === oldValue.rightSidebarItem);\n          if (rightSidebarOpen) {\n            return {\n              rightSidebarOpen,\n              rightSidebarItem: oldItem ?? \"variables\",\n            };\n          } else {\n            return { rightSidebarOpen: false };\n          }\n        });\n      },\n\n      setRightSidebarSize: (rightSidebarSize: undefined | number) => set({ rightSidebarSize }),\n    };\n  }, [enableNewTopNav, set, supportsAccountSettings]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport moment from \"moment-timezone\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { Time } from \"@foxglove/studio\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\nimport { formatDate, formatTime } from \"@foxglove/studio-base/util/formatTime\";\nimport { formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\nimport { useAppConfigurationValue } from \"./useAppConfigurationValue\";\n\nexport interface IAppTimeFormat {\n  formatDate: (date: Time) => string;\n  formatTime: (stamp: Time) => string;\n  formatDuration: (duration: Time) => string;\n  timeFormat: TimeDisplayMethod;\n  setTimeFormat: (format: TimeDisplayMethod) => Promise<void>;\n  timeZone: string | undefined;\n}\n\nexport function useAppTimeFormat(): IAppTimeFormat {\n  const [timeFormat, setTimeFormat] = useAppConfigurationValue<string>(AppSetting.TIME_FORMAT);\n  const [timeZone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n\n  const effectiveFormat: TimeDisplayMethod = useMemo(\n    () => (timeFormat === \"SEC\" ? \"SEC\" : \"TOD\"),\n    [timeFormat],\n  );\n\n  const formatDateCallback = useCallback(\n    (date: Time) => {\n      return formatDate(date, timeZone);\n    },\n    [timeZone],\n  );\n\n  const formatTimeCallback = useCallback(\n    (stamp: Time) => {\n      if (effectiveFormat === \"TOD\") {\n        return formatTime(stamp, timeZone);\n      } else {\n        return formatTimeRaw(stamp);\n      }\n    },\n    [effectiveFormat, timeZone],\n  );\n\n  const formatDurationCallback = useCallback(\n    (duration: Time) => {\n      if (effectiveFormat === \"TOD\") {\n        return (\n          moment.duration(duration.sec * 1e3).format(\"h:mm:ss\", { trim: false }) +\n          `.${duration.nsec}`\n        );\n      } else {\n        return formatTimeRaw(duration);\n      }\n    },\n    [effectiveFormat],\n  );\n\n  return {\n    formatDate: formatDateCallback,\n    formatTime: formatTimeCallback,\n    formatDuration: formatDurationCallback,\n    setTimeFormat,\n    timeFormat: effectiveFormat,\n    timeZone,\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect, useState } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\ntype UseMemoryInfoOptions = {\n  refreshIntervalMs: number;\n};\n\nconst performance = window.performance;\n\nexport function useMemoryInfo(opt: UseMemoryInfoOptions): MemoryInfo | undefined {\n  const { refreshIntervalMs } = opt;\n  const [memoryInfo, setMemoryInfo] = useState<MemoryInfo | undefined>(performance.memory);\n\n  useEffect(() => {\n    if (!performance.memory) {\n      log.info(\"No memory information available\");\n      return;\n    }\n\n    const interval = setInterval(() => {\n      setMemoryInfo(performance.memory);\n    }, refreshIntervalMs);\n    return () => {\n      clearInterval(interval);\n    };\n  }, [refreshIntervalMs]);\n\n  return memoryInfo;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useCallback, useEffect, useState } from \"react\";\n\nimport {\n  AppConfigurationValue,\n  useAppConfiguration,\n} from \"@foxglove/studio-base/context/AppConfigurationContext\";\n\n/**\n * Load a value from app configuration and provide a function to change it\n * This function behaves similarly to useState for a given app configuration key.\n */\nexport function useAppConfigurationValue<T extends AppConfigurationValue>(\n  key: string,\n): [value: T | undefined, setter: (value?: T) => Promise<void>] {\n  const appConfiguration = useAppConfiguration();\n\n  const [configurationValue, setConfigurationValue] = useState<T | undefined>(() => {\n    const val = appConfiguration.get(key) as T | undefined;\n    // coerce empty strings into undefined\n    if (typeof val === \"string\" && val.length === 0) {\n      return undefined;\n    }\n    return val;\n  });\n\n  useEffect(() => {\n    const handler = (val: unknown) => {\n      setConfigurationValue(val as T);\n    };\n\n    appConfiguration.addChangeListener(key, handler);\n    return () => appConfiguration.removeChangeListener(key, handler);\n  }, [key, appConfiguration]);\n\n  const wrappedSetter = useCallback(\n    async (value?: T) => {\n      setConfigurationValue(value);\n      return await appConfiguration.set(key, value);\n    },\n    [appConfiguration, key],\n  );\n\n  return [configurationValue, wrappedSetter];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { isEqual } from \"lodash\";\nimport { useRef } from \"react\";\n\n// Continues to return the same instance as long as deep equality is maintained.\nexport default function useDeepMemo<T>(value: T): T {\n  const ref = useRef(value);\n  if (isEqual(value, ref.current)) {\n    return ref.current;\n  }\n  ref.current = value;\n  return value;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport type { VariableValue } from \"@foxglove/studio\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\nexport type GlobalVariables = { [key: string]: VariableValue };\n\nexport const EMPTY_GLOBAL_VARIABLES: GlobalVariables = Object.freeze({});\n\nconst globalVariablesSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.globalVariables ?? EMPTY_GLOBAL_VARIABLES;\n\nexport default function useGlobalVariables(): {\n  globalVariables: GlobalVariables;\n  setGlobalVariables: (arg0: GlobalVariables) => void;\n  overwriteGlobalVariables: (arg0: GlobalVariables) => void;\n} {\n  const { setGlobalVariables, overwriteGlobalVariables } = useCurrentLayoutActions();\n  const globalVariables = useCurrentLayoutSelector(globalVariablesSelector);\n  return { setGlobalVariables, overwriteGlobalVariables, globalVariables };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useContext, Context } from \"react\";\n\nexport default function useGuaranteedContext<T>(\n  contextType: Context<T | undefined>,\n  debugContextName?: string,\n): T {\n  const context = useContext(contextType);\n  if (context == undefined) {\n    throw new Error(\n      `useGuaranteedContext got null for contextType${\n        debugContextName != undefined ? `: '${debugContextName}'` : \"\"\n      }`,\n    );\n  }\n  return context;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useRef } from \"react\";\n\n// Call _warn_ if a given value changes twice within 200 ms\nexport default function useShouldNotChangeOften<T>(value: T, warn: () => void): T {\n  const prev = useRef(value);\n  const prevPrev = useRef(value);\n  const lastTime = useRef<number>(Date.now());\n  if (\n    value !== prev.current &&\n    prev.current !== prevPrev.current &&\n    Date.now() - lastTime.current < 200\n  ) {\n    warn();\n  }\n  prevPrev.current = prev.current;\n  prev.current = value;\n  lastTime.current = Date.now();\n  return value;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\n// by default, modal dialogs are appended to the document body\n// providing a value to this context will instead cause modals\n// to be appended to the DOM node whose id matches the provided value\nconst DialogHostIdContext = createContext<string | undefined>(undefined);\nDialogHostIdContext.displayName = \"DialogHostIdContext\";\n\nfunction useDialogHostId(): string | undefined {\n  return useContext(DialogHostIdContext);\n}\n\nexport { useDialogHostId };\nexport default DialogHostIdContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { GlobalStyles, useTheme } from \"@mui/material\";\n\n/** GlobalCss component configures html, body, and #root with theme elements */\nexport default function GlobalCss(): JSX.Element {\n  const theme = useTheme();\n\n  return (\n    <GlobalStyles\n      styles={{\n        \"html, body\": {\n          boxSizing: \"border-box\",\n          margin: 0,\n          padding: 0,\n          height: \"100%\",\n          width: \"100%\",\n\n          // https://github.com/necolas/normalize.css/blob/master/normalize.css#L12\n          lineHeight: 1.15,\n        },\n        \"*, *:before, *:after\": {\n          boxSizing: \"inherit\",\n        },\n        body: {\n          background: theme.palette.background.default,\n          color: theme.palette.text.primary,\n          font: \"inherit\",\n          fontFamily: theme.typography.body2.fontFamily,\n          fontFeatureSettings: theme.typography.body2.fontFeatureSettings,\n          fontSize: theme.typography.body2.fontSize,\n          fontWeight: theme.typography.body2.fontWeight,\n\n          // Prevent scroll \"bouncing\" since the app workspace is not scrollable. Allows individual\n          // scrollable elements to be scrolled without the whole page moving (even if they don't\n          // preventDefault on scroll events).\n          overscrollBehavior: \"none\",\n        },\n        \"#root\": {\n          height: \"100%\",\n          width: \"100%\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          position: \"relative\",\n          flex: \"1 1 100%\",\n          outline: \"none\",\n          overflow: \"hidden\",\n          zIndex: 0,\n        },\n      }}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { AsyncState } from \"react-use/lib/useAsyncFn\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { Time } from \"@foxglove/rostime\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\n\n/**\n * DataSourceEvent representings a single event within a data source.\n */\nexport type DataSourceEvent = {\n  id: string;\n  createdAt: string;\n  deviceId: string;\n  durationNanos: string;\n  endTime: Time;\n  endTimeInSeconds: number;\n  metadata: Record<string, string>;\n  startTime: Time;\n  startTimeInSeconds: number;\n  timestampNanos: string;\n  updatedAt: string;\n};\n\n/**\n * Represents an event including its fractional position on the timeline.\n */\nexport type TimelinePositionedEvent = {\n  /** The event. */\n  event: DataSourceEvent;\n\n  /** The end position of the event, as a value 0-1 relative to the timeline. */\n  endPosition: number;\n\n  /** The start position of the event, as a value 0-1 relative to the timeline. */\n  startPosition: number;\n\n  /** The time, in seconds, relative to the start of the timeline. */\n  secondsSinceStart: number;\n};\n\nexport type EventsStore = DeepReadonly<{\n  /** Used to signal event refreshes. */\n  eventFetchCount: number;\n\n  /** Whether events are supported for the currently loaded source. */\n  eventsSupported: boolean;\n\n  /** Fetched events for this session. */\n  events: AsyncState<TimelinePositionedEvent[]>;\n\n  /** The current event filter expression. */\n  filter: string;\n\n  /** The currently selected event, if any. */\n  selectedEventId: undefined | string;\n\n  /** The active device under which new events should be created. */\n  deviceId: string | undefined;\n\n  /** Refreshes events from api. */\n  refreshEvents: () => void;\n\n  /** Select an event by id or clear the selection. */\n  selectEvent: (id: undefined | string) => void;\n\n  /** Set the fetched events. */\n  setEvents: (events: AsyncState<TimelinePositionedEvent[]>) => void;\n\n  /** Set the flag indicating support for events. */\n  // eslint-disable-next-line @foxglove/no-boolean-parameters\n  setEventsSupported: (supported: boolean) => void;\n\n  /** Update the current filter expression. */\n  setFilter: (filter: string) => void;\n\n  /** Set the active device. */\n  setDeviceId: (deviceId: string | undefined) => void;\n}>;\n\nexport const EventsContext = createContext<undefined | StoreApi<EventsStore>>(undefined);\n\nexport function useEvents<T>(\n  selector: (store: EventsStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(EventsContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ReactNode, useState } from \"react\";\nimport { AsyncState } from \"react-use/lib/useAsyncFn\";\nimport { createStore } from \"zustand\";\n\nimport {\n  EventsContext,\n  EventsStore,\n  TimelinePositionedEvent,\n} from \"@foxglove/studio-base/context/EventsContext\";\n\nconst NO_EVENTS: TimelinePositionedEvent[] = [];\n\nfunction createEventsStore() {\n  return createStore<EventsStore>((set) => ({\n    eventFetchCount: 0,\n    events: { loading: false, value: NO_EVENTS },\n    filter: \"\",\n    selectedEventId: undefined,\n    eventsSupported: false,\n    deviceId: undefined,\n\n    refreshEvents: () => set((old) => ({ eventFetchCount: old.eventFetchCount + 1 })),\n    selectEvent: (id: undefined | string) => set({ selectedEventId: id }),\n    setEvents: (events: AsyncState<TimelinePositionedEvent[]>) =>\n      set({ events, selectedEventId: undefined }),\n    setFilter: (filter: string) => set({ filter }),\n    // eslint-disable-next-line @foxglove/no-boolean-parameters\n    setEventsSupported: (eventsSupported: boolean) => set({ eventsSupported }),\n    setDeviceId: (deviceId: string | undefined) => set({ deviceId }),\n  }));\n}\n\nexport default function EventsProvider({ children }: { children?: ReactNode }): JSX.Element {\n  const [store] = useState(createEventsStore);\n\n  return <EventsContext.Provider value={store}>{children}</EventsContext.Provider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { LogLevel } from \"@foxglove/log\";\nimport useGuaranteedContext from \"@foxglove/studio-base/hooks/useGuaranteedContext\";\n\ntype StudioLogConfigChannel = { name: string; enabled: boolean };\n\ninterface IStudioLogsSettings {\n  readonly globalLevel: LogLevel;\n\n  readonly channels: ReadonlyArray<{ name: string; enabled: boolean }>;\n\n  // Enable/disable a channel. Name is the full name of the channel.\n  enableChannel(name: string): void;\n  disableChannel(name: string): void;\n\n  // Enable/disable an entire prefix. Any channels with a name starting with the prefix will be toggled\n  enablePrefix(prefix: string): void;\n  disablePrefix(prefix: string): void;\n\n  // Set the global log level for all channels\n  // This does not affect whether a channel is enabled or disabled\n  setGlobalLevel(level: LogLevel): void;\n}\n\nconst StudioLogsSettingsContext = createContext<undefined | StoreApi<IStudioLogsSettings>>(\n  undefined,\n);\n\nfunction useStudioLogsSettings(): IStudioLogsSettings {\n  const context = useGuaranteedContext(StudioLogsSettingsContext);\n  return useStore(context);\n}\n\nexport { StudioLogsSettingsContext, useStudioLogsSettings };\nexport type { IStudioLogsSettings, StudioLogConfigChannel };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createStore, StoreApi } from \"zustand\";\n\nimport Log, { Logger, LogLevel, toLogLevel } from \"@foxglove/log\";\nimport {\n  IStudioLogsSettings,\n  StudioLogConfigChannel,\n} from \"@foxglove/studio-base/context/StudioLogsSettingsContext\";\n\nimport { LocalStorageSaveState } from \"./types\";\n\nconst log = Log.getLogger(__filename);\n\nconst defaultGlobalLevel: LogLevel = process.env.NODE_ENV === \"development\" ? \"debug\" : \"warn\";\n\nfunction createStudioLogsSettingsStore(\n  initialState?: LocalStorageSaveState,\n): StoreApi<IStudioLogsSettings> {\n  const globalLevel = toLogLevel(initialState?.globalLevel ?? defaultGlobalLevel);\n  const disabledChannels = initialState?.disabledChannels ?? [];\n\n  log.debug(`Initializing log Config. ${disabledChannels.length} disabled channels.`);\n  const channels: StudioLogConfigChannel[] = [];\n\n  // Lookup channel by name, there might be multiple channels that use the same name\n  const channelByName = new Map<string, Logger[]>();\n\n  const sortedChannels = Log.channels().sort((a, b) => a.name().localeCompare(b.name()));\n\n  for (const channel of sortedChannels) {\n    const name = channel.name() ? channel.name() : \"<root>\";\n\n    if (disabledChannels.includes(name)) {\n      channel.setLevel(\"warn\");\n    } else {\n      channel.setLevel(globalLevel);\n    }\n\n    // enabled means the channel meets at least the global logging level?\n    // if the channel is greater than the global logging level it is not enabled?\n\n    // Only add to the channels list (for the provider) if we haven't seen this name.\n    // If another channel has the same name we only add to the channels list once because they\n    // are indistiguishable from each other.\n    if (!channelByName.has(name)) {\n      channels.push({\n        name,\n        enabled: channel.isLevelOn(globalLevel),\n      });\n    }\n\n    const existing = channelByName.get(name) ?? [];\n    existing.push(channel);\n    channelByName.set(name, existing);\n  }\n\n  function regenerateChannels(\n    get: () => IStudioLogsSettings,\n    set: (partial: Partial<IStudioLogsSettings>) => void,\n  ) {\n    const currentGlobalLevel = get().globalLevel;\n    let didChange = false;\n    for (const channel of channels) {\n      const logChannels = channelByName.get(channel.name);\n      if (!logChannels) {\n        continue;\n      }\n\n      const anyChannel = logChannels[0];\n      if (anyChannel && anyChannel.isLevelOn(currentGlobalLevel) !== channel.enabled) {\n        channel.enabled = !channel.enabled;\n        didChange = true;\n      }\n    }\n\n    if (!didChange) {\n      return;\n    }\n\n    set({ channels: [...channels] });\n  }\n\n  return createStore<IStudioLogsSettings>((set, get) => ({\n    globalLevel,\n\n    channels,\n\n    setGlobalLevel(level: LogLevel) {\n      log.debug(`Set global level: ${level}`);\n\n      // Enable the underlying log channels\n      for (const [_, logChannels] of channelByName) {\n        for (const channel of logChannels) {\n          channel.setLevel(level);\n        }\n      }\n\n      set({ globalLevel: level });\n      regenerateChannels(get, set);\n    },\n\n    enableChannel(name: string) {\n      log.debug(`Enable channel: ${name}`);\n\n      // Enable the underlying log channels\n      const logChannels = channelByName.get(name) ?? [];\n      for (const channel of logChannels) {\n        channel.setLevel(\"debug\");\n      }\n\n      regenerateChannels(get, set);\n    },\n\n    disableChannel(name: string) {\n      log.debug(`Disable channel: ${name}`);\n\n      // Enable the underlying log channels\n      const logChannels = channelByName.get(name) ?? [];\n      for (const channel of logChannels) {\n        channel.setLevel(\"warn\");\n      }\n\n      regenerateChannels(get, set);\n    },\n\n    enablePrefix(prefix: string) {\n      log.debug(`Enable prefix ${prefix}`);\n      // find all channels matching the prefix and enable them\n      for (const [key, logChannels] of channelByName) {\n        if (key.startsWith(prefix)) {\n          for (const channel of logChannels) {\n            channel.setLevel(\"debug\");\n          }\n        }\n      }\n\n      regenerateChannels(get, set);\n    },\n\n    disablePrefix(prefix: string) {\n      log.debug(`Disable prefix ${prefix}`);\n\n      for (const [key, logChannels] of channelByName) {\n        if (key.startsWith(prefix)) {\n          for (const channel of logChannels) {\n            channel.setLevel(\"warn\");\n          }\n        }\n      }\n\n      regenerateChannels(get, set);\n    },\n  }));\n}\n\nexport { createStudioLogsSettingsStore };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren, useEffect, useRef, useState } from \"react\";\nimport { useLocalStorage } from \"react-use\";\n\nimport Log from \"@foxglove/log\";\nimport { StudioLogsSettingsContext } from \"@foxglove/studio-base/context/StudioLogsSettingsContext\";\n\nimport { createStudioLogsSettingsStore } from \"./store\";\nimport { LocalStorageSaveState } from \"./types\";\n\nfunction StudioLogsSettingsProvider(props: PropsWithChildren<unknown>): JSX.Element {\n  const [studioLogsSettingsSavedState, setStudioLogsSettingsSavedState] =\n    useLocalStorage<LocalStorageSaveState>(\"fox.studio-logs-settings\", {});\n\n  const [studioLogsSettingsStore, setStudioLogsSettingsStore] = useState(() =>\n    createStudioLogsSettingsStore(studioLogsSettingsSavedState),\n  );\n\n  // To avoid resetting effect below when the localstorage state changes we use a ref for the localstorage state\n  const savedStateRef = useRef<LocalStorageSaveState | undefined>(studioLogsSettingsSavedState);\n  useEffect(() => {\n    savedStateRef.current = studioLogsSettingsSavedState;\n  });\n\n  // Setup an interval to check for changes to the total number of logging channels\n  //\n  // When the total number of channels changes we re-initialize the settings store so we display any\n  // newly added log channels.\n  useEffect(() => {\n    const storeChannelsCount = studioLogsSettingsStore.getState().channels.length;\n    const intervalHandle = setInterval(() => {\n      if (storeChannelsCount !== Log.channels().length) {\n        setStudioLogsSettingsStore(createStudioLogsSettingsStore(savedStateRef.current));\n      }\n    }, 1000);\n\n    return () => clearInterval(intervalHandle);\n  }, [studioLogsSettingsStore, studioLogsSettingsSavedState]);\n\n  useEffect(() => {\n    return studioLogsSettingsStore.subscribe((value) => {\n      const disabledChannels: string[] = [];\n\n      for (const channel of value.channels) {\n        if (!channel.enabled) {\n          disabledChannels.push(channel.name);\n        }\n      }\n      setStudioLogsSettingsSavedState({ globalLevel: value.globalLevel, disabledChannels });\n    });\n  }, [studioLogsSettingsStore, setStudioLogsSettingsSavedState]);\n\n  return (\n    <StudioLogsSettingsContext.Provider value={studioLogsSettingsStore}>\n      {props.children}\n    </StudioLogsSettingsContext.Provider>\n  );\n}\n\nexport { StudioLogsSettingsProvider };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEqual, keyBy } from \"lodash\";\nimport { ReactNode, useState } from \"react\";\nimport { createStore, StoreApi } from \"zustand\";\n\nimport { TimelinePositionedEvent } from \"@foxglove/studio-base/context/EventsContext\";\nimport {\n  TimelineInteractionStateContext,\n  TimelineInteractionStateStore,\n  SyncBounds,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { HoverValue } from \"@foxglove/studio-base/types/hoverValue\";\n\nfunction createTimelineInteractionStateStore(): StoreApi<TimelineInteractionStateStore> {\n  return createStore((set) => {\n    return {\n      eventsAtHoverValue: {},\n      globalBounds: undefined,\n      hoveredEvent: undefined,\n      hoverValue: undefined,\n\n      clearHoverValue: (componentId: string) =>\n        set((store) => ({\n          hoverValue: store.hoverValue?.componentId === componentId ? undefined : store.hoverValue,\n        })),\n\n      setEventsAtHoverValue: (eventsAtHoverValue: TimelinePositionedEvent[]) =>\n        set({ eventsAtHoverValue: keyBy(eventsAtHoverValue, (event) => event.event.id) }),\n\n      setGlobalBounds: (\n        newBounds:\n          | undefined\n          | SyncBounds\n          | ((oldValue: undefined | SyncBounds) => undefined | SyncBounds),\n      ) => {\n        if (typeof newBounds === \"function\") {\n          set((store) => ({ globalBounds: newBounds(store.globalBounds) }));\n        } else {\n          set({ globalBounds: newBounds });\n        }\n      },\n\n      setHoveredEvent: (hoveredEvent: undefined | TimelinePositionedEvent) => {\n        if (hoveredEvent) {\n          set({\n            hoveredEvent,\n            hoverValue: {\n              componentId: `event_${hoveredEvent.event.id}`,\n              type: \"PLAYBACK_SECONDS\",\n              value: hoveredEvent.secondsSinceStart,\n            },\n          });\n        } else {\n          set({ hoveredEvent: undefined, hoverValue: undefined });\n        }\n      },\n\n      setHoverValue: (newValue: HoverValue) =>\n        set((store) => ({\n          hoverValue: isEqual(newValue, store.hoverValue) ? store.hoverValue : newValue,\n        })),\n    };\n  });\n}\n\nexport default function TimelineInteractionStateProvider({\n  children,\n}: {\n  children?: ReactNode;\n}): JSX.Element {\n  const [store] = useState(createTimelineInteractionStateStore());\n\n  return (\n    <TimelineInteractionStateContext.Provider value={store}>\n      {children}\n    </TimelineInteractionStateContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography } from \"@mui/material\";\nimport { CSSProperties, Fragment, PropsWithChildren } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nconst useStyles = makeStyles()((theme) => ({\n  leadingItems: {\n    display: \"flex\",\n    alignItems: \"center\",\n    marginLeft: theme.spacing(-1),\n    gap: theme.spacing(0.5),\n  },\n  toolbar: {\n    minHeight: 56,\n    flexShrink: 0,\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: theme.spacing(2, 2, 0, 2),\n    gap: theme.spacing(0.5),\n  },\n}));\n\nexport function SidebarContent({\n  disablePadding = false,\n  disableToolbar = false,\n  title,\n  children,\n  leadingItems,\n  overflow = \"auto\",\n  trailingItems,\n}: PropsWithChildren<SidebarContentProps>): JSX.Element {\n  const { classes } = useStyles();\n\n  return (\n    <Stack overflow={overflow} fullHeight flex=\"auto\" gap={1}>\n      {!disableToolbar && (\n        <div className={classes.toolbar}>\n          {leadingItems != undefined && (\n            <div className={classes.leadingItems}>\n              {leadingItems.map((item, i) => (\n                <Fragment key={i}>{item}</Fragment>\n              ))}\n            </div>\n          )}\n          <Typography component=\"h2\" variant=\"h4\" fontWeight={800} flex=\"auto\">\n            {title}\n          </Typography>\n          {trailingItems != undefined && (\n            <Stack direction=\"row\" alignItems=\"center\">\n              {trailingItems.map((item, i) => (\n                <div key={i}>{item}</div>\n              ))}\n            </Stack>\n          )}\n        </div>\n      )}\n      <Stack flex=\"auto\" {...(!disablePadding && { padding: 2 })}>\n        {children}\n      </Stack>\n    </Stack>\n  );\n}\n\ntype SidebarContentProps = {\n  title?: string;\n  disablePadding?: boolean;\n  disableToolbar?: boolean;\n\n  /** Buttons/items to display on the leading (left) side of the header */\n  leadingItems?: React.ReactNode[];\n\n  /** Overflow style of root element\n   * @default: \"auto\"\n   */\n  overflow?: CSSProperties[\"overflow\"];\n\n  /** Buttons/items to display on the trailing (right) side of the header */\n  trailingItems?: React.ReactNode[];\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function BlockheadFilledIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <g fill=\"currentColor\">\n        <rect x=\"8.07\" y=\"5.38\" width=\"7.87\" height=\"7.87\" rx=\"2\" />\n        <path d=\"M12,1.53A10.5,10.5,0,1,0,22.5,12,10.51,10.51,0,0,0,12,1.53ZM18.41,19l-1.67-2.61a2.47,2.47,0,0,0-2-1H9.26a2.48,2.48,0,0,0-2,1L5.59,19a9.5,9.5,0,1,1,12.82,0Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Dialog, DialogContent, DialogTitle, DialogActions, Button } from \"@mui/material\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useKeyPressEvent } from \"react-use\";\n\ntype ConfirmVariant = \"danger\" | \"primary\";\ntype ConfirmAction = \"ok\" | \"cancel\";\n\ntype ConfirmOptions = {\n  // the title of the confirm modal\n  title: string;\n  // text in the body of the confirm modal. Specify a string or JSX Element\n  prompt?: string | JSX.Element;\n  // the text for the OK button - defaults to \"OK\"\n  ok?: string;\n  // the text for the cancel button - defaults to \"Cancel\"\n  // set to false to completely hide the cancel button\n  cancel?: string | false;\n  // indicate the type of confirmation\n  variant?: ConfirmVariant;\n};\n\ntype ConfirmModalProps = ConfirmOptions & {\n  onComplete: (value: ConfirmAction) => void;\n};\n\nfunction ConfirmModal(props: ConfirmModalProps) {\n  const originalOnComplete = props.onComplete;\n\n  const completed = useRef(false);\n  const onComplete = useCallback(\n    (result: ConfirmAction) => {\n      if (!completed.current) {\n        completed.current = true;\n        originalOnComplete(result);\n      }\n    },\n    [originalOnComplete],\n  );\n\n  useKeyPressEvent(\"Enter\", () => onComplete(\"ok\"));\n\n  // Ensure we still call onComplete(undefined) when the component unmounts, if it hasn't been\n  // called already\n  useEffect(() => {\n    return () => onComplete(\"cancel\");\n  }, [onComplete]);\n\n  const buttons = [\n    props.cancel !== false && (\n      <Button\n        size=\"large\"\n        variant=\"outlined\"\n        color=\"inherit\"\n        key=\"cancel\"\n        onClick={() => onComplete(\"cancel\")}\n      >\n        {props.cancel ?? \"Cancel\"}\n      </Button>\n    ),\n    <Button\n      key=\"confirm\"\n      variant=\"contained\"\n      size=\"large\"\n      color={props.variant === \"danger\" ? \"error\" : \"primary\"}\n      type=\"submit\"\n    >\n      {props.ok ?? \"OK\"}\n    </Button>,\n  ];\n  if (props.variant === \"danger\") {\n    buttons.reverse();\n  }\n\n  return (\n    <Dialog open onClose={() => onComplete(\"cancel\")} maxWidth=\"xs\" fullWidth>\n      <form\n        onSubmit={(event) => {\n          event.preventDefault();\n          onComplete(\"ok\");\n        }}\n      >\n        <DialogTitle>{props.title}</DialogTitle>\n        <DialogContent>{props.prompt}</DialogContent>\n        <DialogActions>{buttons}</DialogActions>\n      </form>\n    </Dialog>\n  );\n}\n\n// Returns a function that can be used similarly to the DOM confirm(), but\n// backed by a React element rather than a native modal, and asynchronous.\nexport function useConfirm(): [\n  confirm: (options: ConfirmOptions) => Promise<ConfirmAction>,\n  confirmModal: JSX.Element | undefined,\n] {\n  const [modal, setModal] = useState<JSX.Element | undefined>();\n\n  const openConfirm = useCallback(async (options: ConfirmOptions) => {\n    return await new Promise<ConfirmAction>((resolve) => {\n      setModal(\n        <ConfirmModal\n          {...options}\n          onComplete={(value) => {\n            resolve(value);\n            setModal(undefined);\n          }}\n        />,\n      );\n    });\n  }, []);\n\n  return [openConfirm, modal];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, CircularProgress, Typography } from \"@mui/material\";\nimport { useSnackbar } from \"notistack\";\nimport { useCallback } from \"react\";\nimport { useAsyncFn } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Logger from \"@foxglove/log\";\nimport BlockheadFilledIcon from \"@foxglove/studio-base/components/BlockheadFilledIcon\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useCurrentUser, User } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { useConfirm } from \"@foxglove/studio-base/hooks/useConfirm\";\n\nconst log = Logger.getLogger(__filename);\n\nexport const AVATAR_ICON_SIZE = 42;\n\nconst useStyles = makeStyles()((theme) => ({\n  icon: {\n    color: theme.palette.primary.main,\n    fontSize: AVATAR_ICON_SIZE,\n  },\n}));\n\nexport default function AccountInfo(props: { currentUser?: User }): JSX.Element {\n  const { signOut } = useCurrentUser();\n  const { enqueueSnackbar } = useSnackbar();\n  const [confirm, confirmModal] = useConfirm();\n  const { classes } = useStyles();\n\n  const [{ loading }, beginSignOut] = useAsyncFn(async () => {\n    try {\n      await signOut?.();\n    } catch (error) {\n      log.error(error);\n      enqueueSnackbar((error as Error).toString(), { variant: \"error\" });\n    }\n  }, [enqueueSnackbar, signOut]);\n\n  const onSignoutClick = useCallback(() => {\n    void confirm({\n      title: \"Are you sure you want to sign out?\",\n      ok: \"Sign out\",\n    }).then((response) => {\n      if (response === \"ok\") {\n        void beginSignOut();\n      }\n    });\n  }, [beginSignOut, confirm]);\n\n  const onSettingsClick = useCallback(() => {\n    window.open(process.env.FOXGLOVE_ACCOUNT_PROFILE_URL, \"_blank\");\n  }, []);\n\n  if (!props.currentUser) {\n    return <></>;\n  }\n\n  return (\n    <Stack fullHeight justifyContent=\"space-between\">\n      {confirmModal}\n      <Stack gap={2}>\n        <Stack direction=\"row\" alignItems=\"center\" gap={1} flexWrap=\"wrap\">\n          <BlockheadFilledIcon className={classes.icon} />\n          <Stack justifyContent=\"center\">\n            <Typography variant=\"subtitle1\">{props.currentUser.email}</Typography>\n            <Typography variant=\"body2\" color=\"text.secondary\">\n              {props.currentUser.orgDisplayName ?? props.currentUser.orgSlug}\n            </Typography>\n          </Stack>\n        </Stack>\n        <Button onClick={onSettingsClick} variant=\"contained\">\n          Account settings\n        </Button>\n      </Stack>\n      <Stack gap={1}>\n        <Button onClick={onSignoutClick} variant=\"outlined\">\n          Sign out&nbsp;{loading && <CircularProgress size={16} />}\n        </Button>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\ntype Props = {\n  width?: number;\n};\n\nexport default function AccountSyncGraphic(props: Props): JSX.Element {\n  const { width } = props;\n  return (\n    <svg width={width} viewBox=\"0 0 256 256\">\n      <g stroke=\"currentColor\">\n        <path\n          d=\"M122.63,54.19C103,70.22,90,97.21,90,128c0,22.77,7.08,43.54,18.73,59.3\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path\n          d=\"M133.32,201.82C153,185.8,166,158.81,166,128c0-22.35-6.82-42.78-18.09-58.43\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path\n          d=\"M181,170.16a101.44,101.44,0,0,0-53-14.45,102.52,102.52,0,0,0-47.9,11.56\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path\n          d=\"M76,87.42a101.64,101.64,0,0,0,52,13.87,102.12,102.12,0,0,0,49.85-12.63\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path d=\"M128,54V202\" fill=\"none\" strokeWidth=\"4.5\" />\n        <path\n          d=\"M192,165.16A74,74,0,0,0,93,62.78,40,40,0,0,1,62.78,93,74,74,0,0,0,164.44,192.4,40,40,0,0,1,192,165.16Z\"\n          fill=\"none\"\n          strokeWidth=\"4.5\"\n        />\n      </g>\n\n      <g fill=\"currentColor\">\n        <circle cx=\"119.46\" cy=\"30.37\" r=\"3\" />\n        <circle cx=\"102.64\" cy=\"33.34\" r=\"3\" />\n        <circle cx=\"33.34\" cy=\"102.64\" r=\"3\" />\n        <circle cx=\"30.37\" cy=\"119.46\" r=\"3\" />\n        <circle cx=\"30.37\" cy=\"136.54\" r=\"3\" />\n        <circle cx=\"33.34\" cy=\"153.36\" r=\"3\" />\n        <circle cx=\"39.18\" cy=\"169.42\" r=\"3\" />\n        <circle cx=\"47.72\" cy=\"184.21\" r=\"3\" />\n        <circle cx=\"58.7\" cy=\"197.3\" r=\"3\" />\n        <circle cx=\"71.79\" cy=\"208.28\" r=\"3\" />\n        <circle cx=\"86.58\" cy=\"216.82\" r=\"3\" />\n        <circle cx=\"102.64\" cy=\"222.66\" r=\"3\" />\n        <circle cx=\"119.46\" cy=\"225.63\" r=\"3\" />\n        <circle cx=\"136.54\" cy=\"225.63\" r=\"3\" />\n        <circle cx=\"153.36\" cy=\"222.66\" r=\"3\" />\n        <circle cx=\"222.66\" cy=\"153.36\" r=\"3\" />\n        <circle cx=\"225.63\" cy=\"136.54\" r=\"3\" />\n        <circle cx=\"225.63\" cy=\"119.46\" r=\"3\" />\n        <circle cx=\"222.66\" cy=\"102.64\" r=\"3\" />\n        <circle cx=\"216.82\" cy=\"86.58\" r=\"3\" />\n        <circle cx=\"208.28\" cy=\"71.79\" r=\"3\" />\n        <circle cx=\"197.3\" cy=\"58.7\" r=\"3\" />\n        <circle cx=\"184.21\" cy=\"47.72\" r=\"3\" />\n        <circle cx=\"169.42\" cy=\"39.18\" r=\"3\" />\n        <circle cx=\"153.36\" cy=\"33.34\" r=\"3\" />\n        <circle cx=\"136.54\" cy=\"30.37\" r=\"3\" />\n      </g>\n\n      <g stroke=\"currentColor\">\n        <path\n          d=\"M28.89,85.13l7.72-12.2a8,8,0,0,1,6.51-3.35H64.88a8,8,0,0,1,6.51,3.35l7.72,12.2\"\n          fill=\"none\"\n          strokeWidth=\"4.5\"\n        />\n        <rect x=\"40\" y=\"29.18\" width=\"28\" height=\"28\" rx=\"7\" fill=\"none\" strokeWidth=\"4.5\" />\n        <circle cx=\"54\" cy=\"54\" r=\"40\" fill=\"none\" strokeWidth=\"4.5\" />\n      </g>\n\n      <g stroke=\"currentColor\">\n        <path\n          d=\"M177.71,234.79l7.72-12.2a8,8,0,0,1,6.51-3.35H213.7a8,8,0,0,1,6.51,3.35l7.71,12.2\"\n          fill=\"none\"\n          strokeWidth=\"4.5\"\n        />\n        <rect x=\"188.82\" y=\"178.84\" width=\"28\" height=\"28\" rx=\"7\" fill=\"none\" strokeWidth=\"4.5\" />\n        <circle cx=\"202.82\" cy=\"203.66\" r=\"40\" fill=\"none\" strokeWidth=\"4.5\" />\n      </g>\n    </svg>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, Typography } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\n\nimport AccountSyncGraphic from \"./AccountSyncGraphic\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: theme.spacing(2.5),\n  },\n  icon: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    color: theme.palette.primary.main,\n  },\n}));\n\nexport default function SigninForm(): JSX.Element {\n  const { classes } = useStyles();\n  const { signIn } = useCurrentUser();\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.icon}>\n        <AccountSyncGraphic width={192} />\n      </div>\n      <Typography variant=\"body1\">\n        <>\n          Create a Foxglove account to:\n          <ul>\n            <li>Sync your layouts across multiple devices</li>\n            <li>Share your layouts with others</li>\n            <li>Manage and store your robotics data</li>\n          </ul>\n        </>\n      </Typography>\n\n      <Button variant=\"contained\" color=\"primary\" onClick={signIn}>\n        Sign in\n      </Button>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useMemo } from \"react\";\n\nimport { SidebarContent } from \"@foxglove/studio-base/components/SidebarContent\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\n\nimport AccountInfo from \"./AccountInfo\";\nimport SigninForm from \"./SigninForm\";\n\nexport default function AccountSettings(): JSX.Element {\n  const { currentUser } = useCurrentUser();\n\n  const content = useMemo(() => {\n    if (!currentUser) {\n      return <SigninForm />;\n    }\n\n    return <AccountInfo currentUser={currentUser} />;\n  }, [currentUser]);\n\n  return <SidebarContent title=\"Account\">{content}</SidebarContent>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const APP_BAR_HEIGHT = 44;\nexport const APP_BAR_PRIMARY_COLOR = \"#9480ed\";\nexport const APP_BAR_FOREGROUND_COLOR = \"#ffffff\";\nexport const APP_BAR_BACKGROUND_COLOR = {\n  light: \"#27272b\",\n  dark: \"#35363A\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IconButton, IconButtonProps, Tooltip } from \"@mui/material\";\nimport { forwardRef } from \"react\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport {\n  APP_BAR_FOREGROUND_COLOR,\n  APP_BAR_PRIMARY_COLOR,\n} from \"@foxglove/studio-base/components/AppBar/constants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  tooltip: {\n    marginTop: `${theme.spacing(0.5)} !important`,\n  },\n  iconButton: {\n    borderRadius: 0,\n    fontSize: 24,\n    padding: theme.spacing(1.25),\n\n    svg: {\n      fontSize: \"1em !important\",\n    },\n    \"&:hover\": {\n      backgroundColor: tinycolor(APP_BAR_FOREGROUND_COLOR).setAlpha(0.08).toRgbString(),\n    },\n    \"&.Mui-selected\": {\n      backgroundColor: APP_BAR_PRIMARY_COLOR,\n    },\n    \"&.Mui-disabled\": {\n      color: \"currentColor\",\n      opacity: theme.palette.action.disabledOpacity,\n    },\n  },\n}));\n\ntype AppBarIconButtonProps = Omit<IconButtonProps, \"title\"> & { title: React.ReactNode };\n\nexport const AppBarIconButton = forwardRef<HTMLButtonElement, AppBarIconButtonProps>(\n  (props, ref) => {\n    const { title, className, children, color = \"inherit\", ...rest } = props;\n    const { classes, cx } = useStyles();\n\n    return (\n      <Tooltip\n        disableInteractive\n        classes={{ tooltip: classes.tooltip }}\n        title={title}\n        arrow={false}\n        enterDelay={200}\n      >\n        <IconButton color={color} ref={ref} className={cx(classes.iconButton, className)} {...rest}>\n          {children}\n        </IconButton>\n      </Tooltip>\n    );\n  },\n);\n\nAppBarIconButton.displayName = \"AppBarIconButton\";\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CheckBoxOutlineBlankIcon from \"@mui/icons-material/CheckBoxOutlineBlank\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport FilterNoneIcon from \"@mui/icons-material/FilterNone\";\nimport MinimizeIcon from \"@mui/icons-material/Minimize\";\nimport { IconButton } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nexport type CustomWindowControlsProps = {\n  showCustomWindowControls?: boolean;\n  isMaximized?: boolean;\n  onMinimizeWindow?: () => void;\n  onMaximizeWindow?: () => void;\n  onUnmaximizeWindow?: () => void;\n  onCloseWindow?: () => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  closeButton: {\n    \":hover\": {\n      backgroundColor: theme.palette.error.main,\n    },\n  },\n}));\n\nexport function CustomWindowControls({\n  isMaximized = false,\n  onMinimizeWindow,\n  onMaximizeWindow,\n  onUnmaximizeWindow,\n  onCloseWindow,\n}: Omit<CustomWindowControlsProps, \"showCustomWindowControls\">): JSX.Element {\n  const { classes } = useStyles();\n  return (\n    <Stack direction=\"row\" gap={1} paddingX={1}>\n      <IconButton\n        size=\"small\"\n        color=\"inherit\"\n        onClick={onMinimizeWindow}\n        data-testid=\"win-minimize\"\n      >\n        <MinimizeIcon fontSize=\"inherit\" color=\"inherit\" />\n      </IconButton>\n\n      <IconButton\n        size=\"small\"\n        color=\"inherit\"\n        onClick={isMaximized ? onUnmaximizeWindow : onMaximizeWindow}\n        data-testid=\"win-maximize\"\n      >\n        {isMaximized ? (\n          <FilterNoneIcon fontSize=\"inherit\" color=\"inherit\" />\n        ) : (\n          <CheckBoxOutlineBlankIcon fontSize=\"inherit\" color=\"inherit\" />\n        )}\n      </IconButton>\n\n      <IconButton\n        className={classes.closeButton}\n        size=\"small\"\n        color=\"inherit\"\n        onClick={onCloseWindow}\n        data-testid=\"win-close\"\n      >\n        <CloseIcon fontSize=\"inherit\" color=\"inherit\" />\n      </IconButton>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport function FoxgloveLogo(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon viewBox=\"0 0 400 400\" {...props}>\n      <title>Foxglove</title>\n      <g fill=\"currentColor\">\n        <ellipse cx=\"143.854\" cy=\"297.143\" rx=\"38.839\" ry=\"38.8571\" />\n        <ellipse opacity=\"0.5\" cx=\"255.89\" cy=\"297.143\" rx=\"38.839\" ry=\"38.8571\" />\n        <ellipse opacity=\"0.5\" cx=\"311.161\" cy=\"200\" rx=\"38.839\" ry=\"38.8571\" />\n        <path d=\"M143.899 64C153.005 64 161.384 67.1164 168.028 72.3414C176.674 79.3821 187.705 83.603 199.722 83.603C211.739 83.603 222.77 79.3821 231.416 72.3414C238.06 67.1164 246.438 64 255.545 64C277.126 64 294.621 81.5031 294.621 103.094C294.621 124.685 277.126 142.189 255.545 142.189C246.438 142.189 238.06 139.072 231.416 133.847C222.77 126.806 211.739 122.586 199.722 122.586C187.705 122.586 176.674 126.806 168.028 133.847C161.384 139.072 153.005 142.189 143.899 142.189C122.318 142.189 104.823 124.685 104.823 103.094C104.823 81.5031 122.318 64 143.899 64Z\" />\n        <path d=\"M88.0761 161.177C97.1825 161.177 105.561 164.294 112.205 169.519C120.851 176.559 131.882 180.78 143.899 180.78C155.916 180.78 166.947 176.559 175.593 169.519C182.237 164.294 190.616 161.177 199.722 161.177C221.303 161.177 238.798 178.68 238.798 200.272C238.798 221.863 221.303 239.366 199.722 239.366C190.616 239.366 182.237 236.249 175.593 231.024C166.947 223.984 155.916 219.763 143.899 219.763C131.882 219.763 120.851 223.984 112.205 231.024C105.561 236.249 97.1825 239.366 88.0761 239.366C66.495 239.366 49 221.863 49 200.272C49 178.68 66.495 161.177 88.0761 161.177Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Tooltip, Typography } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { useAppConfigurationValue, useMemoryInfo } from \"@foxglove/studio-base/hooks\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    width: 50,\n    flex: \"1 0 50px\",\n    fontSize: theme.typography.caption.fontSize,\n    overflow: \"hidden\",\n  },\n  label: {\n    fontWeight: \"bold\",\n  },\n  text: {\n    lineHeight: 1.1,\n  },\n}));\n\nfunction toMB(bytes: number): number {\n  return bytes / 1024 / 1024;\n}\n\nfunction MemoryUseIndicator(): JSX.Element {\n  const memoryInfo = useMemoryInfo({ refreshIntervalMs: 5000 });\n  const { classes, cx } = useStyles();\n  const [enableNewTopNav = false] = useAppConfigurationValue<boolean>(AppSetting.ENABLE_NEW_TOPNAV);\n\n  // If we can't load memory info (maybe not supported) then we don't show any indicator\n  if (!memoryInfo) {\n    return <></>;\n  }\n\n  const usedPercent = (memoryInfo.usedJSHeapSize / memoryInfo.jsHeapSizeLimit) * 100;\n  const usedMb = toMB(memoryInfo.usedJSHeapSize).toLocaleString();\n  const limitMb = toMB(memoryInfo.jsHeapSizeLimit).toLocaleString();\n\n  return (\n    <Tooltip\n      arrow={false}\n      title={`Used (MB): ${usedMb} / ${limitMb}`}\n      placement={enableNewTopNav ? \"bottom\" : \"right\"}\n    >\n      <div className={classes.root}>\n        <Typography className={cx(classes.label, classes.text)} variant=\"caption\">\n          MEM\n        </Typography>\n        <Typography className={classes.text} variant=\"caption\">\n          {usedPercent.toFixed(2)}%\n        </Typography>\n      </div>\n    </Tooltip>\n  );\n}\n\nexport { MemoryUseIndicator };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport IAnalytics from \"@foxglove/studio-base/services/IAnalytics\";\n\nexport default class NullAnalytics implements IAnalytics {\n  public logEvent(): void | Promise<void> {}\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport IAnalytics from \"@foxglove/studio-base/services/IAnalytics\";\nimport NullAnalytics from \"@foxglove/studio-base/services/NullAnalytics\";\n\nconst AnalyticsContext = createContext<IAnalytics>(new NullAnalytics());\nAnalyticsContext.displayName = \"AnalyticsContext\";\n\nexport function useAnalytics(): IAnalytics {\n  return useContext(AnalyticsContext);\n}\n\n// ts-prune-ignore-next\nexport default AnalyticsContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\ninterface IAppContext {\n  appBarLayoutButton?: JSX.Element;\n  syncAdapters?: readonly JSX.Element[];\n  createEvent?: (args: {\n    deviceId: string;\n    timestamp: string;\n    durationNanos: string;\n    metadata: Record<string, string>;\n  }) => Promise<void>;\n}\n\nconst AppContext = createContext<IAppContext>({});\nAppContext.displayName = \"AppContext\";\n\nexport function useAppContext(): IAppContext {\n  return useContext(AppContext);\n}\n\nexport { AppContext };\nexport type { IAppContext };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nenum AppEvent {\n  APP_INIT = \"Studio: App Initialized\",\n\n  // Dialog events\n  DIALOG_SELECT_VIEW = \"Studio: Dialog View Selected\",\n  DIALOG_CLOSE = \"Studio: Dialog Closed\",\n  DIALOG_CLICK_CTA = \"Studio: Dialog CTA Clicked\",\n\n  // App Bar events\n  APP_BAR_CLICK_CTA = \"Studio: App Bar CTA CLicked\",\n\n  // Help Menu events\n  HELP_MENU_CLICK_CTA = \"Studio: Help Menu CTA Clicked\",\n\n  // Player events\n  PLAYER_CONSTRUCTED = \"Studio: Player Constructed\",\n  PLAYER_PLAY = \"Studio: Player Played\",\n  PLAYER_SEEK = \"Studio: Player Seeked\",\n  PLAYER_SET_SPEED = \"Studio: Player Speed Set\",\n  PLAYER_PAUSE = \"Studio: Player Paused\",\n  PLAYER_CLOSE = \"Studio: Player Closed\",\n\n  // Layout events\n  LAYOUT_UPDATE = \"Studio: Layout Updated\",\n  LAYOUT_CREATE = \"Studio: Layout Created\",\n  LAYOUT_DUPLICATE = \"Studio: Layout Duplicated\",\n  LAYOUT_RENAME = \"Studio: Layout Renamed\",\n  LAYOUT_DELETE = \"Studio: Layout Deleted\",\n  LAYOUT_SELECT = \"Studio: Layout Selected\",\n  LAYOUT_IMPORT = \"Studio: Layout Imported\",\n  LAYOUT_EXPORT = \"Studio: Layout Exported\",\n  LAYOUT_SHARE = \"Studio: Layout Shared\",\n  LAYOUT_OVERWRITE = \"Studio: Layout Overwritten\",\n  LAYOUT_REVERT = \"Studio: Layout Reverted\",\n  LAYOUT_MAKE_PERSONAL_COPY = \"Studio: Layout Personal Copy Made\",\n\n  // Panel events\n  PANEL_ADD = \"Studio: Panel Added\",\n  PANEL_DELETE = \"Studio: Panel Deleted\",\n\n  // Variable events\n  VARIABLE_ADD = \"Studio: Variable Added\",\n  VARIABLE_DELETE = \"Studio: Variable Deleted\",\n\n  // Extension events\n  EXTENSION_INSTALL = \"Studio: Extension Installed\",\n  EXTENSION_UNINSTALL = \"Studio: Extension Uninstalled\",\n\n  // Experimental features\n  EXPERIMENTAL_FEATURE_TOGGLE = \"Studio: Experimental Feature Toggled\",\n}\n\ninterface IAnalytics {\n  logEvent(event: AppEvent, data?: { [key: string]: unknown }): void | Promise<void>;\n}\n\nexport { AppEvent };\nexport default IAnalytics;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useCallback } from \"react\";\n\nimport { PanelSelection } from \"@foxglove/studio-base/components/PanelList\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { getPanelIdForType } from \"@foxglove/studio-base/util/layout\";\n\nexport default function useAddPanel(): (selection: PanelSelection) => void {\n  const { addPanel } = useCurrentLayoutActions();\n  return useCallback(\n    ({ type, config, relatedConfigs }: PanelSelection) => {\n      const id = getPanelIdForType(type);\n      addPanel({ id, config, relatedConfigs });\n    },\n    [addPanel],\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Menu, PopoverPosition, PopoverReference } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport PanelList from \"@foxglove/studio-base/components/PanelList\";\nimport useAddPanel from \"@foxglove/studio-base/hooks/useAddPanel\";\n\nconst useStyles = makeStyles()({\n  menuList: {\n    minWidth: 270,\n  },\n});\n\ntype AddPanelProps = {\n  anchorEl?: HTMLElement;\n  anchorPosition?: PopoverPosition;\n  anchorReference?: PopoverReference;\n  disablePortal?: boolean;\n  handleClose: () => void;\n  open: boolean;\n};\n\nexport function AddPanelMenu(props: AddPanelProps): JSX.Element {\n  const { classes } = useStyles();\n  const { anchorEl, anchorPosition, anchorReference, disablePortal, handleClose, open } = props;\n  const addPanel = useAddPanel();\n\n  return (\n    <Menu\n      id=\"add-panel-menu\"\n      anchorEl={anchorEl}\n      anchorPosition={anchorPosition}\n      anchorReference={anchorReference}\n      disablePortal={disablePortal}\n      open={open}\n      onClose={handleClose}\n      MenuListProps={{\n        disablePadding: true,\n        \"aria-labelledby\": \"add-panel-button\",\n        className: classes.menuList,\n      }}\n      anchorOrigin={{\n        horizontal: \"left\",\n        vertical: \"bottom\",\n      }}\n      transformOrigin={{\n        vertical: \"top\",\n        horizontal: \"left\",\n      }}\n    >\n      <PanelList\n        // Close when a drag starts so the modal menu doesn't block the drop targets\n        onDragStart={handleClose}\n        onPanelSelect={(selection) => {\n          addPanel(selection);\n          handleClose();\n        }}\n      />\n    </Menu>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Box, Dialog, DialogTitle, IconButton, Typography, useTheme } from \"@mui/material\";\nimport { useMemo } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { NotificationMessage } from \"@foxglove/studio-base/util/sendNotification\";\n\nconst useStyles = makeStyles()((theme) => ({\n  container: {\n    alignItems: \"stretch\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    maxHeight: \"50vw\",\n    marginBlockEnd: theme.spacing(3),\n    marginInline: theme.spacing(3),\n  },\n  paper: { maxWidth: \"700px\", width: \"70%\" },\n  text: {\n    backgroundColor: theme.palette.background.default,\n    color: theme.palette.text.primary,\n    fontSize: theme.typography.body1.fontSize,\n    flex: 1,\n    padding: theme.spacing(1),\n    overflowY: \"auto\",\n    whiteSpace: \"pre-wrap\",\n  },\n}));\n\nexport default function NotificationModal({\n  notification: { details, message, severity, subText },\n  onRequestClose,\n}: {\n  notification: NotificationMessage;\n  onRequestClose?: () => void;\n}): React.ReactElement {\n  const theme = useTheme();\n  const { classes } = useStyles();\n\n  const displayPropsBySeverity = {\n    error: theme.palette.error.main,\n    warn: theme.palette.warning.main,\n    info: theme.palette.info.main,\n  };\n\n  const detailsElement = useMemo(() => {\n    if (details instanceof Error) {\n      return <Box className={classes.text}>{details.stack}</Box>;\n    } else if (details != undefined && details !== \"\") {\n      return (\n        <Typography style={{ whiteSpace: \"pre-line\" /* allow newlines in the details message */ }}>\n          {details}\n        </Typography>\n      );\n    } else if (subText) {\n      return undefined;\n    }\n\n    return \"No details provided\";\n  }, [classes, details, subText]);\n\n  return (\n    <Dialog classes={{ paper: classes.paper }} fullWidth open onClose={() => onRequestClose?.()}>\n      <DialogTitle color={displayPropsBySeverity[severity]}>{message}</DialogTitle>\n      <Box className={classes.container}>\n        {subText && <Typography mb={3}>{subText}</Typography>}\n        {detailsElement}\n      </Box>\n      <IconButton\n        aria-label=\"close\"\n        onClick={() => onRequestClose?.()}\n        style={{\n          position: \"absolute\",\n          right: 8,\n          top: 8,\n        }}\n      >\n        <CloseIcon />\n      </IconButton>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ErrorOutlineOutlinedIcon from \"@mui/icons-material/ErrorOutlineOutlined\";\nimport InfoOutlinedIcon from \"@mui/icons-material/InfoOutlined\";\nimport WarningIcon from \"@mui/icons-material/WarningAmber\";\nimport { List, ListItem, ListItemButton, ListItemText, Typography } from \"@mui/material\";\nimport { useCallback, useState } from \"react\";\n\nimport NotificationModal from \"@foxglove/studio-base/components/NotificationModal\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { PlayerProblem } from \"@foxglove/studio-base/players/types\";\n\nexport function ProblemsList({\n  problems,\n  setProblemModal,\n}: {\n  problems: PlayerProblem[];\n  setProblemModal?: (_: JSX.Element | undefined) => void;\n}): JSX.Element {\n  const [localProblemModal, setLocalProblemModal] = useState<JSX.Element | undefined>();\n\n  const showProblemModal = useCallback(\n    (problem: PlayerProblem) => {\n      const modal = (\n        <NotificationModal\n          notification={{\n            message: problem.message,\n            subText: problem.tip,\n            details: problem.error,\n            severity: problem.severity,\n          }}\n          onRequestClose={() => (setProblemModal ?? setLocalProblemModal)(undefined)}\n        />\n      );\n\n      (setProblemModal ?? setLocalProblemModal)(modal);\n    },\n    [setProblemModal],\n  );\n\n  if (problems.length === 0) {\n    return (\n      <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n        <Typography align=\"center\" color=\"text.secondary\">\n          No problems found\n        </Typography>\n      </Stack>\n    );\n  }\n\n  return (\n    <Stack fullHeight flex=\"auto\" overflow=\"auto\">\n      {localProblemModal}\n      <List dense disablePadding>\n        {problems.map((problem, idx) => (\n          <ListItem disablePadding key={`${idx}`}>\n            <ListItemButton onClick={() => showProblemModal(problem)}>\n              <Stack direction=\"row\" gap={0.5} alignItems=\"center\">\n                {problem.severity === \"warn\" && <WarningIcon fontSize=\"small\" color=\"warning\" />}\n                {problem.severity === \"error\" && (\n                  <ErrorOutlineOutlinedIcon fontSize=\"small\" color=\"error\" />\n                )}\n                {problem.severity === \"info\" && <InfoOutlinedIcon fontSize=\"small\" color=\"info\" />}\n                <ListItemText primary={problem.message} />\n              </Stack>\n            </ListItemButton>\n          </ListItem>\n        ))}\n      </List>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { CSSProperties } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst DEFAULT_END_TEXT_LENGTH = 16;\n\nconst useStyles = makeStyles()(() => ({\n  root: {\n    display: \"flex\",\n    justifyContent: \"flex-start\",\n    overflow: \"hidden\",\n  },\n  start: {\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n    whiteSpace: \"nowrap\",\n    flexShrink: 1,\n  },\n  end: {\n    whiteSpace: \"nowrap\",\n    flexBasis: \"content\",\n    flexGrow: 0,\n    flexShrink: 0,\n    maxWidth: \"100%\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n  },\n}));\n\ntype Props = {\n  text: string;\n  endTextLength?: number;\n  className?: string;\n  style?: CSSProperties;\n};\n\nexport default function TextMiddleTruncate({\n  text,\n  endTextLength,\n  className,\n  style,\n}: Props): JSX.Element {\n  const { classes, cx } = useStyles();\n  let startTextLen = Math.max(\n    0,\n    text.length -\n      (endTextLength == undefined || endTextLength === 0 ? DEFAULT_END_TEXT_LENGTH : endTextLength),\n  );\n  // Don't split at or immediately after whitespace.\n  while (startTextLen < text.length && text.charAt(startTextLen).match(/\\s/)) {\n    startTextLen += 2;\n  }\n  const startText = text.substring(0, startTextLen);\n  const endText = text.substring(startTextLen);\n\n  if (!startText) {\n    return (\n      <div className={cx(classes.end, className)} style={style}>\n        {endText}\n      </div>\n    );\n  }\n\n  return (\n    <div\n      data-testid=\"text-middle-truncate\"\n      className={cx(className, classes.root)}\n      title={text}\n      style={style}\n    >\n      <div className={classes.start}>{startText}</div>\n      <div className={classes.end}>{endText}</div>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ErrorCircle20Filled, Open16Filled } from \"@fluentui/react-icons\";\nimport { ButtonBase, CircularProgress, IconButton, Tooltip } from \"@mui/material\";\nimport { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport tc from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport {\n  APP_BAR_PRIMARY_COLOR,\n  APP_BAR_FOREGROUND_COLOR,\n} from \"@foxglove/studio-base/components/AppBar/constants\";\nimport { ProblemsList } from \"@foxglove/studio-base/components/DataSourceSidebar/ProblemsList\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextMiddleTruncate from \"@foxglove/studio-base/components/TextMiddleTruncate\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\n\nconst LEFT_ICON_SIZE = 19;\n\nconst useStyles = makeStyles<void, \"adornmentError\" | \"openIcon\">()((theme, _params, classes) => ({\n  button: {\n    font: \"inherit\",\n    fontSize: theme.typography.body2.fontSize,\n    display: \"flex\",\n    alignItems: \"center\",\n    gap: theme.spacing(0.75),\n    padding: theme.spacing(1.5),\n    whiteSpace: \"nowrap\",\n    minWidth: 0,\n\n    \":not(:hover)\": {\n      color: tc(APP_BAR_FOREGROUND_COLOR).setAlpha(0.8).toString(),\n\n      [`.${classes.openIcon}`]: {\n        visibility: \"hidden\",\n      },\n    },\n    \"&.Mui-disabled\": {\n      color: tc(APP_BAR_FOREGROUND_COLOR).setAlpha(theme.palette.action.disabledOpacity).toString(),\n    },\n  },\n  adornment: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    position: \"relative\",\n    color: APP_BAR_PRIMARY_COLOR,\n    width: LEFT_ICON_SIZE,\n    height: LEFT_ICON_SIZE,\n  },\n  adornmentError: {\n    color: theme.palette.error.main,\n  },\n  spinner: {\n    position: \"absolute\",\n    top: 0,\n    right: 0,\n    left: 0,\n    bottom: 0,\n    margin: \"auto\",\n  },\n  textTruncate: {\n    maxWidth: \"30vw\",\n    overflow: \"hidden\",\n  },\n  openIcon: {\n    opacity: 0.6,\n    flex: \"none\",\n  },\n  iconButton: {\n    padding: 0,\n\n    \"svg:not(.MuiSvgIcon-root)\": {\n      fontSize: \"1em\",\n    },\n  },\n  errorIconButton: {\n    position: \"relative\",\n    zIndex: 1,\n    fontSize: LEFT_ICON_SIZE - 1,\n  },\n  tooltip: {\n    padding: 0,\n  },\n}));\n\nconst selectPlayerName = ({ playerState }: MessagePipelineContext) => playerState.name;\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectPlayerProblems = ({ playerState }: MessagePipelineContext) => playerState.problems;\n\nexport function DataSource({\n  onSelectDataSourceAction,\n}: {\n  onSelectDataSourceAction: () => void;\n}): JSX.Element {\n  const { t } = useTranslation(\"appBar\");\n  const { classes, cx } = useStyles();\n\n  const playerName = useMessagePipeline(selectPlayerName);\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const playerProblems = useMessagePipeline(selectPlayerProblems) ?? [];\n\n  const reconnecting = playerPresence === PlayerPresence.RECONNECTING;\n  const initializing = playerPresence === PlayerPresence.INITIALIZING;\n  const error =\n    playerPresence === PlayerPresence.ERROR ||\n    playerProblems.some((problem) => problem.severity === \"error\");\n  const loading = reconnecting || initializing;\n\n  const playerDisplayName =\n    initializing && playerName == undefined ? \"Initializing...\" : playerName;\n\n  const [problemModal, setProblemModal] = useState<JSX.Element | undefined>(undefined);\n\n  if (playerPresence === PlayerPresence.NOT_PRESENT) {\n    return (\n      <ButtonBase className={classes.button} color=\"inherit\" onClick={onSelectDataSourceAction}>\n        {t(\"openDataSource\")}\n      </ButtonBase>\n    );\n  }\n\n  return (\n    <>\n      {problemModal}\n      <Stack direction=\"row\" alignItems=\"center\">\n        <ButtonBase className={classes.button} onClick={onSelectDataSourceAction}>\n          <div className={cx(classes.adornment, { [classes.adornmentError]: error })}>\n            {loading && (\n              <CircularProgress\n                size={LEFT_ICON_SIZE}\n                color=\"inherit\"\n                className={classes.spinner}\n                variant=\"indeterminate\"\n              />\n            )}\n            {error && (\n              <Tooltip\n                arrow={false}\n                disableHoverListener={initializing}\n                disableFocusListener={initializing}\n                classes={{ tooltip: classes.tooltip }}\n                placement=\"bottom\"\n                title={<ProblemsList problems={playerProblems} setProblemModal={setProblemModal} />}\n              >\n                <IconButton\n                  color=\"inherit\"\n                  className={cx(classes.iconButton, classes.errorIconButton)}\n                >\n                  <ErrorCircle20Filled />\n                </IconButton>\n              </Tooltip>\n            )}\n          </div>\n          <div className={classes.textTruncate}>\n            <TextMiddleTruncate text={playerDisplayName ?? \"<unknown>\"} />\n          </div>\n          <Open16Filled className={classes.openIcon} />\n        </ButtonBase>\n      </Stack>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Divider, Menu, MenuItem, PopoverPosition, PopoverReference } from \"@mui/material\";\nimport { useSnackbar } from \"notistack\";\nimport { useCallback } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Logger from \"@foxglove/log\";\nimport { PreferencesDialogTab } from \"@foxglove/studio-base/components/PreferencesDialog/PreferencesDialog\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  useCurrentUser,\n  useCurrentUserType,\n} from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport { useConfirm } from \"@foxglove/studio-base/hooks/useConfirm\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst log = Logger.getLogger(__filename);\n\nconst useStyles = makeStyles()({\n  menuList: {\n    minWidth: 200,\n  },\n});\n\ntype UserMenuProps = {\n  handleClose: () => void;\n  anchorEl?: HTMLElement;\n  anchorReference?: PopoverReference;\n  anchorPosition?: PopoverPosition;\n  disablePortal?: boolean;\n  open: boolean;\n};\n\nexport function UserMenu({\n  anchorEl,\n  anchorReference,\n  anchorPosition,\n  disablePortal,\n  handleClose,\n  open,\n}: UserMenuProps): JSX.Element {\n  const { classes } = useStyles();\n  const { currentUser, signIn, signOut } = useCurrentUser();\n  const currentUserType = useCurrentUserType();\n  const analytics = useAnalytics();\n  const { enqueueSnackbar } = useSnackbar();\n  const [confirm, confirmModal] = useConfirm();\n\n  const { prefsDialogActions } = useWorkspaceActions();\n\n  const beginSignOut = useCallback(async () => {\n    try {\n      await signOut?.();\n    } catch (error) {\n      log.error(error);\n      enqueueSnackbar((error as Error).toString(), { variant: \"error\" });\n    }\n  }, [enqueueSnackbar, signOut]);\n\n  const onSignoutClick = useCallback(() => {\n    void confirm({\n      title: \"Are you sure you want to sign out?\",\n      ok: \"Sign out\",\n    }).then((response) => {\n      if (response === \"ok\") {\n        void beginSignOut();\n      }\n    });\n  }, [beginSignOut, confirm]);\n\n  const onSignInClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"sign-in\",\n    });\n    signIn?.();\n  }, [analytics, currentUserType, signIn]);\n\n  const onPreferencesClick = useCallback(\n    (tab?: PreferencesDialogTab) => {\n      void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n        user: currentUserType,\n        cta: \"preferences-dialog\",\n      });\n      prefsDialogActions.open(tab);\n    },\n    [analytics, currentUserType, prefsDialogActions],\n  );\n\n  const onProfileClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"profile\",\n    });\n    window.open(process.env.FOXGLOVE_ACCOUNT_PROFILE_URL, \"_blank\");\n  }, [analytics, currentUserType]);\n\n  const onDocsClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"docs\",\n    });\n    window.open(\"https://foxglove.dev/docs\", \"_blank\");\n  }, [analytics, currentUserType]);\n\n  const onSlackClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"join-slack\",\n    });\n    window.open(\"https://foxglove.dev/slack\", \"_blank\");\n  }, [analytics, currentUserType]);\n\n  return (\n    <>\n      <Menu\n        anchorEl={anchorEl}\n        anchorReference={anchorReference}\n        anchorPosition={anchorPosition}\n        disablePortal={disablePortal}\n        id=\"account-menu\"\n        open={open}\n        onClose={handleClose}\n        onClick={handleClose}\n        MenuListProps={{ className: classes.menuList, dense: true }}\n      >\n        {currentUser && <MenuItem disabled>{currentUser.email}</MenuItem>}\n        <MenuItem onClick={() => onPreferencesClick()}>Settings</MenuItem>\n        <MenuItem onClick={() => onPreferencesClick(\"extensions\")}>Extensions</MenuItem>\n        {currentUser && <MenuItem onClick={onProfileClick}>User profile</MenuItem>}\n        <Divider variant=\"middle\" />\n        <MenuItem onClick={onDocsClick}>Documentation</MenuItem>\n        <MenuItem onClick={onSlackClick}>Join Slack community</MenuItem>\n        {signIn != undefined && <Divider variant=\"middle\" />}\n        {currentUser ? (\n          <MenuItem onClick={onSignoutClick}>Sign out</MenuItem>\n        ) : signIn != undefined ? (\n          <MenuItem onClick={onSignInClick}>Sign in</MenuItem>\n        ) : undefined}\n      </Menu>\n      {confirmModal}\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  SlideAdd24Regular,\n  PanelLeft24Filled,\n  PanelLeft24Regular,\n  PanelRight24Filled,\n  PanelRight24Regular,\n} from \"@fluentui/react-icons\";\nimport PersonIcon from \"@mui/icons-material/Person\";\nimport { Avatar, Button, IconButton, Tooltip, AppBar as MuiAppBar } from \"@mui/material\";\nimport { useCallback, useState } from \"react\";\nimport tc from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { shallow } from \"zustand/shallow\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { AppBarIconButton } from \"@foxglove/studio-base/components/AppBar/AppBarIconButton\";\nimport {\n  CustomWindowControls,\n  CustomWindowControlsProps,\n} from \"@foxglove/studio-base/components/AppBar/CustomWindowControls\";\nimport { FoxgloveLogo } from \"@foxglove/studio-base/components/FoxgloveLogo\";\nimport { MemoryUseIndicator } from \"@foxglove/studio-base/components/MemoryUseIndicator\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport {\n  useWorkspaceActions,\n  useWorkspaceStore,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nimport { AddPanelMenu } from \"./AddPanelMenu\";\nimport { DataSource } from \"./DataSource\";\nimport { UserMenu } from \"./UserMenu\";\nimport {\n  APP_BAR_BACKGROUND_COLOR,\n  APP_BAR_FOREGROUND_COLOR,\n  APP_BAR_HEIGHT,\n  APP_BAR_PRIMARY_COLOR,\n} from \"./constants\";\n\nconst useStyles = makeStyles<{ leftInset?: number; debugDragRegion?: boolean }, \"avatar\">()(\n  (theme, { leftInset, debugDragRegion = false }, classes) => {\n    const DRAGGABLE_STYLE: Record<string, string> = { WebkitAppRegion: \"drag\" };\n    const NOT_DRAGGABLE_STYLE: Record<string, string> = { WebkitAppRegion: \"no-drag\" };\n    if (debugDragRegion) {\n      DRAGGABLE_STYLE.backgroundColor = \"green\";\n      NOT_DRAGGABLE_STYLE.backgroundColor = \"red\";\n    }\n    return {\n      appBar: {\n        gridArea: \"appbar\",\n        boxShadow: \"none\",\n        backgroundColor: APP_BAR_BACKGROUND_COLOR[theme.palette.mode],\n        borderBottom: \"none\",\n        color: APP_BAR_FOREGROUND_COLOR,\n        height: APP_BAR_HEIGHT,\n\n        // Leave space for system window controls on the right on Windows.\n        // Use hard-coded padding for Mac because it looks better than env(titlebar-area-x).\n        paddingLeft: leftInset,\n        paddingRight: \"calc(100% - env(titlebar-area-x) - env(titlebar-area-width))\",\n        ...DRAGGABLE_STYLE, // make custom window title bar draggable for desktop app\n      },\n      toolbar: {\n        display: \"grid\",\n        width: \"100%\",\n        gridTemplateAreas: `\"start middle end\"`,\n        gridTemplateColumns: \"1fr auto 1fr\",\n        alignItems: \"center\",\n      },\n      logo: {\n        padding: theme.spacing(0.5),\n        fontSize: \"2.125rem\",\n        color: APP_BAR_PRIMARY_COLOR,\n      },\n      start: {\n        gridArea: \"start\",\n        display: \"flex\",\n        flex: 1,\n        alignItems: \"center\",\n      },\n      startInner: {\n        display: \"flex\",\n        alignItems: \"center\",\n        ...NOT_DRAGGABLE_STYLE, // make buttons clickable for desktop app\n      },\n      middle: {\n        gridArea: \"middle\",\n        justifySelf: \"center\",\n        overflow: \"hidden\",\n        maxWidth: \"100%\",\n        ...NOT_DRAGGABLE_STYLE, // make buttons clickable for desktop app\n      },\n      end: {\n        gridArea: \"end\",\n        flex: 1,\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n      },\n      endInner: {\n        display: \"flex\",\n        alignItems: \"center\",\n        ...NOT_DRAGGABLE_STYLE, // make buttons clickable for desktop app\n      },\n      keyEquivalent: {\n        fontFamily: fonts.MONOSPACE,\n        background: tc(APP_BAR_FOREGROUND_COLOR).darken(45).toString(),\n        padding: theme.spacing(0, 0.5),\n        aspectRatio: 1,\n        borderRadius: theme.shape.borderRadius,\n        marginLeft: theme.spacing(1),\n      },\n      tooltip: {\n        marginTop: `${theme.spacing(0.5)} !important`,\n      },\n      avatar: {\n        color: APP_BAR_FOREGROUND_COLOR,\n        backgroundColor: tc(APP_BAR_BACKGROUND_COLOR[theme.palette.mode]).lighten().toString(),\n        height: theme.spacing(3.5),\n        width: theme.spacing(3.5),\n        transition: theme.transitions.create(\"background-color\", {\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n      iconButton: {\n        padding: theme.spacing(1),\n        borderRadius: 0,\n        transition: theme.transitions.create(\"background-color\", {\n          duration: theme.transitions.duration.shortest,\n        }),\n        \"&:hover\": {\n          backgroundColor: tc(APP_BAR_FOREGROUND_COLOR).setAlpha(0.08).toString(),\n\n          [`.${classes.avatar}`]: {\n            backgroundColor: tc(APP_BAR_BACKGROUND_COLOR[theme.palette.mode])\n              .lighten(20)\n              .toString(),\n          },\n        },\n        \"&.Mui-selected\": {\n          backgroundColor: tc(APP_BAR_FOREGROUND_COLOR).setAlpha(0.08).toString(),\n\n          [`.${classes.avatar}`]: {\n            backgroundColor: APP_BAR_PRIMARY_COLOR,\n          },\n        },\n      },\n      userIconImage: {\n        objectFit: \"cover\",\n        width: \"100%\",\n      },\n      button: {\n        marginInline: theme.spacing(1),\n        backgroundColor: APP_BAR_PRIMARY_COLOR,\n\n        \"&:hover\": {\n          backgroundColor: theme.palette.augmentColor({ color: { main: APP_BAR_PRIMARY_COLOR } })\n            .dark,\n        },\n      },\n    };\n  },\n);\n\ntype AppBarProps = CustomWindowControlsProps & {\n  leftInset?: number;\n  onDoubleClick?: () => void;\n  debugDragRegion?: boolean;\n  disableSignIn?: boolean;\n  onSelectDataSourceAction: () => void;\n};\n\nconst selectCurrentLayoutId = ({ selectedLayout }: LayoutState) => selectedLayout?.id;\nconst selectWorkspace = (store: WorkspaceContextStore) => store;\n\nexport function AppBar(props: AppBarProps): JSX.Element {\n  const {\n    debugDragRegion,\n    disableSignIn = false,\n    isMaximized,\n    leftInset,\n    onCloseWindow,\n    onDoubleClick,\n    onMaximizeWindow,\n    onMinimizeWindow,\n    onSelectDataSourceAction,\n    onUnmaximizeWindow,\n    showCustomWindowControls = false,\n  } = props;\n  const { classes, cx } = useStyles({ leftInset, debugDragRegion });\n  const { currentUser, signIn } = useCurrentUser();\n\n  const { appBarLayoutButton } = useAppContext();\n\n  const analytics = useAnalytics();\n  const [enableMemoryUseIndicator = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_MEMORY_USE_INDICATOR,\n  );\n\n  const currentLayoutId = useCurrentLayoutSelector(selectCurrentLayoutId);\n\n  const { leftSidebarOpen, rightSidebarOpen } = useWorkspaceStore(selectWorkspace, shallow);\n  const { setRightSidebarOpen, setLeftSidebarOpen } = useWorkspaceActions();\n\n  const [userAnchorEl, setUserAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const [panelAnchorEl, setPanelAnchorEl] = useState<undefined | HTMLElement>(undefined);\n\n  const userMenuOpen = Boolean(userAnchorEl);\n  const panelMenuOpen = Boolean(panelAnchorEl);\n\n  const handleDoubleClick = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      event.preventDefault();\n      onDoubleClick?.();\n    },\n    [onDoubleClick],\n  );\n\n  return (\n    <>\n      <MuiAppBar\n        className={classes.appBar}\n        position=\"relative\"\n        color=\"inherit\"\n        elevation={0}\n        onDoubleClick={handleDoubleClick}\n      >\n        <div className={classes.toolbar}>\n          <div className={classes.start}>\n            <div className={classes.startInner}>\n              <IconButton className={classes.logo} size=\"large\" color=\"inherit\">\n                <FoxgloveLogo fontSize=\"inherit\" color=\"inherit\" />\n              </IconButton>\n              <AppBarIconButton\n                className={cx({ \"Mui-selected\": panelMenuOpen })}\n                color=\"inherit\"\n                disabled={currentLayoutId == undefined}\n                id=\"add-panel-button\"\n                title=\"Add panel\"\n                aria-label=\"Add panel button\"\n                aria-controls={panelMenuOpen ? \"add-panel-menu\" : undefined}\n                aria-haspopup=\"true\"\n                aria-expanded={panelMenuOpen ? \"true\" : undefined}\n                onClick={(event) => {\n                  setPanelAnchorEl(event.currentTarget);\n                }}\n              >\n                <SlideAdd24Regular />\n              </AppBarIconButton>\n            </div>\n          </div>\n\n          <div className={classes.middle}>\n            <DataSource onSelectDataSourceAction={onSelectDataSourceAction} />\n          </div>\n\n          <div className={classes.end}>\n            <div className={classes.endInner}>\n              {enableMemoryUseIndicator && <MemoryUseIndicator />}\n              {appBarLayoutButton}\n              <Stack direction=\"row\" alignItems=\"center\">\n                <AppBarIconButton\n                  title={\n                    <>\n                      {leftSidebarOpen ? \"Hide\" : \"Show\"} left sidebar{\" \"}\n                      <kbd className={classes.keyEquivalent}>[</kbd>\n                    </>\n                  }\n                  aria-label={`${leftSidebarOpen ? \"Hide\" : \"Show\"} left sidebar`}\n                  onClick={() => setLeftSidebarOpen(!leftSidebarOpen)}\n                >\n                  {leftSidebarOpen ? <PanelLeft24Filled /> : <PanelLeft24Regular />}\n                </AppBarIconButton>\n                <AppBarIconButton\n                  title={\n                    <>\n                      {rightSidebarOpen ? \"Hide\" : \"Show\"} right sidebar{\" \"}\n                      <kbd className={classes.keyEquivalent}>]</kbd>\n                    </>\n                  }\n                  aria-label={`${rightSidebarOpen ? \"Hide\" : \"Show\"} right sidebar`}\n                  onClick={() => setRightSidebarOpen(!rightSidebarOpen)}\n                >\n                  {rightSidebarOpen ? <PanelRight24Filled /> : <PanelRight24Regular />}\n                </AppBarIconButton>\n              </Stack>\n              {!disableSignIn && !currentUser && signIn != undefined && (\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  className={classes.button}\n                  size=\"small\"\n                  onClick={() => {\n                    signIn();\n                    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n                      user: \"unauthenticated\",\n                      cta: \"sign-in\",\n                    });\n                  }}\n                >\n                  Sign in\n                </Button>\n              )}\n              <Tooltip\n                classes={{ tooltip: classes.tooltip }}\n                title={currentUser?.email ?? \"Profile\"}\n                arrow={false}\n              >\n                <IconButton\n                  className={cx(classes.iconButton, { \"Mui-selected\": userMenuOpen })}\n                  aria-label=\"User profile menu button\"\n                  color=\"inherit\"\n                  id=\"user-profile-button\"\n                  aria-controls={userMenuOpen ? \"user-profile-menu\" : undefined}\n                  aria-haspopup=\"true\"\n                  aria-expanded={userMenuOpen ? \"true\" : undefined}\n                  onClick={(event) => setUserAnchorEl(event.currentTarget)}\n                  data-testid=\"user-button\"\n                >\n                  <Avatar className={classes.avatar} variant=\"rounded\">\n                    {currentUser?.avatarImageUrl ? (\n                      <img\n                        src={currentUser.avatarImageUrl}\n                        referrerPolicy=\"same-origin\"\n                        className={classes.userIconImage}\n                      />\n                    ) : (\n                      <PersonIcon />\n                    )}\n                  </Avatar>\n                </IconButton>\n              </Tooltip>\n              {showCustomWindowControls && (\n                <CustomWindowControls\n                  onMinimizeWindow={onMinimizeWindow}\n                  isMaximized={isMaximized}\n                  onUnmaximizeWindow={onUnmaximizeWindow}\n                  onMaximizeWindow={onMaximizeWindow}\n                  onCloseWindow={onCloseWindow}\n                />\n              )}\n            </div>\n          </div>\n        </div>\n      </MuiAppBar>\n      <AddPanelMenu\n        anchorEl={panelAnchorEl}\n        open={panelMenuOpen}\n        handleClose={() => setPanelAnchorEl(undefined)}\n      />\n      <UserMenu\n        anchorEl={userAnchorEl}\n        open={userMenuOpen}\n        handleClose={() => setUserAnchorEl(undefined)}\n      />\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { escapeRegExp } from \"lodash\";\n\n/**\n * Renders the given text with the span matching highlight wrapped in a\n * <mark> component.\n */\nexport function HighlightedText({\n  text,\n  highlight,\n}: {\n  text: string;\n  highlight?: string;\n}): JSX.Element {\n  if (highlight == undefined || !highlight.trim()) {\n    return <span>{text}</span>;\n  }\n  const regex = new RegExp(`(${escapeRegExp(highlight)})`, \"gi\");\n  const parts = text.split(regex);\n  return (\n    <span>\n      {parts\n        .filter((part) => part)\n        .map((part, i) =>\n          regex.test(part) ? <mark key={i}>{part}</mark> : <span key={i}>{part}</span>,\n        )}\n    </span>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { alpha } from \"@mui/material\";\nimport { compact } from \"lodash\";\nimport { Fragment } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { HighlightedText } from \"@foxglove/studio-base/components/HighlightedText\";\nimport {\n  TimelinePositionedEvent,\n  DataSourceEvent,\n} from \"@foxglove/studio-base/context/EventsContext\";\n\nconst useStyles = makeStyles<void, \"eventMetadata\" | \"eventSelected\">()(\n  (theme, _params, classes) => ({\n    spacer: {\n      cursor: \"default\",\n      height: theme.spacing(1),\n      gridColumn: \"span 2\",\n    },\n    event: {\n      display: \"contents\",\n      cursor: \"pointer\",\n      \"&:hover\": {\n        [`.${classes.eventMetadata}`]: {\n          backgroundColor: alpha(theme.palette.info.main, theme.palette.action.hoverOpacity),\n          borderColor: theme.palette.info.main,\n        },\n      },\n    },\n    eventSelected: {\n      [`.${classes.eventMetadata}`]: {\n        backgroundColor: alpha(theme.palette.info.main, theme.palette.action.activatedOpacity),\n        borderColor: theme.palette.info.main,\n        boxShadow: `0 0 0 1px ${theme.palette.info.main}`,\n      },\n    },\n    eventHovered: {\n      [`.${classes.eventMetadata}`]: {\n        backgroundColor: alpha(theme.palette.info.main, theme.palette.action.hoverOpacity),\n        borderColor: theme.palette.info.main,\n      },\n    },\n    eventMetadata: {\n      padding: theme.spacing(1),\n      backgroundColor: theme.palette.background.default,\n      borderRight: `1px solid ${theme.palette.divider}`,\n      borderBottom: `1px solid ${theme.palette.divider}`,\n\n      \"&:nth-of-type(odd)\": {\n        borderLeft: `1px solid ${theme.palette.divider}`,\n      },\n      \"&:first-of-type\": {\n        borderTop: `1px solid ${theme.palette.divider}`,\n        borderTopLeftRadius: theme.shape.borderRadius,\n      },\n      \"&:nth-of-type(2)\": {\n        borderTop: `1px solid ${theme.palette.divider}`,\n        borderTopRightRadius: theme.shape.borderRadius,\n      },\n      \"&:nth-last-of-type(2)\": {\n        borderBottomRightRadius: theme.shape.borderRadius,\n      },\n      \"&:nth-last-of-type(3)\": {\n        borderBottomLeftRadius: theme.shape.borderRadius,\n      },\n    },\n  }),\n);\n\nfunction formatEventDuration(event: DataSourceEvent) {\n  if (event.durationNanos === \"0\") {\n    // instant\n    return \"-\";\n  }\n\n  if (!event.durationNanos) {\n    return \"\";\n  }\n\n  const intDuration = BigInt(event.durationNanos);\n\n  if (intDuration >= BigInt(1e9)) {\n    return `${Number(intDuration / BigInt(1e9))}s`;\n  }\n\n  if (intDuration >= BigInt(1e6)) {\n    return `${Number(intDuration / BigInt(1e6))}ms`;\n  }\n\n  if (intDuration >= BigInt(1e3)) {\n    return `${Number(intDuration / BigInt(1e3))}µs`;\n  }\n\n  return `${event.durationNanos}ns`;\n}\n\nfunction EventViewComponent(params: {\n  event: TimelinePositionedEvent;\n  filter: string;\n  formattedTime: string;\n  isHovered: boolean;\n  isSelected: boolean;\n  onClick: (event: TimelinePositionedEvent) => void;\n  onHoverStart: (event: TimelinePositionedEvent) => void;\n  onHoverEnd: (event: TimelinePositionedEvent) => void;\n}): JSX.Element {\n  const { event, filter, formattedTime, isHovered, isSelected, onClick, onHoverStart, onHoverEnd } =\n    params;\n  const { classes, cx } = useStyles();\n\n  const fields = compact([\n    [\"timestamp\", formattedTime],\n    Number(event.event.durationNanos) > 0 && [\"duration\", formatEventDuration(event.event)],\n    ...Object.entries(event.event.metadata),\n  ]);\n\n  return (\n    <div\n      data-testid=\"sidebar-event\"\n      className={cx(classes.event, {\n        [classes.eventSelected]: isSelected,\n        [classes.eventHovered]: isHovered,\n      })}\n      onClick={() => onClick(event)}\n      onMouseEnter={() => onHoverStart(event)}\n      onMouseLeave={() => onHoverEnd(event)}\n    >\n      {fields.map(([key, value]) => (\n        <Fragment key={key}>\n          <div className={classes.eventMetadata}>\n            <HighlightedText text={key ?? \"\"} highlight={filter} />\n          </div>\n          <div className={classes.eventMetadata}>\n            <HighlightedText text={value ?? \"\"} highlight={filter} />\n          </div>\n        </Fragment>\n      ))}\n      <div className={classes.spacer} />\n    </div>\n  );\n}\n\nexport const EventView = React.memo(EventViewComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport { AppBar, CircularProgress, IconButton, TextField, Typography } from \"@mui/material\";\nimport { useCallback, useMemo } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  EventsStore,\n  TimelinePositionedEvent,\n  useEvents,\n} from \"@foxglove/studio-base/context/EventsContext\";\nimport {\n  TimelineInteractionStateStore,\n  useTimelineInteractionState,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\n\nimport { EventView } from \"./EventView\";\n\nconst useStyles = makeStyles()((theme) => ({\n  appBar: {\n    top: -1,\n    zIndex: theme.zIndex.appBar - 1,\n    display: \"flex\",\n    flexDirection: \"row\",\n    padding: theme.spacing(1),\n    gap: theme.spacing(1),\n    alignItems: \"center\",\n    borderBottom: `1px solid ${theme.palette.divider}`,\n  },\n  grid: {\n    display: \"grid\",\n    flexShrink: 1,\n    gridTemplateColumns: \"auto 1fr\",\n    overflowY: \"auto\",\n    padding: theme.spacing(1),\n  },\n  root: {\n    backgroundColor: theme.palette.background.paper,\n    maxHeight: \"100%\",\n  },\n}));\n\nconst selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\nconst selectEventFilter = (store: EventsStore) => store.filter;\nconst selectSetEventFilter = (store: EventsStore) => store.setFilter;\nconst selectEvents = (store: EventsStore) => store.events;\nconst selectHoveredEvent = (store: TimelineInteractionStateStore) => store.hoveredEvent;\nconst selectSetHoveredEvent = (store: TimelineInteractionStateStore) => store.setHoveredEvent;\nconst selectEventsAtHoverValue = (store: TimelineInteractionStateStore) => store.eventsAtHoverValue;\nconst selectSelectedEventId = (store: EventsStore) => store.selectedEventId;\nconst selectSelectEvent = (store: EventsStore) => store.selectEvent;\n\nexport function EventsList(): JSX.Element {\n  const events = useEvents(selectEvents);\n  const selectedEventId = useEvents(selectSelectedEventId);\n  const selectEvent = useEvents(selectSelectEvent);\n  const { formatTime } = useAppTimeFormat();\n  const seek = useMessagePipeline(selectSeek);\n  const eventsAtHoverValue = useTimelineInteractionState(selectEventsAtHoverValue);\n  const hoveredEvent = useTimelineInteractionState(selectHoveredEvent);\n  const setHoveredEvent = useTimelineInteractionState(selectSetHoveredEvent);\n  const filter = useEvents(selectEventFilter);\n  const setFilter = useEvents(selectSetEventFilter);\n\n  const timestampedEvents = useMemo(\n    () =>\n      (events.value ?? []).map((event) => {\n        return { ...event, formattedTime: formatTime(event.event.startTime) };\n      }),\n    [events, formatTime],\n  );\n\n  const clearFilter = useCallback(() => {\n    setFilter(\"\");\n  }, [setFilter]);\n\n  const onClick = useCallback(\n    (event: TimelinePositionedEvent) => {\n      if (event.event.id === selectedEventId) {\n        selectEvent(undefined);\n      } else {\n        selectEvent(event.event.id);\n      }\n\n      if (seek) {\n        seek(event.event.startTime);\n      }\n    },\n    [seek, selectEvent, selectedEventId],\n  );\n\n  const onHoverEnd = useCallback(() => {\n    setHoveredEvent(undefined);\n  }, [setHoveredEvent]);\n\n  const onHoverStart = useCallback(\n    (event: TimelinePositionedEvent) => {\n      setHoveredEvent(event);\n    },\n    [setHoveredEvent],\n  );\n\n  const { classes } = useStyles();\n\n  return (\n    <Stack className={classes.root} fullHeight>\n      <AppBar className={classes.appBar} position=\"sticky\" color=\"inherit\" elevation={0}>\n        <TextField\n          variant=\"filled\"\n          fullWidth\n          value={filter}\n          onChange={(event) => setFilter(event.currentTarget.value)}\n          placeholder=\"Search by key, value, or key:value\"\n          InputProps={{\n            startAdornment: <SearchIcon fontSize=\"small\" />,\n            endAdornment: filter !== \"\" && (\n              <IconButton edge=\"end\" onClick={clearFilter} size=\"small\">\n                <ClearIcon fontSize=\"small\" />\n              </IconButton>\n            ),\n          }}\n        />\n      </AppBar>\n      {events.loading && (\n        <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n          <CircularProgress />\n        </Stack>\n      )}\n      {events.error && (\n        <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n          <Typography align=\"center\" color=\"error\">\n            Error loading events.\n          </Typography>\n        </Stack>\n      )}\n      {events.value && events.value.length === 0 && (\n        <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n          <Typography align=\"center\" color=\"text.secondary\">\n            No Events\n          </Typography>\n        </Stack>\n      )}\n      <div className={classes.grid}>\n        {timestampedEvents.map((event) => {\n          return (\n            <EventView\n              key={event.event.id}\n              event={event}\n              filter={filter}\n              formattedTime={event.formattedTime}\n              // When hovering within the event list only show hover state on directly\n              // hovered event.\n              isHovered={\n                hoveredEvent\n                  ? event.event.id === hoveredEvent.event.id\n                  : eventsAtHoverValue[event.event.id] != undefined\n              }\n              isSelected={event.event.id === selectedEventId}\n              onClick={onClick}\n              onHoverStart={onHoverStart}\n              onHoverEnd={onHoverEnd}\n            />\n          );\n        })}\n      </div>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Dialog, IconButton, Stack, Typography } from \"@mui/material\";\nimport { useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport WssErrorModalScreenshot from \"./WssErrorModal.png\";\n\nconst useStyles = makeStyles()({\n  image: {\n    maxWidth: \"24rem\",\n  },\n});\n\nexport default function WssErrorModal(props: { onClose?: () => void }): JSX.Element {\n  const [open, setOpen] = useState(true);\n  const { onClose } = props;\n\n  const { classes } = useStyles();\n\n  const handleClose = () => {\n    setOpen(false);\n    onClose?.();\n  };\n\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"flex-start\"\n        paddingX={3}\n        paddingTop={2}\n      >\n        <Typography variant=\"h3\" paddingTop={1}>\n          WebSocket SSL Error\n        </Typography>\n        <IconButton onClick={() => setOpen(false)} edge=\"end\">\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <Stack paddingX={3} paddingY={2} rowGap={2}>\n        <Typography variant=\"body1\" color=\"text.secondary\">\n          By default, Chrome prevents a secure <code>https://</code> page from connecting to an\n          insecure <code>ws://</code> WebSocket server. To allow the connection, enable &quot;Unsafe\n          Scripts&quot; for this page.\n        </Typography>\n        <Typography variant=\"body1\" color=\"text.secondary\">\n          Click the shield icon at the end of your address bar, and then click &quot;Load Unsafe\n          Scripts.&quot;\n        </Typography>\n        <img src={WssErrorModalScreenshot} alt=\"WSS screenshot\" className={classes.image} />\n      </Stack>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport {\n  IconButton,\n  List,\n  ListItem,\n  ListItemText,\n  Skeleton,\n  TextField,\n  Typography,\n  TypographyProps,\n} from \"@mui/material\";\nimport { Fzf, FzfResultItem } from \"fzf\";\nimport { useMemo, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { DirectTopicStatsUpdater } from \"@foxglove/studio-base/components/DirectTopicStatsUpdater\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { PlayerPresence, TopicStats } from \"@foxglove/studio-base/players/types\";\nimport { Topic } from \"@foxglove/studio-base/src/players/types\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\ntype TopicWithStats = Topic & Partial<TopicStats>;\n\nconst topicToFzfResult = (item: TopicWithStats) =>\n  ({\n    item,\n    score: 0,\n    positions: new Set<number>(),\n    start: 0,\n    end: 0,\n  } as FzfResultItem<TopicWithStats>);\n\nconst HighlightChars = ({\n  str,\n  indices,\n  color,\n  offset = 0,\n}: {\n  str: string;\n  indices: Set<number>;\n  color?: TypographyProps[\"color\"];\n  offset?: number;\n}) => {\n  const chars = str.split(\"\");\n\n  const nodes = chars.map((char, i) => {\n    if (indices.has(i + offset)) {\n      return (\n        <Typography component=\"b\" key={i} variant=\"inherit\" color={color ?? \"info.main\"}>\n          {char}\n        </Typography>\n      );\n    }\n    return char;\n  });\n\n  return <>{nodes}</>;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  appBar: {\n    top: 0,\n    zIndex: theme.zIndex.appBar,\n    padding: theme.spacing(0.5),\n    position: \"sticky\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  listItem: {\n    paddingRight: theme.spacing(1),\n\n    \"&.MuiListItem-dense\": {\n      \".MuiListItemText-root\": {\n        marginTop: theme.spacing(0.5),\n        marginBottom: theme.spacing(0.5),\n      },\n    },\n    \".MuiListItemSecondaryAction-root\": {\n      marginRight: theme.spacing(-1),\n    },\n  },\n  textField: {\n    \".MuiOutlinedInput-notchedOutline\": {\n      border: \"none\",\n    },\n  },\n  startAdornment: {\n    display: \"flex\",\n  },\n}));\n\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectSortedTopics = ({ sortedTopics }: MessagePipelineContext) => sortedTopics;\n\nfunction TopicListItem({\n  topic,\n  positions,\n}: {\n  topic: Topic;\n  positions: Set<number>;\n}): JSX.Element {\n  const { classes } = useStyles();\n  return (\n    <ListItem\n      className={classes.listItem}\n      divider\n      key={topic.name}\n      secondaryAction={\n        <Stack style={{ textAlign: \"right\" }}>\n          <Typography\n            variant=\"caption\"\n            color=\"text.secondary\"\n            data-topic={topic.name}\n            data-topic-stat=\"count\"\n          >\n            &mdash;\n          </Typography>\n          <Typography\n            variant=\"caption\"\n            color=\"text.secondary\"\n            data-topic={topic.name}\n            data-topic-stat=\"frequency\"\n          >\n            &mdash;\n          </Typography>\n        </Stack>\n      }\n    >\n      <ListItemText\n        primary={<HighlightChars str={topic.name} indices={positions} />}\n        primaryTypographyProps={{ noWrap: true, title: topic.name }}\n        secondary={\n          topic.schemaName == undefined ? (\n            \"—\"\n          ) : (\n            <HighlightChars\n              str={topic.schemaName}\n              indices={positions}\n              offset={topic.name.length + 1}\n            />\n          )\n        }\n        secondaryTypographyProps={{\n          variant: \"caption\",\n          fontFamily: fonts.MONOSPACE,\n          noWrap: true,\n          title: topic.schemaName,\n        }}\n        style={{ marginRight: \"48px\" }}\n      />\n    </ListItem>\n  );\n}\n\nconst MemoTopicListItem = React.memo(TopicListItem);\n\nexport function TopicList(): JSX.Element {\n  const { classes, cx } = useStyles();\n  const [filterText, setFilterText] = useState<string>(\"\");\n\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const topics = useMessagePipeline(selectSortedTopics);\n\n  const filteredTopics: FzfResultItem<Topic>[] = useMemo(\n    () =>\n      filterText\n        ? new Fzf(topics, {\n            fuzzy: filterText.length > 2 ? \"v2\" : false,\n            sort: true,\n            selector: (item) => `${item.name}|${item.schemaName}`,\n          }).find(filterText)\n        : topics.map((item) => topicToFzfResult(item)),\n    [filterText, topics],\n  );\n\n  if (playerPresence === PlayerPresence.NOT_PRESENT) {\n    return (\n      <Stack flex=\"auto\" fullHeight alignItems=\"center\" gap={1} justifyContent=\"center\">\n        <Typography align=\"center\" variant=\"subtitle2\" color=\"text.secondary\">\n          No data source selected\n        </Typography>\n      </Stack>\n    );\n  }\n\n  if (playerPresence === PlayerPresence.ERROR) {\n    return (\n      <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n        <Typography align=\"center\" color=\"text.secondary\">\n          An error occurred\n        </Typography>\n      </Stack>\n    );\n  }\n\n  if (playerPresence === PlayerPresence.INITIALIZING) {\n    return (\n      <>\n        <header className={classes.appBar}>\n          <TextField\n            disabled\n            className={classes.textField}\n            fullWidth\n            placeholder=\"Waiting for data...\"\n            InputProps={{\n              size: \"small\",\n              startAdornment: <SearchIcon fontSize=\"small\" />,\n            }}\n          />\n        </header>\n        <List key=\"loading\" dense disablePadding>\n          {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15].map((i) => (\n            <ListItem className={cx(classes.listItem, \"loading\")} divider key={i}>\n              <ListItemText\n                primary={<Skeleton animation={false} width=\"20%\" />}\n                secondary={<Skeleton animation=\"wave\" width=\"55%\" />}\n                secondaryTypographyProps={{ variant: \"caption\" }}\n              />\n            </ListItem>\n          ))}\n        </List>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <header className={classes.appBar}>\n        <TextField\n          id=\"topic-filter\"\n          variant=\"filled\"\n          disabled={playerPresence !== PlayerPresence.PRESENT}\n          onChange={(event) => setFilterText(event.target.value)}\n          value={filterText}\n          className={classes.textField}\n          fullWidth\n          placeholder=\"Filter by topic or datatype…\"\n          InputProps={{\n            size: \"small\",\n            startAdornment: (\n              <label className={classes.startAdornment} htmlFor=\"topic-filter\">\n                <SearchIcon fontSize=\"small\" />\n              </label>\n            ),\n            endAdornment: filterText && (\n              <IconButton\n                size=\"small\"\n                title=\"Clear search\"\n                onClick={() => setFilterText(\"\")}\n                edge=\"end\"\n              >\n                <ClearIcon fontSize=\"small\" />\n              </IconButton>\n            ),\n          }}\n        />\n      </header>\n\n      {filteredTopics.length > 0 ? (\n        <List key=\"topics\" dense disablePadding>\n          {filteredTopics.map(({ item: topic, positions }) => {\n            return <MemoTopicListItem key={topic.name} topic={topic} positions={positions} />;\n          })}\n        </List>\n      ) : (\n        <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n          {playerPresence === PlayerPresence.PRESENT && filterText && (\n            <Typography align=\"center\" color=\"text.secondary\">\n              No topics or datatypes matching\n              <br />\n              {`“${filterText}”`}\n            </Typography>\n          )}\n          {playerPresence === PlayerPresence.PRESENT && (\n            <Typography align=\"center\" color=\"text.secondary\">\n              No topics available\n            </Typography>\n          )}\n          {playerPresence === PlayerPresence.RECONNECTING && (\n            <Typography align=\"center\" color=\"text.secondary\">\n              Waiting for connection\n            </Typography>\n          )}\n        </Stack>\n      )}\n      <DirectTopicStatsUpdater interval={6} />\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography } from \"@mui/material\";\nimport { useMemo } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Time } from \"@foxglove/rostime\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\nimport { isAbsoluteTime, formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\ntype Props = {\n  disableDate?: boolean;\n  horizontal?: boolean;\n  time: Time;\n};\n\nconst useStyles = makeStyles()({\n  numericValue: {\n    fontFeatureSettings: `${fonts.SANS_SERIF_FEATURE_SETTINGS}, \"zero\"`,\n  },\n});\n\nexport default function Timestamp(props: Props): JSX.Element {\n  const { classes } = useStyles();\n  const { disableDate = false, horizontal = false, time } = props;\n  const { formatDate, formatTime } = useAppTimeFormat();\n  const currentTimeStr = useMemo(() => formatTime(time), [time, formatTime]);\n  const rawTimeStr = useMemo(() => formatTimeRaw(time), [time]);\n  const date = useMemo(() => formatDate(time), [formatDate, time]);\n\n  if (!isAbsoluteTime(time)) {\n    return (\n      <Stack direction=\"row\" alignItems=\"center\" flexGrow={0}>\n        <Typography className={classes.numericValue} variant=\"inherit\">\n          {rawTimeStr}\n        </Typography>\n      </Stack>\n    );\n  }\n\n  return (\n    <Stack gap={0.5}>\n      <Stack\n        gap={1}\n        flexWrap=\"wrap\"\n        direction={horizontal ? \"row\" : \"column\"}\n        alignItems={horizontal ? \"center\" : \"flex-start\"}\n        justifyContent={horizontal ? \"flex-start\" : \"center\"}\n      >\n        {!disableDate && (\n          <Typography\n            className={classes.numericValue}\n            noWrap\n            fontWeight={!horizontal ? 700 : undefined}\n            variant=\"inherit\"\n          >\n            {date}\n          </Typography>\n        )}\n\n        <Stack direction=\"row\" alignItems=\"center\" flexShrink={0} gap={0.5}>\n          <Typography variant=\"inherit\" className={classes.numericValue}>\n            {currentTimeStr}\n          </Typography>\n        </Stack>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport TextMiddleTruncate from \"@foxglove/studio-base/components/TextMiddleTruncate\";\n\n/**\n * Render multiline text using TextMiddleTruncate for each line.\n */\nexport function MultilineMiddleTruncate(props: { text: string }): JSX.Element {\n  const { text } = props;\n  return (\n    <>\n      {text.split(\"\\n\").map((line) => (\n        <TextMiddleTruncate key={line} text={line} />\n      ))}\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Skeleton, Typography } from \"@mui/material\";\nimport { MutableRefObject, useEffect, useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport Timestamp from \"@foxglove/studio-base/components/Timestamp\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { subtractTimes } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/typescript/userUtils/time\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\nimport { formatDuration } from \"@foxglove/studio-base/util/formatTime\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\nimport { formatTimeRaw, isAbsoluteTime } from \"@foxglove/studio-base/util/time\";\n\nimport { MultilineMiddleTruncate } from \"./MultilineMiddleTruncate\";\n\nconst useStyles = makeStyles()({\n  overline: {\n    opacity: 0.6,\n  },\n  numericValue: {\n    fontFeatureSettings: `${fonts.SANS_SERIF_FEATURE_SETTINGS}, \"zero\"`,\n  },\n});\n\nconst selectStartTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.startTime;\nconst selectEndTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.endTime;\nconst selectPlayerName = (ctx: MessagePipelineContext) => ctx.playerState.name;\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectPlayerSourceId = ({ playerState }: MessagePipelineContext) =>\n  playerState.urlState?.sourceId;\n\nfunction DataSourceInfoContent(props: {\n  disableSource?: boolean;\n  durationRef: MutableRefObject<ReactNull | HTMLDivElement>;\n  endTimeRef: MutableRefObject<ReactNull | HTMLDivElement>;\n  playerName?: string;\n  playerPresence: PlayerPresence;\n  playerSourceId?: string;\n  startTime?: Time;\n}): JSX.Element {\n  const {\n    disableSource = false,\n    durationRef,\n    endTimeRef,\n    playerName,\n    playerPresence,\n    playerSourceId,\n    startTime,\n  } = props;\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"dataSourceInfo\");\n\n  const isLiveConnection =\n    playerSourceId != undefined\n      ? playerSourceId.endsWith(\"socket\") || playerSourceId.endsWith(\"lidar\")\n      : false;\n\n  return (\n    <Stack gap={1.5}>\n      {!disableSource && (\n        <Stack>\n          <Typography className={classes.overline} display=\"block\" variant=\"overline\">\n            {t(\"currentSource\")}\n          </Typography>\n          {playerPresence === PlayerPresence.INITIALIZING ? (\n            <Typography variant=\"inherit\">\n              <Skeleton animation=\"wave\" width=\"40%\" />\n            </Typography>\n          ) : playerPresence === PlayerPresence.RECONNECTING ? (\n            <Typography variant=\"inherit\">{t(\"waitingForConnection\")}</Typography>\n          ) : playerName ? (\n            <Typography variant=\"inherit\" component=\"span\">\n              <MultilineMiddleTruncate text={playerName} />\n            </Typography>\n          ) : (\n            <Typography className={classes.numericValue} variant=\"inherit\">\n              &mdash;\n            </Typography>\n          )}\n        </Stack>\n      )}\n\n      <Stack>\n        <Typography className={classes.overline} variant=\"overline\">\n          {t(\"startTime\")}\n        </Typography>\n        {playerPresence === PlayerPresence.INITIALIZING ? (\n          <Skeleton animation=\"wave\" width=\"50%\" />\n        ) : startTime ? (\n          <Timestamp horizontal time={startTime} />\n        ) : (\n          <Typography className={classes.numericValue} variant=\"inherit\">\n            &mdash;\n          </Typography>\n        )}\n      </Stack>\n\n      {!isLiveConnection && (\n        <Stack>\n          <Typography className={classes.overline} variant=\"overline\">\n            {t(\"endTime\")}\n          </Typography>\n          {playerPresence === PlayerPresence.INITIALIZING ? (\n            <Skeleton animation=\"wave\" width=\"50%\" />\n          ) : (\n            <Typography className={classes.numericValue} variant=\"inherit\" ref={endTimeRef}>\n              &mdash;\n            </Typography>\n          )}\n        </Stack>\n      )}\n\n      <Stack>\n        <Typography className={classes.overline} variant=\"overline\">\n          {t(\"duration\")}\n        </Typography>\n        {playerPresence === PlayerPresence.INITIALIZING ? (\n          <Skeleton animation=\"wave\" width={100} />\n        ) : (\n          <Typography className={classes.numericValue} variant=\"inherit\" ref={durationRef}>\n            &mdash;\n          </Typography>\n        )}\n      </Stack>\n    </Stack>\n  );\n}\n\nconst MemoDataSourceInfoContent = React.memo(DataSourceInfoContent);\n\nconst EmDash = \"\\u2014\";\n\nexport function DataSourceInfoView({ disableSource }: { disableSource?: boolean }): JSX.Element {\n  const startTime = useMessagePipeline(selectStartTime);\n  const endTime = useMessagePipeline(selectEndTime);\n  const playerName = useMessagePipeline(selectPlayerName);\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const playerSourceId = useMessagePipeline(selectPlayerSourceId);\n  const durationRef = useRef<HTMLDivElement>(ReactNull);\n  const endTimeRef = useRef<HTMLDivElement>(ReactNull);\n  const { formatDate, formatTime } = useAppTimeFormat();\n\n  // We bypass react and update the DOM elements directly for better performance here.\n  useEffect(() => {\n    if (durationRef.current) {\n      const duration = endTime && startTime ? subtractTimes(endTime, startTime) : undefined;\n      if (duration) {\n        const durationStr = formatDuration(duration);\n        durationRef.current.innerText = durationStr;\n      } else {\n        durationRef.current.innerText = EmDash;\n      }\n    }\n    if (endTimeRef.current) {\n      if (endTime) {\n        const date = formatDate(endTime);\n        endTimeRef.current.innerText = !isAbsoluteTime(endTime)\n          ? `${formatTimeRaw(endTime)}`\n          : `${date} ${formatTime(endTime)}`;\n      } else {\n        endTimeRef.current.innerHTML = EmDash;\n      }\n    }\n  }, [endTime, formatTime, startTime, playerPresence, formatDate]);\n\n  return (\n    <MemoDataSourceInfoContent\n      disableSource={disableSource}\n      durationRef={durationRef}\n      endTimeRef={endTimeRef}\n      playerName={playerName}\n      playerPresence={playerPresence}\n      playerSourceId={playerSourceId}\n      startTime={startTime}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport AddIcon from \"@mui/icons-material/Add\";\nimport {\n  IconButton,\n  Tab,\n  Tabs,\n  styled as muiStyled,\n  Divider,\n  CircularProgress,\n} from \"@mui/material\";\nimport { useState, useEffect, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { EventsList } from \"@foxglove/studio-base/components/DataSourceSidebar/EventsList\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { SidebarContent } from \"@foxglove/studio-base/components/SidebarContent\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport WssErrorModal from \"@foxglove/studio-base/components/WssErrorModal\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\n\nimport { ProblemsList } from \"./ProblemsList\";\nimport { TopicList } from \"./TopicList\";\nimport { DataSourceInfoView } from \"../DataSourceInfoView\";\n\ntype Props = {\n  disableToolbar?: boolean;\n  onSelectDataSourceAction: () => void;\n};\n\nconst useStyles = makeStyles()({\n  tabContent: {\n    flex: \"auto\",\n  },\n});\n\nconst StyledTab = muiStyled(Tab)(({ theme }) => ({\n  minHeight: 30,\n  minWidth: theme.spacing(8),\n  padding: theme.spacing(0, 1.5),\n  color: theme.palette.text.secondary,\n  fontSize: \"0.6875rem\",\n\n  \"&.Mui-selected\": {\n    color: theme.palette.text.primary,\n  },\n}));\n\nconst StyledTabs = muiStyled(Tabs)({\n  minHeight: \"auto\",\n\n  \".MuiTabs-indicator\": {\n    transform: \"scaleX(0.5)\",\n    height: 2,\n  },\n});\n\nconst ProblemCount = muiStyled(\"div\")(({ theme }) => ({\n  backgroundColor: theme.palette.error.main,\n  fontSize: theme.typography.caption.fontSize,\n  color: theme.palette.error.contrastText,\n  padding: theme.spacing(0.125, 0.75),\n  borderRadius: 8,\n}));\n\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectPlayerProblems = ({ playerState }: MessagePipelineContext) => playerState.problems;\nconst selectSelectedEventId = (store: EventsStore) => store.selectedEventId;\nconst selectEventsSupported = (store: EventsStore) => store.eventsSupported;\n\ntype DataSourceSidebarTab = \"topics\" | \"events\" | \"problems\";\n\nexport default function DataSourceSidebar(props: Props): JSX.Element {\n  const { disableToolbar = false, onSelectDataSourceAction } = props;\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const playerProblems = useMessagePipeline(selectPlayerProblems) ?? [];\n  const { currentUser } = useCurrentUser();\n  const selectedEventId = useEvents(selectSelectedEventId);\n  const [activeTab, setActiveTab] = useState<DataSourceSidebarTab>(\"topics\");\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"dataSourceInfo\");\n\n  const [enableNewTopNav = false] = useAppConfigurationValue<boolean>(AppSetting.ENABLE_NEW_TOPNAV);\n\n  const eventsSupported = useEvents(selectEventsSupported);\n  const showEventsTab = !enableNewTopNav && currentUser != undefined && eventsSupported;\n\n  const isLoading = useMemo(\n    () =>\n      playerPresence === PlayerPresence.INITIALIZING ||\n      playerPresence === PlayerPresence.RECONNECTING,\n    [playerPresence],\n  );\n\n  useEffect(() => {\n    if (playerPresence === PlayerPresence.ERROR || playerPresence === PlayerPresence.RECONNECTING) {\n      setActiveTab(\"problems\");\n    } else if (showEventsTab && selectedEventId != undefined) {\n      setActiveTab(\"events\");\n    }\n  }, [playerPresence, showEventsTab, selectedEventId]);\n\n  const [hasDismissedWssErrorModal, setHasDismissedWssErrorModal] = useState(false);\n  const hasWssConnectionProblem = playerProblems.find(\n    (problem) =>\n      problem.severity === \"error\" && problem.message === \"Insecure WebSocket connection\",\n  );\n\n  return (\n    <SidebarContent\n      disablePadding\n      disableToolbar={disableToolbar}\n      overflow=\"auto\"\n      title={t(\"dataSource\")}\n      trailingItems={[\n        isLoading && (\n          <Stack key=\"loading\" alignItems=\"center\" justifyContent=\"center\" padding={1}>\n            <CircularProgress size={18} variant=\"indeterminate\" />\n          </Stack>\n        ),\n        <IconButton\n          key=\"add-connection\"\n          color=\"primary\"\n          title=\"New connection\"\n          onClick={onSelectDataSourceAction}\n        >\n          <AddIcon />\n        </IconButton>,\n      ].filter(Boolean)}\n    >\n      <Stack fullHeight>\n        {!disableToolbar && (\n          <Stack paddingX={2} paddingBottom={2}>\n            <DataSourceInfoView />\n          </Stack>\n        )}\n        {playerPresence !== PlayerPresence.NOT_PRESENT && (\n          <>\n            <Stack flex={1}>\n              {!disableToolbar && (\n                <>\n                  <StyledTabs\n                    value={activeTab}\n                    onChange={(_ev, newValue: DataSourceSidebarTab) => setActiveTab(newValue)}\n                    textColor=\"inherit\"\n                  >\n                    <StyledTab disableRipple label=\"Topics\" value=\"topics\" />\n                    {showEventsTab && <StyledTab disableRipple label=\"Events\" value=\"events\" />}\n                    <StyledTab\n                      disableRipple\n                      label={\n                        <Stack direction=\"row\" alignItems=\"baseline\" gap={1}>\n                          Problems\n                          {playerProblems.length > 0 && (\n                            <ProblemCount>{playerProblems.length}</ProblemCount>\n                          )}\n                        </Stack>\n                      }\n                      value=\"problems\"\n                    />\n                  </StyledTabs>\n                  <Divider />\n                </>\n              )}\n              {activeTab === \"topics\" && (\n                <div className={classes.tabContent}>\n                  <TopicList />\n                </div>\n              )}\n              {activeTab === \"events\" && (\n                <div className={classes.tabContent}>\n                  <EventsList />\n                </div>\n              )}\n              {activeTab === \"problems\" && (\n                <div className={classes.tabContent}>\n                  <ProblemsList problems={playerProblems} />\n                </div>\n              )}\n            </Stack>\n          </>\n        )}\n      </Stack>\n      {hasWssConnectionProblem && !hasDismissedWssErrorModal && (\n        <WssErrorModal onClose={() => setHasDismissedWssErrorModal(true)} />\n      )}\n    </SidebarContent>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { alpha, Dialog, Typography } from \"@mui/material\";\nimport { PropsWithChildren } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  outer: {\n    background: alpha(theme.palette.background.paper, 0.84),\n    backgroundImage: `linear-gradient(${theme.palette.action.hover}, ${theme.palette.action.hover})`,\n    pointerEvents: \"none\",\n    padding: theme.spacing(5),\n    boxShadow: \"none\",\n    maxHeight: \"none\", // override inset for titlebar area on Windows desktop app\n  },\n  inner: {\n    borderRadius: 16,\n    height: \"100%\",\n    border: `2px dashed ${theme.palette.text.primary}`,\n    display: \"flex\",\n    flexDirection: \"column\",\n    textAlign: \"center\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    fontWeight: 800,\n    padding: theme.spacing(5),\n    lineHeight: \"normal\",\n  },\n}));\n\nfunction DropOverlay(props: PropsWithChildren<{ open: boolean }>): JSX.Element {\n  const { classes } = useStyles();\n  return (\n    <Dialog\n      fullScreen\n      open={props.open}\n      style={{ zIndex: 10000000 }}\n      classes={{ paperFullScreen: classes.outer }}\n    >\n      <div className={classes.inner}>\n        <Typography variant=\"h1\" align=\"center\">\n          {props.children}\n        </Typography>\n      </div>\n    </Dialog>\n  );\n}\n\nexport default DropOverlay;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useSnackbar } from \"notistack\";\nimport { extname } from \"path\";\nimport { useCallback, useLayoutEffect, useState } from \"react\";\n\nimport Logger from \"@foxglove/log\";\nimport DropOverlay from \"@foxglove/studio-base/components/DropOverlay\";\n\nconst log = Logger.getLogger(__filename);\n\ntype Props = {\n  allowedExtensions?: string[];\n  onDrop?: (event: {\n    files?: File[];\n    handles?: FileSystemFileHandle[]; // foxglove-depcheck-used: @types/wicg-file-system-access\n  }) => void;\n};\n\nexport default function DocumentDropListener(props: Props): JSX.Element {\n  const [hovering, setHovering] = useState(false);\n\n  const { onDrop: onDropProp, allowedExtensions } = props;\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const onDrop = useCallback(\n    async (ev: DragEvent) => {\n      setHovering(false);\n\n      if (!ev.dataTransfer || !allowedExtensions) {\n        return;\n      }\n\n      let handles: FileSystemFileHandle[] | undefined = [];\n      const handlePromises: Promise<FileSystemHandle | ReactNull>[] = [];\n      const allFiles: File[] = [];\n      const directories: FileSystemDirectoryEntry[] = [];\n      const dataItems = ev.dataTransfer.items;\n      for (const item of Array.from(dataItems)) {\n        // Attempt to grab the filesystem handle if the feature is available.\n        // A file system handle is more versatile than File instances.\n        // Note: awaiting on the fileSystemHandle function triggered a (bug?) where all other\n        // dataTransfer items were ignored\n        //\n        // getAsFileSystemHandle is only available in a secure context. If called outside a secure\n        // context the observed behavior is a browser (tab) crash. To avoid the crash we check that\n        // we are in a secure context and only call the api if available.\n        //\n        // Handles power features like recents which require saving handles in indexeddb. This check\n        // allows us to gracefully degrade away from this feature if the user deploys Studio in an\n        // unsecure context.\n        if (window.isSecureContext && \"getAsFileSystemHandle\" in item) {\n          handlePromises.push(item.getAsFileSystemHandle());\n        } else {\n          log.info(\n            \"getAsFileSystemHandle not available on a dropped item. Features requiring handles will not be available for the item\",\n            item,\n          );\n        }\n\n        const entry = item.webkitGetAsEntry();\n\n        // Keep track of all File and Directory instaces\n        if (entry?.isFile === true) {\n          const file = item.getAsFile();\n          if (file) {\n            allFiles.push(file);\n          }\n        } else if (entry?.isDirectory === true) {\n          directories.push(entry as FileSystemDirectoryEntry);\n        }\n      }\n\n      // If we had any directories, then we will not use handles and instead use File instances.\n      // A future enhancement could be to load handles from directories.\n      if (directories.length === 0) {\n        for (const promise of handlePromises) {\n          const fileSystemHandle = await promise;\n          if (fileSystemHandle instanceof FileSystemFileHandle) {\n            handles.push(fileSystemHandle);\n          }\n        }\n      }\n\n      // Allow event to bubble for non-file based drag and drop\n      if (allFiles.length === 0 && directories.length === 0 && handles.length === 0) {\n        return;\n      }\n\n      for (const directory of directories) {\n        // Read the list of files and folders in this directory (non-recursively)\n        const entries = await new Promise<FileSystemEntry[]>((resolve, reject) => {\n          directory.createReader().readEntries(resolve, reject);\n        });\n\n        // Add all files in this directory to our list of files\n        for (const entry of entries) {\n          if (entry.isFile) {\n            const file = await new Promise<File>((resolve, reject) => {\n              (entry as FileSystemFileEntry).file(resolve, reject);\n            });\n            allFiles.push(file);\n          }\n        }\n      }\n\n      // If we had any directories, then we will not use handles and instead use File instances.\n      // A future enhancement could be to load handles from directories.\n      if (directories.length > 0 || handles.length === 0) {\n        handles = undefined;\n      }\n\n      const filteredFiles = allFiles.filter((file) =>\n        allowedExtensions.includes(extname(file.name)),\n      );\n      const filteredHandles = handles?.filter((handle) =>\n        allowedExtensions.includes(extname(handle.name)),\n      );\n\n      // Check for no supported files\n      if (filteredFiles.length === 0 && filteredHandles?.length === 0) {\n        enqueueSnackbar(\"The file format is unsupported.\", { variant: \"error\" });\n        return;\n      }\n\n      ev.preventDefault();\n      ev.stopPropagation();\n\n      onDropProp?.({ files: filteredFiles, handles: filteredHandles });\n    },\n    [enqueueSnackbar, onDropProp, allowedExtensions],\n  );\n\n  const onDragOver = useCallback(\n    (ev: DragEvent) => {\n      if (!allowedExtensions) {\n        return;\n      }\n\n      const { dataTransfer } = ev;\n      if (dataTransfer?.types.includes(\"Files\") === true) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        dataTransfer.dropEffect = \"copy\";\n        setHovering(true);\n      }\n    },\n    [allowedExtensions],\n  );\n\n  const onDragLeave = useCallback(() => {\n    setHovering(false);\n  }, []);\n\n  useLayoutEffect(() => {\n    document.addEventListener(\"dragover\", onDragOver);\n    document.addEventListener(\"drop\", onDrop);\n    document.addEventListener(\"dragleave\", onDragLeave);\n    return () => {\n      document.removeEventListener(\"dragover\", onDragOver);\n      document.removeEventListener(\"drop\", onDrop);\n      document.removeEventListener(\"dragleave\", onDragLeave);\n    };\n  }, [onDragLeave, onDragOver, onDrop]);\n\n  return (\n    <>\n      <input // Expose a hidden input for Puppeteer to use to drop a file in.\n        type=\"file\"\n        style={{ display: \"none\" }}\n        onChange={(event) => {\n          if (event.target.files) {\n            props.onDrop?.({ files: Array.from(event.target.files) });\n          }\n        }}\n        data-puppeteer-file-upload\n        multiple\n      />\n      <DropOverlay open={hovering}>Drop a file here</DropOverlay>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { createContext } from \"react\";\n\n// This context provides a function that handles link clicks, for example to handle app-internal\n// links by showing a modal dialog rather than actualy navigating.\nconst LinkHandlerContext = createContext<(event: React.MouseEvent, href: string) => void>(() => {});\nLinkHandlerContext.displayName = \"LinkHandlerContext\";\n\nexport default LinkHandlerContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Link } from \"@mui/material\";\nimport { PropsWithChildren, CSSProperties, useCallback, useContext } from \"react\";\nimport Markdown from \"react-markdown\";\nimport rehypeRaw from \"rehype-raw\";\nimport { withStyles } from \"tss-react/mui\";\n\nimport LinkHandlerContext from \"@foxglove/studio-base/context/LinkHandlerContext\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst TextContentRoot = withStyles(\"div\", (theme) => {\n  const { palette, shape, spacing, typography, shadows } = theme;\n  return {\n    root: {\n      fontFamily: typography.body2.fontFamily,\n      fontSize: typography.body2.fontSize,\n      fontWeight: typography.body2.fontWeight,\n      lineHeight: typography.body2.lineHeight,\n      backgroundColor: \"transparent\",\n      color: palette.text.secondary,\n\n      \"h1, h2, h3, h4, h5, h6\": {\n        color: palette.text.primary,\n\n        \"&:first-child\": { marginTop: 0 },\n      },\n      h1: {\n        fontFamily: typography.h4.fontFamily,\n        fontSize: typography.h4.fontSize,\n        lineHeight: typography.h4.lineHeight,\n        marginBottom: spacing(1),\n        fontWeight: 500,\n      },\n      h2: {\n        fontFamily: typography.h5.fontFamily,\n        fontSize: typography.h5.fontSize,\n        lineHeight: typography.h5.lineHeight,\n        marginBottom: spacing(1),\n        fontWeight: 500,\n      },\n      h3: {\n        fontFamily: typography.h6.fontFamily,\n        fontSize: typography.h6.fontSize,\n        lineHeight: typography.h6.lineHeight,\n        marginBottom: spacing(1),\n        color: palette.text.secondary,\n        fontWeight: 500,\n      },\n      h4: {\n        fontFamily: typography.subtitle1.fontFamily,\n        fontSize: typography.subtitle1.fontSize,\n        lineHeight: typography.subtitle1.lineHeight,\n        marginBottom: spacing(0.5),\n        color: palette.text.secondary,\n        fontWeight: 500,\n      },\n      \"h5, h6\": {\n        fontFamily: typography.body1.fontFamily,\n        fontSize: typography.body1.fontSize,\n        lineHeight: typography.body1.lineHeight,\n        marginBottom: spacing(0.5),\n        color: palette.text.secondary,\n        fontWeight: 500,\n      },\n      \"ol, ul\": {\n        paddingLeft: spacing(2.5),\n        marginBottom: spacing(2.5),\n      },\n      li: {\n        margin: spacing(0.5, 0),\n      },\n      \"b, strong\": {\n        fontWeight: \"700 !important\",\n      },\n      \"p, ul\": {\n        margin: spacing(1, 0),\n\n        \"&:only-child\": {\n          margin: spacing(0.5, 0),\n        },\n      },\n      img: {\n        maxWidth: \"100%\",\n      },\n      pre: {\n        whiteSpace: \"pre-wrap\",\n        fontFamily: fonts.MONOSPACE,\n        backgroundColor: palette.action.hover,\n        padding: spacing(0, 0.5),\n        borderRadius: shadows[2],\n\n        code: {\n          backgroundColor: \"transparent\",\n          padding: 0,\n        },\n      },\n      code: {\n        fontFamily: fonts.MONOSPACE,\n        backgroundColor: palette.action.hover,\n        borderRadius: \"0.2em\",\n        padding: spacing(0, 0.5),\n      },\n      kbd: {\n        display: \"inline-flex\",\n        flex: \"none\",\n        fontFamily: fonts.MONOSPACE,\n        color: palette.text.secondary,\n        backgroundColor: palette.background.default,\n        boxShadow: `inset 0 1px 0 ${palette.action.hover}`,\n        borderRadius: shape.borderRadius,\n        fontSize: typography.body2.fontSize,\n        padding: spacing(0, 0.5),\n        fontWeight: 500,\n        minWidth: 20,\n        alignItems: \"center\",\n        justifyContent: \"center\",\n      },\n      table: {\n        borderCollapse: \"collapse\",\n        borderSpacing: 0,\n        margin: spacing(1, -0.5),\n        border: `1px solid ${palette.divider}`,\n      },\n      \"td, th\": {\n        padding: spacing(0.5),\n        borderBottom: `1px solid ${palette.divider}`,\n        borderRight: `1px solid ${palette.divider}`,\n\n        \"&:last-child\": {\n          borderRight: \"none\",\n        },\n      },\n      th: {\n        whiteSpace: \"nowrap\",\n      },\n      tr: {\n        \"&:last-child\": {\n          \"td, th\": { borderBottom: \"none\" },\n        },\n      },\n    },\n  };\n});\n\ntype Props = {\n  style?: CSSProperties;\n  allowMarkdownHtml?: boolean;\n};\n\nexport default function TextContent(\n  props: PropsWithChildren<Props>,\n): React.ReactElement | ReactNull {\n  const { children, style, allowMarkdownHtml } = props;\n\n  const handleLink = useContext(LinkHandlerContext);\n\n  const linkRenderer = useCallback(\n    (linkProps: { href?: string; children: React.ReactNode }) => {\n      return (\n        <Link\n          color=\"primary\"\n          underline=\"hover\"\n          variant=\"inherit\"\n          href={linkProps.href}\n          rel=\"noopener noreferrer\"\n          onClick={(event) => handleLink(event, linkProps.href ?? \"\")}\n          target=\"_blank\"\n        >\n          {linkProps.children}\n        </Link>\n      );\n    },\n    [handleLink],\n  );\n\n  return (\n    <TextContentRoot style={style}>\n      {typeof children === \"string\" ? (\n        <Markdown\n          rehypePlugins={allowMarkdownHtml === true ? [rehypeRaw] : []}\n          components={{ a: linkRenderer }}\n        >\n          {children}\n        </Markdown>\n      ) : (\n        children\n      )}\n    </TextContentRoot>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nexport type ExtensionMarketplaceDetail = {\n  id: string;\n  name: string;\n  qualifiedName: string;\n  namespace?: ExtensionNamespace;\n  description: string;\n  publisher: string;\n  homepage: string;\n  license: string;\n  version: string;\n  readme?: string;\n  changelog?: string;\n  sha256sum?: string;\n  foxe?: string;\n  keywords?: string[];\n  time?: Record<string, string>;\n};\n\nexport interface ExtensionMarketplace {\n  getAvailableExtensions(): Promise<ExtensionMarketplaceDetail[]>;\n  getMarkdown(url: string): Promise<string>;\n}\n\nconst ExtensionMarketplaceContext = createContext<ExtensionMarketplace | undefined>(undefined);\nExtensionMarketplaceContext.displayName = \"ExtensionMarketplaceContext\";\n\nexport function useExtensionMarketplace(): ExtensionMarketplace {\n  const extensionMarketplace = useContext(ExtensionMarketplaceContext);\n  if (extensionMarketplace == undefined) {\n    throw new Error(\n      \"An ExtensionMarketplaceContext provider is required to useExtensionMarketplace\",\n    );\n  }\n  return extensionMarketplace;\n}\n\nexport default ExtensionMarketplaceContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ChevronLeftIcon from \"@mui/icons-material/ChevronLeft\";\nimport {\n  IconButton,\n  Button,\n  Link,\n  Tab,\n  Tabs,\n  Typography,\n  Divider,\n  styled as muiStyled,\n} from \"@mui/material\";\nimport { useSnackbar } from \"notistack\";\nimport { useCallback, useState } from \"react\";\nimport { useAsync, useMountedState } from \"react-use\";\nimport { DeepReadonly } from \"ts-essentials\";\n\nimport { SidebarContent } from \"@foxglove/studio-base/components/SidebarContent\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextContent from \"@foxglove/studio-base/components/TextContent\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport {\n  ExtensionMarketplaceDetail,\n  useExtensionMarketplace,\n} from \"@foxglove/studio-base/context/ExtensionMarketplaceContext\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\ntype Props = {\n  installed: boolean;\n  extension: DeepReadonly<ExtensionMarketplaceDetail>;\n  onClose: () => void;\n};\n\nconst StyledButton = muiStyled(Button)({ minWidth: 100 });\n\nexport function ExtensionDetails({ extension, onClose, installed }: Props): React.ReactElement {\n  const [isInstalled, setIsInstalled] = useState(installed);\n  const [activeTab, setActiveTab] = useState<number>(0);\n  const isMounted = useMountedState();\n  const downloadExtension = useExtensionCatalog((state) => state.downloadExtension);\n  const installExtension = useExtensionCatalog((state) => state.installExtension);\n  const uninstallExtension = useExtensionCatalog((state) => state.uninstallExtension);\n  const marketplace = useExtensionMarketplace();\n  const { enqueueSnackbar } = useSnackbar();\n  const readmeUrl = extension.readme;\n  const changelogUrl = extension.changelog;\n  const canInstall = extension.foxe != undefined;\n  const canUninstall = extension.namespace !== \"org\";\n\n  const { value: readmeContent } = useAsync(\n    async () => (readmeUrl != undefined ? await marketplace.getMarkdown(readmeUrl) : \"\"),\n    [marketplace, readmeUrl],\n  );\n  const { value: changelogContent } = useAsync(\n    async () => (changelogUrl != undefined ? await marketplace.getMarkdown(changelogUrl) : \"\"),\n    [marketplace, changelogUrl],\n  );\n\n  const analytics = useAnalytics();\n\n  const install = useCallback(async () => {\n    if (!isDesktopApp()) {\n      enqueueSnackbar(\"Download the desktop app to use marketplace extensions.\", {\n        variant: \"error\",\n      });\n      return;\n    }\n\n    const url = extension.foxe;\n    try {\n      if (url == undefined) {\n        throw new Error(`Cannot install extension ${extension.id}, \"foxe\" URL is missing`);\n      }\n      const data = await downloadExtension(url);\n      await installExtension(\"local\", data);\n      if (isMounted()) {\n        setIsInstalled(true);\n        void analytics.logEvent(AppEvent.EXTENSION_INSTALL, { type: extension.id });\n      }\n    } catch (err) {\n      enqueueSnackbar(`Failed to download extension ${extension.id}. ${err.message}`, {\n        variant: \"error\",\n      });\n    }\n  }, [\n    analytics,\n    downloadExtension,\n    enqueueSnackbar,\n    extension.foxe,\n    extension.id,\n    installExtension,\n    isMounted,\n  ]);\n\n  const uninstall = useCallback(async () => {\n    await uninstallExtension(extension.namespace ?? \"local\", extension.id);\n    if (isMounted()) {\n      setIsInstalled(false);\n      void analytics.logEvent(AppEvent.EXTENSION_UNINSTALL, { type: extension.id });\n    }\n  }, [analytics, extension.id, extension.namespace, isMounted, uninstallExtension]);\n\n  return (\n    <SidebarContent\n      title={extension.name}\n      leadingItems={[\n        <IconButton key=\"back-arrow\" onClick={onClose} size=\"small\" edge=\"start\">\n          <ChevronLeftIcon />\n        </IconButton>,\n      ]}\n    >\n      <Stack gap={1} alignItems=\"flex-start\">\n        <Stack gap={0.5} paddingBottom={1}>\n          <Stack direction=\"row\" gap={1} alignItems=\"baseline\">\n            <Link\n              variant=\"body2\"\n              color=\"primary\"\n              href={extension.homepage}\n              target=\"_blank\"\n              underline=\"hover\"\n            >\n              {extension.id}\n            </Link>\n            <Typography\n              variant=\"caption\"\n              color=\"text.secondary\"\n            >{`v${extension.version}`}</Typography>\n            <Typography variant=\"caption\" color=\"text.secondary\">\n              {extension.license}\n            </Typography>\n          </Stack>\n          <Typography variant=\"subtitle2\" gutterBottom>\n            {extension.publisher}\n          </Typography>\n          <Typography variant=\"body2\" gutterBottom>\n            {extension.description}\n          </Typography>\n        </Stack>\n        {isInstalled && canUninstall ? (\n          <StyledButton\n            size=\"small\"\n            key=\"uninstall\"\n            color=\"inherit\"\n            variant=\"contained\"\n            onClick={uninstall}\n          >\n            Uninstall\n          </StyledButton>\n        ) : (\n          canInstall && (\n            <StyledButton\n              size=\"small\"\n              key=\"install\"\n              color=\"inherit\"\n              variant=\"contained\"\n              onClick={install}\n            >\n              Install\n            </StyledButton>\n          )\n        )}\n      </Stack>\n\n      <Stack paddingTop={2} style={{ marginLeft: -16, marginRight: -16 }}>\n        <Tabs\n          textColor=\"inherit\"\n          value={activeTab}\n          onChange={(_event, newValue: number) => setActiveTab(newValue)}\n        >\n          <Tab disableRipple label=\"README\" value={0} />\n          <Tab disableRipple label=\"CHANGELOG\" value={1} />\n        </Tabs>\n        <Divider />\n      </Stack>\n\n      <Stack flex=\"auto\" paddingY={2}>\n        {activeTab === 0 && <TextContent>{readmeContent}</TextContent>}\n        {activeTab === 1 && <TextContent>{changelogContent}</TextContent>}\n      </Stack>\n    </SidebarContent>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Button,\n  List,\n  ListItem,\n  ListItemButton,\n  ListItemText,\n  Typography,\n  styled as muiStyled,\n} from \"@mui/material\";\nimport { differenceWith, groupBy, isEmpty, keyBy } from \"lodash\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useAsyncFn } from \"react-use\";\nimport { DeepReadonly } from \"ts-essentials\";\n\nimport Log from \"@foxglove/log\";\nimport { ExtensionDetails } from \"@foxglove/studio-base/components/ExtensionDetails\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport {\n  ExtensionMarketplaceDetail,\n  useExtensionMarketplace,\n} from \"@foxglove/studio-base/context/ExtensionMarketplaceContext\";\n\nconst log = Log.getLogger(__filename);\n\nconst StyledListItemButton = muiStyled(ListItemButton)(({ theme }) => ({\n  \"&:hover\": {\n    color: theme.palette.primary.main,\n  },\n}));\n\nfunction displayNameForNamespace(namespace: string): string {\n  switch (namespace) {\n    case \"org\":\n      return \"Organization\";\n    default:\n      return namespace;\n  }\n}\n\nfunction ExtensionListEntry(props: {\n  entry: DeepReadonly<ExtensionMarketplaceDetail>;\n  onClick: () => void;\n}): JSX.Element {\n  const {\n    entry: { id, description, name, publisher, version },\n    onClick,\n  } = props;\n  return (\n    <ListItem disablePadding key={id}>\n      <StyledListItemButton onClick={onClick}>\n        <ListItemText\n          disableTypography\n          primary={\n            <Stack direction=\"row\" alignItems=\"baseline\" gap={0.5}>\n              <Typography variant=\"subtitle2\" fontWeight={600}>\n                {name}\n              </Typography>\n              <Typography variant=\"caption\" color=\"text.secondary\">\n                {version}\n              </Typography>\n            </Stack>\n          }\n          secondary={\n            <Stack gap={0.5}>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                {description}\n              </Typography>\n              <Typography color=\"text.primary\" variant=\"body2\">\n                {publisher}\n              </Typography>\n            </Stack>\n          }\n        />\n      </StyledListItemButton>\n    </ListItem>\n  );\n}\n\nexport default function ExtensionsSettings(): React.ReactElement {\n  const [focusedExtension, setFocusedExtension] = useState<\n    | {\n        installed: boolean;\n        entry: DeepReadonly<ExtensionMarketplaceDetail>;\n      }\n    | undefined\n  >(undefined);\n  const installed = useExtensionCatalog((state) => state.installedExtensions);\n  const marketplace = useExtensionMarketplace();\n\n  const [marketplaceEntries, refreshMarketplaceEntries] = useAsyncFn(\n    async () => await marketplace.getAvailableExtensions(),\n    [marketplace],\n  );\n\n  const marketplaceMap = useMemo(\n    () => keyBy(marketplaceEntries.value ?? [], (entry) => entry.id),\n    [marketplaceEntries],\n  );\n\n  const installedEntries = useMemo(\n    () =>\n      (installed ?? []).map((entry) => {\n        const marketplaceEntry = marketplaceMap[entry.id];\n        if (marketplaceEntry != undefined) {\n          return { ...marketplaceEntry, namespace: entry.namespace };\n        }\n\n        return {\n          id: entry.id,\n          installed: true,\n          name: entry.displayName,\n          displayName: entry.displayName,\n          description: entry.description,\n          publisher: entry.publisher,\n          homepage: entry.homepage,\n          license: entry.license,\n          version: entry.version,\n          keywords: entry.keywords,\n          namespace: entry.namespace,\n          qualifiedName: entry.qualifiedName,\n        };\n      }),\n    [installed, marketplaceMap],\n  );\n\n  const namespacedEntries = useMemo(\n    () => groupBy(installedEntries, (entry) => entry.namespace),\n    [installedEntries],\n  );\n\n  // Hide installed extensions from the list of available extensions\n  const filteredMarketplaceEntries = useMemo(\n    () =>\n      differenceWith(\n        marketplaceEntries.value ?? [],\n        installed ?? [],\n        (a, b) => a.id === b.id && a.namespace === b.namespace,\n      ),\n    [marketplaceEntries, installed],\n  );\n\n  useEffect(() => {\n    refreshMarketplaceEntries().catch((error) => log.error(error));\n  }, [refreshMarketplaceEntries]);\n\n  if (focusedExtension != undefined) {\n    return (\n      <ExtensionDetails\n        installed={focusedExtension.installed}\n        extension={focusedExtension.entry}\n        onClose={() => setFocusedExtension(undefined)}\n      />\n    );\n  }\n\n  if (marketplaceEntries.error) {\n    return (\n      <Stack gap={1} alignItems=\"center\" justifyContent=\"center\" fullHeight>\n        <Typography align=\"center\" variant=\"body2\" color=\"text.secondary\">\n          Failed to fetch the list of available extensions. Check your Internet connection and try\n          again.\n        </Typography>\n        <Button onClick={async () => await refreshMarketplaceEntries()}>\n          Retry Fetching Extensions\n        </Button>\n      </Stack>\n    );\n  }\n\n  return (\n    <Stack gap={1}>\n      {!isEmpty(namespacedEntries) ? (\n        Object.entries(namespacedEntries).map(([namespace, entries]) => (\n          <List key={namespace}>\n            <Stack paddingY={0.25} paddingX={2}>\n              <Typography component=\"li\" variant=\"overline\" color=\"text.secondary\">\n                {displayNameForNamespace(namespace)}\n              </Typography>\n            </Stack>\n            {entries.map((entry) => (\n              <ExtensionListEntry\n                key={`${entry.id}`}\n                entry={entry}\n                onClick={() => setFocusedExtension({ installed: true, entry })}\n              />\n            ))}\n          </List>\n        ))\n      ) : (\n        <List>\n          <ListItem>\n            <ListItemText primary=\"No installed extensions\" />\n          </ListItem>\n        </List>\n      )}\n      <List>\n        <Stack paddingY={0.25} paddingX={2}>\n          <Typography component=\"li\" variant=\"overline\" color=\"text.secondary\">\n            Available\n          </Typography>\n        </Stack>\n        {filteredMarketplaceEntries.map((entry) => (\n          <ExtensionListEntry\n            key={`${entry.id}_${entry.namespace}`}\n            entry={entry}\n            onClick={() => setFocusedExtension({ installed: false, entry })}\n          />\n        ))}\n      </List>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { ButtonBase, IconButton, Link, Typography } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\n\ntype SignInPromptProps = {\n  onDismiss?: () => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    display: \"flex\",\n    padding: theme.spacing(1.5, 1, 1.5, 2),\n    gap: theme.spacing(1),\n    backgroundColor: theme.palette.action.hover,\n    position: \"sticky\",\n    alignItems: \"center\",\n    bottom: 0,\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.action.focus,\n    },\n  },\n  title: {\n    maxWidth: 280,\n  },\n}));\n\nexport default function SignInPrompt(props: SignInPromptProps): JSX.Element {\n  const { onDismiss } = props;\n  const { signIn } = useCurrentUser();\n  const { classes } = useStyles();\n  const { openAccountSettings } = useWorkspaceActions();\n  const [topNavEnabled = false] = useAppConfigurationValue<boolean>(AppSetting.ENABLE_NEW_TOPNAV);\n\n  const action = topNavEnabled ? signIn : openAccountSettings;\n\n  return (\n    <ButtonBase className={classes.root} onClick={action}>\n      <Typography align=\"left\" className={classes.title} variant=\"body2\">\n        <Link color=\"inherit\" onClick={action} underline=\"always\">\n          Sign in\n        </Link>{\" \"}\n        to sync layouts across multiple devices, and share them with your organization.\n      </Typography>\n      {onDismiss != undefined && (\n        <IconButton\n          aria-label=\"Dismiss\"\n          size=\"small\"\n          role=\"button\"\n          onClick={(event) => {\n            event.stopPropagation();\n            onDismiss();\n          }}\n        >\n          <CloseIcon />\n        </IconButton>\n      )}\n    </ButtonBase>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  FormControlLabel,\n  Radio,\n  RadioGroup,\n  TextField,\n  Typography,\n} from \"@mui/material\";\nimport { ChangeEvent, useCallback, useLayoutEffect, useMemo, useRef, useState } from \"react\";\nimport { useLatest, useUnmount } from \"react-use\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { Layout } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\ntype UnsavedChangesResolution =\n  | { type: \"cancel\" }\n  | { type: \"discard\" }\n  | { type: \"makePersonal\"; name: string }\n  | { type: \"overwrite\" };\n\nexport function UnsavedChangesPrompt({\n  layout,\n  isOnline,\n  onComplete,\n  defaultSelectedKey = \"discard\",\n  defaultPersonalCopyName,\n}: {\n  layout: Layout;\n  isOnline: boolean;\n  onComplete: (_: UnsavedChangesResolution) => void;\n  defaultSelectedKey?: Exclude<UnsavedChangesResolution[\"type\"], \"cancel\">;\n  defaultPersonalCopyName?: string;\n}): JSX.Element {\n  const [selectedKey, setSelectedKey] = useState<string>(defaultSelectedKey);\n\n  const handleChoiceGroupChange = React.useCallback(\n    (event: ChangeEvent<HTMLInputElement>): void => {\n      setSelectedKey((event.target as HTMLInputElement).value);\n    },\n    [],\n  );\n\n  const [personalCopyName, setPersonalCopyName] = useState(\n    defaultPersonalCopyName ?? `${layout.name} copy`,\n  );\n  const personalCopyNameRef = useLatest(personalCopyName);\n\n  const handleNameChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    setPersonalCopyName(event.target.value);\n  }, []);\n\n  const nameError = useMemo(\n    () => (personalCopyName.length === 0 ? \"Name cannot be empty\" : undefined),\n    [personalCopyName],\n  );\n\n  const handleSubmit = useCallback(\n    (event: React.FormEvent) => {\n      event.preventDefault();\n      switch (selectedKey) {\n        case \"discard\":\n          onComplete({ type: \"discard\" });\n          break;\n        case \"overwrite\":\n          onComplete({ type: \"overwrite\" });\n          break;\n        case \"makePersonal\":\n          onComplete({ type: \"makePersonal\", name: personalCopyNameRef.current });\n          break;\n      }\n    },\n    [onComplete, personalCopyNameRef, selectedKey],\n  );\n\n  const handleCancel = useCallback(() => {\n    onComplete({ type: \"cancel\" });\n  }, [onComplete]);\n\n  return (\n    <Dialog open onClose={handleCancel} maxWidth=\"xs\" fullWidth>\n      <form onSubmit={handleSubmit}>\n        <DialogTitle>{`“${layout.name}” has unsaved changes`}</DialogTitle>\n        <DialogContent>\n          <Stack gap={2} style={{ minHeight: 180 }}>\n            <RadioGroup defaultValue=\"discard\" onChange={handleChoiceGroupChange}>\n              <FormControlLabel value=\"discard\" label=\"Discard changes\" control={<Radio />} />\n              <FormControlLabel\n                value=\"overwrite\"\n                label={[\n                  `Update shared layout “${layout.name}”`,\n                  !isOnline && \"(unavailable while offline)\",\n                ]\n                  .filter(Boolean)\n                  .join(\" \")}\n                control={<Radio />}\n                disabled={!isOnline}\n              />\n              <FormControlLabel\n                value=\"makePersonal\"\n                label=\"Save a personal copy\"\n                control={<Radio />}\n              />\n            </RadioGroup>\n            {selectedKey === \"discard\" && (\n              <Typography variant=\"body2\" color=\"error.main\">\n                Your changes will be permantly deleted. This cannot be undone.\n              </Typography>\n            )}\n            {selectedKey === \"makePersonal\" && (\n              <TextField\n                autoFocus\n                variant=\"outlined\"\n                label=\"Layout name\"\n                value={personalCopyName}\n                onChange={handleNameChange}\n                error={nameError != undefined}\n                helperText={nameError}\n                FormHelperTextProps={{\n                  variant: \"standard\",\n                }}\n              />\n            )}\n          </Stack>\n        </DialogContent>\n        <DialogActions>\n          <Button variant=\"outlined\" size=\"large\" color=\"inherit\" onClick={handleCancel}>\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            size=\"large\"\n            variant=\"contained\"\n            color={selectedKey === \"discard\" ? \"error\" : \"primary\"}\n            disabled={selectedKey === \"makePersonal\" && nameError != undefined}\n          >\n            {selectedKey === \"discard\" ? \"Discard changes\" : \"Save\"}\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n}\n\nexport function useUnsavedChangesPrompt(): {\n  unsavedChangesPrompt?: JSX.Element;\n  openUnsavedChangesPrompt: (item: Layout) => Promise<UnsavedChangesResolution>;\n} {\n  const [layout, setLayout] = useState<Layout | undefined>();\n  const resolveRef = useRef<(res: UnsavedChangesResolution) => void>();\n\n  const layoutManager = useLayoutManager();\n  const [isOnline, setIsOnline] = useState(layoutManager.isOnline);\n\n  useLayoutEffect(() => {\n    const onlineListener = () => setIsOnline(layoutManager.isOnline);\n    onlineListener();\n    layoutManager.on(\"onlinechange\", onlineListener);\n    return () => layoutManager.off(\"onlinechange\", onlineListener);\n  }, [layoutManager]);\n\n  const unsavedChangesPrompt = useMemo(() => {\n    if (!layout) {\n      return undefined;\n    }\n    return (\n      <UnsavedChangesPrompt\n        layout={layout}\n        isOnline={isOnline}\n        onComplete={(value) => {\n          resolveRef.current?.(value);\n          resolveRef.current = undefined;\n          setLayout(undefined);\n        }}\n      />\n    );\n  }, [isOnline, layout]);\n\n  const openUnsavedChangesPrompt = useCallback(async (item: Layout) => {\n    setLayout(item);\n    return await new Promise<UnsavedChangesResolution>((resolve) => {\n      resolveRef.current?.({ type: \"cancel\" });\n      resolveRef.current = resolve;\n    });\n  }, []);\n\n  // Close automatically when unmounted\n  useUnmount(() => {\n    resolveRef.current?.({ type: \"cancel\" });\n  });\n  return { unsavedChangesPrompt, openUnsavedChangesPrompt };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\n\nimport { LayoutID } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\ntype ILayoutStorageDebugging = {\n  syncNow: () => Promise<void>;\n  // eslint-disable-next-line @foxglove/no-boolean-parameters\n  setOnline: (online: boolean) => void;\n  injectEdit: (id: LayoutID) => Promise<void>;\n  injectRename: (id: LayoutID) => Promise<void>;\n  injectDelete: (id: LayoutID) => Promise<void>;\n};\n\nconst LayoutStorageDebuggingContext = createContext<ILayoutStorageDebugging | undefined>(undefined);\nLayoutStorageDebuggingContext.displayName = \"LayoutStorageDebuggingContext\";\n\nexport default LayoutStorageDebuggingContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useSnackbar } from \"notistack\";\nimport { useCallback } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\n/**\n * A version of React.useCallback() displaying any errors thrown from the function as toast notifications.\n */\nexport default function useCallbackWithToast<Args extends unknown[]>(\n  callback: (...args: Args) => Promise<void> | void,\n  deps: unknown[],\n): (...args: Args) => Promise<void> {\n  const { enqueueSnackbar } = useSnackbar();\n  return useCallback(\n    async (...args: Args) => {\n      try {\n        return await callback(...args);\n      } catch (error) {\n        log.error(error);\n        enqueueSnackbar((error as Error).toString(), { variant: \"error\" });\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [enqueueSnackbar, ...deps],\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, Dialog, DialogActions, DialogContent, TextField, Typography } from \"@mui/material\";\nimport { FormEvent, useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useKeyPressEvent } from \"react-use\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\ntype PromptOptions = {\n  title: string;\n  subText?: string;\n  placeholder?: string;\n  initialValue?: string;\n  label?: string;\n\n  // Map the user-provided value to another value before returning it from prompt(). This function\n  // may throw an error; if it does, it will present as a validation error and the user will not be\n  // allowed to submit the prompt. (Note: ideally this would be generic `(value: string) => T`, but\n  // when doing that it's hard to keep it as an optional field since there is only a sensible\n  // default when T == string. See https://github.com/microsoft/TypeScript/issues/43425)\n  transformer?: (value: string) => string;\n};\n\ntype ModalPromptProps = PromptOptions & {\n  onComplete: (value: string | undefined) => void;\n};\n\nfunction ModalPrompt({\n  onComplete: originalOnComplete,\n  title,\n  subText,\n  placeholder,\n  initialValue,\n  label,\n  transformer,\n}: ModalPromptProps) {\n  const [value, setValue] = useState(initialValue ?? \"\");\n  const errorMessage = useMemo<string | undefined>(() => {\n    if (value === \"\") {\n      return undefined;\n    }\n    try {\n      transformer?.(value);\n    } catch (err) {\n      return err.toString();\n    }\n  }, [transformer, value]);\n\n  const onConfirmAction = () => {\n    try {\n      onComplete(transformer ? transformer(value) : value);\n    } catch (err) {\n      onComplete(undefined);\n    }\n  };\n\n  const onSubmitAction = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    onConfirmAction();\n  };\n\n  const completed = useRef(false);\n  const onComplete = useCallback(\n    (result: string | undefined) => {\n      if (!completed.current) {\n        completed.current = true;\n        originalOnComplete(result);\n      }\n    },\n    [originalOnComplete],\n  );\n\n  useKeyPressEvent(\"Enter\", onConfirmAction);\n\n  // Ensure we still call onComplete(undefined) when the component unmounts, if it hasn't been\n  // called already\n  useEffect(() => {\n    return () => onComplete(undefined);\n  }, [onComplete]);\n\n  return (\n    <Dialog open maxWidth=\"xs\" fullWidth onClose={() => onComplete(undefined)}>\n      <form onSubmit={onSubmitAction}>\n        <Stack paddingX={3} paddingTop={2}>\n          <Typography variant=\"h4\" fontWeight={600} gutterBottom>\n            {title}\n          </Typography>\n          {subText && (\n            <Typography variant=\"body1\" color=\"text.secondary\">\n              {subText}\n            </Typography>\n          )}\n        </Stack>\n        <DialogContent>\n          <TextField\n            label={label}\n            autoFocus\n            fullWidth\n            placeholder={placeholder}\n            value={value}\n            error={errorMessage != undefined}\n            helperText={errorMessage}\n            FormHelperTextProps={{\n              variant: \"standard\",\n            }}\n            onChange={(event) => setValue(event.target.value)}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button\n            color=\"inherit\"\n            size=\"large\"\n            variant=\"outlined\"\n            onClick={() => onComplete(undefined)}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            variant=\"contained\"\n            size=\"large\"\n            disabled={value === \"\" || errorMessage != undefined}\n          >\n            OK\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n}\n\n// Returns a function that can be used similarly to the DOM prompt(), but\n// backed by a React element rather than a native modal, and asynchronous.\nexport function usePrompt(): [\n  prompt: (options: PromptOptions) => Promise<string | undefined>,\n  promptModal: JSX.Element | undefined,\n] {\n  const [modal, setModal] = useState<JSX.Element | undefined>();\n\n  const runPrompt = useCallback(async (options: PromptOptions) => {\n    return await new Promise<string | undefined>((resolve) => {\n      setModal(\n        <ModalPrompt\n          {...options}\n          onComplete={(value) => {\n            resolve(value);\n            setModal(undefined);\n          }}\n        />,\n      );\n    });\n  }, []);\n\n  return [runPrompt, modal];\n}\n\nexport type { PromptOptions };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\n\n// We use \"brand\" tags to prevent confusion between string types with distinct meanings\n// https://github.com/microsoft/TypeScript/issues/4895\nexport type LayoutID = string & { __brand: \"LayoutID\" };\nexport type ISO8601Timestamp = string & { __brand: \"ISO8601Timestamp\" };\n\nexport type LayoutPermission = \"CREATOR_WRITE\" | \"ORG_READ\" | \"ORG_WRITE\";\n\nexport type LayoutSyncStatus =\n  | \"new\"\n  | \"updated\"\n  | \"tracked\"\n  | \"locally-deleted\"\n  | \"remotely-deleted\";\nexport type Layout = {\n  id: LayoutID;\n  name: string;\n  permission: LayoutPermission;\n\n  /** @deprecated old field name, migrated to working/baseline */\n  data?: LayoutData;\n  /** @deprecated old field name, migrated to working/baseline */\n  state?: LayoutData;\n\n  /** The last explicitly saved version of this layout. */\n  baseline: {\n    data: LayoutData;\n    savedAt: ISO8601Timestamp | undefined;\n  };\n\n  /**\n   * The working copy of this layout, if it has been edited since the last explicit save.\n   */\n  working:\n    | {\n        data: LayoutData;\n        savedAt: ISO8601Timestamp | undefined;\n      }\n    | undefined;\n\n  /** Info about this layout from remote storage. */\n  syncInfo:\n    | {\n        status: LayoutSyncStatus;\n        /** The last savedAt time returned by the server. */\n        lastRemoteSavedAt: ISO8601Timestamp | undefined;\n      }\n    | undefined;\n};\n\nexport interface ILayoutStorage {\n  list(namespace: string): Promise<readonly Layout[]>;\n  get(namespace: string, id: LayoutID): Promise<Layout | undefined>;\n  put(namespace: string, layout: Layout): Promise<Layout>;\n  delete(namespace: string, id: LayoutID): Promise<void>;\n\n  /**\n   * If applicable, the layout manager will call this method to migrate any old existing local\n   * layouts into the new namespace used for local layouts.\n   */\n  migrateUnnamespacedLayouts?(namespace: string): Promise<void>;\n\n  /**\n   * The layout manager will call this method to convert any local layouts to personal layouts when logging in.\n   */\n  importLayouts(params: { fromNamespace: string; toNamespace: string }): Promise<void>;\n}\n\nexport function layoutPermissionIsShared(\n  permission: LayoutPermission,\n): permission is Exclude<LayoutPermission, \"CREATOR_WRITE\"> {\n  return permission !== \"CREATOR_WRITE\";\n}\n\nexport function layoutIsShared(\n  layout: Layout,\n): layout is Layout & { permission: Exclude<LayoutPermission, \"CREATOR_WRITE\"> } {\n  return layoutPermissionIsShared(layout.permission);\n}\n\nexport function layoutAppearsDeleted(layout: Layout): boolean {\n  return (\n    layout.syncInfo?.status === \"locally-deleted\" ||\n    (layout.syncInfo?.status === \"remotely-deleted\" && layout.working == undefined)\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * A wrapper around window.showOpenFilePicker that returns an empty array instead of throwing when\n * the user cancels the file picker.\n */\nexport default async function showOpenFilePicker(\n  options?: OpenFilePickerOptions,\n): Promise<FileSystemFileHandle[] /* foxglove-depcheck-used: @types/wicg-file-system-access */> {\n  try {\n    return await window.showOpenFilePicker(options);\n  } catch (err) {\n    if (err.name === \"AbortError\") {\n      return [];\n    }\n    throw err;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport {\n  ListItem,\n  ListItemButton,\n  ListItemText,\n  IconButton,\n  Menu,\n  MenuItem,\n  SvgIcon,\n  Divider,\n  Typography,\n  TextField,\n  styled as muiStyled,\n} from \"@mui/material\";\nimport {\n  useCallback,\n  useContext,\n  useLayoutEffect,\n  useMemo,\n  useState,\n  MouseEvent,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { useMountedState } from \"react-use\";\n\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport LayoutStorageDebuggingContext from \"@foxglove/studio-base/context/LayoutStorageDebuggingContext\";\nimport { useConfirm } from \"@foxglove/studio-base/hooks/useConfirm\";\nimport { Layout, layoutIsShared } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\nconst StyledListItem = muiStyled(ListItem, {\n  shouldForwardProp: (prop) =>\n    prop !== \"hasModifications\" && prop !== \"deletedOnServer\" && prop !== \"editingName\",\n})<{ editingName: boolean; hasModifications: boolean; deletedOnServer: boolean }>(\n  ({ editingName, hasModifications, deletedOnServer, theme }) => ({\n    \".MuiListItemSecondaryAction-root\": {\n      right: theme.spacing(0.25),\n    },\n    \".MuiListItemButton-root\": {\n      maxWidth: \"100%\",\n    },\n    \"@media (pointer: fine)\": {\n      \".MuiListItemButton-root\": {\n        paddingRight: theme.spacing(4.5),\n      },\n      \".MuiListItemSecondaryAction-root\": {\n        visibility: !hasModifications && !deletedOnServer && \"hidden\",\n      },\n      \"&:hover .MuiListItemSecondaryAction-root\": {\n        visibility: \"visible\",\n      },\n    },\n    ...(editingName && {\n      \".MuiListItemButton-root\": {\n        paddingTop: theme.spacing(0.5),\n        paddingBottom: theme.spacing(0.5),\n        paddingLeft: theme.spacing(1),\n      },\n      \".MuiListItemText-root\": {\n        margin: 0,\n      },\n    }),\n  }),\n);\n\nconst StyledMenuItem = muiStyled(MenuItem, {\n  shouldForwardProp: (prop) => prop !== \"debug\",\n})<{ debug?: boolean }>(({ theme, debug = false }) => ({\n  position: \"relative\",\n\n  ...(debug && {\n    \"&:before\": {\n      content: \"''\",\n      position: \"absolute\",\n      left: 0,\n      top: 0,\n      bottom: 0,\n      width: 4,\n      backgroundColor: theme.palette.warning.main,\n      backgroundImage: `repeating-linear-gradient(${[\n        \"-35deg\",\n        \"transparent\",\n        \"transparent 6px\",\n        `${theme.palette.common.black} 6px`,\n        `${theme.palette.common.black} 12px`,\n      ].join(\",\")})`,\n    },\n  }),\n}));\n\nexport type LayoutActionMenuItem =\n  | {\n      type: \"item\";\n      text: string;\n      secondaryText?: string;\n      key: string;\n      onClick?: (event: React.MouseEvent<HTMLLIElement>) => void;\n      disabled?: boolean;\n      debug?: boolean;\n      \"data-testid\"?: string;\n    }\n  | {\n      type: \"divider\";\n      key: string;\n      debug?: boolean;\n    }\n  | {\n      type: \"header\";\n      key: string;\n      text: string;\n      debug?: boolean;\n    };\n\nexport default React.memo(function LayoutRow({\n  layout,\n  anySelectedModifiedLayouts,\n  multiSelectedIds,\n  selected,\n  onSelect,\n  onRename,\n  onDuplicate,\n  onDelete,\n  onShare,\n  onExport,\n  onOverwrite,\n  onRevert,\n  onMakePersonalCopy,\n}: {\n  layout: Layout;\n  anySelectedModifiedLayouts: boolean;\n  multiSelectedIds: readonly string[];\n  selected: boolean;\n  onSelect: (item: Layout, params?: { selectedViaClick?: boolean; event?: MouseEvent }) => void;\n  onRename: (item: Layout, newName: string) => void;\n  onDuplicate: (item: Layout) => void;\n  onDelete: (item: Layout) => void;\n  onShare: (item: Layout) => void;\n  onExport: (item: Layout) => void;\n  onOverwrite: (item: Layout) => void;\n  onRevert: (item: Layout) => void;\n  onMakePersonalCopy: (item: Layout) => void;\n}): JSX.Element {\n  const isMounted = useMountedState();\n  const [confirm, confirmModal] = useConfirm();\n  const layoutDebug = useContext(LayoutStorageDebuggingContext);\n  const layoutManager = useLayoutManager();\n\n  const [editingName, setEditingName] = useState(false);\n  const [nameFieldValue, setNameFieldValue] = useState(\"\");\n  const [isOnline, setIsOnline] = useState(layoutManager.isOnline);\n  const [contextMenuTarget, setContextMenuTarget] = useState<\n    | { type: \"position\"; mouseX: number; mouseY: number; element?: undefined }\n    | { type: \"element\"; element: Element }\n    | undefined\n  >(undefined);\n\n  const deletedOnServer = layout.syncInfo?.status === \"remotely-deleted\";\n  const hasModifications = layout.working != undefined;\n  const multiSelection = multiSelectedIds.length > 1;\n\n  useLayoutEffect(() => {\n    const onlineListener = () => setIsOnline(layoutManager.isOnline);\n    onlineListener();\n    layoutManager.on(\"onlinechange\", onlineListener);\n    return () => {\n      layoutManager.off(\"onlinechange\", onlineListener);\n    };\n  }, [layoutManager]);\n\n  const overwriteAction = useCallback(() => {\n    onOverwrite(layout);\n  }, [layout, onOverwrite]);\n\n  const confirmRevert = useCallback(async () => {\n    const response = await confirm({\n      title: multiSelection ? `Revert layouts` : `Revert “${layout.name}”?`,\n      prompt: \"Your changes will be permantly discarded. This cannot be undone.\",\n      ok: \"Discard changes\",\n      variant: \"danger\",\n    });\n    if (response !== \"ok\") {\n      return;\n    }\n\n    onRevert(layout);\n  }, [confirm, layout, multiSelection, onRevert]);\n\n  const makePersonalCopyAction = useCallback(() => {\n    onMakePersonalCopy(layout);\n  }, [layout, onMakePersonalCopy]);\n\n  const renameAction = useCallback(() => {\n    setNameFieldValue(layout.name);\n    setEditingName(true);\n  }, [layout]);\n\n  const onClick = useCallback(\n    (event: MouseEvent) => {\n      onSelect(layout, { selectedViaClick: true, event });\n    },\n    [layout, onSelect],\n  );\n\n  const duplicateAction = useCallback(() => onDuplicate(layout), [layout, onDuplicate]);\n  const shareAction = useCallback(() => onShare(layout), [layout, onShare]);\n  const exportAction = useCallback(() => onExport(layout), [layout, onExport]);\n\n  const onSubmit = useCallback(\n    (event: React.FormEvent) => {\n      event.preventDefault();\n      if (!editingName) {\n        return;\n      }\n      const newName = nameFieldValue;\n      if (newName && newName !== layout.name) {\n        onRename(layout, newName);\n      }\n      setEditingName(false);\n    },\n    [editingName, layout, nameFieldValue, onRename],\n  );\n\n  const onTextFieldKeyDown = useCallback((event: React.KeyboardEvent) => {\n    if (event.key === \"Escape\") {\n      setEditingName(false);\n    }\n  }, []);\n\n  const onBlur = useCallback(\n    (event: React.FocusEvent) => {\n      onSubmit(event);\n    },\n    [onSubmit],\n  );\n\n  const nameInputRef = useRef<HTMLInputElement>(ReactNull);\n\n  const confirmDelete = useCallback(() => {\n    const layoutWarning =\n      !multiSelection && layoutIsShared(layout)\n        ? \"Organization members will no longer be able to access this layout. \"\n        : \"\";\n    const prompt = `${layoutWarning}This action cannot be undone.`;\n    const title = multiSelection ? \"Delete selected layouts?\" : `Delete “${layout.name}”?`;\n    void confirm({\n      title,\n      prompt,\n      ok: \"Delete\",\n      variant: \"danger\",\n    }).then((response) => {\n      if (response === \"ok\" && isMounted()) {\n        onDelete(layout);\n      }\n    });\n  }, [confirm, isMounted, layout, multiSelection, onDelete]);\n\n  const handleContextMenu = useCallback((event: React.MouseEvent) => {\n    event.preventDefault();\n    setContextMenuTarget((target) =>\n      target == undefined\n        ? { type: \"position\", mouseX: event.clientX, mouseY: event.clientY }\n        : undefined,\n    );\n  }, []);\n\n  const handleMenuButtonClick = useCallback((event: React.MouseEvent) => {\n    event.preventDefault();\n    const { currentTarget } = event;\n    setContextMenuTarget((target) =>\n      target == undefined ? { type: \"element\", element: currentTarget } : undefined,\n    );\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setContextMenuTarget(undefined);\n  }, []);\n\n  const menuItems: (boolean | LayoutActionMenuItem)[] = [\n    {\n      type: \"item\",\n      key: \"rename\",\n      text: \"Rename\",\n      onClick: renameAction,\n      \"data-testid\": \"rename-layout\",\n      disabled: (layoutIsShared(layout) && !isOnline) || multiSelection,\n      secondaryText: layoutIsShared(layout) && !isOnline ? \"Offline\" : undefined,\n    },\n    // For shared layouts, duplicate first requires saving or discarding changes\n    !(layoutIsShared(layout) && hasModifications) && {\n      type: \"item\",\n      key: \"duplicate\",\n      text:\n        layoutManager.supportsSharing && layoutIsShared(layout)\n          ? \"Make a personal copy\"\n          : \"Duplicate\",\n      onClick: duplicateAction,\n      \"data-testid\": \"duplicate-layout\",\n    },\n    layoutManager.supportsSharing &&\n      !layoutIsShared(layout) && {\n        type: \"item\",\n        key: \"share\",\n        text: \"Share with team…\",\n        onClick: shareAction,\n        disabled: !isOnline || multiSelection,\n        secondaryText: !isOnline ? \"Offline\" : undefined,\n      },\n    {\n      type: \"item\",\n      key: \"export\",\n      text: \"Export…\",\n      disabled: multiSelection,\n      onClick: exportAction,\n    },\n    { key: \"divider_1\", type: \"divider\" },\n    {\n      type: \"item\",\n      key: \"delete\",\n      text: \"Delete\",\n      onClick: confirmDelete,\n      \"data-testid\": \"delete-layout\",\n    },\n  ];\n\n  if (hasModifications || anySelectedModifiedLayouts) {\n    const sectionItems: LayoutActionMenuItem[] = [\n      {\n        type: \"item\",\n        key: \"overwrite\",\n        text: \"Save changes\",\n        onClick: overwriteAction,\n        disabled: deletedOnServer || (layoutIsShared(layout) && !isOnline),\n        secondaryText: layoutIsShared(layout) && !isOnline ? \"Offline\" : undefined,\n      },\n      {\n        type: \"item\",\n        key: \"revert\",\n        text: \"Revert\",\n        onClick: confirmRevert,\n        disabled: deletedOnServer,\n      },\n    ];\n    if (layoutIsShared(layout)) {\n      sectionItems.push({\n        type: \"item\",\n        key: \"copy_to_personal\",\n        text: \"Make a personal copy\",\n        disabled: multiSelection,\n        onClick: makePersonalCopyAction,\n      });\n    }\n\n    const unsavedChangesMessage = anySelectedModifiedLayouts\n      ? \"These layouts have unsaved changes\"\n      : \"This layout has unsaved changes\";\n\n    menuItems.unshift(\n      {\n        key: \"changes\",\n        type: \"header\",\n        text: deletedOnServer ? \"Someone else has deleted this layout\" : unsavedChangesMessage,\n      },\n      ...sectionItems,\n      { key: \"changes_divider\", type: \"divider\" },\n    );\n  }\n\n  if (layoutDebug) {\n    menuItems.push(\n      { key: \"debug_divider\", type: \"divider\" },\n      {\n        type: \"item\",\n        key: \"debug_id\",\n        text: layout.id,\n        disabled: true,\n        debug: true,\n      },\n      {\n        type: \"item\",\n        key: \"debug_updated_at\",\n        text: `Saved at: ${layout.working?.savedAt ?? layout.baseline.savedAt}`,\n        disabled: true,\n        debug: true,\n      },\n      {\n        type: \"item\",\n        key: \"debug_sync_status\",\n        text: `Sync status: ${layout.syncInfo?.status}`,\n        disabled: true,\n        debug: true,\n      },\n      {\n        type: \"item\",\n        key: \"debug_edit\",\n        text: \"Inject edit\",\n        onClick: () => void layoutDebug.injectEdit(layout.id),\n        debug: true,\n      },\n      {\n        type: \"item\",\n        key: \"debug_rename\",\n        text: \"Inject rename\",\n        onClick: () => void layoutDebug.injectRename(layout.id),\n        debug: true,\n      },\n      {\n        type: \"item\",\n        key: \"debug_delete\",\n        text: \"Inject delete\",\n        onClick: () => void layoutDebug.injectDelete(layout.id),\n        debug: true,\n      },\n    );\n  }\n\n  const filteredItems = menuItems.filter(\n    (item): item is LayoutActionMenuItem => typeof item === \"object\",\n  );\n\n  const actionIcon = useMemo(\n    () =>\n      deletedOnServer ? (\n        <ErrorIcon fontSize=\"small\" color=\"error\" />\n      ) : hasModifications ? (\n        <SvgIcon fontSize=\"small\" color=\"primary\">\n          <circle cx={12} cy={12} r={4} />\n        </SvgIcon>\n      ) : (\n        <MoreVertIcon fontSize=\"small\" />\n      ),\n    [deletedOnServer, hasModifications],\n  );\n\n  useEffect(() => {\n    if (editingName) {\n      nameInputRef.current?.focus();\n      nameInputRef.current?.select();\n    }\n  }, [editingName]);\n\n  return (\n    <StyledListItem\n      editingName={editingName}\n      hasModifications={hasModifications}\n      deletedOnServer={deletedOnServer}\n      disablePadding\n      secondaryAction={\n        <IconButton\n          data-testid=\"layout-actions\"\n          aria-controls={contextMenuTarget != undefined ? \"layout-action-menu\" : undefined}\n          aria-haspopup=\"true\"\n          aria-expanded={contextMenuTarget != undefined ? \"true\" : undefined}\n          onClick={handleMenuButtonClick}\n          onContextMenu={handleContextMenu}\n        >\n          {actionIcon}\n        </IconButton>\n      }\n    >\n      {confirmModal}\n      <ListItemButton\n        data-testid=\"layout-list-item\"\n        selected={selected || multiSelectedIds.includes(layout.id)}\n        onSubmit={onSubmit}\n        onClick={editingName ? undefined : onClick}\n        onContextMenu={editingName ? undefined : handleContextMenu}\n        component=\"form\"\n      >\n        <ListItemText disableTypography>\n          <TextField\n            inputRef={nameInputRef}\n            value={nameFieldValue}\n            onChange={(event) => setNameFieldValue(event.target.value)}\n            onKeyDown={onTextFieldKeyDown}\n            onBlur={onBlur}\n            fullWidth\n            style={{\n              font: \"inherit\",\n              display: editingName ? \"inline\" : \"none\",\n            }}\n            size=\"small\"\n            variant=\"filled\"\n          />\n          <Typography\n            component=\"span\"\n            variant=\"inherit\"\n            color=\"inherit\"\n            noWrap\n            style={{ display: editingName ? \"none\" : \"block\" }}\n          >\n            {layout.name}\n          </Typography>\n        </ListItemText>\n      </ListItemButton>\n      <Menu\n        id=\"layout-action-menu\"\n        open={contextMenuTarget != undefined}\n        disableAutoFocus\n        disableRestoreFocus\n        anchorReference={contextMenuTarget?.type === \"position\" ? \"anchorPosition\" : \"anchorEl\"}\n        anchorPosition={\n          contextMenuTarget?.type === \"position\"\n            ? { top: contextMenuTarget.mouseY, left: contextMenuTarget.mouseX }\n            : undefined\n        }\n        anchorEl={contextMenuTarget?.element}\n        onClose={handleClose}\n        MenuListProps={{\n          \"aria-labelledby\": \"layout-actions\",\n          dense: true,\n        }}\n      >\n        {filteredItems.map((item) => {\n          switch (item.type) {\n            case \"divider\":\n              return <Divider key={item.key} variant=\"middle\" />;\n            case \"item\":\n              return (\n                <StyledMenuItem\n                  debug={item.debug}\n                  disabled={item.disabled}\n                  key={item.key}\n                  data-testid={item[\"data-testid\"]}\n                  onClick={(event) => {\n                    item.onClick?.(event);\n                    handleClose();\n                  }}\n                >\n                  <Typography variant=\"inherit\" color={item.key === \"delete\" ? \"error\" : undefined}>\n                    {item.text}\n                  </Typography>\n                </StyledMenuItem>\n              );\n            case \"header\":\n              return (\n                <MenuItem disabled key={item.key}>\n                  {item.text}\n                </MenuItem>\n              );\n            default:\n              return undefined;\n          }\n        })}\n      </Menu>\n    </StyledListItem>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography, List } from \"@mui/material\";\nimport { MouseEvent } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { Layout } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\nimport LayoutRow from \"./LayoutRow\";\n\nexport default function LayoutSection({\n  title,\n  disablePadding = false,\n  emptyText,\n  items,\n  anySelectedModifiedLayouts,\n  multiSelectedIds,\n  selectedId,\n  onSelect,\n  onRename,\n  onDuplicate,\n  onDelete,\n  onShare,\n  onExport,\n  onOverwrite,\n  onRevert,\n  onMakePersonalCopy,\n}: {\n  title: string | undefined;\n  disablePadding?: boolean;\n  emptyText: string | undefined;\n  items: readonly Layout[] | undefined;\n  anySelectedModifiedLayouts: boolean;\n  multiSelectedIds: readonly string[];\n  selectedId?: string;\n  onSelect: (item: Layout, params?: { selectedViaClick?: boolean; event?: MouseEvent }) => void;\n  onRename: (item: Layout, newName: string) => void;\n  onDuplicate: (item: Layout) => void;\n  onDelete: (item: Layout) => void;\n  onShare: (item: Layout) => void;\n  onExport: (item: Layout) => void;\n  onOverwrite: (item: Layout) => void;\n  onRevert: (item: Layout) => void;\n  onMakePersonalCopy: (item: Layout) => void;\n}): JSX.Element {\n  return (\n    <Stack>\n      {title != undefined && (\n        <Stack paddingX={2} paddingY={disablePadding ? 1 : 0}>\n          <Typography variant=\"overline\" color=\"text.secondary\">\n            {title}\n          </Typography>\n        </Stack>\n      )}\n      <List disablePadding={disablePadding}>\n        {items != undefined && items.length === 0 && (\n          <Stack paddingX={2}>\n            <Typography variant=\"body2\" color=\"text.secondary\">\n              {emptyText}\n            </Typography>\n          </Stack>\n        )}\n        {items?.map((layout) => (\n          <LayoutRow\n            anySelectedModifiedLayouts={anySelectedModifiedLayouts}\n            multiSelectedIds={multiSelectedIds}\n            selected={layout.id === selectedId}\n            key={layout.id}\n            layout={layout}\n            onSelect={onSelect}\n            onRename={onRename}\n            onDuplicate={onDuplicate}\n            onDelete={onDelete}\n            onShare={onShare}\n            onExport={onExport}\n            onOverwrite={onOverwrite}\n            onRevert={onRevert}\n            onMakePersonalCopy={onMakePersonalCopy}\n          />\n        ))}\n      </List>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { compact, pull, union, xor } from \"lodash\";\nimport { Dispatch } from \"react\";\nimport { useImmerReducer } from \"use-immer\";\n\nimport { Layout } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\ntype MultiAction = \"delete\" | \"duplicate\" | \"revert\" | \"save\";\n\ntype State = {\n  busy: boolean;\n  error: undefined | Error;\n  online: boolean;\n  lastSelectedId: undefined | string;\n  multiAction: undefined | { action: MultiAction; ids: string[] };\n  selectedIds: string[];\n};\n\ntype Action =\n  | { type: \"clear-multi-action\" }\n  | { type: \"queue-multi-action\"; action: MultiAction }\n  | {\n      type: \"select-id\";\n      id?: string;\n      layouts?: undefined | { personal: Layout[]; shared: Layout[] };\n      shiftKey?: boolean;\n      modKey?: boolean;\n    }\n  | { type: \"set-busy\"; value: boolean }\n  | { type: \"set-error\"; value: undefined | Error }\n  | { type: \"set-online\"; value: boolean }\n  | { type: \"shift-multi-action\" };\n\nfunction reducer(draft: State, action: Action) {\n  switch (action.type) {\n    case \"clear-multi-action\":\n      draft.multiAction = undefined;\n      break;\n    case \"queue-multi-action\":\n      draft.multiAction = { action: action.action, ids: draft.selectedIds };\n      break;\n    case \"select-id\":\n      if (action.modKey === true) {\n        draft.selectedIds = xor(draft.selectedIds, compact([action.id]));\n      } else if (action.shiftKey === true) {\n        for (const layouts of Object.values(action.layouts ?? {})) {\n          const lastId = layouts.findIndex((layout) => layout.id === draft.lastSelectedId);\n          const thisId = layouts.findIndex((layout) => layout.id === action.id);\n          if (lastId !== -1 && thisId !== -1) {\n            const start = Math.min(lastId, thisId);\n            const end = Math.max(lastId, thisId);\n            for (let i = start; i <= end; i++) {\n              draft.selectedIds = union(draft.selectedIds, [layouts[i]!.id]);\n            }\n          }\n        }\n      } else {\n        draft.multiAction = undefined;\n        draft.selectedIds = compact([action.id]);\n      }\n      draft.lastSelectedId = action.id;\n      break;\n    case \"set-busy\":\n      draft.busy = action.value;\n      break;\n    case \"set-error\":\n      draft.error = action.value;\n      break;\n    case \"set-online\":\n      draft.online = action.value;\n      break;\n    case \"shift-multi-action\": {\n      const id = draft.multiAction?.ids.shift();\n      if (draft.multiAction?.ids.length === 0) {\n        draft.multiAction = undefined;\n      }\n      pull(draft.selectedIds, id);\n      break;\n    }\n  }\n}\n\nexport function useLayoutBrowserReducer(\n  props: Pick<State, \"busy\" | \"error\" | \"online\" | \"lastSelectedId\">,\n): [State, Dispatch<Action>] {\n  return useImmerReducer(reducer, {\n    ...props,\n    selectedIds: [],\n    multiAction: undefined,\n  });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport AddIcon from \"@mui/icons-material/Add\";\nimport CloudOffIcon from \"@mui/icons-material/CloudOff\";\nimport FileOpenOutlinedIcon from \"@mui/icons-material/FileOpenOutlined\";\nimport {\n  Button,\n  IconButton,\n  Switch,\n  FormGroup,\n  FormControlLabel,\n  CircularProgress,\n  List,\n  ListItem,\n  ListItemButton,\n  ListItemText,\n  Divider,\n} from \"@mui/material\";\nimport { partition } from \"lodash\";\nimport moment from \"moment\";\nimport { useSnackbar } from \"notistack\";\nimport path from \"path\";\nimport { MouseEvent, useCallback, useContext, useEffect, useLayoutEffect, useMemo } from \"react\";\nimport { useMountedState } from \"react-use\";\nimport useAsyncFn from \"react-use/lib/useAsyncFn\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Logger from \"@foxglove/log\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport SignInPrompt from \"@foxglove/studio-base/components/LayoutBrowser/SignInPrompt\";\nimport { useUnsavedChangesPrompt } from \"@foxglove/studio-base/components/LayoutBrowser/UnsavedChangesPrompt\";\nimport { SidebarContent } from \"@foxglove/studio-base/components/SidebarContent\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport LayoutStorageDebuggingContext from \"@foxglove/studio-base/context/LayoutStorageDebuggingContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport useCallbackWithToast from \"@foxglove/studio-base/hooks/useCallbackWithToast\";\nimport { useConfirm } from \"@foxglove/studio-base/hooks/useConfirm\";\nimport { usePrompt } from \"@foxglove/studio-base/hooks/usePrompt\";\nimport { defaultPlaybackConfig } from \"@foxglove/studio-base/providers/CurrentLayoutProvider/reducers\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport { Layout, LayoutID, layoutIsShared } from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport { downloadTextFile } from \"@foxglove/studio-base/util/download\";\nimport showOpenFilePicker from \"@foxglove/studio-base/util/showOpenFilePicker\";\n\nimport LayoutSection from \"./LayoutSection\";\nimport { useLayoutBrowserReducer } from \"./reducer\";\n\nconst log = Logger.getLogger(__filename);\n\nconst selectedLayoutIdSelector = (state: LayoutState) => state.selectedLayout?.id;\n\nconst useStyles = makeStyles()((theme) => ({\n  debugBanner: {\n    bottom: 0,\n    left: 0,\n    right: 0,\n    background: theme.palette.background.paper,\n    borderWidth: 4,\n    borderStyle: \"solid\",\n    borderImage: `repeating-linear-gradient(${[\n      \"-45deg\",\n      theme.palette.warning.main,\n      `${theme.palette.warning.main} 6px`,\n      \"#121217 6px\",\n      \"#121217 12px\",\n    ].join(\",\")}) 4`,\n  },\n  actionList: {\n    paddingTop: theme.spacing(1),\n  },\n}));\n\nexport default function LayoutBrowser({\n  menuClose,\n  currentDateForStorybook,\n}: React.PropsWithChildren<{\n  menuClose?: () => void;\n  currentDateForStorybook?: Date;\n}>): JSX.Element {\n  const { classes } = useStyles();\n  const { signIn } = useCurrentUser();\n  const isMounted = useMountedState();\n  const { enqueueSnackbar } = useSnackbar();\n  const layoutManager = useLayoutManager();\n  const [prompt, promptModal] = usePrompt();\n  const analytics = useAnalytics();\n  const [confirm, confirmModal] = useConfirm();\n  const { unsavedChangesPrompt, openUnsavedChangesPrompt } = useUnsavedChangesPrompt();\n\n  const currentLayoutId = useCurrentLayoutSelector(selectedLayoutIdSelector);\n  const { setSelectedLayoutId } = useCurrentLayoutActions();\n\n  const [state, dispatch] = useLayoutBrowserReducer({\n    lastSelectedId: currentLayoutId,\n    busy: layoutManager.isBusy,\n    error: layoutManager.error,\n    online: layoutManager.isOnline,\n  });\n\n  useLayoutEffect(() => {\n    const busyListener = () => {\n      dispatch({ type: \"set-busy\", value: layoutManager.isBusy });\n    };\n    const onlineListener = () => dispatch({ type: \"set-online\", value: layoutManager.isOnline });\n    const errorListener = () => dispatch({ type: \"set-error\", value: layoutManager.error });\n    busyListener();\n    onlineListener();\n    errorListener();\n    layoutManager.on(\"busychange\", busyListener);\n    layoutManager.on(\"onlinechange\", onlineListener);\n    layoutManager.on(\"errorchange\", errorListener);\n    return () => {\n      layoutManager.off(\"busychange\", busyListener);\n      layoutManager.off(\"onlinechange\", onlineListener);\n      layoutManager.off(\"errorchange\", errorListener);\n    };\n  }, [dispatch, layoutManager]);\n\n  const [layouts, reloadLayouts] = useAsyncFn(\n    async () => {\n      const [shared, personal] = partition(\n        await layoutManager.getLayouts(),\n        layoutManager.supportsSharing ? layoutIsShared : () => false,\n      );\n      return {\n        personal: personal.sort((a, b) => a.name.localeCompare(b.name)),\n        shared: shared.sort((a, b) => a.name.localeCompare(b.name)),\n      };\n    },\n    [layoutManager],\n    { loading: true },\n  );\n\n  useEffect(() => {\n    const processAction = async () => {\n      if (!state.multiAction) {\n        return;\n      }\n\n      const id = state.multiAction.ids[0];\n      if (id) {\n        try {\n          switch (state.multiAction.action) {\n            case \"delete\":\n              await layoutManager.deleteLayout({ id: id as LayoutID });\n              dispatch({ type: \"shift-multi-action\" });\n              break;\n            case \"duplicate\": {\n              const layout = await layoutManager.getLayout(id as LayoutID);\n              if (layout) {\n                await layoutManager.saveNewLayout({\n                  name: `${layout.name} copy`,\n                  data: layout.working?.data ?? layout.baseline.data,\n                  permission: \"CREATOR_WRITE\",\n                });\n              }\n              dispatch({ type: \"shift-multi-action\" });\n              break;\n            }\n            case \"revert\":\n              await layoutManager.revertLayout({ id: id as LayoutID });\n              dispatch({ type: \"shift-multi-action\" });\n              break;\n            case \"save\":\n              await layoutManager.overwriteLayout({ id: id as LayoutID });\n              dispatch({ type: \"shift-multi-action\" });\n              break;\n          }\n        } catch (err) {\n          enqueueSnackbar(`Error processing layouts: ${err.message}`, { variant: \"error\" });\n          dispatch({ type: \"clear-multi-action\" });\n        }\n      }\n    };\n\n    processAction().catch((err) => log.error(err));\n  }, [dispatch, enqueueSnackbar, layoutManager, state.multiAction]);\n\n  useEffect(() => {\n    const listener = () => void reloadLayouts();\n    layoutManager.on(\"change\", listener);\n    return () => layoutManager.off(\"change\", listener);\n  }, [layoutManager, reloadLayouts]);\n\n  // Start loading on first mount\n  useEffect(() => {\n    reloadLayouts().catch((err) => log.error(err));\n  }, [reloadLayouts]);\n\n  /**\n   * Don't allow the user to switch away from a personal layout if they have unsaved changes. This\n   * currently has a race condition because of the throttled save in CurrentLayoutProvider -- it's\n   * possible to make changes and switch layouts before they're sent to the layout manager.\n   * @returns true if the original action should continue, false otherwise\n   */\n  const promptForUnsavedChanges = useCallback(async () => {\n    const currentLayout =\n      currentLayoutId != undefined ? await layoutManager.getLayout(currentLayoutId) : undefined;\n    if (\n      currentLayout != undefined &&\n      layoutIsShared(currentLayout) &&\n      currentLayout.working != undefined\n    ) {\n      const result = await openUnsavedChangesPrompt(currentLayout);\n      switch (result.type) {\n        case \"cancel\":\n          return false;\n        case \"discard\":\n          await layoutManager.revertLayout({ id: currentLayout.id });\n          void analytics.logEvent(AppEvent.LAYOUT_REVERT, {\n            permission: currentLayout.permission,\n            context: \"UnsavedChangesPrompt\",\n          });\n          return true;\n        case \"overwrite\":\n          await layoutManager.overwriteLayout({ id: currentLayout.id });\n          void analytics.logEvent(AppEvent.LAYOUT_OVERWRITE, {\n            permission: currentLayout.permission,\n            context: \"UnsavedChangesPrompt\",\n          });\n          return true;\n        case \"makePersonal\":\n          // We don't use onMakePersonalCopy() here because it might need to prompt for unsaved changes, and we don't want to select the newly created layout\n          await layoutManager.makePersonalCopy({\n            id: currentLayout.id,\n            name: result.name,\n          });\n          void analytics.logEvent(AppEvent.LAYOUT_MAKE_PERSONAL_COPY, {\n            permission: currentLayout.permission,\n            syncStatus: currentLayout.syncInfo?.status,\n            context: \"UnsavedChangesPrompt\",\n          });\n          return true;\n      }\n    }\n    return true;\n  }, [analytics, currentLayoutId, layoutManager, openUnsavedChangesPrompt]);\n\n  const onSelectLayout = useCallbackWithToast(\n    async (\n      item: Layout,\n      { selectedViaClick = false, event }: { selectedViaClick?: boolean; event?: MouseEvent } = {},\n    ) => {\n      if (selectedViaClick) {\n        if (!(await promptForUnsavedChanges())) {\n          return;\n        }\n        void analytics.logEvent(AppEvent.LAYOUT_SELECT, { permission: item.permission });\n      }\n      if (event?.ctrlKey === true || event?.metaKey === true || event?.shiftKey === true) {\n        if (item.id !== currentLayoutId) {\n          dispatch({\n            type: \"select-id\",\n            id: item.id,\n            layouts: layouts.value,\n            modKey: event.ctrlKey || event.metaKey,\n            shiftKey: event.shiftKey,\n          });\n        }\n      } else {\n        setSelectedLayoutId(item.id);\n        dispatch({ type: \"select-id\", id: item.id });\n        menuClose?.();\n      }\n    },\n    [\n      analytics,\n      currentLayoutId,\n      dispatch,\n      layouts.value,\n      menuClose,\n      promptForUnsavedChanges,\n      setSelectedLayoutId,\n    ],\n  );\n\n  const onRenameLayout = useCallbackWithToast(\n    async (item: Layout, newName: string) => {\n      await layoutManager.updateLayout({ id: item.id, name: newName });\n      void analytics.logEvent(AppEvent.LAYOUT_RENAME, { permission: item.permission });\n    },\n    [analytics, layoutManager],\n  );\n\n  const onDuplicateLayout = useCallbackWithToast(\n    async (item: Layout) => {\n      if (state.selectedIds.length > 1) {\n        dispatch({ type: \"queue-multi-action\", action: \"duplicate\" });\n        return;\n      }\n\n      if (!(await promptForUnsavedChanges())) {\n        return;\n      }\n      const newLayout = await layoutManager.saveNewLayout({\n        name: `${item.name} copy`,\n        data: item.working?.data ?? item.baseline.data,\n        permission: \"CREATOR_WRITE\",\n      });\n      await onSelectLayout(newLayout);\n      void analytics.logEvent(AppEvent.LAYOUT_DUPLICATE, { permission: item.permission });\n    },\n    [\n      analytics,\n      dispatch,\n      layoutManager,\n      onSelectLayout,\n      promptForUnsavedChanges,\n      state.selectedIds.length,\n    ],\n  );\n\n  const onDeleteLayout = useCallbackWithToast(\n    async (item: Layout) => {\n      if (state.selectedIds.length > 1) {\n        dispatch({ type: \"queue-multi-action\", action: \"delete\" });\n        return;\n      }\n\n      void analytics.logEvent(AppEvent.LAYOUT_DELETE, { permission: item.permission });\n\n      // If the layout was selected, select a different available layout.\n      //\n      // When a users current layout is deleted, we display a notice. By selecting a new layout\n      // before deleting their current layout we avoid the weirdness of displaying a notice that the\n      // user just deleted their current layout which is somewhat obvious to the user.\n      if (currentLayoutId === item.id) {\n        const storedLayouts = await layoutManager.getLayouts();\n        const targetLayout = storedLayouts.find((layout) => layout.id !== currentLayoutId);\n        setSelectedLayoutId(targetLayout?.id);\n        dispatch({ type: \"select-id\", id: targetLayout?.id });\n      }\n      await layoutManager.deleteLayout({ id: item.id });\n    },\n    [\n      analytics,\n      currentLayoutId,\n      dispatch,\n      layoutManager,\n      setSelectedLayoutId,\n      state.selectedIds.length,\n    ],\n  );\n\n  const createNewLayout = useCallbackWithToast(async () => {\n    if (!(await promptForUnsavedChanges())) {\n      return;\n    }\n    const name = `Unnamed layout ${moment(currentDateForStorybook).format(\"l\")} at ${moment(\n      currentDateForStorybook,\n    ).format(\"LT\")}`;\n    const layoutData: Omit<LayoutData, \"name\" | \"id\"> = {\n      configById: {},\n      globalVariables: {},\n      userNodes: {},\n      playbackConfig: defaultPlaybackConfig,\n    };\n    const newLayout = await layoutManager.saveNewLayout({\n      name,\n      data: layoutData as LayoutData,\n      permission: \"CREATOR_WRITE\",\n    });\n    void onSelectLayout(newLayout);\n\n    void analytics.logEvent(AppEvent.LAYOUT_CREATE);\n  }, [promptForUnsavedChanges, currentDateForStorybook, layoutManager, onSelectLayout, analytics]);\n\n  const onExportLayout = useCallbackWithToast(\n    async (item: Layout) => {\n      const content = JSON.stringify(item.working?.data ?? item.baseline.data, undefined, 2) ?? \"\";\n      downloadTextFile(content, `${item.name}.json`);\n      void analytics.logEvent(AppEvent.LAYOUT_EXPORT, { permission: item.permission });\n    },\n    [analytics],\n  );\n\n  const onShareLayout = useCallbackWithToast(\n    async (item: Layout) => {\n      const name = await prompt({\n        title: \"Share a copy with your organization\",\n        subText: \"Shared layouts can be used and changed by other members of your organization.\",\n        initialValue: item.name,\n        label: \"Layout name\",\n      });\n      if (name != undefined) {\n        const newLayout = await layoutManager.saveNewLayout({\n          name,\n          data: item.working?.data ?? item.baseline.data,\n          permission: \"ORG_WRITE\",\n        });\n        void analytics.logEvent(AppEvent.LAYOUT_SHARE, { permission: item.permission });\n        await onSelectLayout(newLayout);\n      }\n    },\n    [analytics, layoutManager, onSelectLayout, prompt],\n  );\n\n  const onOverwriteLayout = useCallbackWithToast(\n    async (item: Layout) => {\n      // We don't need to confirm the multiple selection case because we force users to save\n      // or abandon changes before selecting another layout with unsaved changes to the current\n      // shared layout.\n      if (state.selectedIds.length > 1) {\n        dispatch({ type: \"queue-multi-action\", action: \"save\" });\n        return;\n      }\n\n      if (layoutIsShared(item)) {\n        const response = await confirm({\n          title: `Update “${item.name}”?`,\n          prompt:\n            \"Your changes will overwrite this layout for all organization members. This cannot be undone.\",\n          ok: \"Save\",\n        });\n        if (response !== \"ok\") {\n          return;\n        }\n      }\n      await layoutManager.overwriteLayout({ id: item.id });\n      void analytics.logEvent(AppEvent.LAYOUT_OVERWRITE, { permission: item.permission });\n    },\n    [analytics, confirm, dispatch, layoutManager, state.selectedIds.length],\n  );\n\n  const onRevertLayout = useCallbackWithToast(\n    async (item: Layout) => {\n      if (state.selectedIds.length > 1) {\n        dispatch({ type: \"queue-multi-action\", action: \"revert\" });\n        return;\n      }\n\n      await layoutManager.revertLayout({ id: item.id });\n      void analytics.logEvent(AppEvent.LAYOUT_REVERT, { permission: item.permission });\n    },\n    [analytics, dispatch, layoutManager, state.selectedIds.length],\n  );\n\n  const onMakePersonalCopy = useCallbackWithToast(\n    async (item: Layout) => {\n      const newLayout = await layoutManager.makePersonalCopy({\n        id: item.id,\n        name: `${item.name} copy`,\n      });\n      await onSelectLayout(newLayout);\n      void analytics.logEvent(AppEvent.LAYOUT_MAKE_PERSONAL_COPY, {\n        permission: item.permission,\n        syncStatus: item.syncInfo?.status,\n      });\n    },\n    [analytics, layoutManager, onSelectLayout],\n  );\n\n  const importLayout = useCallbackWithToast(async () => {\n    if (!(await promptForUnsavedChanges())) {\n      return;\n    }\n    const fileHandles = await showOpenFilePicker({\n      multiple: true,\n      excludeAcceptAllOption: false,\n      types: [\n        {\n          description: \"JSON Files\",\n          accept: {\n            \"application/json\": [\".json\"],\n          },\n        },\n      ],\n    });\n    if (fileHandles.length === 0) {\n      return;\n    }\n\n    const newLayouts = await Promise.all(\n      fileHandles.map(async (fileHandle) => {\n        const file = await fileHandle.getFile();\n        const layoutName = path.basename(file.name, path.extname(file.name));\n        const content = await file.text();\n\n        if (!isMounted()) {\n          return;\n        }\n\n        let parsedState: unknown;\n        try {\n          parsedState = JSON.parse(content);\n        } catch (err) {\n          enqueueSnackbar(`${file.name} is not a valid layout: ${err.message}`, {\n            variant: \"error\",\n          });\n          return;\n        }\n\n        if (typeof parsedState !== \"object\" || !parsedState) {\n          enqueueSnackbar(`${file.name} is not a valid layout`, { variant: \"error\" });\n          return;\n        }\n\n        const data = parsedState as LayoutData;\n        const newLayout = await layoutManager.saveNewLayout({\n          name: layoutName,\n          data,\n          permission: \"CREATOR_WRITE\",\n        });\n        return newLayout;\n      }),\n    );\n\n    if (!isMounted()) {\n      return;\n    }\n    const newLayout = newLayouts.find((layout) => layout != undefined);\n    if (newLayout) {\n      void onSelectLayout(newLayout);\n    }\n    void analytics.logEvent(AppEvent.LAYOUT_IMPORT, { numLayouts: fileHandles.length });\n  }, [\n    analytics,\n    enqueueSnackbar,\n    isMounted,\n    layoutManager,\n    onSelectLayout,\n    promptForUnsavedChanges,\n  ]);\n\n  const layoutDebug = useContext(LayoutStorageDebuggingContext);\n\n  const [enableNewTopNav = false] = useAppConfigurationValue<boolean>(AppSetting.ENABLE_NEW_TOPNAV);\n  const [hideSignInPrompt = false, setHideSignInPrompt] = useAppConfigurationValue<boolean>(\n    AppSetting.HIDE_SIGN_IN_PROMPT,\n  );\n  const showSignInPrompt =\n    signIn != undefined && !layoutManager.supportsSharing && !hideSignInPrompt;\n\n  const pendingMultiAction = state.multiAction?.ids != undefined;\n\n  const anySelectedModifiedLayouts = useMemo(() => {\n    return [layouts.value?.personal ?? [], layouts.value?.shared ?? []]\n      .flat()\n      .some((layout) => layout.working != undefined && state.selectedIds.includes(layout.id));\n  }, [layouts, state.selectedIds]);\n\n  return (\n    <SidebarContent\n      title=\"Layouts\"\n      disablePadding\n      disableToolbar={enableNewTopNav}\n      trailingItems={[\n        (layouts.loading || state.busy || pendingMultiAction) && (\n          <Stack key=\"loading\" alignItems=\"center\" justifyContent=\"center\" padding={1}>\n            <CircularProgress size={18} variant=\"indeterminate\" />\n          </Stack>\n        ),\n        (!state.online || state.error != undefined) && (\n          <IconButton color=\"primary\" key=\"offline\" disabled title=\"Offline\">\n            <CloudOffIcon />\n          </IconButton>\n        ),\n        <IconButton\n          color=\"primary\"\n          key=\"add-layout\"\n          onClick={createNewLayout}\n          aria-label=\"Create new layout\"\n          data-testid=\"add-layout\"\n          title=\"Create new layout\"\n        >\n          <AddIcon />\n        </IconButton>,\n        <IconButton\n          color=\"primary\"\n          key=\"import-layout\"\n          onClick={importLayout}\n          aria-label=\"Import layout\"\n          title=\"Import layout\"\n        >\n          <FileOpenOutlinedIcon />\n        </IconButton>,\n      ].filter(Boolean)}\n    >\n      {promptModal}\n      {confirmModal}\n      {unsavedChangesPrompt}\n      <Stack\n        fullHeight\n        gap={enableNewTopNav ? 1 : 2}\n        style={{ pointerEvents: pendingMultiAction ? \"none\" : \"auto\" }}\n      >\n        {enableNewTopNav && (\n          <>\n            <List className={classes.actionList} disablePadding>\n              <ListItem disablePadding>\n                <ListItemButton onClick={createNewLayout}>\n                  <ListItemText disableTypography>Create new layout</ListItemText>\n                </ListItemButton>\n              </ListItem>\n              <ListItem disablePadding>\n                <ListItemButton onClick={importLayout}>\n                  <ListItemText disableTypography>Import from file…</ListItemText>\n                </ListItemButton>\n              </ListItem>\n            </List>\n            <Divider variant=\"middle\" />\n          </>\n        )}\n        <LayoutSection\n          disablePadding={enableNewTopNav}\n          title={layoutManager.supportsSharing ? \"Personal\" : undefined}\n          emptyText=\"Add a new layout to get started with Foxglove Studio!\"\n          items={layouts.value?.personal}\n          anySelectedModifiedLayouts={anySelectedModifiedLayouts}\n          multiSelectedIds={state.selectedIds}\n          selectedId={currentLayoutId}\n          onSelect={onSelectLayout}\n          onRename={onRenameLayout}\n          onDuplicate={onDuplicateLayout}\n          onDelete={onDeleteLayout}\n          onShare={onShareLayout}\n          onExport={onExportLayout}\n          onOverwrite={onOverwriteLayout}\n          onRevert={onRevertLayout}\n          onMakePersonalCopy={onMakePersonalCopy}\n        />\n        {layoutManager.supportsSharing && (\n          <LayoutSection\n            disablePadding={enableNewTopNav}\n            title=\"Organization\"\n            emptyText=\"Your organization doesn’t have any shared layouts yet. Share a layout to collaborate with others.\"\n            items={layouts.value?.shared}\n            anySelectedModifiedLayouts={anySelectedModifiedLayouts}\n            multiSelectedIds={state.selectedIds}\n            selectedId={currentLayoutId}\n            onSelect={onSelectLayout}\n            onRename={onRenameLayout}\n            onDuplicate={onDuplicateLayout}\n            onDelete={onDeleteLayout}\n            onShare={onShareLayout}\n            onExport={onExportLayout}\n            onOverwrite={onOverwriteLayout}\n            onRevert={onRevertLayout}\n            onMakePersonalCopy={onMakePersonalCopy}\n          />\n        )}\n        {!enableNewTopNav && <Stack flexGrow={1} />}\n        {showSignInPrompt && <SignInPrompt onDismiss={() => void setHideSignInPrompt(true)} />}\n        {layoutDebug && (\n          <Stack gap={0.5} padding={1} position=\"sticky\" className={classes.debugBanner}>\n            <Stack direction=\"row\" flex=\"auto\" gap={1} alignItems=\"center\">\n              <Button\n                size=\"small\"\n                color=\"inherit\"\n                onClick={async () => {\n                  await layoutDebug.syncNow();\n                  await reloadLayouts();\n                }}\n              >\n                Sync\n              </Button>\n\n              <Stack flex=\"auto\" />\n\n              <FormGroup>\n                <FormControlLabel\n                  control={\n                    <Switch\n                      size=\"small\"\n                      color=\"warning\"\n                      checked={layoutManager.isOnline}\n                      onChange={(_, checked) => {\n                        layoutDebug.setOnline(checked);\n                      }}\n                    />\n                  }\n                  label={layoutManager.isOnline ? \"Online\" : \"Offline\"}\n                />\n              </FormGroup>\n            </Stack>\n          </Stack>\n        )}\n      </Stack>\n    </SidebarContent>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren } from \"react\";\n\n/**\n * Reduces the amount of nesting required to wrap a subtree with multiple React context providers.\n * Rather than indenting each provider inside the next, all providers can be passed in a flat array\n * to the MultiProvider.\n */\nexport default function MultiProvider({\n  children,\n  providers,\n}: PropsWithChildren<{ providers: readonly JSX.Element[] }>): JSX.Element {\n  const wrapped = providers.reduceRight(\n    (wrappedChildren, provider) => React.cloneElement(provider, undefined, wrappedChildren),\n    children,\n  );\n  // TS requires our return type to be Element instead of Node\n  return <>{wrapped}</>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useLayoutEffect, useRef } from \"react\";\nimport * as THREE from \"three\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()({\n  container: {\n    position: \"absolute\",\n    top: \"0\",\n    left: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n  },\n});\n\nexport default function Snow({ effect }: { effect: \"snow\" | \"confetti\" }): JSX.Element {\n  const { classes } = useStyles();\n  const containerRef = useRef<HTMLDivElement>(ReactNull);\n\n  useLayoutEffect(() => {\n    let requestID: ReturnType<typeof requestAnimationFrame>;\n    const container = containerRef.current;\n    if (!container) {\n      return;\n    }\n\n    const scene = new THREE.Scene();\n    const camera = new THREE.OrthographicCamera();\n\n    const POINT_COUNT = effect === \"snow\" ? 75 : 100;\n    const positions = new Float32Array(POINT_COUNT * 3);\n    const colors = new Float32Array(POINT_COUNT * 3);\n    const sizes = new Float32Array(POINT_COUNT);\n    const phases = new Float32Array(POINT_COUNT);\n\n    const vertex = new THREE.Vector3();\n    const color = new THREE.Color();\n    for (let i = 0; i < POINT_COUNT; i++) {\n      vertex.x = Math.random();\n      vertex.y = Math.random();\n      vertex.z = -1.0;\n      vertex.toArray(positions, i * 3);\n\n      if (effect === \"snow\") {\n        color.setRGB(1.0, 1.0, 1.0);\n      } else {\n        color.setHSL(Math.random(), 1.0, 0.5);\n      }\n      color.toArray(colors, i * 3);\n\n      sizes[i] = Math.random();\n      phases[i] = Math.random() * Math.PI;\n    }\n\n    const geometry = new THREE.BufferGeometry();\n    geometry.setAttribute(\"position\", new THREE.BufferAttribute(positions, 3));\n    geometry.setAttribute(\"color\", new THREE.BufferAttribute(colors, 3));\n    geometry.setAttribute(\"size\", new THREE.BufferAttribute(sizes, 1));\n    geometry.setAttribute(\"phase\", new THREE.BufferAttribute(phases, 1));\n\n    const material = new THREE.ShaderMaterial({\n      uniforms: {\n        time: { value: 1.0 },\n        yspeed: { value: effect === \"snow\" ? 0.1 : 0.2 },\n        wind: { value: effect === \"snow\" ? 0.02 : 0.0 },\n      },\n      vertexShader: /* glsl */ `\n      uniform float time;\n      uniform float yspeed;\n      uniform float wind;\n      attribute vec3 color;\n      attribute float size;\n      attribute float phase;\n      const float xspeed = 10.0;\n      const float amplitude = 0.03;\n      const float minsize = 5.0;\n      const float maxsize = 12.0;\n      varying vec4 vcolor;\n      void main() {\n        vcolor = vec4(color, 1.0);\n        float x = mix(-1.0, 1.0, mod(\n          position.x + sin(phase + time * xspeed * yspeed) * amplitude + time * xspeed * yspeed * wind,\n          1.0));\n\t\t\t\tfloat y = mix(-1.0, 1.0, mod(position.y - time * yspeed * mix(0.2, 1.0, size), 1.0));\n\t\t\t\tgl_PointSize = mix(minsize, maxsize, size);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(x, y, position.z, 1.0);\n\t\t\t}\n      `,\n      fragmentShader: /* glsl */ `\n      varying vec4 vcolor;\n\t\t\tvoid main() {\n        if (length(gl_PointCoord * 2.0 - 1.0) > 1.0) {\n          discard;\n        }\n\t\t\t\tgl_FragColor = vcolor;\n\t\t\t}\n      `,\n    });\n\n    const points = new THREE.Points(geometry, material);\n    scene.add(points);\n\n    const renderer = new THREE.WebGLRenderer({ alpha: true });\n    renderer.setPixelRatio(window.devicePixelRatio);\n    renderer.setSize(container.clientWidth, container.clientHeight);\n    container.appendChild(renderer.domElement);\n\n    const startTime = new Date();\n    function render() {\n      const time = (new Date().getTime() - startTime.getTime()) / 1000.0;\n      material.uniforms.time = { value: time };\n\n      renderer.render(scene, camera);\n    }\n\n    let animating = true;\n    function animate() {\n      if (!animating) {\n        return;\n      }\n\n      requestID = requestAnimationFrame(animate);\n      render();\n    }\n\n    animate();\n\n    return () => {\n      animating = false;\n      geometry.dispose();\n      material.dispose();\n      renderer.dispose();\n      container.removeChild(renderer.domElement);\n      cancelAnimationFrame(requestID);\n    };\n  }, [effect]);\n\n  return <div className={classes.container} ref={containerRef} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { Player, PlayerMetricsCollectorInterface } from \"@foxglove/studio-base/players/types\";\nimport { RegisteredIconNames } from \"@foxglove/studio-base/types/Icons\";\n\nexport type DataSourceFactoryInitializeArgs = {\n  metricsCollector: PlayerMetricsCollectorInterface;\n  file?: File;\n  files?: File[];\n  params?: Record<string, string | undefined>;\n};\n\nexport type DataSourceFactoryType = \"file\" | \"connection\" | \"sample\";\n\nexport type Field = {\n  id: string;\n  label: string;\n  defaultValue?: string;\n  placeholder?: string;\n  description?: string;\n\n  /**\n   * Optional validate function\n   *\n   * The function is called with a value and can return an Error if the value should\n   * be rejected. If the function returns `undefined`, then the value is accepted.\n   */\n  validate?: (value: string) => Error | undefined;\n};\n\nexport interface IDataSourceFactory {\n  id: string;\n\n  // A list of alternate ids used to identify this factory\n  // https://github.com/foxglove/studio/issues/4937\n  legacyIds?: string[];\n\n  type: DataSourceFactoryType;\n  displayName: string;\n  iconName?: RegisteredIconNames;\n  description?: string;\n  docsLinks?: { label?: string; url: string }[];\n  disabledReason?: string | JSX.Element;\n  badgeText?: string;\n  hidden?: boolean;\n  warning?: string;\n\n  /** Whether to wait for a user to be logged in before initializing this source. */\n  currentUserRequired?: boolean;\n\n  sampleLayout?: LayoutData;\n\n  formConfig?: {\n    // Initialization args are populated with keys of the _id_ field\n    fields: Field[];\n  };\n\n  // If data source initialization supports \"Open File\" workflow, this property lists the supported\n  // file types\n  supportedFileTypes?: string[];\n\n  supportsMultiFile?: boolean;\n\n  // Initialize a player.\n  initialize: (args: DataSourceFactoryInitializeArgs) => Player | undefined;\n}\n\n/**\n * Recently selected source information\n *\n * The _id_ is opaque and up to the PlayerSelectionContext implementation.\n */\nexport type RecentSource = {\n  id: string;\n  title: string;\n  label?: string;\n};\n\n// File data sources accept either file instances or handles\ntype FileDataSourceArgs = {\n  type: \"file\";\n  files?: File[];\n  handle?: FileSystemFileHandle; // foxglove-depcheck-used: @types/wicg-file-system-access\n};\n\ntype ConnectionDataSourceArgs = {\n  type: \"connection\";\n  params?: Record<string, string | undefined>;\n};\n\nexport type DataSourceArgs = FileDataSourceArgs | ConnectionDataSourceArgs;\n\n/**\n * PlayerSelectionContext exposes the available data sources and a function to set the current data source\n */\nexport interface PlayerSelection {\n  selectSource: (sourceId: string, args?: DataSourceArgs) => void;\n  selectRecent: (recentId: string) => void;\n\n  /** Currently selected data source */\n  selectedSource?: IDataSourceFactory;\n\n  /** List of available data sources */\n  availableSources: IDataSourceFactory[];\n\n  /** Recently selected sources */\n  recentSources: RecentSource[];\n}\n\nconst PlayerSelectionContext = createContext<PlayerSelection>({\n  selectSource: () => {},\n  selectRecent: () => {},\n  availableSources: [],\n  recentSources: [],\n});\nPlayerSelectionContext.displayName = \"PlayerSelectionContext\";\n\nexport function usePlayerSelection(): PlayerSelection {\n  return useContext(PlayerSelectionContext);\n}\n\nexport default PlayerSelectionContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function BlockheadIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <g fill=\"currentColor\">\n        <path d=\"M22.5,12A10.5,10.5,0,1,0,5.08,19.87l0,0,.35.28a10,10,0,0,0,1.55,1l.24.12.6.29.4.16.48.17.45.14.48.13c.15,0,.3.07.46.09a5,5,0,0,0,.56.09l.39.05c.32,0,.65.05,1,.05s.66,0,1-.05l.39-.05a5,5,0,0,0,.56-.09,3.41,3.41,0,0,0,.46-.1,3.59,3.59,0,0,0,.47-.12l.47-.14.46-.17.42-.17.55-.26.29-.15a9.84,9.84,0,0,0,1.54-1l.35-.28,0,0A10.44,10.44,0,0,0,22.5,12Zm-5.12,7.82-.15.11-.58.34-.2.12-.61.29a1,1,0,0,1-.18.08,6.77,6.77,0,0,1-.75.28l-.35.1-.48.12-.37.08-.53.08-.31,0c-.29,0-.58,0-.87,0s-.58,0-.87,0l-.31,0-.53-.08-.37-.08-.48-.12L9.09,21a6.77,6.77,0,0,1-.75-.28,1,1,0,0,1-.18-.08l-.61-.29-.2-.12c-.2-.11-.39-.22-.58-.35l-.15-.1-.22-.17L8.06,17a1.51,1.51,0,0,1,1.22-.62h5.44a1.51,1.51,0,0,1,1.21.6l1.67,2.65A1.84,1.84,0,0,1,17.38,19.82Zm-.63-3.38a2.49,2.49,0,0,0-2-1H9.28a2.5,2.5,0,0,0-2,1.07L5.62,19a9.5,9.5,0,1,1,12.76,0Z\" />\n        <path d=\"M14,5.36h-3.9a2,2,0,0,0-2,2v3.9a2,2,0,0,0,2,2H14a2,2,0,0,0,2-2V7.36A2,2,0,0,0,14,5.36Zm1,5.9a1,1,0,0,1-1,1h-3.9a1,1,0,0,1-1-1V7.36a1,1,0,0,1,1-1H14a1,1,0,0,1,1,1Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n","function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport React from \"react\";\nexport default (({\n  styles = {},\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\"\n}, props), /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"currentColor\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M22.6 19.07l-1.07-.83c.02-.16.04-.32.04-.49s-.01-.33-.04-.49l1.06-.83a.26.26 0 00.06-.32l-1-1.73c-.06-.11-.19-.15-.31-.11l-1.24.5c-.26-.2-.54-.37-.85-.49l-.19-1.32c-.01-.12-.12-.21-.24-.21h-2c-.12 0-.23.09-.25.21l-.19 1.32c-.3.13-.59.29-.85.49l-1.24-.5c-.11-.04-.24 0-.31.11l-1 1.73c-.06.11-.04.24.06.32l1.06.83a3.908 3.908 0 000 .98l-1.06.83a.26.26 0 00-.06.32l1 1.73c.06.11.19.15.31.11l1.24-.5c.26.2.54.37.85.49l.19 1.32c.02.12.12.21.25.21h2c.12 0 .23-.09.25-.21l.19-1.32c.3-.13.59-.29.84-.49l1.25.5c.11.04.24 0 .31-.11l1-1.73a.26.26 0 00-.06-.32zm-4.78.18c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M4 6v12c0 .69.32 1.29.77 1.78.45.48 1.08.88 1.79 1.2 1.43.64 3.35 1.02 5.43 1.02.51 0 .53-.02 1.01-.07-.42-.52-.46-.84-.88-1.43-1.87-.01-3.78-.36-4.95-.89-.6-.27-1.04-.57-1.32-.86-.28-.29-.37-.54-.37-.75V8.39c.32.22.68.42 1.07.59C7.98 9.62 9.9 10 11.98 10s4-.38 5.43-1.02c.39-.17.75-.37 1.07-.59v3.43h.75c.49 0 .75.56.75.56V6.01c0-.69-.32-1.29-.77-1.78-.45-.48-1.08-.88-1.79-1.2-1.43-.64-3.35-1.02-5.43-1.02s-4 .38-5.43 1.02c-.71.32-1.34.72-1.79 1.2C4.31 4.72 4 5.32 4 6.01zm1.5 0c0-.21.09-.46.36-.75.28-.3.72-.6 1.32-.86 1.2-.54 2.9-.89 4.82-.89s3.62.35 4.82.89c.6.27 1.04.57 1.32.86.27.29.36.54.36.75s-.09.46-.36.75c-.28.3-.72.6-1.32.86-1.19.54-2.9.89-4.82.89s-3.62-.35-4.82-.89c-.6-.27-1.04-.57-1.32-.86-.27-.29-.36-.54-.36-.75z\"\n}))));","function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport React from \"react\";\nexport default (({\n  styles = {},\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\"\n}, props), /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M19.25 4H4.75C3.23 4 2 5.23 2 6.75v10.5C2 18.77 3.23 20 4.75 20h14.5c1.52 0 2.75-1.23 2.75-2.75V6.75C22 5.23 20.77 4 19.25 4zm1.25 2.75v4.5h-3.27V5.5h2.02c.69 0 1.25.56 1.25 1.25zm-8.06 6h3.29v5.75h-3.29v-5.75zm0-1.5V5.5h3.29v5.75h-3.29zm-8.94 6V6.75c0-.69.56-1.25 1.25-1.25h6.19v13H4.75c-.69 0-1.25-.56-1.25-1.25zm15.75 1.25h-2.02v-5.75h3.27v4.5c0 .69-.56 1.25-1.25 1.25z\"\n})));","function _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport React from \"react\";\nexport default (({\n  styles = {},\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  xmlns: \"http://www.w3.org/2000/svg\",\n  viewBox: \"0 0 24 24\"\n}, props), /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"currentColor\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M4.75 18.5c-.69 0-1.25-.56-1.25-1.25V6.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v4.98c.55.29 1.05.65 1.5 1.08V6.75C22 5.23 20.77 4 19.25 4H4.75C3.23 4 2 5.23 2 6.75v10.5C2 18.77 3.23 20 4.75 20h6.75c-.2-.47-.34-.98-.42-1.5H4.75z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M22.28 18.82l-1.07-.83c.02-.16.04-.32.04-.49s-.01-.33-.04-.49l1.06-.83a.26.26 0 00.06-.32l-1-1.73c-.06-.11-.19-.15-.31-.11l-1.24.5c-.26-.2-.54-.37-.85-.49l-.19-1.32c-.01-.12-.12-.21-.24-.21h-2c-.12 0-.23.09-.25.21l-.19 1.32c-.3.13-.59.29-.85.49l-1.24-.5c-.11-.04-.24 0-.31.11l-1 1.73c-.06.11-.04.24.06.32l1.06.83a3.908 3.908 0 000 .98l-1.06.83a.26.26 0 00-.06.32l1 1.73c.06.11.19.15.31.11l1.24-.5c.26.2.54.37.85.49l.19 1.32c.02.12.12.21.25.21h2c.12 0 .23-.09.25-.21l.19-1.32c.3-.13.59-.29.84-.49l1.25.5c.11.04.24 0 .31-.11l1-1.73a.26.26 0 00-.06-.32zM17.5 19c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z\"\n}))));","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Add24Regular,\n  AppsAddIn24Regular,\n  BarcodeScanner24Regular,\n  BookStar24Regular,\n  BracesVariable24Regular,\n  Delete24Regular,\n  Dismiss24Regular,\n  DismissCircle24Regular,\n  Document24Regular,\n  DocumentLink24Regular,\n  Edit24Regular,\n  Flow16Regular,\n  GridDots24Filled,\n  Settings20Regular,\n  SlideAdd24Regular,\n  TextBulletListLtr24Regular,\n} from \"@fluentui/react-icons\";\n\nimport BlockheadFilledIcon from \"@foxglove/studio-base/components/BlockheadFilledIcon\";\nimport BlockheadIcon from \"@foxglove/studio-base/components/BlockheadIcon\";\nimport { RegisteredIconNames } from \"@foxglove/studio-base/types/Icons\";\n\nimport DatabaseSettings from \"../assets/database-settings.svg\";\nimport PanelLayout from \"../assets/panel-layout.svg\";\nimport PanelSettings from \"../assets/panel-settings.svg\";\n\nconst icons: {\n  // This makes it a type error to forget to add an icon here once it has been added to RegisteredIconNames.\n  [N in RegisteredIconNames]: React.ReactElement;\n} = {\n  Add: <Add24Regular />,\n  AddIn: <AppsAddIn24Regular />,\n  BacklogList: <TextBulletListLtr24Regular />,\n  Blockhead: <BlockheadIcon />,\n  BlockheadFilled: <BlockheadFilledIcon />,\n  BookStar: <BookStar24Regular />,\n  Cancel: <Dismiss24Regular />,\n  DatabaseSettings: <DatabaseSettings />,\n  Delete: <Delete24Regular />,\n  Edit: <Edit24Regular />,\n  ErrorBadge: <DismissCircle24Regular />,\n  FileASPX: <DocumentLink24Regular />,\n  FiveTileGrid: <PanelLayout />,\n  Flow: <Flow16Regular />,\n  GenericScan: <BarcodeScanner24Regular />,\n  OpenFile: <Document24Regular />,\n  PanelSettings: <PanelSettings />,\n  RectangularClipping: <SlideAdd24Regular />,\n  Settings: <Settings20Regular />,\n  Variable2: <BracesVariable24Regular />,\n  ROS: <GridDots24Filled />,\n};\n\nexport default icons;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ICONS from \"@foxglove/studio-base/theme/icons\";\nimport { RegisteredIconNames } from \"@foxglove/studio-base/types/Icons\";\n\ntype BuiltinIconProps = {\n  name?: RegisteredIconNames;\n};\n\nexport function BuiltinIcon(props: BuiltinIconProps): JSX.Element {\n  if (props.name == undefined) {\n    return <></>;\n  }\n  return ICONS[props.name];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { FormHelperText, TextField } from \"@mui/material\";\nimport { ChangeEvent, useState } from \"react\";\n\nimport { Field } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\n\ntype Props = {\n  disabled: boolean;\n  field: Field;\n  onChange: (newValue: string | undefined) => void;\n  onError: (message: string) => void;\n};\n\nexport function FormField(props: Props): JSX.Element {\n  const [error, setError] = useState<string | undefined>();\n  const field = props.field;\n\n  const onChange = (event: ChangeEvent<HTMLInputElement>) => {\n    setError(undefined);\n\n    const maybeError = field.validate?.(event.target.value);\n\n    if (maybeError instanceof Error) {\n      setError(maybeError.message);\n      props.onError(maybeError.message);\n      return;\n    }\n\n    props.onChange(event.target.value);\n  };\n\n  return (\n    <div>\n      <TextField\n        fullWidth\n        disabled={props.disabled}\n        key={field.label}\n        label={field.label}\n        error={error != undefined}\n        helperText={error}\n        FormHelperTextProps={{\n          variant: \"standard\",\n        }}\n        placeholder={field.placeholder}\n        defaultValue={field.defaultValue}\n        onChange={onChange}\n        variant=\"outlined\"\n        InputProps={{\n          notched: false,\n        }}\n        InputLabelProps={{ shrink: true }}\n      />\n      <FormHelperText>{field.description}</FormHelperText>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ChevronLeftIcon from \"@mui/icons-material/ChevronLeft\";\nimport { Button } from \"@mui/material\";\nimport { PropsWithChildren } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\ntype ViewProps = {\n  onBack?: () => void;\n  onCancel?: () => void;\n  onOpen?: () => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  content: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1,\n    height: \"100%\",\n    justifyContent: \"space-between\",\n    gap: theme.spacing(2),\n    overflowY: \"auto\",\n  },\n}));\n\nexport default function View(props: PropsWithChildren<ViewProps>): JSX.Element {\n  const { onCancel, onOpen, onBack } = props;\n  const { classes } = useStyles();\n\n  return (\n    <>\n      <div className={classes.content}>{props.children}</div>\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        paddingX={4}\n        paddingBottom={4}\n        paddingTop={2}\n      >\n        <Button startIcon={<ChevronLeftIcon fontSize=\"large\" />} onClick={onBack} size=\"large\">\n          Back\n        </Button>\n\n        <Stack direction=\"row\" gap={2}>\n          <Button size=\"large\" color=\"inherit\" variant=\"outlined\" onClick={onCancel}>\n            Cancel\n          </Button>\n          <Button size=\"large\" variant=\"contained\" onClick={onOpen} disabled={onOpen == undefined}>\n            Open\n          </Button>\n        </Stack>\n      </Stack>\n    </>\n  );\n\n  return <>{props.children}</>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Alert, Link, Tab, Tabs, Typography, useMediaQuery, useTheme } from \"@mui/material\";\nimport { useState, useMemo, useCallback, useLayoutEffect, FormEvent } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { BuiltinIcon } from \"@foxglove/studio-base/components/BuiltinIcon\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  IDataSourceFactory,\n  usePlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport { FormField } from \"./FormField\";\nimport View from \"./View\";\n\ntype ConnectionProps = {\n  onBack?: () => void;\n  onCancel?: () => void;\n  availableSources: IDataSourceFactory[];\n  activeSource?: IDataSourceFactory;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  grid: {\n    padding: theme.spacing(4, 4, 0),\n    columnGap: theme.spacing(4),\n    rowGap: theme.spacing(2),\n\n    [theme.breakpoints.up(\"md\")]: {\n      overflow: \"hidden\",\n      display: \"grid\",\n      padding: theme.spacing(4, 4, 0, 4),\n      gridTemplateAreas: `\n        \"header header\"\n        \"sidebar form\"\n      `,\n      gridTemplateColumns: \"240px 1fr\",\n      gridTemplateRows: \"auto auto\",\n    },\n  },\n  header: {\n    gridArea: \"header\",\n  },\n  form: {\n    gridArea: \"form\",\n    overflowY: \"auto\",\n  },\n  formInner: {\n    [theme.breakpoints.up(\"md\")]: {\n      height: theme.spacing(43), // this is aproximately the height of the tallest form\n    },\n  },\n  sidebar: {\n    gridArea: \"sidebar\",\n    overflowY: \"auto\",\n  },\n  tab: {\n    \"> svg:not(.MuiSvgIcon-root)\": {\n      display: \"flex\",\n      flex: \"none\",\n      color: theme.palette.primary.main,\n      marginRight: theme.spacing(1.5),\n    },\n    [theme.breakpoints.up(\"md\")]: {\n      textAlign: \"right\",\n      flexDirection: \"row\",\n      justifyContent: \"flex-start\",\n      alignItems: \"center\",\n      minHeight: \"auto\",\n      paddingTop: theme.spacing(1.5),\n      paddingBottom: theme.spacing(1.5),\n    },\n  },\n  indicator: {\n    [theme.breakpoints.up(\"md\")]: {\n      right: 0,\n      width: \"100%\",\n      backgroundColor: theme.palette.action.hover,\n      borderRadius: theme.shape.borderRadius,\n    },\n  },\n}));\n\nexport default function Connection(props: ConnectionProps): JSX.Element {\n  const { availableSources, activeSource, onCancel, onBack } = props;\n  const { classes } = useStyles();\n\n  const theme = useTheme();\n  const mdUp = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n  const { selectSource } = usePlayerSelection();\n  const analytics = useAnalytics();\n\n  // List enabled sources before disabled sources so the default selected item is an available source\n  const enabledSourcesFirst = useMemo(() => {\n    const enabledSources = availableSources.filter((source) => source.disabledReason == undefined);\n    const disabledSources = availableSources.filter((source) => source.disabledReason);\n    return [...enabledSources, ...disabledSources];\n  }, [availableSources]);\n\n  const [selectedConnectionIdx, setSelectedConnectionIdx] = useState<number>(() => {\n    const foundIdx = availableSources.findIndex((source) => source === activeSource);\n    const selectedIdx = foundIdx < 0 ? 0 : foundIdx;\n    void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, {\n      type: \"live\",\n      data: enabledSourcesFirst[selectedIdx]?.id,\n    });\n    return selectedIdx;\n  });\n\n  const selectedSource = useMemo(\n    () => enabledSourcesFirst[selectedConnectionIdx],\n    [enabledSourcesFirst, selectedConnectionIdx],\n  );\n\n  const [fieldErrors, setFieldErrors] = useState(new Map<string, string>());\n  const [fieldValues, setFieldValues] = useState<Record<string, string | undefined>>({});\n\n  useLayoutEffect(() => {\n    const connectionIdx = availableSources.findIndex((source) => source === activeSource);\n    if (connectionIdx >= 0) {\n      setSelectedConnectionIdx(connectionIdx);\n    }\n  }, [activeSource, availableSources]);\n\n  // clear field values when the user changes the source tab\n  useLayoutEffect(() => {\n    const defaultFieldValues: Record<string, string | undefined> = {};\n    for (const field of selectedSource?.formConfig?.fields ?? []) {\n      if (field.defaultValue != undefined) {\n        defaultFieldValues[field.id] = field.defaultValue;\n      }\n    }\n    setFieldValues(defaultFieldValues);\n  }, [selectedSource]);\n\n  const onOpen = useCallback(() => {\n    if (!selectedSource) {\n      return;\n    }\n    selectSource(selectedSource.id, { type: \"connection\", params: fieldValues });\n    onCancel?.();\n  }, [onCancel, selectedSource, fieldValues, selectSource]);\n\n  const disableOpen = selectedSource?.disabledReason != undefined || fieldErrors.size > 0;\n\n  const onSubmit = useCallback(\n    (event: FormEvent) => {\n      event.preventDefault();\n      if (!disableOpen) {\n        onOpen();\n      }\n    },\n    [disableOpen, onOpen],\n  );\n\n  return (\n    <View onBack={onBack} onCancel={onCancel} onOpen={disableOpen ? undefined : onOpen}>\n      <Stack className={classes.grid}>\n        <header className={classes.header}>\n          <Typography variant=\"h3\" fontWeight={600} gutterBottom>\n            Open a new connection\n          </Typography>\n        </header>\n        <div className={classes.sidebar}>\n          <Tabs\n            classes={{ indicator: classes.indicator }}\n            variant=\"scrollable\"\n            textColor=\"inherit\"\n            orientation={mdUp ? \"vertical\" : \"horizontal\"}\n            onChange={(_event, newValue: number) => {\n              setSelectedConnectionIdx(newValue);\n              void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, {\n                type: \"live\",\n                data: enabledSourcesFirst[newValue]?.id,\n              });\n            }}\n            value={selectedConnectionIdx}\n          >\n            {enabledSourcesFirst.map((source, idx) => {\n              const { id, iconName, displayName } = source;\n              return (\n                <Tab\n                  value={idx}\n                  key={id}\n                  icon={mdUp ? <BuiltinIcon name={iconName ?? \"Flow\"} /> : undefined}\n                  label={displayName}\n                  className={classes.tab}\n                />\n              );\n            })}\n          </Tabs>\n        </div>\n\n        <Stack className={classes.form} key={selectedSource?.id} flex=\"1 0\">\n          <form onSubmit={onSubmit}>\n            <Stack className={classes.formInner} gap={2}>\n              {selectedSource?.disabledReason == undefined && selectedSource?.warning && (\n                <Alert severity=\"warning\">{selectedSource.warning}</Alert>\n              )}\n              {selectedSource?.disabledReason != undefined && (\n                <Alert severity=\"warning\">{selectedSource.disabledReason}</Alert>\n              )}\n\n              {selectedSource?.description && <Typography>{selectedSource.description}</Typography>}\n              {selectedSource?.formConfig != undefined && (\n                <Stack flexGrow={1} justifyContent=\"space-between\">\n                  <Stack gap={2}>\n                    {selectedSource.formConfig.fields.map((field) => (\n                      <FormField\n                        key={field.id}\n                        field={field}\n                        disabled={selectedSource.disabledReason != undefined}\n                        onError={(err) => {\n                          setFieldErrors((existing) => {\n                            existing.set(field.id, err);\n                            return new Map(existing);\n                          });\n                        }}\n                        onChange={(newValue) => {\n                          setFieldErrors((existing) => {\n                            existing.delete(field.id);\n                            return new Map(existing);\n                          });\n                          setFieldValues((existing) => {\n                            return {\n                              ...existing,\n                              [field.id]: newValue,\n                            };\n                          });\n                        }}\n                      />\n                    ))}\n                  </Stack>\n                </Stack>\n              )}\n              <Stack direction=\"row\" gap={1}>\n                {(selectedSource?.docsLinks ?? []).map((item) => (\n                  <Link\n                    key={item.url}\n                    color=\"primary\"\n                    href={item.url}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                  >\n                    {item.label ? `View docs for ${item.label}` : \"View docs\"}\n                  </Link>\n                ))}\n              </Stack>\n            </Stack>\n          </form>\n        </Stack>\n      </Stack>\n    </View>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function FoxgloveLogoText(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon viewBox=\"0 0 909 204\" {...props}>\n      <title>Foxglove</title>\n      <g>\n        <path\n          d=\"M313.65 92.55H295.05V156H269.85V92.55H258.15V80.25L270.15 73.8V69.9C270.15 59.3 272.55 51.9 277.35 47.7C282.15 43.4 289.25 41.25 298.65 41.25C302.95 41.25 306.85 41.6 310.35 42.3C313.95 43 317.25 43.85 320.25 44.85L314.25 62.25C312.75 61.85 311.05 61.45 309.15 61.05C307.25 60.65 305.15 60.45 302.85 60.45C300.15 60.45 298.15 61.3 296.85 63C295.65 64.6 295.05 66.9 295.05 69.9V73.65H313.65V92.55ZM402.362 114.6C402.362 128.4 398.712 139 391.412 146.4C384.212 153.8 374.312 157.5 361.712 157.5C353.912 157.5 346.962 155.85 340.862 152.55C334.862 149.15 330.112 144.3 326.612 138C323.212 131.6 321.512 123.8 321.512 114.6C321.512 101 325.112 90.55 332.312 83.25C339.612 75.85 349.562 72.15 362.162 72.15C369.962 72.15 376.862 73.8 382.862 77.1C388.962 80.4 393.712 85.2 397.112 91.5C400.612 97.8 402.362 105.5 402.362 114.6ZM347.162 114.6C347.162 122.3 348.312 128.15 350.612 132.15C352.912 136.05 356.712 138 362.012 138C367.212 138 370.962 136.05 373.262 132.15C375.562 128.15 376.712 122.3 376.712 114.6C376.712 107 375.562 101.3 373.262 97.5C370.962 93.6 367.162 91.65 361.862 91.65C356.662 91.65 352.912 93.6 350.612 97.5C348.312 101.3 347.162 107 347.162 114.6ZM434.075 114L408.125 73.65H436.775L451.175 98.4L465.725 73.65H494.375L468.125 114L495.575 156H466.925L451.175 129.3L435.425 156H406.775L434.075 114ZM533.61 72.15C539.01 72.15 543.61 73.2 547.41 75.3C551.21 77.4 554.36 80.3 556.86 84H557.46L559.41 73.65H581.01V156.15C581.01 167.85 577.46 176.75 570.36 182.85C563.36 188.95 552.76 192 538.56 192C532.36 192 526.76 191.65 521.76 190.95C516.76 190.25 511.86 189 507.06 187.2V166.65C512.16 168.75 517.16 170.3 522.06 171.3C526.96 172.4 532.46 172.95 538.56 172.95C550.06 172.95 555.81 167.7 555.81 157.2V155.55C555.81 154.15 555.86 152.55 555.96 150.75C556.16 148.85 556.36 147.05 556.56 145.35H555.81C553.41 149.25 550.31 152.25 546.51 154.35C542.81 156.45 538.36 157.5 533.16 157.5C523.86 157.5 516.46 153.8 510.96 146.4C505.56 139 502.86 128.5 502.86 114.9C502.86 101.2 505.61 90.65 511.11 83.25C516.71 75.85 524.21 72.15 533.61 72.15ZM542.46 92.1C533.16 92.1 528.51 99.85 528.51 115.35C528.51 123.05 529.66 128.75 531.96 132.45C534.36 136.05 537.96 137.85 542.76 137.85C548.06 137.85 551.86 136.3 554.16 133.2C556.46 130.1 557.61 125 557.61 117.9V114.75C557.61 107.05 556.46 101.35 554.16 97.65C551.96 93.95 548.06 92.1 542.46 92.1ZM628.064 156H602.714V42H628.064V156ZM726.386 114.6C726.386 128.4 722.736 139 715.436 146.4C708.236 153.8 698.336 157.5 685.736 157.5C677.936 157.5 670.986 155.85 664.886 152.55C658.886 149.15 654.136 144.3 650.636 138C647.236 131.6 645.536 123.8 645.536 114.6C645.536 101 649.136 90.55 656.336 83.25C663.636 75.85 673.586 72.15 686.186 72.15C693.986 72.15 700.886 73.8 706.886 77.1C712.986 80.4 717.736 85.2 721.136 91.5C724.636 97.8 726.386 105.5 726.386 114.6ZM671.186 114.6C671.186 122.3 672.336 128.15 674.636 132.15C676.936 136.05 680.736 138 686.036 138C691.236 138 694.986 136.05 697.286 132.15C699.586 128.15 700.736 122.3 700.736 114.6C700.736 107 699.586 101.3 697.286 97.5C694.986 93.6 691.186 91.65 685.886 91.65C680.686 91.65 676.936 93.6 674.636 97.5C672.336 101.3 671.186 107 671.186 114.6ZM761.399 156L730.049 73.65H756.449L771.449 121.35C771.949 123.05 772.399 125.15 772.799 127.65C773.299 130.05 773.599 132.25 773.699 134.25H774.299C774.399 132.15 774.649 129.95 775.049 127.65C775.549 125.35 776.099 123.3 776.699 121.5L791.999 73.65H818.249L786.899 156H761.399ZM864.582 72.15C876.182 72.15 885.382 75.35 892.182 81.75C898.982 88.05 902.382 97.35 902.382 109.65V121.35H850.332C850.532 126.75 852.282 131.05 855.582 134.25C858.882 137.45 863.582 139.05 869.682 139.05C874.882 139.05 879.632 138.55 883.932 137.55C888.332 136.55 892.832 134.95 897.432 132.75V151.5C893.332 153.6 888.982 155.1 884.382 156C879.882 157 874.282 157.5 867.582 157.5C859.282 157.5 851.882 156 845.382 153C838.982 150 833.932 145.4 830.232 139.2C826.632 132.9 824.832 124.95 824.832 115.35C824.832 105.65 826.482 97.6 829.782 91.2C833.082 84.8 837.682 80.05 843.582 76.95C849.582 73.75 856.582 72.15 864.582 72.15ZM865.032 89.7C861.132 89.7 857.882 90.95 855.282 93.45C852.782 95.85 851.282 99.7 850.782 105H879.132C879.032 100.7 877.832 97.1 875.532 94.2C873.232 91.2 869.732 89.7 865.032 89.7Z\"\n          fill=\"currentColor\"\n        />\n        <circle cx=\"63.4983\" cy=\"166\" r=\"26\" fill=\"currentColor\" />\n        <circle opacity=\"0.5\" cx=\"138.498\" cy=\"166\" r=\"26\" fill=\"currentColor\" />\n        <circle opacity=\"0.5\" cx=\"175.498\" cy=\"101\" r=\"26\" fill=\"currentColor\" />\n        <path\n          d=\"M63.5281 10C69.6242 10 75.2332 12.0853 79.6808 15.5814C85.4685 20.2924 92.8532 23.1167 100.898 23.1167C108.942 23.1167 116.327 20.2924 122.114 15.5814C126.562 12.0853 132.171 10 138.267 10C152.714 10 164.426 21.7116 164.426 36.1587C164.426 50.6057 152.714 62.3174 138.267 62.3174C132.171 62.3174 126.562 60.2321 122.114 56.736C116.327 52.0249 108.942 49.2007 100.898 49.2007C92.8532 49.2007 85.4685 52.0249 79.6808 56.736C75.2332 60.2321 69.6242 62.3174 63.5281 62.3174C49.081 62.3174 37.3694 50.6057 37.3694 36.1587C37.3694 21.7116 49.081 10 63.5281 10Z\"\n          fill=\"currentColor\"\n        />\n        <path\n          d=\"M26.1587 75.023C32.2548 75.023 37.8638 77.1083 42.3114 80.6044C48.0991 85.3155 55.4838 88.1397 63.5282 88.1397C71.5726 88.1397 78.9574 85.3155 84.745 80.6044C89.1927 77.1083 94.8017 75.023 100.898 75.023C115.345 75.023 127.056 86.7347 127.056 101.182C127.056 115.629 115.345 127.34 100.898 127.34C94.8017 127.34 89.1927 125.255 84.745 121.759C78.9574 117.048 71.5726 114.224 63.5282 114.224C55.4838 114.224 48.0991 117.048 42.3114 121.759C37.8638 125.255 32.2548 127.34 26.1587 127.34C11.7116 127.34 0 115.629 0 101.182C0 86.7347 11.7116 75.023 26.1587 75.023Z\"\n          fill=\"currentColor\"\n        />\n      </g>\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, Link, List, ListItem, ListItemButton, SvgIcon, Typography } from \"@mui/material\";\nimport { ReactNode, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport FoxgloveLogoText from \"@foxglove/studio-base/components/FoxgloveLogoText\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextMiddleTruncate from \"@foxglove/studio-base/components/TextMiddleTruncate\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  useCurrentUser,\n  useCurrentUserType,\n} from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport { OpenDialogViews } from \"./types\";\n\nexport type IStartProps = {\n  onSelectView: (newValue: OpenDialogViews) => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  logo: {\n    width: 212,\n    height: \"auto\",\n    marginLeft: theme.spacing(-1),\n  },\n  grid: {\n    [theme.breakpoints.up(\"md\")]: {\n      display: \"grid\",\n      gridTemplateAreas: `\n        \"header spacer\"\n        \"content sidebar\"\n      `,\n      gridTemplateRows: `content auto`,\n      gridTemplateColumns: `1fr 375px`,\n    },\n  },\n  header: {\n    padding: theme.spacing(6),\n    gridArea: \"header\",\n\n    [theme.breakpoints.down(\"md\")]: {\n      padding: theme.spacing(4),\n    },\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      display: \"none\",\n    },\n  },\n  content: {\n    padding: theme.spacing(0, 6, 6),\n    overflow: \"hidden\",\n    gridArea: \"content\",\n\n    [theme.breakpoints.down(\"md\")]: {\n      padding: theme.spacing(0, 4, 4),\n    },\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      paddingTop: theme.spacing(6),\n    },\n  },\n  spacer: {\n    gridArea: \"spacer\",\n    backgroundColor: tinycolor(theme.palette.text.primary).setAlpha(0.04).toRgbString(),\n\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      display: \"none\",\n    },\n  },\n  sidebar: {\n    gridArea: \"sidebar\",\n    backgroundColor: tinycolor(theme.palette.text.primary).setAlpha(0.04).toRgbString(),\n    padding: theme.spacing(0, 5, 5),\n\n    [theme.breakpoints.down(\"md\")]: {\n      padding: theme.spacing(4),\n    },\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      paddingTop: theme.spacing(6),\n    },\n  },\n  button: {\n    whiteSpace: \"nowrap\",\n    textOverflow: \"ellipsis\",\n    overflow: \"hidden\",\n  },\n  connectionButton: {\n    textAlign: \"left\",\n    justifyContent: \"flex-start\",\n    padding: theme.spacing(2, 3),\n    gap: theme.spacing(1.5),\n    borderColor: theme.palette.divider,\n\n    \".MuiButton-startIcon .MuiSvgIcon-fontSizeLarge\": {\n      fontSize: 28,\n    },\n  },\n  recentListItemButton: {\n    overflow: \"hidden\",\n    color: theme.palette.primary.main,\n\n    \"&:hover\": {\n      backgroundColor: \"transparent\",\n      color: theme.palette.primary[theme.palette.mode === \"dark\" ? \"light\" : \"dark\"],\n    },\n  },\n  recentSourceSecondary: {\n    color: \"inherit\",\n  },\n  featureList: {\n    paddingLeft: theme.spacing(1.5),\n\n    \"li:not(:last-of-type)\": {\n      marginBottom: theme.spacing(0.5),\n    },\n  },\n}));\n\ntype DataSourceOptionProps = {\n  text: string;\n  secondaryText: string;\n  icon: JSX.Element;\n  onClick: () => void;\n  href?: string;\n  target: \"_blank\";\n};\n\nfunction DataSourceOption(props: DataSourceOptionProps): JSX.Element {\n  const { icon, onClick, text, secondaryText, href, target } = props;\n  const { classes } = useStyles();\n  const button = (\n    <Button\n      className={classes.connectionButton}\n      fullWidth\n      color=\"inherit\"\n      variant=\"outlined\"\n      size=\"large\"\n      startIcon={icon}\n      onClick={onClick}\n    >\n      <Stack flex=\"auto\" zeroMinWidth>\n        <Typography variant=\"subtitle1\" color=\"text.primary\">\n          {text}\n        </Typography>\n        <Typography variant=\"body2\" color=\"text.secondary\" noWrap>\n          {secondaryText}\n        </Typography>\n      </Stack>\n    </Button>\n  );\n\n  return href ? (\n    <Link href={href} target={target} style={{ textDecoration: \"none\" }}>\n      {button}\n    </Link>\n  ) : (\n    button\n  );\n}\n\ntype SidebarItem = {\n  id: string;\n  title: string;\n  text: ReactNode;\n  actions?: ReactNode;\n};\n\nfunction SidebarItems(props: { onSelectView: (newValue: OpenDialogViews) => void }): JSX.Element {\n  const { onSelectView } = props;\n  const { signIn } = useCurrentUser();\n  const currentUserType = useCurrentUserType();\n  const analytics = useAnalytics();\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"openDialog\");\n\n  const { freeUser, teamOrEnterpriseUser } = useMemo(() => {\n    const demoItem = {\n      id: \"new\",\n      title: t(\"newToFoxgloveStudio\"),\n      text: t(\"newToFoxgloveStudioDescription\"),\n      actions: (\n        <>\n          <Button\n            onClick={() => {\n              onSelectView(\"demo\");\n              void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"demo\" });\n              void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                user: currentUserType,\n                cta: \"demo\",\n              });\n            }}\n            className={classes.button}\n            variant=\"outlined\"\n          >\n            {t(\"exploreSampleData\")}\n          </Button>\n          <Button\n            href=\"https://foxglove.dev/docs/studio/connection/data-sources\"\n            target=\"_blank\"\n            className={classes.button}\n            onClick={() => {\n              void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                user: currentUserType,\n                cta: \"docs\",\n              });\n            }}\n          >\n            {t(\"viewOurDocs\")}\n          </Button>\n        </>\n      ),\n    };\n    return {\n      freeUser: [demoItem],\n      teamOrEnterpriseUser: [\n        demoItem,\n        {\n          id: \"join-community\",\n          title: t(\"joinOurCommunity\"),\n          text: t(\"joinOurCommunityDescription\"),\n          actions: (\n            <>\n              <Button\n                href=\"https://foxglove.dev/slack\"\n                target=\"_blank\"\n                className={classes.button}\n                variant=\"outlined\"\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"join-slack\",\n                  });\n                }}\n              >\n                {t(\"joinOurSlack\")}\n              </Button>\n              <Button\n                href=\"https://github.com/foxglove/studio/issues/new/choose\"\n                target=\"_blank\"\n                className={classes.button}\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"go-to-github\",\n                  });\n                }}\n              >\n                {t(\"openAGitHubIssue\")}\n              </Button>\n            </>\n          ),\n        },\n        {\n          id: \"need-help\",\n          title: t(\"needHelp\"),\n          text: t(\"needHelpDescription\"),\n          actions: (\n            <>\n              <Button\n                href=\"https://foxglove.dev/docs/studio\"\n                target=\"_blank\"\n                className={classes.button}\n                variant=\"outlined\"\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"docs\",\n                  });\n                }}\n              >\n                {t(\"viewOurDocs\")}\n              </Button>\n              <Button\n                href=\"https://foxglove.dev/tutorials\"\n                target=\"_blank\"\n                className={classes.button}\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"tutorials\",\n                  });\n                }}\n              >\n                {t(\"seeTutorials\")}\n              </Button>\n            </>\n          ),\n        },\n      ],\n    };\n  }, [analytics, classes.button, currentUserType, onSelectView, t]);\n\n  const sidebarItems: SidebarItem[] = useMemo(() => {\n    switch (currentUserType) {\n      case \"unauthenticated\":\n        return [\n          ...freeUser,\n          {\n            id: \"collaborate\",\n            title: t(\"collaborateTitle\"),\n            text: (\n              <ul className={classes.featureList}>\n                <li>{t(\"secureStorageOfData\")}</li>\n                <li>{t(\"convenientWebInterface\")}</li>\n                <li>{t(\"canBeShared\")}</li>\n              </ul>\n            ),\n            actions: signIn ? (\n              <>\n                <Button\n                  className={classes.button}\n                  variant=\"outlined\"\n                  onClick={() => {\n                    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                      user: currentUserType,\n                      cta: \"create-account\",\n                    });\n                    signIn();\n                  }}\n                >\n                  {t(\"createAFreeAccount\")}\n                </Button>\n                <Button\n                  className={classes.button}\n                  onClick={() => {\n                    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                      user: currentUserType,\n                      cta: \"sign-in\",\n                    });\n                    signIn();\n                  }}\n                >\n                  {t(\"signIn\")}\n                </Button>\n              </>\n            ) : (\n              <Button\n                href=\"https://foxglove.dev/data-platform\"\n                target=\"_blank\"\n                className={classes.button}\n                variant=\"outlined\"\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"create-account\",\n                  });\n                }}\n              >\n                {t(\"learnMore\")}\n              </Button>\n            ),\n          },\n        ];\n      case \"authenticated-free\":\n        return [\n          {\n            id: \"start-collaborating\",\n            title: t(\"startCollaborating\"),\n            text: t(\"startCollaboratingDescription\"),\n            actions: (\n              <>\n                <Button\n                  href=\"https://console.foxglove.dev/recordings\"\n                  target=\"_blank\"\n                  variant=\"outlined\"\n                  className={classes.button}\n                  onClick={() => {\n                    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                      user: currentUserType,\n                      cta: \"upload-to-dp\",\n                    });\n                  }}\n                >\n                  {t(\"uploadToDataPlatform\")}\n                </Button>\n                <Button\n                  href=\"https://foxglove.dev/docs/studio/layouts#team-layouts\"\n                  target=\"_blank\"\n                  className={classes.button}\n                >\n                  {t(\"shareLayouts\")}\n                </Button>\n              </>\n            ),\n          },\n          ...freeUser,\n        ];\n      case \"authenticated-team\":\n        return teamOrEnterpriseUser;\n      case \"authenticated-enterprise\":\n        return teamOrEnterpriseUser;\n    }\n  }, [\n    analytics,\n    classes.button,\n    classes.featureList,\n    currentUserType,\n    freeUser,\n    signIn,\n    teamOrEnterpriseUser,\n    t,\n  ]);\n\n  return (\n    <>\n      {sidebarItems.map((item) => (\n        <Stack key={item.id}>\n          <Typography variant=\"h5\" gutterBottom>\n            {item.title}\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            {item.text}\n          </Typography>\n          {item.actions != undefined && (\n            <Stack direction=\"row\" alignItems=\"center\" gap={1} paddingTop={1.5}>\n              {item.actions}\n            </Stack>\n          )}\n        </Stack>\n      ))}\n    </>\n  );\n}\n\nexport default function Start(props: IStartProps): JSX.Element {\n  const { onSelectView } = props;\n  const { recentSources, selectRecent } = usePlayerSelection();\n  const { classes } = useStyles();\n  const analytics = useAnalytics();\n  const { t } = useTranslation(\"openDialog\");\n\n  const startItems = useMemo(() => {\n    return [\n      {\n        key: \"open-local-file\",\n        text: t(\"openLocalFile\"),\n        secondaryText: t(\"openLocalFileDescription\"),\n        icon: (\n          <SvgIcon fontSize=\"large\" color=\"primary\" viewBox=\"0 0 2048 2048\">\n            <path d=\"M1955 1533l-163-162v677h-128v-677l-163 162-90-90 317-317 317 317-90 90zM256 1920h1280v128H128V0h1115l549 549v475h-128V640h-512V128H256v1792zM1280 512h293l-293-293v293z\" />\n          </SvgIcon>\n        ),\n        onClick: () => {\n          onSelectView(\"file\");\n          void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"local\" });\n        },\n      },\n      {\n        key: \"open-url\",\n        text: t(\"openUrl\"),\n        secondaryText: t(\"openUrlDescription\"),\n        icon: (\n          <SvgIcon fontSize=\"large\" color=\"primary\" viewBox=\"0 0 2048 2048\">\n            <path d=\"M256 1920h512v128H128V0h1115l549 549v91h-640V128H256v1792zM1280 512h293l-293-293v293zm128 256q133 0 249 50t204 137 137 203 50 250q0 133-50 249t-137 204-203 137-250 50q-133 0-249-50t-204-137-137-203-50-250q0-133 50-249t137-204 203-137 250-50zm0 1152q21 0 37-14t28-38 21-53 15-57 9-53 6-41h-230q2 14 5 39t10 53 16 58 21 52 27 39 35 15zm126-384q1-32 1-64t1-64q0-63-3-128h-250q-3 65-3 128 0 64 3 128h251zm-638-128q0 32 4 64t12 64h243q-3-64-3-128 0-63 3-128H912q-8 32-12 64t-4 64zm512-512q-19 0-34 15t-27 39-21 53-15 57-10 53-6 39h225q-2-13-6-37t-11-53-16-58-20-54-27-39-32-15zm253 384q3 65 3 128v64q0 32-2 64h242q8-32 12-64t4-64q0-32-4-64t-12-64h-243zm190-128q-43-75-108-131t-145-88q21 52 32 107t19 112h202zm-637-218q-78 32-142 88t-107 130h200q13-111 49-218zm-249 730q42 73 106 129t142 88q-21-51-31-106t-17-111H965zm642 215q77-32 139-87t105-128h-198q-5 51-15 109t-31 106z\" />\n          </SvgIcon>\n        ),\n        iconProps: { iconName: \"FileASPX\" },\n        href: \"https://console.foxglove.dev/recordings\",\n        onClick: () => {\n          void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"data-platform\" });\n        },\n      },\n      {\n        key: \"open-connection\",\n        text: t(\"openConnection\"),\n        secondaryText: t(\"openConnectionDescription\"),\n        icon: (\n          <SvgIcon fontSize=\"large\" color=\"primary\" viewBox=\"0 0 2048 2048\">\n            <path d=\"M1408 256h640v640h-640V640h-120l-449 896H640v256H0v-640h640v256h120l449-896h199V256zM512 1664v-384H128v384h384zm1408-896V384h-384v384h384z\" />\n          </SvgIcon>\n        ),\n        onClick: () => {\n          onSelectView(\"connection\");\n          void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"live\" });\n        },\n      },\n    ];\n  }, [analytics, onSelectView, t]);\n\n  return (\n    <Stack className={classes.grid}>\n      <header className={classes.header}>\n        <FoxgloveLogoText color=\"primary\" className={classes.logo} />\n      </header>\n      <Stack className={classes.content}>\n        <Stack gap={4}>\n          <Stack gap={1}>\n            <Typography variant=\"h5\" gutterBottom>\n              {t(\"openDataSource\")}\n            </Typography>\n            {startItems.map((item) => (\n              <DataSourceOption\n                key={item.key}\n                text={item.text}\n                secondaryText={item.secondaryText}\n                icon={item.icon}\n                onClick={item.onClick}\n                href={item.href}\n                target=\"_blank\"\n              />\n            ))}\n          </Stack>\n          {recentSources.length > 0 && (\n            <Stack gap={1}>\n              <Typography variant=\"h5\" gutterBottom>\n                {t(\"recentDataSources\")}\n              </Typography>\n              <List disablePadding>\n                {recentSources.slice(0, 5).map((recent) => (\n                  <ListItem disablePadding key={recent.id} id={recent.id}>\n                    <ListItemButton\n                      disableGutters\n                      onClick={() => selectRecent(recent.id)}\n                      className={classes.recentListItemButton}\n                    >\n                      <TextMiddleTruncate\n                        className={classes.recentSourceSecondary}\n                        text={recent.title}\n                      />\n                    </ListItemButton>\n                  </ListItem>\n                ))}\n              </List>\n            </Stack>\n          )}\n        </Stack>\n      </Stack>\n      <div className={classes.spacer} />\n      <Stack gap={4} className={classes.sidebar}>\n        <SidebarItems onSelectView={onSelectView} />\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport path from \"path\";\nimport { useCallback, useMemo } from \"react\";\n\nimport {\n  IDataSourceFactory,\n  usePlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport showOpenFilePicker from \"@foxglove/studio-base/util/showOpenFilePicker\";\n\nexport function useOpenFile(sources: IDataSourceFactory[]): () => Promise<void> {\n  const { selectSource } = usePlayerSelection();\n\n  const allExtensions = useMemo(() => {\n    return sources.reduce((all, source) => {\n      if (!source.supportedFileTypes) {\n        return all;\n      }\n\n      return [...all, ...source.supportedFileTypes];\n    }, [] as string[]);\n  }, [sources]);\n\n  return useCallback(async () => {\n    const [fileHandle] = await showOpenFilePicker({\n      types: [\n        {\n          description: allExtensions.join(\", \"),\n          accept: { \"application/octet-stream\": allExtensions },\n        },\n      ],\n    });\n    if (!fileHandle) {\n      return;\n    }\n\n    const file = await fileHandle.getFile();\n    // Find the first _file_ source which can load our extension\n    const matchingSources = sources.filter((source) => {\n      // Only consider _file_ type sources that have a list of supported file types\n      if (!source.supportedFileTypes || source.type !== \"file\") {\n        return false;\n      }\n\n      const extension = path.extname(file.name);\n      return source.supportedFileTypes.includes(extension);\n    });\n\n    if (matchingSources.length > 1) {\n      throw new Error(`Multiple source matched ${file.name}. This is not supported.`);\n    }\n\n    const foundSource = matchingSources[0];\n    if (!foundSource) {\n      throw new Error(`Cannot find source to handle ${file.name}`);\n    }\n\n    selectSource(foundSource.id, { type: \"file\", handle: fileHandle });\n  }, [allExtensions, selectSource, sources]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Dialog, IconButton } from \"@mui/material\";\nimport { useCallback, useLayoutEffect, useMemo, useState } from \"react\";\nimport { useMountedState } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Snow from \"@foxglove/studio-base/components/OpenDialog/Snow\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  IDataSourceFactory,\n  usePlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport Connection from \"./Connection\";\nimport Start from \"./Start\";\nimport { OpenDialogViews } from \"./types\";\nimport { useOpenFile } from \"./useOpenFile\";\n\nexport type OpenDialogProps = {\n  activeDataSource?: IDataSourceFactory;\n  activeView?: OpenDialogViews;\n  backdropAnimation?: boolean;\n  onDismiss?: () => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  paper: {\n    maxWidth: `calc(min(${theme.breakpoints.values.md}px, 100% - ${theme.spacing(4)}))`,\n  },\n  closeButton: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n    margin: theme.spacing(3),\n  },\n}));\n\nexport default function OpenDialog(props: OpenDialogProps): JSX.Element {\n  const { activeView: defaultActiveView, onDismiss, activeDataSource, backdropAnimation } = props;\n  const { classes } = useStyles();\n  const { availableSources, selectSource } = usePlayerSelection();\n\n  const isMounted = useMountedState();\n  const [activeView, setActiveView] = useState<OpenDialogViews>(defaultActiveView ?? \"start\");\n\n  const openFile = useOpenFile(availableSources);\n\n  const firstSampleSource = useMemo(() => {\n    return availableSources.find((source) => source.type === \"sample\");\n  }, [availableSources]);\n\n  useLayoutEffect(() => {\n    setActiveView(defaultActiveView ?? \"start\");\n  }, [defaultActiveView]);\n\n  const onSelectView = useCallback((view: OpenDialogViews) => {\n    setActiveView(view);\n  }, []);\n\n  const analytics = useAnalytics();\n\n  const onModalClose = useCallback(() => {\n    if (onDismiss) {\n      onDismiss();\n      void analytics.logEvent(AppEvent.DIALOG_CLOSE, { activeView });\n    }\n  }, [analytics, activeView, onDismiss]);\n\n  useLayoutEffect(() => {\n    if (activeView === \"file\") {\n      openFile()\n        .catch((err) => {\n          console.error(err);\n        })\n        .finally(() => {\n          // set the view back to start so the user can click to open file again\n          if (isMounted()) {\n            setActiveView(\"start\");\n          }\n        });\n    } else if (activeView === \"demo\" && firstSampleSource) {\n      selectSource(firstSampleSource.id);\n    }\n  }, [activeView, firstSampleSource, isMounted, openFile, selectSource]);\n\n  const backdrop = useMemo(() => {\n    const now = new Date();\n    if (backdropAnimation === false) {\n      return;\n    } else if (now >= new Date(now.getFullYear(), 11, 25)) {\n      return <Snow effect=\"snow\" />;\n    } else if (now < new Date(now.getFullYear(), 0, 2)) {\n      return <Snow effect=\"confetti\" />;\n    }\n    return;\n  }, [backdropAnimation]);\n\n  // connectionSources is the list of availableSources supporting \"connections\"\n  const connectionSources = useMemo(() => {\n    return availableSources.filter((source) => {\n      return source.type === \"connection\" && source.hidden !== true;\n    });\n  }, [availableSources]);\n\n  const view = useMemo(() => {\n    switch (activeView) {\n      case \"demo\": {\n        return {\n          title: \"\",\n          component: <></>,\n        };\n      }\n      case \"connection\":\n        return {\n          title: \"Open new connection\",\n          component: (\n            <Connection\n              onBack={() => onSelectView(\"start\")}\n              onCancel={onModalClose}\n              availableSources={connectionSources}\n              activeSource={activeDataSource}\n            />\n          ),\n        };\n      default:\n        return {\n          title: \"Get started\",\n          component: <Start onSelectView={onSelectView} />,\n        };\n    }\n  }, [activeDataSource, activeView, connectionSources, onModalClose, onSelectView]);\n\n  return (\n    <Dialog\n      open\n      onClose={onModalClose}\n      fullWidth\n      maxWidth=\"lg\"\n      BackdropProps={{ children: backdrop }}\n      PaperProps={{\n        square: false,\n        elevation: 4,\n        className: classes.paper,\n      }}\n    >\n      <IconButton className={classes.closeButton} onClick={onModalClose} edge=\"end\">\n        <CloseIcon />\n      </IconButton>\n      <Stack\n        flexGrow={1}\n        fullHeight\n        justifyContent=\"space-between\"\n        overflow={activeView === \"connection\" ? \"hidden\" : undefined}\n      >\n        {view.component}\n      </Stack>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport { IconButton, Menu, MenuItem } from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\n\nexport function ActionMenu({\n  allowShare,\n  onReset,\n  onShare,\n}: {\n  allowShare: boolean;\n  onReset: () => void;\n  onShare: () => void;\n}): JSX.Element {\n  const [anchorEl, setAnchorEl] = React.useState<undefined | HTMLElement>();\n  const { t } = useTranslation(\"panelSettings\");\n  const open = Boolean(anchorEl);\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  return (\n    <div>\n      <IconButton\n        id=\"basic-button\"\n        aria-controls={open ? \"basic-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n      >\n        <MoreVertIcon />\n      </IconButton>\n      <Menu\n        id=\"basic-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n        MenuListProps={{\n          \"aria-labelledby\": \"basic-button\",\n        }}\n      >\n        <MenuItem\n          disabled={!allowShare}\n          onClick={() => {\n            onShare();\n            handleClose();\n          }}\n        >\n          {t(\"importOrExportSettingsWithEllipsis\")}\n        </MenuItem>\n        <MenuItem\n          onClick={() => {\n            onReset();\n            handleClose();\n          }}\n        >\n          {t(\"resetToDefaults\")}\n        </MenuItem>\n      </Menu>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport TagIcon from \"@mui/icons-material/Tag\";\nimport { TextField } from \"@mui/material\";\nimport { useCallback, useState, useEffect, useMemo } from \"react\";\nimport { HexAlphaColorPicker, HexColorPicker } from \"react-colorful\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { useDebouncedCallback } from \"use-debounce\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  container: {\n    padding: theme.spacing(2),\n  },\n  picker: {\n    \"&.react-colorful\": {\n      width: \"100%\",\n      gap: theme.spacing(0.75),\n    },\n    \".react-colorful__last-control\": {\n      borderRadius: 0,\n    },\n    \".react-colorful__saturation\": {\n      borderRadius: 0,\n    },\n    \".react-colorful__hue\": {\n      order: -1,\n    },\n    \".react-colorful__hue-pointer\": {\n      zIndex: 4,\n    },\n  },\n}));\n\ntype ColorPickerInputProps = {\n  alphaType: \"none\" | \"alpha\";\n  value: undefined | string;\n  onChange: (value: string) => void;\n  onEnterKey?: () => void;\n};\n\nfunction isValidHexColor(color: string, alphaType: \"none\" | \"alpha\") {\n  return alphaType === \"alpha\" ? /^[0-9a-f]{8}$/i.test(color) : /^[0-9a-f]{6}$/i.test(color);\n}\n\nexport function ColorPickerControl(props: ColorPickerInputProps): JSX.Element {\n  const { alphaType, onChange, value, onEnterKey } = props;\n\n  const { classes } = useStyles();\n\n  const parsedValue = useMemo(() => (value ? tinycolor(value) : undefined), [value]);\n  const displayValue =\n    alphaType === \"alpha\" ? parsedValue?.toHex8String() : parsedValue?.toHexString();\n  const swatchColor = displayValue ?? \"#00000044\";\n\n  const [editedValue, setEditedValue] = useState(\"\");\n\n  const editedValueIsInvalid = editedValue.length > 0 && !isValidHexColor(editedValue, alphaType);\n\n  const updateColor = useDebouncedCallback((newValue: string) => {\n    onChange(newValue);\n  });\n\n  const updateEditedValue = useCallback(\n    (newValue: string) => {\n      setEditedValue(newValue);\n\n      if (isValidHexColor(newValue, alphaType)) {\n        onChange(`#${newValue}`);\n      }\n    },\n    [alphaType, onChange],\n  );\n\n  useEffect(() => {\n    setEditedValue((alphaType === \"alpha\" ? parsedValue?.toHex8() : parsedValue?.toHex()) ?? \"\");\n  }, [alphaType, parsedValue]);\n\n  return (\n    <Stack className={classes.container} gap={1}>\n      {alphaType === \"alpha\" ? (\n        <HexAlphaColorPicker\n          className={classes.picker}\n          color={swatchColor}\n          onChange={(newValue) => updateColor(newValue)}\n        />\n      ) : (\n        <HexColorPicker\n          className={classes.picker}\n          color={swatchColor}\n          onChange={(newValue) => updateColor(newValue)}\n        />\n      )}\n      <TextField\n        size=\"small\"\n        error={editedValueIsInvalid}\n        InputProps={{\n          onFocus: (event) => event.target.select(),\n          role: \"input\",\n          startAdornment: <TagIcon fontSize=\"small\" />,\n          style: { fontFamily: fonts.MONOSPACE },\n        }}\n        placeholder={alphaType === \"alpha\" ? \"RRGGBBAA\" : \"RRGGBB\"}\n        value={editedValue}\n        onKeyDown={(event) => event.key === \"Enter\" && onEnterKey?.()}\n        onChange={(event) => updateEditedValue(event.target.value)}\n      />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Theme, useTheme } from \"@mui/material\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nfunction calculateBorderColor(theme: Theme, color: string): string {\n  const parsedColor = tinycolor(color);\n  return parsedColor.isValid()\n    ? theme.palette.getContrastText(parsedColor.toHexString())\n    : theme.palette.text.primary;\n}\n\ntype ColorSwatchProps = {\n  color: string;\n  size?: \"small\" | \"medium\" | \"large\";\n} & React.HTMLAttributes<HTMLDivElement>;\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    // Color on top of white/black diagonal gradient. Color must be specified as a gradient because a\n    // background color can't be stacked on top of a background image.\n    backgroundImage: `linear-gradient(to bottom right, white 50%, black 50%)`,\n    borderRadius: theme.shape.borderRadius,\n    display: \"inline-flex\",\n    aspectRatio: \"1/1\",\n    flexShrink: 0,\n  },\n  swatch: {\n    aspectRatio: \"1/1\",\n  },\n  sizeSmall: {\n    height: theme.spacing(2),\n    width: theme.spacing(2),\n  },\n  sizeMedium: {\n    height: theme.spacing(2),\n    width: theme.spacing(2),\n  },\n  sizeLarge: {\n    height: theme.spacing(3),\n    width: theme.spacing(3),\n  },\n}));\n\nexport function ColorSwatch(props: ColorSwatchProps): JSX.Element {\n  const { color, size = \"medium\", className, ...rest } = props;\n  const { classes, cx } = useStyles();\n  const theme = useTheme();\n  return (\n    <div\n      className={cx(\n        classes.root,\n        {\n          [classes.sizeSmall]: size === \"small\",\n          [classes.sizeMedium]: size === \"medium\",\n          [classes.sizeLarge]: size === \"large\",\n        },\n        className,\n      )}\n      {...rest}\n    >\n      <div\n        title={color}\n        className={classes.swatch}\n        style={{\n          backgroundColor: color,\n          border: `1px solid ${calculateBorderColor(theme, color)}`,\n        }}\n      />\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CancelIcon from \"@mui/icons-material/Cancel\";\nimport { TextField, Popover, IconButton } from \"@mui/material\";\nimport { useCallback, MouseEvent, useState, useMemo } from \"react\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nimport { ColorPickerControl } from \"./ColorPickerControl\";\nimport { ColorSwatch } from \"./ColorSwatch\";\n\nconst useStyles = makeStyles<void, \"iconButton\">()((theme, _params, classes) => ({\n  root: {\n    position: \"relative\",\n  },\n  rootDisabled: {\n    pointerEvents: \"none\",\n  },\n  textField: {\n    \".MuiInputBase-formControl.MuiInputBase-root\": {\n      padding: 0,\n    },\n    \".MuiInputBase-root\": {\n      cursor: \"pointer\",\n\n      [`:not(:hover) .${classes.iconButton}`]: {\n        visibility: \"hidden\",\n      },\n    },\n    \".MuiInputBase-input\": {\n      alignItems: \"center\",\n      fontFeatureSettings: `${fonts.SANS_SERIF_FEATURE_SETTINGS}, \"zero\"`,\n    },\n  },\n  iconButton: {\n    marginRight: theme.spacing(0.25),\n    opacity: theme.palette.action.disabledOpacity,\n\n    \":hover\": {\n      background: \"transparent\",\n      opacity: 1,\n    },\n  },\n  colorSwatch: {\n    marginLeft: theme.spacing(0.75),\n  },\n}));\n\ntype ColorPickerInputProps = {\n  alphaType: \"none\" | \"alpha\";\n  disabled?: boolean;\n  value: undefined | string;\n  onChange: (value: undefined | string) => void;\n  placeholder?: string;\n  readOnly?: boolean;\n  hideClearButton?: boolean;\n};\n\nexport function ColorPickerInput(props: ColorPickerInputProps): JSX.Element {\n  const { alphaType, disabled, onChange, readOnly, hideClearButton, value } = props;\n\n  const { classes, cx } = useStyles();\n\n  const [anchorElement, setAnchorElement] = useState<undefined | HTMLDivElement>(undefined);\n\n  const parsedValue = useMemo(() => (value ? tinycolor(value) : undefined), [value]);\n  const displayValue =\n    alphaType === \"alpha\" ? parsedValue?.toHex8String() : parsedValue?.toHexString();\n  const swatchColor = displayValue ?? \"#00000044\";\n\n  const handleClick = useCallback((event: MouseEvent<HTMLDivElement>) => {\n    setAnchorElement(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorElement(undefined);\n  }, []);\n\n  const clearValue = useCallback(() => {\n    onChange(undefined);\n  }, [onChange]);\n\n  const open = Boolean(anchorElement);\n\n  const shouldHideClearButton = (displayValue ?? \"\") === \"\" || (hideClearButton ?? false);\n  return (\n    <Stack\n      className={cx(classes.root, {\n        [classes.rootDisabled]: disabled === true || readOnly === true,\n      })}\n    >\n      <TextField\n        className={classes.textField}\n        fullWidth\n        disabled={disabled}\n        placeholder={props.placeholder}\n        size=\"small\"\n        value={displayValue ?? \"\"}\n        variant=\"filled\"\n        InputProps={{\n          readOnly: true,\n          startAdornment: (\n            <ColorSwatch\n              className={classes.colorSwatch}\n              color={swatchColor}\n              onClick={handleClick}\n              size=\"small\"\n            />\n          ),\n          endAdornment: !shouldHideClearButton && (\n            <IconButton\n              size=\"small\"\n              className={classes.iconButton}\n              onClick={clearValue}\n              disabled={disabled}\n            >\n              <CancelIcon />\n            </IconButton>\n          ),\n        }}\n      />\n      <Popover\n        open={open}\n        anchorEl={anchorElement}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <ColorPickerControl\n          alphaType={alphaType}\n          value={value}\n          onChange={onChange}\n          onEnterKey={handleClose}\n        />\n      </Popover>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Popover, TextField, useTheme } from \"@mui/material\";\nimport { useCallback, useState } from \"react\";\nimport tinycolor from \"tinycolor2\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { ColorPickerControl } from \"./ColorPickerControl\";\nimport { ColorSwatch } from \"./ColorSwatch\";\n\nexport function ColorGradientInput({\n  colors,\n  disabled = false,\n  onChange,\n  readOnly = false,\n}: {\n  colors: undefined | readonly [string, string];\n  disabled?: boolean;\n  onChange: (colors: [string, string]) => void;\n  readOnly?: boolean;\n}): JSX.Element {\n  const [leftAnchor, setLeftAnchor] = useState<undefined | HTMLDivElement>(undefined);\n  const [rightAnchor, setRightAnchor] = useState<undefined | HTMLDivElement>(undefined);\n\n  const handleLeftClick = useCallback(\n    (event: React.MouseEvent<HTMLDivElement>) => {\n      if (readOnly) {\n        return;\n      }\n\n      setLeftAnchor(event.currentTarget);\n      setRightAnchor(undefined);\n    },\n    [readOnly],\n  );\n\n  const handleRightClick = useCallback(\n    (event: React.MouseEvent<HTMLDivElement>) => {\n      if (readOnly) {\n        return;\n      }\n\n      setLeftAnchor(undefined);\n      setRightAnchor(event.currentTarget);\n    },\n    [readOnly],\n  );\n\n  const handleClose = useCallback(() => {\n    setLeftAnchor(undefined);\n    setRightAnchor(undefined);\n  }, []);\n\n  const leftColor = colors?.[0] ?? \"#000000\";\n  const rightColor = colors?.[1] ?? \"#FFFFFF\";\n  const safeLeftColor = tinycolor(leftColor).isValid() ? leftColor : \"#000000\";\n  const safeRightColor = tinycolor(rightColor).isValid() ? rightColor : \"#FFFFFF\";\n\n  const theme = useTheme();\n\n  return (\n    <Stack\n      direction=\"row\"\n      alignItems=\"center\"\n      position=\"relative\"\n      paddingX={0.75}\n      style={{\n        opacity: disabled ? 0.5 : 1,\n        pointerEvents: disabled ? \"none\" : \"auto\",\n        background: `linear-gradient(to right, ${safeLeftColor}, ${safeRightColor}), repeating-conic-gradient(transparent 0 90deg, ${theme.palette.action.disabled} 90deg 180deg) top left/10px 10px repeat`,\n      }}\n    >\n      <ColorSwatch color={safeLeftColor} onClick={handleLeftClick} />\n      <TextField\n        variant=\"filled\"\n        size=\"small\"\n        fullWidth\n        value={`${leftColor} / ${rightColor}`}\n        style={{ visibility: \"hidden\" }}\n      />\n      <ColorSwatch color={safeRightColor} onClick={handleRightClick} />\n      <Popover\n        open={leftAnchor != undefined}\n        anchorEl={leftAnchor}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <ColorPickerControl\n          value={leftColor}\n          alphaType=\"alpha\"\n          onChange={(newValue) => onChange([newValue, rightColor])}\n          onEnterKey={handleClose}\n        />\n      </Popover>\n      <Popover\n        open={rightAnchor != undefined}\n        anchorEl={rightAnchor}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <ColorPickerControl\n          value={rightColor}\n          alphaType=\"alpha\"\n          onChange={(newValue) => onChange([leftColor, newValue])}\n          onEnterKey={handleClose}\n        />\n      </Popover>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ChevronLeftIcon from \"@mui/icons-material/ChevronLeft\";\nimport ChevronRightIcon from \"@mui/icons-material/ChevronRight\";\nimport { IconButton, TextFieldProps, TextField } from \"@mui/material\";\nimport { clamp, isFinite } from \"lodash\";\nimport { ReactNode, useCallback, useRef } from \"react\";\nimport { useLatest } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  iconButton: {\n    \"&.MuiIconButton-edgeStart\": {\n      marginLeft: theme.spacing(-0.75),\n      borderTopRightRadius: 0,\n      borderBottomRightRadius: 0,\n    },\n    \"&.MuiIconButton-edgeEnd\": {\n      marginRight: theme.spacing(-0.75),\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n    },\n  },\n\n  textField: {\n    \".MuiInputBase-formControl.MuiInputBase-root\": {\n      paddingTop: 0,\n      paddingBottom: 0,\n    },\n    \".MuiInputBase-input\": {\n      textAlign: \"center\",\n      fontFamily: fonts.MONOSPACE,\n      cursor: \"ew-resize\",\n\n      \"&::-webkit-outer-spin-button, &::-webkit-inner-spin-button\": {\n        appearance: \"none\",\n        margin: 0,\n      },\n    },\n    \"@media (pointer: fine)\": {\n      \".MuiIconButton-root\": {\n        visibility: \"hidden\",\n      },\n      \"&:hover .MuiIconButton-root\": {\n        visibility: \"visible\",\n      },\n    },\n  },\n  textFieldReadonly: {\n    \".MuiInputBase-input\": {\n      cursor: \"auto\",\n    },\n  },\n}));\n\nexport function NumberInput(\n  props: {\n    iconUp?: ReactNode;\n    iconDown?: ReactNode;\n    max?: number;\n    min?: number;\n    precision?: number;\n    readOnly?: boolean;\n    step?: number;\n    value?: number;\n    onChange: (value: undefined | number) => void;\n  } & Omit<TextFieldProps, \"onChange\">,\n): JSX.Element {\n  const { classes, cx } = useStyles();\n  const {\n    value,\n    iconDown,\n    iconUp,\n    step = 1,\n    min,\n    max,\n    onChange,\n    disabled,\n    readOnly,\n    precision = 2,\n  } = props;\n\n  const inputRef = useRef<HTMLInputElement>(ReactNull);\n\n  // Maintain our own internal scrub value during the scrub to prevent jitter.\n  const scrubValue = useRef(0);\n\n  const latestValue = useLatest(value);\n\n  const placeHolderValue = isFinite(Number(props.placeholder))\n    ? Number(props.placeholder)\n    : undefined;\n\n  const updateValue = useCallback(\n    (newValue: undefined | number) => {\n      if (disabled === true || readOnly === true) {\n        return;\n      }\n\n      const clampedValue =\n        newValue == undefined\n          ? undefined\n          : clamp(newValue, min ?? Number.NEGATIVE_INFINITY, max ?? Number.POSITIVE_INFINITY);\n      onChange(clampedValue);\n    },\n    [disabled, readOnly, min, max, onChange],\n  );\n\n  const onPointerDown = useCallback(\n    (event: React.PointerEvent) => {\n      event.currentTarget.setPointerCapture(event.pointerId);\n      const scrubStart = latestValue.current ?? placeHolderValue ?? 0;\n      scrubValue.current = isFinite(scrubStart) ? scrubStart : 0;\n    },\n    [latestValue, placeHolderValue],\n  );\n\n  const onPointerUp = useCallback((event: React.PointerEvent) => {\n    event.currentTarget.releasePointerCapture(event.pointerId);\n  }, []);\n\n  const onPointerMove = useCallback(\n    (event: React.PointerEvent<HTMLInputElement>) => {\n      if (event.buttons === 1) {\n        event.preventDefault();\n        event.currentTarget.blur();\n        const scale = event.shiftKey ? 10 : 1;\n        const delta =\n          Math.sign(event.movementX) *\n          Math.pow(Math.abs(event.movementX), 1.5) *\n          0.1 *\n          step *\n          scale;\n        scrubValue.current += delta;\n        updateValue(scrubValue.current);\n      }\n    },\n    [step, updateValue],\n  );\n\n  const displayValue =\n    inputRef.current === document.activeElement ? value : value?.toFixed(precision);\n\n  return (\n    <TextField\n      {...props}\n      value={displayValue ?? \"\"}\n      onChange={(event) =>\n        updateValue(event.target.value.length > 0 ? Number(event.target.value) : undefined)\n      }\n      type=\"number\"\n      className={cx(classes.textField, { [classes.textFieldReadonly]: readOnly })}\n      inputProps={{\n        ref: inputRef,\n        step,\n        onPointerDown,\n        onPointerUp,\n        onPointerMove,\n      }}\n      InputProps={{\n        readOnly,\n        startAdornment: (\n          <IconButton\n            className={classes.iconButton}\n            size=\"small\"\n            edge=\"start\"\n            tabIndex={-1} // Disable tabbing to the step buttons.\n            onClick={(event: React.MouseEvent) =>\n              updateValue((value ?? placeHolderValue ?? 0) - (event.shiftKey ? step * 10 : step))\n            }\n          >\n            {iconDown ?? <ChevronLeftIcon fontSize=\"small\" />}\n          </IconButton>\n        ),\n        endAdornment: (\n          <IconButton\n            className={classes.iconButton}\n            size=\"small\"\n            edge=\"end\"\n            tabIndex={-1} // Disable tabbing to the step buttons.\n            onClick={(event: React.MouseEvent) =>\n              updateValue((value ?? placeHolderValue ?? 0) + (event.shiftKey ? step * 10 : step))\n            }\n          >\n            {iconUp ?? <ChevronRightIcon fontSize=\"small\" />}\n          </IconButton>\n        ),\n      }}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { NumberInput } from \"./NumberInput\";\n\ntype Vec2Props = {\n  disabled?: boolean;\n  onChange: (value: undefined | [undefined | number, undefined | number]) => void;\n  precision?: number;\n  readOnly?: boolean;\n  step?: number;\n  placeholder?: readonly [undefined | string, undefined | string];\n  value: undefined | readonly [undefined | number, undefined | number];\n  min?: number;\n  max?: number;\n};\n\nexport function Vec2Input(props: Vec2Props): JSX.Element {\n  const {\n    disabled = false,\n    onChange,\n    precision,\n    readOnly = false,\n    step,\n    value,\n    min,\n    max,\n    placeholder,\n  } = props;\n\n  const onChangeCallback = useCallback(\n    (position: number, inputValue: undefined | number) => {\n      const newValue: [undefined | number, undefined | number] = [...(value ?? [0, 0])];\n      newValue[position] = inputValue;\n      onChange(newValue);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Stack gap={0.25}>\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[0]}\n        value={value?.[0]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(0, newValue)}\n      />\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[1]}\n        value={value?.[1]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(1, newValue)}\n      />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { NumberInput } from \"./NumberInput\";\n\ntype Vec3Props = {\n  disabled?: boolean;\n  onChange: (\n    value: undefined | [undefined | number, undefined | number, undefined | number],\n  ) => void;\n  precision?: number;\n  readOnly?: boolean;\n  step?: number;\n  placeholder?: readonly [undefined | string, undefined | string, undefined | string];\n  value: undefined | readonly [undefined | number, undefined | number, undefined | number];\n  min?: number;\n  max?: number;\n};\n\nexport function Vec3Input(props: Vec3Props): JSX.Element {\n  const {\n    disabled = false,\n    onChange,\n    precision,\n    readOnly = false,\n    step,\n    value,\n    min,\n    max,\n    placeholder,\n  } = props;\n\n  const onChangeCallback = useCallback(\n    (position: number, inputValue: undefined | number) => {\n      const newValue: [undefined | number, undefined | number, undefined | number] = [\n        ...(value ?? [0, 0, 0]),\n      ];\n      newValue[position] = inputValue;\n      onChange(newValue);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Stack gap={0.25}>\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[0]}\n        value={value?.[0]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(0, newValue)}\n      />\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[1]}\n        value={value?.[1]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(1, newValue)}\n      />\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[2]}\n        value={value?.[2]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(2, newValue)}\n      />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport {\n  Autocomplete,\n  ToggleButton,\n  ToggleButtonGroup,\n  Typography,\n  List,\n  MenuItem,\n  Select,\n  Tooltip,\n  TextField,\n  ListProps,\n} from \"@mui/material\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { v4 as uuid } from \"uuid\";\n\nimport { SettingsTreeAction, SettingsTreeField } from \"@foxglove/studio\";\nimport MessagePathInput from \"@foxglove/studio-base/components/MessagePathSyntax/MessagePathInput\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { ColorPickerInput, ColorGradientInput, NumberInput, Vec3Input, Vec2Input } from \"./inputs\";\n\n/** Used to allow both undefined and empty string in select inputs. */\nconst UNDEFINED_SENTINEL_VALUE = uuid();\n/** Used to avoid MUI errors when an invalid option is selected */\nconst INVALID_SENTINEL_VALUE = uuid();\n\nconst useStyles = makeStyles<void, \"error\">()((theme, _params, classes) => {\n  const prefersDarkMode = theme.palette.mode === \"dark\";\n  const inputBackgroundColor = prefersDarkMode\n    ? \"rgba(255, 255, 255, 0.09)\"\n    : \"rgba(0, 0, 0, 0.06)\";\n\n  return {\n    error: {},\n    fieldLabel: {\n      color: theme.palette.text.secondary,\n      overflow: \"hidden\",\n      textOverflow: \"ellipsis\",\n      whiteSpace: \"nowrap\",\n    },\n    fieldWrapper: {\n      minWidth: theme.spacing(14),\n      marginRight: theme.spacing(0.5),\n      [`&.${classes.error} .MuiInputBase-root, .MuiInputBase-root.${classes.error}`]: {\n        outline: `1px ${theme.palette.error.main} solid`,\n        outlineOffset: -1,\n      },\n    },\n    multiLabelWrapper: {\n      display: \"grid\",\n      gridTemplateColumns: \"1fr auto\",\n      columnGap: theme.spacing(0.5),\n      height: \"100%\",\n      width: \"100%\",\n      alignItems: \"center\",\n      textAlign: \"end\",\n    },\n    pseudoInputWrapper: {\n      borderRadius: theme.shape.borderRadius,\n      fontSize: \"0.75em\",\n      backgroundColor: inputBackgroundColor,\n\n      input: {\n        height: \"1.77em\",\n      },\n      \"&:hover\": {\n        backgroundColor: prefersDarkMode ? \"rgba(255, 255, 255, 0.13)\" : \"rgba(0, 0, 0, 0.09)\",\n        // Reset on touch devices, it doesn't add specificity\n        \"@media (hover: none)\": {\n          backgroundColor: inputBackgroundColor,\n        },\n      },\n      \"&:focus-within\": {\n        backgroundColor: inputBackgroundColor,\n      },\n    },\n    styledToggleButtonGroup: {\n      backgroundColor: theme.palette.action.hover,\n      gap: theme.spacing(0.25),\n\n      \"& .MuiToggleButtonGroup-grouped\": {\n        margin: theme.spacing(0.55),\n        borderRadius: theme.shape.borderRadius,\n        paddingTop: 0,\n        paddingBottom: 0,\n        borderColor: \"transparent !important\",\n        lineHeight: 1.75,\n\n        \"&.Mui-selected\": {\n          background: theme.palette.background.paper,\n          borderColor: \"transparent\",\n\n          \"&:hover\": {\n            borderColor: theme.palette.action.active,\n          },\n        },\n        \"&:not(:first-of-type)\": {\n          borderRadius: theme.shape.borderRadius,\n        },\n        \"&:first-of-type\": {\n          borderRadius: theme.shape.borderRadius,\n        },\n      },\n    },\n  };\n});\n\nfunction FieldInput({\n  actionHandler,\n  field,\n  path,\n}: {\n  actionHandler: (action: SettingsTreeAction) => void;\n  field: DeepReadonly<SettingsTreeField>;\n  path: readonly string[];\n}): JSX.Element {\n  const { classes, cx } = useStyles();\n\n  switch (field.input) {\n    case \"autocomplete\":\n      return (\n        <Autocomplete\n          size=\"small\"\n          freeSolo={true}\n          value={field.value}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          ListboxComponent={List}\n          ListboxProps={{ dense: true } as Partial<ListProps>}\n          renderOption={(props, option, { selected }) => (\n            <MenuItem selected={selected} {...props}>\n              {option}\n            </MenuItem>\n          )}\n          componentsProps={{ clearIndicator: { size: \"small\" } }}\n          clearIcon={<ClearIcon fontSize=\"small\" />}\n          renderInput={(params) => <TextField {...params} variant=\"filled\" size=\"small\" />}\n          onInputChange={(_event, value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"autocomplete\", value } })\n          }\n          onChange={(_event, value) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"autocomplete\", value: value ?? undefined },\n            })\n          }\n          options={field.items}\n        />\n      );\n    case \"number\":\n      return (\n        <NumberInput\n          size=\"small\"\n          variant=\"filled\"\n          value={field.value}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          placeholder={field.placeholder}\n          fullWidth\n          max={field.max}\n          min={field.min}\n          precision={field.precision}\n          step={field.step}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"number\", value } })\n          }\n        />\n      );\n    case \"toggle\":\n      return (\n        <ToggleButtonGroup\n          className={classes.styledToggleButtonGroup}\n          fullWidth\n          value={field.value ?? UNDEFINED_SENTINEL_VALUE}\n          exclusive\n          disabled={field.disabled}\n          size=\"small\"\n          onChange={(_event, value) => {\n            if (field.readonly !== true) {\n              actionHandler({\n                action: \"update\",\n                payload: {\n                  path,\n                  input: \"toggle\",\n                  value: value === UNDEFINED_SENTINEL_VALUE ? undefined : value,\n                },\n              });\n            }\n          }}\n        >\n          {field.options.map((opt) => (\n            <ToggleButton\n              key={(typeof opt === \"string\" ? opt : opt.value) ?? UNDEFINED_SENTINEL_VALUE}\n              value={(typeof opt === \"string\" ? opt : opt.value) ?? UNDEFINED_SENTINEL_VALUE}\n            >\n              {typeof opt === \"string\" ? opt : opt.label}\n            </ToggleButton>\n          ))}\n        </ToggleButtonGroup>\n      );\n    case \"string\":\n      return (\n        <TextField\n          variant=\"filled\"\n          size=\"small\"\n          fullWidth\n          disabled={field.disabled}\n          value={field.value ?? \"\"}\n          placeholder={field.placeholder}\n          InputProps={{\n            readOnly: field.readonly,\n          }}\n          onChange={(event) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"string\", value: event.target.value },\n            })\n          }\n        />\n      );\n    case \"boolean\":\n      return (\n        <ToggleButtonGroup\n          className={classes.styledToggleButtonGroup}\n          fullWidth\n          value={field.value ?? false}\n          exclusive\n          disabled={field.disabled}\n          size=\"small\"\n          onChange={(_event, value) => {\n            if (value != undefined && field.readonly !== true) {\n              actionHandler({\n                action: \"update\",\n                payload: { path, input: \"boolean\", value },\n              });\n            }\n          }}\n        >\n          <ToggleButton value={false}>Off</ToggleButton>\n          <ToggleButton value={true}>On</ToggleButton>\n        </ToggleButtonGroup>\n      );\n    case \"rgb\":\n      return (\n        <ColorPickerInput\n          alphaType=\"none\"\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          placeholder={field.placeholder}\n          value={field.value?.toString()}\n          onChange={(value) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"rgb\", value },\n            })\n          }\n          hideClearButton={field.hideClearButton}\n        />\n      );\n    case \"rgba\":\n      return (\n        <ColorPickerInput\n          alphaType=\"alpha\"\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          placeholder={field.placeholder}\n          value={field.value?.toString()}\n          onChange={(value) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"rgba\", value },\n            })\n          }\n        />\n      );\n    case \"messagepath\":\n      return (\n        <Stack className={classes.pseudoInputWrapper} direction=\"row\">\n          <MessagePathInput\n            path={field.value ?? \"\"}\n            disabled={field.disabled}\n            readOnly={field.readonly}\n            onChange={(value) =>\n              actionHandler({\n                action: \"update\",\n                payload: { path, input: \"messagepath\", value },\n              })\n            }\n            validTypes={field.validTypes}\n          />\n        </Stack>\n      );\n    case \"select\": {\n      const selectedOptionIndex = // use findIndex instead of find to avoid confusing TypeScript with union of arrays\n        field.options.findIndex((option) => option.value === field.value);\n      const selectedOption = field.options[selectedOptionIndex];\n\n      const isEmpty = field.options.length === 0;\n      let selectValue = field.value;\n      if (!selectedOption) {\n        selectValue = INVALID_SENTINEL_VALUE;\n      } else if (selectValue == undefined) {\n        // We can't pass value={undefined} or we get a React error \"A component is changing an\n        // uncontrolled input to be controlled\" when changing the value to be non-undefined.\n        selectValue = UNDEFINED_SENTINEL_VALUE;\n      }\n\n      const hasError = !selectedOption && (!isEmpty || field.value != undefined);\n      return (\n        <Select\n          className={cx({ [classes.error]: hasError })}\n          size=\"small\"\n          displayEmpty\n          fullWidth\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          variant=\"filled\"\n          value={selectValue}\n          renderValue={(_value) => {\n            // Use field.value rather than the passed-in value so we can render the value even when\n            // it was not present in the list of options.\n            const value = field.value;\n            for (const option of field.options) {\n              if (option.value === value) {\n                return option.label.trim();\n              }\n            }\n            return value;\n          }}\n          onChange={(event) =>\n            actionHandler({\n              action: \"update\",\n              payload: {\n                path,\n                input: \"select\",\n                value:\n                  event.target.value === UNDEFINED_SENTINEL_VALUE\n                    ? undefined\n                    : (event.target.value as undefined | string | string[]),\n              },\n            })\n          }\n          MenuProps={{ MenuListProps: { dense: true } }}\n        >\n          {field.options.map(({ label, value = UNDEFINED_SENTINEL_VALUE }) => (\n            <MenuItem key={value} value={value}>\n              {label}\n            </MenuItem>\n          ))}\n          {isEmpty && <MenuItem disabled>No options</MenuItem>}\n          {!selectedOption && (\n            <MenuItem style={{ display: \"none\" }} value={INVALID_SENTINEL_VALUE} />\n          )}\n        </Select>\n      );\n    }\n    case \"gradient\":\n      return (\n        <ColorGradientInput\n          colors={field.value}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"gradient\", value } })\n          }\n        />\n      );\n    case \"vec3\":\n      return (\n        <Vec3Input\n          step={field.step}\n          placeholder={field.placeholder}\n          value={field.value}\n          precision={field.precision}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          min={field.min}\n          max={field.max}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"vec3\", value } })\n          }\n        />\n      );\n    case \"vec2\":\n      return (\n        <Vec2Input\n          step={field.step}\n          value={field.value}\n          placeholder={field.placeholder}\n          precision={field.precision}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          min={field.min}\n          max={field.max}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"vec2\", value } })\n          }\n        />\n      );\n  }\n}\n\nfunction FieldLabel({ field }: { field: DeepReadonly<SettingsTreeField> }): JSX.Element {\n  const { classes } = useStyles();\n\n  if (field.input === \"vec2\") {\n    const labels = field.labels ?? [\"X\", \"Y\"];\n    return (\n      <>\n        <div className={classes.multiLabelWrapper}>\n          <Typography\n            title={field.label}\n            variant=\"subtitle2\"\n            color=\"text.secondary\"\n            noWrap\n            flex=\"auto\"\n          >\n            {field.label}\n          </Typography>\n          {labels.map((label, index) => (\n            <Typography\n              key={label}\n              title={field.label}\n              variant=\"subtitle2\"\n              color=\"text.secondary\"\n              noWrap\n              style={{ gridColumn: index === 0 ? \"span 1\" : \"2 / span 1\" }}\n              flex=\"auto\"\n            >\n              {label}\n            </Typography>\n          ))}\n        </div>\n      </>\n    );\n  } else if (field.input === \"vec3\") {\n    const labels = field.labels ?? [\"X\", \"Y\", \"Z\"];\n    return (\n      <>\n        <div className={classes.multiLabelWrapper}>\n          <Typography\n            title={field.label}\n            variant=\"subtitle2\"\n            color=\"text.secondary\"\n            noWrap\n            flex=\"auto\"\n          >\n            {field.label}\n          </Typography>\n          {labels.map((label, index) => (\n            <Typography\n              key={label}\n              title={field.label}\n              variant=\"subtitle2\"\n              color=\"text.secondary\"\n              noWrap\n              style={{ gridColumn: index === 0 ? \"span 1\" : \"2 / span 1\" }}\n              flex=\"auto\"\n            >\n              {label}\n            </Typography>\n          ))}\n        </div>\n      </>\n    );\n  } else {\n    return (\n      <>\n        <Typography\n          className={classes.fieldLabel}\n          title={field.help ?? field.label}\n          variant=\"subtitle2\"\n        >\n          {field.label}\n        </Typography>\n      </>\n    );\n  }\n}\n\nfunction FieldEditorComponent({\n  actionHandler,\n  field,\n  path,\n}: {\n  actionHandler: (action: SettingsTreeAction) => void;\n  field: DeepReadonly<SettingsTreeField>;\n  path: readonly string[];\n}): JSX.Element {\n  const indent = Math.min(path.length, 4);\n  const paddingLeft = 0.75 + 2 * (indent - 1);\n  const { classes, cx } = useStyles();\n\n  return (\n    <>\n      <Stack\n        direction=\"row\"\n        alignItems=\"center\"\n        justifyContent=\"flex-end\"\n        gap={0.5}\n        paddingLeft={paddingLeft}\n        fullHeight\n      >\n        {field.error && (\n          <Tooltip\n            arrow\n            placement=\"top\"\n            title={<Typography variant=\"subtitle2\">{field.error}</Typography>}\n          >\n            <ErrorIcon color=\"error\" fontSize=\"small\" />\n          </Tooltip>\n        )}\n        <FieldLabel field={field} />\n      </Stack>\n      <div className={cx(classes.fieldWrapper, { [classes.error]: field.error != undefined })}>\n        <FieldInput actionHandler={actionHandler} field={field} path={path} />\n      </div>\n      <Stack paddingBottom={0.25} style={{ gridColumn: \"span 2\" }} />\n    </>\n  );\n}\n\nexport const FieldEditor = React.memo(FieldEditorComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Clock from \"@mui/icons-material/AccessTime\";\nimport Add from \"@mui/icons-material/Add\";\nimport Addchart from \"@mui/icons-material/Addchart\";\nimport Points from \"@mui/icons-material/BlurOn\";\nimport Check from \"@mui/icons-material/Check\";\nimport Circle from \"@mui/icons-material/Circle\";\nimport Clear from \"@mui/icons-material/Clear\";\nimport Delete from \"@mui/icons-material/Delete\";\nimport Walk from \"@mui/icons-material/DirectionsWalk\";\nimport Flag from \"@mui/icons-material/Flag\";\nimport Folder from \"@mui/icons-material/Folder\";\nimport FolderOpen from \"@mui/icons-material/FolderOpen\";\nimport Grid from \"@mui/icons-material/GridOn\";\nimport Hive from \"@mui/icons-material/HiveOutlined\";\nimport Shapes from \"@mui/icons-material/Interests\";\nimport World from \"@mui/icons-material/Language\";\nimport Background from \"@mui/icons-material/Layers\";\nimport Map from \"@mui/icons-material/Map\";\nimport MoveDown from \"@mui/icons-material/MoveDown\";\nimport MoveUp from \"@mui/icons-material/MoveUp\";\nimport NorthWest from \"@mui/icons-material/NorthWest\";\nimport NoteFilled from \"@mui/icons-material/Note\";\nimport Note from \"@mui/icons-material/NoteOutlined\";\nimport Move from \"@mui/icons-material/OpenWith\";\nimport Camera from \"@mui/icons-material/PhotoCamera\";\nimport PrecisionManufacturing from \"@mui/icons-material/PrecisionManufacturing\";\nimport Radar from \"@mui/icons-material/Radar\";\nimport Settings from \"@mui/icons-material/Settings\";\nimport Share from \"@mui/icons-material/Share\";\nimport SouthEast from \"@mui/icons-material/SouthEast\";\nimport Star from \"@mui/icons-material/StarOutline\";\nimport Timeline from \"@mui/icons-material/Timeline\";\nimport Topic from \"@mui/icons-material/Topic\";\nimport Collapse from \"@mui/icons-material/UnfoldLess\";\nimport Expand from \"@mui/icons-material/UnfoldMore\";\nimport Cells from \"@mui/icons-material/ViewComfy\";\nimport Cube from \"@mui/icons-material/ViewInAr\";\nimport ImageProjection from \"@mui/icons-material/Vrpano\";\n\nimport { SettingsIcon } from \"@foxglove/studio\";\n\nconst icons: Record<SettingsIcon, typeof Add> = {\n  Add,\n  Addchart,\n  Background,\n  Camera,\n  Cells,\n  Check,\n  Circle,\n  Clear,\n  Clock,\n  Collapse,\n  Cube,\n  Delete,\n  Expand,\n  Flag,\n  Folder,\n  FolderOpen,\n  Grid,\n  Hive,\n  ImageProjection,\n  Map,\n  Move,\n  MoveDown,\n  MoveUp,\n  NorthWest,\n  Note,\n  NoteFilled,\n  Points,\n  PrecisionManufacturing,\n  Radar,\n  Settings,\n  Shapes,\n  Share,\n  SouthEast,\n  Star,\n  Timeline,\n  Topic,\n  Walk,\n  World,\n};\n\nexport { icons };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport { Menu, MenuItem, IconButton, ListItemIcon, ListItemText, Divider } from \"@mui/material\";\nimport { useState } from \"react\";\n\nimport { SettingsTreeNodeAction } from \"@foxglove/studio\";\n\nimport { icons } from \"./icons\";\n\nexport function NodeActionsMenu({\n  actions,\n  onSelectAction,\n}: {\n  actions: readonly SettingsTreeNodeAction[];\n  onSelectAction: (actionId: string) => void;\n}): JSX.Element {\n  const [anchorEl, setAnchorEl] = useState<undefined | HTMLButtonElement>(undefined);\n  const open = Boolean(anchorEl);\n\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = (id: string) => {\n    onSelectAction(id);\n    setAnchorEl(undefined);\n  };\n\n  const anyItemHasIcon = actions.some((action) => action.type === \"action\" && action.icon);\n\n  return (\n    <>\n      <IconButton\n        title=\"More actions\"\n        aria-controls={open ? \"node-actions-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n        data-testid=\"node-actions-menu-button\"\n        size=\"small\"\n      >\n        <MoreVertIcon fontSize=\"small\" />\n      </IconButton>\n      <Menu\n        id=\"basic-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={() => setAnchorEl(undefined)}\n        MenuListProps={{\n          \"aria-label\": \"node actions button\",\n        }}\n      >\n        {actions.map((action, index) => {\n          if (action.type === \"divider\") {\n            return (\n              <Divider variant={anyItemHasIcon ? \"inset\" : \"fullWidth\"} key={`divider_${index}`} />\n            );\n          }\n          const Icon = action.icon ? icons[action.icon] : undefined;\n          return (\n            <MenuItem key={action.id} onClick={() => handleClose(action.id)}>\n              {Icon && (\n                <ListItemIcon>\n                  <Icon fontSize=\"small\" />\n                </ListItemIcon>\n              )}\n              <ListItemText inset={!Icon && anyItemHasIcon}>{action.label}</ListItemText>\n            </MenuItem>\n          );\n        })}\n      </Menu>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Checkbox,\n  CheckboxProps,\n  SvgIcon,\n  styled as muiStyled,\n  IconButtonProps,\n} from \"@mui/material\";\n\nconst StyledCheckbox = muiStyled(Checkbox, {\n  shouldForwardProp: (prop) => prop !== \"size\",\n})<{ size: IconButtonProps[\"size\"] }>(({ theme, size = \"medium\" }) => ({\n  borderRadius: theme.shape.borderRadius,\n  padding: theme.spacing(1),\n\n  \"&:hover\": {\n    backgroundColor: theme.palette.action.hover,\n  },\n  ...(size === \"small\" && {\n    padding: theme.spacing(0.625),\n  }),\n}));\n\nexport function VisibilityToggle(\n  props: CheckboxProps & { size: IconButtonProps[\"size\"] },\n): JSX.Element {\n  return (\n    <StyledCheckbox\n      {...props}\n      title=\"Toggle visibility\"\n      icon={\n        <SvgIcon fontSize=\"small\" viewBox=\"0 0 16 16\" color=\"disabled\">\n          {/* Eye open */}\n          <path\n            fill=\"currentColor\"\n            d=\"M13.508 7.801c.556-.527 1.036-1.134 1.422-1.801h-1.185C12.48 7.814 10.378 9 8 9 5.622 9 3.52 7.814 2.254 6H1.07c.386.667.866 1.274 1.421 1.801L.896 9.396l.708.707L3.26 8.446c.71.523 1.511.932 2.374 1.199l-.617 2.221.964.268.626-2.255C7.06 9.96 7.525 10 8 10c.475 0 .94-.041 1.392-.12l.626 2.254.964-.268-.617-2.221c.863-.267 1.663-.676 2.374-1.2l1.657 1.658.708-.707-1.595-1.595z\"\n            fillRule=\"nonzero\"\n          />\n        </SvgIcon>\n      }\n      checkedIcon={\n        <SvgIcon fontSize=\"small\" viewBox=\"0 0 16 16\">\n          {/* Eye closed */}\n          <g fill=\"currentColor\">\n            <path\n              d=\"M8 10c1.105 0 2-.895 2-2 0-1.105-.895-2-2-2-1.104 0-2 .895-2 2 0 1.105.896 2 2 2z\"\n              fillRule=\"nonzero\"\n            />\n            <path\n              d=\"M8 4c2.878 0 5.378 1.621 6.635 4-1.257 2.379-3.757 4-6.635 4-2.878 0-5.377-1.621-6.635-4C2.623 5.621 5.122 4 8 4zm0 7c-2.3 0-4.322-1.194-5.478-3C3.678 6.194 5.7 5 8 5c2.3 0 4.322 1.194 5.479 3C12.322 9.806 10.3 11 8 11z\"\n              fillRule=\"evenodd\"\n            />\n          </g>\n        </SvgIcon>\n      }\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { sortBy } from \"lodash\";\nimport { DeepReadonly } from \"ts-essentials\";\n\nimport { SettingsTreeNode, SettingsTreeNodes } from \"@foxglove/studio\";\n\n/**\n * Filters and sorts roots to prepare them for rendering.\n */\nexport function prepareSettingsNodes(\n  roots: DeepReadonly<SettingsTreeNodes>,\n): DeepReadonly<Array<[string, SettingsTreeNode]>> {\n  // Use sortBy here for stable sorting.\n  return sortBy(\n    Object.entries(roots).filter(\n      (entry): entry is [string, SettingsTreeNode] => entry[1] != undefined,\n    ),\n    (entry) => entry[1].order,\n  );\n}\n\n/**\n * Recursively filter out nodes that don't match the given filter.\n */\nexport function filterTreeNodes(\n  nodes: DeepReadonly<SettingsTreeNodes>,\n  filter: string,\n): DeepReadonly<SettingsTreeNodes> {\n  const result: Record<string, DeepReadonly<SettingsTreeNode>> = {};\n  Object.entries(nodes).forEach(([key, node]) => {\n    if (node == undefined) {\n      return;\n    }\n\n    // Include node in results if any children match the filter.\n    const filtered = filterTreeNodes(node.children ?? {}, filter);\n    if (Object.values(filtered).length > 0) {\n      result[key] = { ...node, children: filtered };\n    }\n\n    // Match on label or key in tree.\n    const stringToMatch = (node.label ?? key).toLocaleLowerCase();\n    if (stringToMatch.includes(filter.toLocaleLowerCase())) {\n      result[key] = node;\n    }\n    return;\n  });\n\n  return result;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport ArrowRightIcon from \"@mui/icons-material/ArrowRight\";\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport EditIcon from \"@mui/icons-material/Edit\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport {\n  Button,\n  Divider,\n  IconButton,\n  TextField,\n  Tooltip,\n  Typography,\n  useTheme,\n} from \"@mui/material\";\nimport { TFunction } from \"i18next\";\nimport { isEqual, partition } from \"lodash\";\nimport memoizeWeak from \"memoize-weak\";\nimport { ChangeEvent, useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport tinycolor from \"tinycolor2\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { keyframes } from \"tss-react\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { useImmer } from \"use-immer\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { SettingsTreeAction, SettingsTreeNode, SettingsTreeNodeActionItem } from \"@foxglove/studio\";\nimport { HighlightedText } from \"@foxglove/studio-base/components/HighlightedText\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { FieldEditor } from \"./FieldEditor\";\nimport { NodeActionsMenu } from \"./NodeActionsMenu\";\nimport { VisibilityToggle } from \"./VisibilityToggle\";\nimport { icons } from \"./icons\";\nimport { prepareSettingsNodes } from \"./utils\";\n\nexport type NodeEditorProps = {\n  actionHandler: (action: SettingsTreeAction) => void;\n  defaultOpen?: boolean;\n  filter?: string;\n  focusedPath?: readonly string[];\n  path: readonly string[];\n  settings?: DeepReadonly<SettingsTreeNode>;\n};\n\nexport const NODE_HEADER_MIN_HEIGHT = 35;\n\nconst useStyles = makeStyles()((theme) => ({\n  actionButton: {\n    padding: theme.spacing(0.5),\n  },\n  editNameField: {\n    font: \"inherit\",\n    gridColumn: \"span 2\",\n    width: \"100%\",\n\n    \".MuiInputBase-input\": {\n      fontSize: \"0.75rem\",\n      padding: theme.spacing(0.75, 1),\n    },\n  },\n  focusedNode: {\n    animation: `\n      ${keyframes`\n      from {\n        background-color: ${tinycolor(theme.palette.primary.main).setAlpha(0.3).toRgbString()};\n      }\n      to {\n        background-color: transparent;\n      }`}\n      0.5s ease-in-out\n    `,\n  },\n  fieldPadding: {\n    gridColumn: \"span 2\",\n    height: theme.spacing(0.5),\n  },\n  iconWrapper: {\n    position: \"absolute\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    top: \"50%\",\n    left: 0,\n    transform: \"translate(-97.5%, -50%)\",\n  },\n\n  nodeHeader: {\n    display: \"flex\",\n    gridColumn: \"span 2\",\n    paddingRight: theme.spacing(0.5),\n    minHeight: NODE_HEADER_MIN_HEIGHT,\n\n    \"@media (pointer: fine)\": {\n      \".MuiCheckbox-root\": {\n        visibility: \"visible\",\n      },\n\n      \"[data-node-function=edit-label]\": {\n        visibility: \"hidden\",\n      },\n\n      \"&:hover\": {\n        backgroundColor: theme.palette.action.hover,\n\n        \".MuiCheckbox-root\": {\n          visibility: \"visible\",\n        },\n\n        \"[data-node-function=edit-label]\": {\n          visibility: \"visible\",\n        },\n      },\n    },\n  },\n  nodeHeaderVisible: {\n    \"@media (pointer: fine)\": {\n      \".MuiCheckbox-root\": {\n        visibility: \"hidden\",\n      },\n      \"&:hover\": {\n        \".MuiCheckbox-root\": {\n          visibility: \"visible\",\n        },\n      },\n    },\n  },\n\n  nodeHeaderToggle: {\n    display: \"grid\",\n    alignItems: \"center\",\n    gridTemplateColumns: \"auto 1fr auto\",\n    opacity: 0.6,\n    position: \"relative\",\n    userSelect: \"none\",\n    width: \"100%\",\n  },\n  nodeHeaderToggleHasProperties: {\n    cursor: \"pointer\",\n  },\n  nodeHeaderToggleVisible: {\n    opacity: 1,\n  },\n  errorTooltip: {\n    whiteSpace: \"pre-line\",\n    maxHeight: \"15vh\",\n    overflowY: \"auto\",\n  },\n}));\n\nfunction ExpansionArrow({ expanded }: { expanded: boolean }): JSX.Element {\n  const { classes } = useStyles();\n\n  const Component = expanded ? ArrowDownIcon : ArrowRightIcon;\n  return (\n    <div className={classes.iconWrapper}>\n      <Component />\n    </div>\n  );\n}\n\nconst makeStablePath = memoizeWeak((path: readonly string[], key: string) => [...path, key]);\n\ntype SelectVisibilityFilterValue = \"all\" | \"visible\" | \"invisible\";\nconst SelectVisibilityFilterOptions: (t: TFunction<\"settingsEditor\">) => {\n  label: string;\n  value: SelectVisibilityFilterValue;\n}[] = (t) => [\n  { label: t(\"listAll\"), value: \"all\" },\n  { label: t(\"listVisible\"), value: \"visible\" },\n  { label: t(\"listInvisible\"), value: \"invisible\" },\n];\nfunction showVisibleFilter(child: DeepReadonly<SettingsTreeNode>): boolean {\n  // want to show children with undefined visibility\n  return child.visible !== false;\n}\nfunction showInvisibleFilter(child: DeepReadonly<SettingsTreeNode>): boolean {\n  // want to show children with undefined visibility\n  return child.visible !== true;\n}\nconst getSelectVisibilityFilterField = (t: TFunction<\"settingsEditor\">) =>\n  ({\n    input: \"select\",\n    label: t(\"filterList\"),\n    help: t(\"filterListHelp\"),\n    options: SelectVisibilityFilterOptions(t),\n  } as const);\n\ntype State = {\n  editing: boolean;\n  focusedPath: undefined | readonly string[];\n  open: boolean;\n  visibilityFilter: SelectVisibilityFilterValue;\n};\n\nfunction NodeEditorComponent(props: NodeEditorProps): JSX.Element {\n  const { actionHandler, defaultOpen = true, filter, focusedPath, settings = {} } = props;\n  const [state, setState] = useImmer<State>({\n    editing: false,\n    focusedPath: undefined,\n    open: defaultOpen,\n    visibilityFilter: \"all\",\n  });\n  const { t } = useTranslation(\"settingsEditor\");\n  const { classes, cx } = useStyles();\n\n  const theme = useTheme();\n  const indent = props.path.length;\n  const allowVisibilityToggle = props.settings?.visible != undefined;\n  const visible = props.settings?.visible !== false;\n  const selectVisibilityFilterEnabled = props.settings?.enableVisibilityFilter === true;\n\n  const selectVisibilityFilter = (action: SettingsTreeAction) => {\n    if (action.action === \"update\" && action.payload.input === \"select\") {\n      setState((draft) => {\n        draft.visibilityFilter = action.payload.value as SelectVisibilityFilterValue;\n      });\n    }\n  };\n\n  const toggleVisibility = () => {\n    actionHandler({\n      action: \"update\",\n      payload: { input: \"boolean\", path: [...props.path, \"visible\"], value: !visible },\n    });\n  };\n\n  const handleNodeAction = (actionId: string) => {\n    actionHandler({ action: \"perform-node-action\", payload: { id: actionId, path: props.path } });\n  };\n\n  const isFocused = isEqual(focusedPath, props.path);\n\n  useEffect(() => {\n    const isOnFocusedPath =\n      focusedPath != undefined && isEqual(props.path, focusedPath.slice(0, props.path.length));\n\n    if (isOnFocusedPath) {\n      setState((draft) => {\n        draft.open = true;\n      });\n    }\n\n    if (isFocused) {\n      rootRef.current?.scrollIntoView();\n    }\n  }, [focusedPath, isFocused, props.path, setState]);\n\n  const { fields, children } = settings;\n  const hasChildren = children != undefined && Object.keys(children).length > 0;\n  const hasProperties = fields != undefined || hasChildren;\n\n  const rootRef = useRef<HTMLDivElement>(ReactNull);\n\n  const fieldEditors = filterMap(Object.entries(fields ?? {}), ([key, field]) => {\n    return field ? (\n      <FieldEditor\n        key={key}\n        field={field}\n        path={makeStablePath(props.path, key)}\n        actionHandler={actionHandler}\n      />\n    ) : undefined;\n  });\n\n  const filterFn =\n    state.visibilityFilter === \"visible\"\n      ? showVisibleFilter\n      : state.visibilityFilter === \"invisible\"\n      ? showInvisibleFilter\n      : undefined;\n  const childNodes = filterMap(prepareSettingsNodes(children ?? {}), ([key, child]) => {\n    return !filterFn || filterFn(child) ? (\n      <NodeEditor\n        actionHandler={actionHandler}\n        defaultOpen={child.defaultExpansionState === \"collapsed\" ? false : true}\n        filter={filter}\n        focusedPath={focusedPath}\n        key={key}\n        settings={child}\n        path={makeStablePath(props.path, key)}\n      />\n    ) : undefined;\n  });\n\n  const IconComponent = settings.icon ? icons[settings.icon] : undefined;\n\n  const onEditLabel = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      if (settings.renamable === true) {\n        actionHandler({\n          action: \"update\",\n          payload: { path: [...props.path, \"label\"], input: \"string\", value: event.target.value },\n        });\n      }\n    },\n    [actionHandler, props.path, settings.renamable],\n  );\n\n  const toggleEditing = useCallback(() => {\n    setState((draft) => {\n      draft.editing = !draft.editing;\n    });\n  }, [setState]);\n\n  const toggleOpen = useCallback(() => {\n    setState((draft) => {\n      if (!draft.editing) {\n        draft.open = !draft.open;\n      }\n    });\n  }, [setState]);\n\n  const onLabelKeyDown = useCallback(\n    (event: React.KeyboardEvent) => {\n      if (event.key === \"Enter\" || event.key === \"Escape\") {\n        toggleEditing();\n      }\n    },\n    [toggleEditing],\n  );\n\n  const [inlineActions, menuActions] = useMemo(\n    () =>\n      partition(\n        settings.actions,\n        (action): action is SettingsTreeNodeActionItem =>\n          action.type === \"action\" && action.display === \"inline\",\n      ),\n    [settings.actions],\n  );\n\n  return (\n    <>\n      <div\n        className={cx(classes.nodeHeader, {\n          [classes.focusedNode]: isFocused,\n          [classes.nodeHeaderVisible]: visible,\n        })}\n        ref={rootRef}\n      >\n        <div\n          className={cx(classes.nodeHeaderToggle, {\n            [classes.nodeHeaderToggleHasProperties]: hasProperties,\n            [classes.nodeHeaderToggleVisible]: visible,\n          })}\n          style={{\n            marginLeft: theme.spacing(0.75 + 2 * indent),\n          }}\n          onClick={toggleOpen}\n          data-testid={`settings__nodeHeaderToggle__${props.path.join(\"-\")}`}\n        >\n          {hasProperties && <ExpansionArrow expanded={state.open} />}\n          {IconComponent && (\n            <IconComponent\n              fontSize=\"small\"\n              color=\"inherit\"\n              style={{\n                marginRight: theme.spacing(0.5),\n                opacity: 0.8,\n              }}\n            />\n          )}\n          {state.editing ? (\n            <TextField\n              className={classes.editNameField}\n              autoFocus\n              variant=\"filled\"\n              onChange={onEditLabel}\n              value={settings.label}\n              onBlur={toggleEditing}\n              onKeyDown={onLabelKeyDown}\n              onFocus={(event) => event.target.select()}\n              InputProps={{\n                endAdornment: (\n                  <IconButton\n                    className={classes.actionButton}\n                    title=\"Rename\"\n                    data-node-function=\"edit-label\"\n                    color=\"primary\"\n                    onClick={(event) => {\n                      event.stopPropagation();\n                      toggleEditing();\n                    }}\n                  >\n                    <CheckIcon fontSize=\"small\" />\n                  </IconButton>\n                ),\n              }}\n            />\n          ) : (\n            <Typography\n              noWrap={true}\n              flex=\"auto\"\n              variant=\"subtitle2\"\n              fontWeight={indent < 2 ? 600 : 400}\n              color={visible ? \"text.primary\" : \"text.disabled\"}\n            >\n              <HighlightedText text={settings.label ?? t(\"general\")} highlight={filter} />\n            </Typography>\n          )}\n        </div>\n        <Stack alignItems=\"center\" direction=\"row\">\n          {settings.renamable === true && !state.editing && (\n            <IconButton\n              className={classes.actionButton}\n              title=\"Rename\"\n              data-node-function=\"edit-label\"\n              color=\"primary\"\n              onClick={(event) => {\n                event.stopPropagation();\n                toggleEditing();\n              }}\n            >\n              <EditIcon fontSize=\"small\" />\n            </IconButton>\n          )}\n          {settings.visible != undefined && (\n            <VisibilityToggle\n              size=\"small\"\n              checked={visible}\n              onChange={toggleVisibility}\n              style={{ opacity: allowVisibilityToggle ? 1 : 0 }}\n              disabled={!allowVisibilityToggle}\n            />\n          )}\n          {inlineActions.map((action) => {\n            const Icon = action.icon ? icons[action.icon] : undefined;\n            const handler = () =>\n              actionHandler({\n                action: \"perform-node-action\",\n                payload: { id: action.id, path: props.path },\n              });\n            return Icon ? (\n              <IconButton\n                key={action.id}\n                onClick={handler}\n                title={action.label}\n                className={classes.actionButton}\n              >\n                <Icon fontSize=\"small\" />\n              </IconButton>\n            ) : (\n              <Button\n                key={action.id}\n                onClick={handler}\n                size=\"small\"\n                color=\"inherit\"\n                className={classes.actionButton}\n              >\n                {action.label}\n              </Button>\n            );\n          })}\n          {props.settings?.error && (\n            <Tooltip\n              arrow\n              title={\n                <Typography variant=\"subtitle2\" className={classes.errorTooltip}>\n                  {props.settings.error}\n                </Typography>\n              }\n            >\n              <IconButton size=\"small\" color=\"error\">\n                <ErrorIcon fontSize=\"small\" />\n              </IconButton>\n            </Tooltip>\n          )}\n\n          {menuActions.length > 0 && (\n            <NodeActionsMenu actions={menuActions} onSelectAction={handleNodeAction} />\n          )}\n        </Stack>\n      </div>\n      {state.open && fieldEditors.length > 0 && (\n        <>\n          <div className={classes.fieldPadding} />\n          {fieldEditors}\n          <div className={classes.fieldPadding} />\n        </>\n      )}\n      {state.open && selectVisibilityFilterEnabled && hasChildren && (\n        <FieldEditor\n          key=\"visibilityFilter\"\n          field={{ ...getSelectVisibilityFilterField(t), value: state.visibilityFilter }}\n          path={makeStablePath(props.path, \"visibilityFilter\")}\n          actionHandler={selectVisibilityFilter}\n        />\n      )}\n      {state.open && childNodes}\n      {indent === 1 && <Divider style={{ gridColumn: \"span 2\" }} />}\n    </>\n  );\n}\n\nexport const NodeEditor = React.memo(NodeEditorComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport { IconButton, TextField } from \"@mui/material\";\nimport memoizeWeak from \"memoize-weak\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { SettingsTree, SettingsTreeAction, SettingsTreeField } from \"@foxglove/studio\";\nimport { useConfigById } from \"@foxglove/studio-base/PanelAPI\";\nimport { FieldEditor } from \"@foxglove/studio-base/components/SettingsTreeEditor/FieldEditor\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useSelectedPanels } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { usePanelStateStore } from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { getPanelTypeFromId, PANEL_TITLE_CONFIG_KEY } from \"@foxglove/studio-base/util/layout\";\n\nimport { NodeEditor } from \"./NodeEditor\";\nimport { filterTreeNodes, prepareSettingsNodes } from \"./utils\";\n\nconst useStyles = makeStyles()((theme) => ({\n  appBar: {\n    top: 0,\n    zIndex: theme.zIndex.appBar,\n    padding: theme.spacing(0.5),\n    position: \"sticky\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  fieldGrid: {\n    display: \"grid\",\n    gridTemplateColumns: \"minmax(20%, 20ch) auto\",\n    columnGap: theme.spacing(1),\n  },\n  textField: {\n    \".MuiOutlinedInput-notchedOutline\": {\n      border: \"none\",\n    },\n  },\n  startAdornment: {\n    display: \"flex\",\n  },\n}));\n\nconst makeStablePath = memoizeWeak((key: string) => [key]);\n\nexport default function SettingsTreeEditor({\n  settings,\n}: {\n  settings: DeepReadonly<SettingsTree>;\n}): JSX.Element {\n  const { classes } = useStyles();\n  const { actionHandler, focusedPath } = settings;\n  const [filterText, setFilterText] = useState<string>(\"\");\n  const { t } = useTranslation(\"settingsEditor\");\n\n  const filteredNodes = useMemo(() => {\n    if (filterText.length > 0) {\n      return filterTreeNodes(settings.nodes, filterText);\n    } else {\n      return settings.nodes;\n    }\n  }, [settings.nodes, filterText]);\n\n  const definedNodes = useMemo(() => prepareSettingsNodes(filteredNodes), [filteredNodes]);\n\n  const { selectedPanelIds } = useSelectedPanels();\n  const selectedPanelId = useMemo(\n    () => (selectedPanelIds.length === 1 ? selectedPanelIds[0] : undefined),\n    [selectedPanelIds],\n  );\n  const panelCatalog = usePanelCatalog();\n  const panelType = useMemo(\n    () => (selectedPanelId != undefined ? getPanelTypeFromId(selectedPanelId) : undefined),\n    [selectedPanelId],\n  );\n  const panelInfo = useMemo(\n    () => (panelType != undefined ? panelCatalog.getPanelByType(panelType) : undefined),\n    [panelCatalog, panelType],\n  );\n  const [config, saveConfig] = useConfigById(selectedPanelId);\n  const defaultPanelTitle = usePanelStateStore((state) =>\n    selectedPanelId ? state.defaultTitles[selectedPanelId] : undefined,\n  );\n  const customPanelTitle =\n    typeof config?.[PANEL_TITLE_CONFIG_KEY] === \"string\"\n      ? config[PANEL_TITLE_CONFIG_KEY]\n      : undefined;\n  const panelTitleField = useMemo<SettingsTreeField>(\n    () => ({\n      input: \"string\",\n      label: t(\"title\"),\n      placeholder: defaultPanelTitle ?? panelInfo?.title,\n      value: customPanelTitle,\n    }),\n    [customPanelTitle, defaultPanelTitle, panelInfo?.title, t],\n  );\n  const handleTitleChange = useCallback(\n    (action: SettingsTreeAction) => {\n      if (action.action === \"update\" && action.payload.path[0] === PANEL_TITLE_CONFIG_KEY) {\n        saveConfig({ [PANEL_TITLE_CONFIG_KEY]: action.payload.value });\n      }\n    },\n    [saveConfig],\n  );\n\n  const showTitleField = filterText.length === 0 && panelInfo?.hasCustomToolbar !== true;\n\n  return (\n    <Stack fullHeight>\n      {settings.enableFilter === true && (\n        <header className={classes.appBar}>\n          <TextField\n            id=\"settings-filter\"\n            variant=\"filled\"\n            data-testid=\"settings-filter-field\"\n            onChange={(event) => setFilterText(event.target.value)}\n            value={filterText}\n            className={classes.textField}\n            fullWidth\n            placeholder={t(\"searchPanelSettings\")}\n            InputProps={{\n              size: \"small\",\n              startAdornment: (\n                <label className={classes.startAdornment} htmlFor=\"settings-filter\">\n                  <SearchIcon fontSize=\"small\" />\n                </label>\n              ),\n              endAdornment: filterText && (\n                <IconButton\n                  size=\"small\"\n                  title={t(\"clearSearch\")}\n                  onClick={() => setFilterText(\"\")}\n                  edge=\"end\"\n                >\n                  <ClearIcon fontSize=\"small\" />\n                </IconButton>\n              ),\n            }}\n          />\n        </header>\n      )}\n      <div className={classes.fieldGrid}>\n        {showTitleField && (\n          <>\n            <Stack paddingBottom={0.5} style={{ gridColumn: \"span 2\" }} />\n            <FieldEditor\n              field={panelTitleField}\n              path={[PANEL_TITLE_CONFIG_KEY]}\n              actionHandler={handleTitleChange}\n            />\n          </>\n        )}\n        {definedNodes.map(([key, root]) => (\n          <NodeEditor\n            key={key}\n            actionHandler={actionHandler}\n            defaultOpen={root.defaultExpansionState === \"collapsed\" ? false : true}\n            filter={filterText}\n            focusedPath={focusedPath}\n            path={makeStablePath(key)}\n            settings={root}\n          />\n        ))}\n      </div>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ArrowDownload20Filled } from \"@fluentui/react-icons\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport DeleteOutline from \"@mui/icons-material/DeleteOutline\";\nimport {\n  Button,\n  IconButton,\n  Dialog,\n  DialogContent,\n  DialogActions,\n  TextField,\n  Typography,\n  styled as muiStyled,\n} from \"@mui/material\";\nimport { useCallback, useMemo, useState } from \"react\";\n\nimport CopyButton from \"@foxglove/studio-base/components/CopyButton\";\nimport HoverableIconButton from \"@foxglove/studio-base/components/HoverableIconButton\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { downloadTextFile } from \"@foxglove/studio-base/util/download\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\ntype Props = {\n  onRequestClose: () => void;\n  onChange: (value: unknown) => void;\n  initialValue: unknown;\n  title: string;\n};\n\nconst StyledTextarea = muiStyled(TextField)(({ theme }) => ({\n  \".MuiOutlinedInput-root\": {\n    backgroundColor: theme.palette.action.hover,\n    fontFamily: fonts.MONOSPACE,\n    maxHeight: \"60vh\",\n    overflowY: \"auto\",\n    padding: theme.spacing(0.25),\n  },\n}));\n\nexport default function ShareJsonModal({\n  initialValue = {},\n  onChange,\n  onRequestClose,\n  title,\n}: Props): JSX.Element {\n  const [value, setValue] = useState(JSON.stringify(initialValue, undefined, 2) ?? \"\");\n\n  const { decodedValue, error } = useMemo(() => {\n    try {\n      return { decodedValue: JSON.parse(value === \"\" ? \"{}\" : value) as unknown, error: undefined };\n    } catch (err) {\n      return { decodedValue: undefined, error: err as Error };\n    }\n  }, [value]);\n\n  const handleSubmit = useCallback(() => {\n    onChange(decodedValue);\n    onRequestClose();\n  }, [decodedValue, onChange, onRequestClose]);\n\n  const handleDownload = useCallback(() => {\n    downloadTextFile(value, \"layout.json\");\n  }, [value]);\n\n  const getText = useCallback(() => value, [value]);\n\n  return (\n    <Dialog open onClose={onRequestClose} maxWidth=\"sm\" fullWidth>\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"flex-start\"\n        paddingX={3}\n        paddingTop={2}\n      >\n        <Stack>\n          <Typography variant=\"h4\" fontWeight={600} gutterBottom>\n            {title}\n          </Typography>\n        </Stack>\n\n        <IconButton onClick={onRequestClose} edge=\"end\">\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <DialogContent>\n        <StyledTextarea\n          fullWidth\n          multiline\n          rows={10}\n          value={value}\n          onChange={(event) => setValue(event.target.value)}\n          autoFocus\n          error={error != undefined}\n          helperText={\n            error ? \"The JSON provided is invalid.\" : \" \" // pass whitespace to prevent height from jumping\n          }\n          FormHelperTextProps={{ variant: \"standard\" }}\n          spellCheck={false}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Stack direction=\"row\" gap={1}>\n          <IconButton onClick={handleDownload} title=\"Download\" aria-label=\"Download\">\n            <ArrowDownload20Filled />\n          </IconButton>\n          <CopyButton color=\"default\" getText={getText} />\n          <HoverableIconButton\n            activeColor=\"error\"\n            onClick={() => setValue(\"{}\")}\n            title=\"Clear\"\n            aria-label=\"Clear\"\n            icon={<DeleteOutline />}\n          />\n        </Stack>\n\n        <Stack flex=\"auto\" />\n\n        <Button\n          disabled={error != undefined}\n          variant=\"contained\"\n          size=\"large\"\n          onClick={handleSubmit}\n        >\n          Apply\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link, Typography } from \"@mui/material\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport { useUnmount } from \"react-use\";\n\nimport { SettingsTree } from \"@foxglove/studio\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { useConfigById } from \"@foxglove/studio-base/PanelAPI\";\nimport { ActionMenu } from \"@foxglove/studio-base/components/PanelSettings/ActionMenu\";\nimport SettingsTreeEditor from \"@foxglove/studio-base/components/SettingsTreeEditor\";\nimport ShareJsonModal from \"@foxglove/studio-base/components/ShareJsonModal\";\nimport { SidebarContent } from \"@foxglove/studio-base/components/SidebarContent\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n  useSelectedPanels,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport {\n  PanelStateStore,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport { PanelConfig } from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nconst selectedLayoutIdSelector = (state: LayoutState) => state.selectedLayout?.id;\n\nconst singlePanelIdSelector = (state: LayoutState) =>\n  typeof state.selectedLayout?.data?.layout === \"string\"\n    ? state.selectedLayout.data.layout\n    : undefined;\n\nconst selectIncrementSequenceNumber = (store: PanelStateStore) => store.incrementSequenceNumber;\n\nconst EMPTY_SETTINGS_TREE: SettingsTree = Object.freeze({\n  actionHandler: () => undefined,\n  nodes: {},\n});\n\nexport default function PanelSettings({\n  disableToolbar = false,\n  selectedPanelIdsForTests,\n}: React.PropsWithChildren<{\n  disableToolbar?: boolean;\n  selectedPanelIdsForTests?: readonly string[];\n}>): JSX.Element {\n  const { t } = useTranslation(\"panelSettings\");\n  const selectedLayoutId = useCurrentLayoutSelector(selectedLayoutIdSelector);\n  const singlePanelId = useCurrentLayoutSelector(singlePanelIdSelector);\n  const {\n    selectedPanelIds: originalSelectedPanelIds,\n    setSelectedPanelIds,\n    selectAllPanels,\n  } = useSelectedPanels();\n  const selectedPanelIds = selectedPanelIdsForTests ?? originalSelectedPanelIds;\n\n  const [enableNewTopNav = false] = useAppConfigurationValue<boolean>(AppSetting.ENABLE_NEW_TOPNAV);\n\n  // If no panel is selected and there is only one panel in the layout, select it\n  useEffect(() => {\n    if (selectedPanelIds.length === 0 && singlePanelId != undefined) {\n      selectAllPanels();\n    }\n  }, [selectAllPanels, selectedPanelIds, singlePanelId]);\n\n  const { openLayoutBrowser } = useWorkspaceActions();\n  const selectedPanelId = useMemo(\n    () => (selectedPanelIds.length === 1 ? selectedPanelIds[0] : undefined),\n    [selectedPanelIds],\n  );\n\n  // Automatically deselect the panel we were editing when the settings sidebar closes\n  useUnmount(() => {\n    if (selectedPanelId != undefined) {\n      setSelectedPanelIds([]);\n    }\n  });\n\n  const panelCatalog = usePanelCatalog();\n  const { getCurrentLayoutState: getCurrentLayout, savePanelConfigs } = useCurrentLayoutActions();\n  const panelType = useMemo(\n    () => (selectedPanelId != undefined ? getPanelTypeFromId(selectedPanelId) : undefined),\n    [selectedPanelId],\n  );\n  const panelInfo = useMemo(\n    () => (panelType != undefined ? panelCatalog.getPanelByType(panelType) : undefined),\n    [panelCatalog, panelType],\n  );\n\n  const incrementSequenceNumber = usePanelStateStore(selectIncrementSequenceNumber);\n\n  const [showShareModal, setShowShareModal] = useState(false);\n  const shareModal = useMemo(() => {\n    const panelConfigById = getCurrentLayout().selectedLayout?.data?.configById;\n    if (selectedPanelId == undefined || !showShareModal || !panelConfigById) {\n      return ReactNull;\n    }\n    return (\n      <ShareJsonModal\n        onRequestClose={() => setShowShareModal(false)}\n        initialValue={panelConfigById[selectedPanelId] ?? {}}\n        onChange={(config) => {\n          savePanelConfigs({\n            configs: [{ id: selectedPanelId, config: config as PanelConfig, override: true }],\n          });\n          incrementSequenceNumber(selectedPanelId);\n        }}\n        title={t(\"importOrExportSettings\")}\n      />\n    );\n  }, [\n    getCurrentLayout,\n    selectedPanelId,\n    showShareModal,\n    savePanelConfigs,\n    incrementSequenceNumber,\n    t,\n  ]);\n\n  const [config] = useConfigById(selectedPanelId);\n\n  const settingsTree = usePanelStateStore((state) =>\n    selectedPanelId ? state.settingsTrees[selectedPanelId] : undefined,\n  );\n\n  const resetToDefaults = useCallback(() => {\n    if (selectedPanelId) {\n      savePanelConfigs({\n        configs: [{ id: selectedPanelId, config: {}, override: true }],\n      });\n      incrementSequenceNumber(selectedPanelId);\n    }\n  }, [incrementSequenceNumber, savePanelConfigs, selectedPanelId]);\n\n  if (selectedLayoutId == undefined) {\n    return (\n      <SidebarContent disableToolbar={disableToolbar} title={t(\"panelSettings\")}>\n        <Typography color=\"text.secondary\">\n          <Trans\n            t={t}\n            i18nKey=\"noLayoutSelected\"\n            components={{\n              selectLayoutLink: <Link onClick={openLayoutBrowser} />,\n            }}\n          />\n        </Typography>\n      </SidebarContent>\n    );\n  }\n\n  if (selectedPanelId == undefined) {\n    return (\n      <SidebarContent disableToolbar={disableToolbar} title={t(\"panelSettings\")}>\n        <Typography color=\"text.secondary\">{t(\"selectAPanelToEditItsSettings\")}</Typography>\n      </SidebarContent>\n    );\n  }\n\n  if (!config) {\n    return (\n      <SidebarContent disableToolbar={disableToolbar} title={t(\"panelSettings\")}>\n        <Typography color=\"text.secondary\">{t(\"loadingPanelSettings\")}</Typography>\n      </SidebarContent>\n    );\n  }\n\n  const isSettingsTree = settingsTree != undefined;\n\n  const showTitleField = panelInfo != undefined && panelInfo.hasCustomToolbar !== true;\n  const title = panelInfo?.title ?? t(\"unknown\");\n\n  return (\n    <SidebarContent\n      disablePadding={enableNewTopNav || isSettingsTree}\n      disableToolbar={disableToolbar}\n      title={t(\"currentSettingsPanelName\", { title })}\n      trailingItems={[\n        <ActionMenu\n          key={1}\n          allowShare={panelType !== TAB_PANEL_TYPE}\n          onReset={resetToDefaults}\n          onShare={() => setShowShareModal(true)}\n        />,\n      ]}\n    >\n      {shareModal}\n      <Stack gap={2} justifyContent=\"flex-start\" flex=\"auto\">\n        <Stack flex=\"auto\">\n          {settingsTree && enableNewTopNav && (\n            <Stack padding={0.75}>\n              <Typography variant=\"subtitle2\">{t(\"panelName\", { title })}</Typography>\n            </Stack>\n          )}\n          {settingsTree || showTitleField ? (\n            <SettingsTreeEditor\n              key={selectedPanelId}\n              settings={settingsTree ?? EMPTY_SETTINGS_TREE}\n            />\n          ) : (\n            <Stack\n              flex=\"auto\"\n              alignItems=\"center\"\n              justifyContent=\"center\"\n              paddingX={enableNewTopNav ? 1 : 0}\n            >\n              <Typography variant=\"body2\" color=\"text.secondary\" align=\"center\">\n                {t(\"panelDoesNotHaveSettings\")}\n              </Typography>\n            </Stack>\n          )}\n        </Stack>\n      </Stack>\n    </SidebarContent>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport AddIcon from \"@mui/icons-material/Add\";\nimport RemoveIcon from \"@mui/icons-material/Remove\";\nimport {\n  Alert,\n  Button,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  TextField,\n  ToggleButton,\n  ToggleButtonGroup,\n  Typography,\n  FormLabel,\n  FormControl,\n  IconButton,\n  ButtonGroup,\n} from \"@mui/material\";\nimport { countBy } from \"lodash\";\nimport { KeyboardEvent, useCallback } from \"react\";\nimport { useAsyncFn } from \"react-use\";\nimport { keyframes } from \"tss-react\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { useImmer } from \"use-immer\";\n\nimport Log from \"@foxglove/log\";\nimport { toDate, toNanoSec } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\n\nconst log = Log.getLogger(__filename);\n\nconst fadeInAnimation = keyframes`\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n`;\n\nconst useStyles = makeStyles<void, \"toggleButton\">()((theme, _params, classes) => ({\n  grid: {\n    alignItems: \"center\",\n    display: \"grid\",\n    gridTemplateColumns: \"1fr 1fr auto\",\n    gap: theme.spacing(1),\n    overflow: \"auto\",\n    alignContent: \"flex-start\",\n  },\n  row: {\n    animation: `${fadeInAnimation} 0.2s ease-in-out`,\n    display: \"contents\",\n  },\n  toggleButton: {\n    border: \"none\",\n    lineHeight: 1,\n  },\n  toggleButtonGroup: {\n    marginRight: theme.spacing(-1),\n    gap: theme.spacing(0.25),\n\n    [`.${classes.toggleButton}`]: {\n      borderRadius: `${theme.shape.borderRadius}px !important`,\n      marginLeft: \"0px !important\",\n      borderLeft: \"none !important\",\n    },\n  },\n}));\n\ntype KeyValue = { key: string; value: string };\n\nconst selectCurrentTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.currentTime;\nconst selectRefreshEvents = (store: EventsStore) => store.refreshEvents;\nconst selectDeviceId = (store: EventsStore) => store.deviceId;\n\nexport function CreateEventDialog(props: { onClose: () => void }): JSX.Element {\n  const { onClose } = props;\n\n  const { classes } = useStyles();\n\n  const refreshEvents = useEvents(selectRefreshEvents);\n  const currentTime = useMessagePipeline(selectCurrentTime);\n  const [event, setEvent] = useImmer<{\n    startTime: undefined | Date;\n    duration: undefined | number;\n    durationUnit: \"sec\" | \"nsec\";\n    metadataEntries: KeyValue[];\n  }>({\n    startTime: currentTime ? toDate(currentTime) : undefined,\n    duration: 0,\n    durationUnit: \"sec\",\n    metadataEntries: [{ key: \"\", value: \"\" }],\n  });\n\n  const updateMetadata = useCallback(\n    (index: number, updateType: keyof KeyValue, value: string) => {\n      setEvent((draft) => {\n        const keyval = draft.metadataEntries[index];\n        if (keyval) {\n          keyval[updateType] = value;\n\n          // Automatically add new row if we're at the end and have both key and value.\n          if (\n            index === draft.metadataEntries.length - 1 &&\n            keyval.key.length > 0 &&\n            keyval.value.length > 0\n          ) {\n            draft.metadataEntries.push({ key: \"\", value: \"\" });\n          }\n        }\n      });\n    },\n    [setEvent],\n  );\n\n  const { formatTime } = useAppTimeFormat();\n  const { createEvent: appModuleCreateEvent } = useAppContext();\n\n  const countedMetadata = countBy(event.metadataEntries, (kv) => kv.key);\n  const duplicateKey = Object.entries(countedMetadata).find(\n    ([key, count]) => key.length > 0 && count > 1,\n  );\n  const canSubmit = event.startTime != undefined && event.duration != undefined && !duplicateKey;\n\n  const deviceId = useEvents(selectDeviceId);\n\n  const [createdEvent, createEvent] = useAsyncFn(async () => {\n    if (event.startTime == undefined || event.duration == undefined || deviceId == undefined) {\n      return;\n    }\n\n    const filteredMeta = event.metadataEntries.filter(\n      (entry) => entry.key.length > 0 && entry.value.length > 0,\n    );\n    const keyedMetadata = Object.fromEntries(\n      filteredMeta.map((entry) => [entry.key.trim(), entry.value.trim()]),\n    );\n\n    await appModuleCreateEvent?.({\n      deviceId,\n      timestamp: event.startTime.toISOString(),\n      durationNanos: toNanoSec(\n        event.durationUnit === \"sec\"\n          ? { sec: event.duration, nsec: 0 }\n          : { sec: 0, nsec: event.duration },\n      ).toString(),\n      metadata: keyedMetadata,\n    });\n\n    onClose();\n    refreshEvents();\n  }, [appModuleCreateEvent, deviceId, event, onClose, refreshEvents]);\n\n  const onMetaDataKeyDown = useCallback(\n    (keyboardEvent: KeyboardEvent) => {\n      if (keyboardEvent.key === \"Enter\") {\n        createEvent().catch((error) => log.error(error));\n      }\n    },\n    [createEvent],\n  );\n\n  const addRow = useCallback(\n    (index: number) => {\n      setEvent((draft) => {\n        draft.metadataEntries.splice(index + 1, 0, { key: \"\", value: \"\" });\n      });\n    },\n    [setEvent],\n  );\n\n  const removeRow = useCallback(\n    (index: number) => {\n      setEvent((draft) => {\n        if (draft.metadataEntries.length > 1) {\n          draft.metadataEntries.splice(index, 1);\n        }\n      });\n    },\n    [setEvent],\n  );\n\n  const formattedStartTime = currentTime ? formatTime(currentTime) : \"-\";\n\n  return (\n    <Dialog open onClose={onClose} fullWidth maxWidth=\"sm\">\n      <Stack paddingX={3} paddingTop={2}>\n        <Typography variant=\"h2\">Create event</Typography>\n      </Stack>\n      <Stack paddingX={3} paddingTop={2}>\n        <div className={classes.grid}>\n          <FormControl>\n            <FormLabel>Start Time</FormLabel>\n            <Typography paddingY={1}>{formattedStartTime}</Typography>\n          </FormControl>\n          <TextField\n            value={event.duration ?? \"\"}\n            fullWidth\n            label=\"Duration\"\n            onChange={(ev) => {\n              const duration = Number(ev.currentTarget.value);\n              setEvent((oldEvent) => ({\n                ...oldEvent,\n                duration: duration > 0 ? duration : undefined,\n              }));\n            }}\n            type=\"number\"\n            InputProps={{\n              endAdornment: (\n                <ToggleButtonGroup\n                  className={classes.toggleButtonGroup}\n                  size=\"small\"\n                  exclusive\n                  value={event.durationUnit}\n                  onChange={(_ev, durationUnit) => {\n                    if (event.durationUnit !== durationUnit) {\n                      setEvent((old) => ({ ...old, durationUnit }));\n                    }\n                  }}\n                >\n                  <ToggleButton className={classes.toggleButton} tabIndex={-1} value=\"sec\">\n                    sec\n                  </ToggleButton>\n                  <ToggleButton className={classes.toggleButton} tabIndex={-1} value=\"nsec\">\n                    nsec\n                  </ToggleButton>\n                </ToggleButtonGroup>\n              ),\n            }}\n          />\n          <ButtonGroup style={{ visibility: \"hidden\" }}>\n            <IconButton tabIndex={-1} data-testid=\"add\">\n              <AddIcon />\n            </IconButton>\n            <IconButton tabIndex={-1}>\n              <AddIcon />\n            </IconButton>\n          </ButtonGroup>\n        </div>\n      </Stack>\n      <Stack paddingX={3} paddingTop={2}>\n        <FormLabel>Metadata</FormLabel>\n        <div className={classes.grid}>\n          {event.metadataEntries.map(({ key, value }, index) => {\n            const hasDuplicate = ((key.length > 0 && countedMetadata[key]) ?? 0) > 1;\n            return (\n              <div className={classes.row} key={index}>\n                <TextField\n                  fullWidth\n                  value={key}\n                  autoFocus={index === 0}\n                  placeholder=\"Key (string)\"\n                  error={hasDuplicate}\n                  onKeyDown={onMetaDataKeyDown}\n                  onChange={(evt) => updateMetadata(index, \"key\", evt.currentTarget.value)}\n                />\n                <TextField\n                  fullWidth\n                  value={value}\n                  placeholder=\"Value (string)\"\n                  error={hasDuplicate}\n                  onKeyDown={onMetaDataKeyDown}\n                  onChange={(evt) => updateMetadata(index, \"value\", evt.currentTarget.value)}\n                />\n                <ButtonGroup>\n                  <IconButton tabIndex={-1} onClick={() => addRow(index)}>\n                    <AddIcon />\n                  </IconButton>\n                  <IconButton\n                    tabIndex={-1}\n                    onClick={() => removeRow(index)}\n                    style={{ visibility: event.metadataEntries.length > 1 ? \"visible\" : \"hidden\" }}\n                  >\n                    <RemoveIcon />\n                  </IconButton>\n                </ButtonGroup>\n              </div>\n            );\n          })}\n        </div>\n      </Stack>\n      <DialogActions>\n        <Button variant=\"outlined\" size=\"large\" onClick={onClose}>\n          Cancel\n        </Button>\n        <Button\n          variant=\"contained\"\n          size=\"large\"\n          onClick={createEvent}\n          disabled={!canSubmit || createdEvent.loading}\n        >\n          {createdEvent.loading && (\n            <CircularProgress color=\"inherit\" size=\"1rem\" style={{ marginRight: \"0.5rem\" }} />\n          )}\n          Create Event\n        </Button>\n      </DialogActions>\n      {duplicateKey && <Alert severity=\"error\">Duplicate key {duplicateKey[0]}</Alert>}\n      {createdEvent.error?.message && <Alert severity=\"error\">{createdEvent.error.message}</Alert>}\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function EventIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M18.03,3.03H6.03c-.55,0-1,.45-1,1v3h0v9.42c0,.36,.18,.69,.5,.87l6.5,3.71,6.5-3.71c.31-.18,.5-.51,.5-.87V4.03c0-.55-.45-1-1-1Z\" />\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function EventOutlinedIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M17.03,5.03V15.87l-5,2.85-5-2.85V5.03h10m1-2H6.03c-.55,0-1,.45-1,1v12.42c0,.36,.18,.69,.5,.87l6.5,3.71,6.5-3.71c.31-.18,.5-.51,.5-.87V4.03c0-.55-.45-1-1-1h0Z\" />\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function LoopIcon(props: { strokeWidth: number } & SvgIconProps): JSX.Element {\n  const { strokeWidth = 1, ...rest } = props;\n  return (\n    <SvgIcon {...rest}>\n      <g fill=\"currentColor\">\n        <path\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth={strokeWidth}\n          strokeLinecap=\"butt\"\n          d=\"M12.808,6l-4.621,-0c-3.312,-0 -6,2.689 -6,6c-0,3.311 2.688,6 6,6\"\n        />\n        <path\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth={strokeWidth}\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          d=\"M10.692,3.879l2.121,2.121l-2.121,2.121\"\n        />\n        <path\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth={strokeWidth}\n          strokeLinecap=\"butt\"\n          d=\"M11.192,18l4.621,-0c3.312,-0 6,-2.689 6,-6c0,-3.311 -2.688,-6 -6,-6\"\n        />\n        <path\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth={strokeWidth}\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          d=\"M13.308,20.121l-2.121,-2.121l2.121,-2.121\"\n        />\n      </g>\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDropDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport {\n  Button,\n  ListItemIcon,\n  ListItemText,\n  Menu,\n  MenuItem,\n  styled as muiStyled,\n} from \"@mui/material\";\nimport { useCallback, useEffect, useState } from \"react\";\n\nimport { useMessagePipeline } from \"@foxglove/studio-base/components/MessagePipeline\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\nconst SPEED_OPTIONS = [0.01, 0.02, 0.05, 0.1, 0.2, 0.5, 0.8, 1, 2, 3, 5];\n\nconst formatSpeed = (val: number) => `${val < 0.1 ? val.toFixed(2) : val}×`;\n\nconst configSpeedSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.playbackConfig.speed;\n\nconst StyledButton = muiStyled(Button)(({ theme }) => ({\n  padding: theme.spacing(0.625, 0.5),\n  backgroundColor: \"transparent\",\n\n  \":hover\": {\n    backgroundColor: theme.palette.action.hover,\n  },\n}));\n\nexport default function PlaybackSpeedControls(): JSX.Element {\n  const [anchorEl, setAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const open = Boolean(anchorEl);\n  const configSpeed = useCurrentLayoutSelector(configSpeedSelector);\n  const speed = useMessagePipeline(\n    useCallback(({ playerState }) => playerState.activeData?.speed, []),\n  );\n  const setPlaybackSpeed = useMessagePipeline(useCallback((state) => state.setPlaybackSpeed, []));\n  const { setPlaybackConfig } = useCurrentLayoutActions();\n  const setSpeed = useCallback(\n    (newSpeed: number) => {\n      setPlaybackConfig({ speed: newSpeed });\n      setPlaybackSpeed?.(newSpeed);\n    },\n    [setPlaybackConfig, setPlaybackSpeed],\n  );\n\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  // Set the speed to the speed that we got from the config whenever we get a new Player.\n  useEffect(() => {\n    if (configSpeed != undefined) {\n      setPlaybackSpeed?.(configSpeed);\n    }\n  }, [configSpeed, setPlaybackSpeed]);\n\n  const displayedSpeed = speed ?? configSpeed;\n\n  return (\n    <>\n      <StyledButton\n        id=\"playback-speed-button\"\n        aria-controls={open ? \"playback-speed-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n        data-testid=\"PlaybackSpeedControls-Dropdown\"\n        disabled={setPlaybackSpeed == undefined}\n        disableRipple\n        variant=\"contained\"\n        color=\"inherit\"\n        endIcon={<ArrowDropDownIcon />}\n      >\n        {displayedSpeed == undefined ? \"–\" : formatSpeed(displayedSpeed)}\n      </StyledButton>\n      <Menu\n        id=\"playback-speed-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n        MenuListProps={{\n          \"aria-labelledby\": \"playback-speed-button\",\n        }}\n        anchorOrigin={{\n          vertical: \"top\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n      >\n        {SPEED_OPTIONS.map((option) => (\n          <MenuItem\n            selected={displayedSpeed === option}\n            key={option}\n            onClick={() => {\n              setSpeed(option);\n              handleClose();\n            }}\n          >\n            {displayedSpeed === option && (\n              <ListItemIcon>\n                <CheckIcon fontSize=\"small\" />\n              </ListItemIcon>\n            )}\n            <ListItemText\n              inset={displayedSpeed !== option}\n              primary={formatSpeed(option)}\n              primaryTypographyProps={{ variant: \"body2\" }}\n            />\n          </MenuItem>\n        ))}\n      </Menu>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDropDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport WarningIcon from \"@mui/icons-material/Warning\";\nimport {\n  TextField,\n  IconButton,\n  Menu,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  styled as muiStyled,\n} from \"@mui/material\";\nimport { useState, useCallback, useMemo, useEffect, MouseEvent, useRef } from \"react\";\n\nimport { Time, isTimeInRangeInclusive } from \"@foxglove/rostime\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\nimport {\n  formatDate,\n  formatTime,\n  getValidatedTimeAndMethodFromString,\n} from \"@foxglove/studio-base/util/formatTime\";\nimport { formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\ntype PlaybackTimeDisplayMethodProps = {\n  currentTime?: Time;\n  startTime?: Time;\n  endTime?: Time;\n  timezone?: string;\n  onSeek: (arg0: Time) => void;\n  onPause: () => void;\n  isPlaying: boolean;\n};\n\nconst StyledTextField = muiStyled(TextField)<{ error?: boolean }>(({ error, theme }) => ({\n  borderRadius: theme.shape.borderRadius,\n\n  \"&.Mui-disabled\": {\n    \".MuiFilledInput-root\": {\n      backgroundColor: \"transparent\",\n    },\n  },\n  \"&:not(.Mui-disabled):hover\": {\n    backgroundColor: theme.palette.action.hover,\n\n    \".MuiIconButton-root\": {\n      visibility: \"visible\",\n    },\n  },\n  \".MuiFilledInput-root\": {\n    backgroundColor: \"transparent\",\n\n    \":hover\": {\n      backgroundColor: \"transparent\",\n    },\n  },\n  \".MuiInputBase-input\": {\n    fontFeatureSettings: `${theme.typography.fontFeatureSettings}, 'zero' !important`,\n    minWidth: \"20ch\",\n  },\n  \".MuiIconButton-root\": {\n    borderTopLeftRadius: 0,\n    borderBottomLeftRadius: 0,\n    borderLeft: `1px solid ${theme.palette.background.paper}`,\n    visibility: \"hidden\",\n    marginRight: theme.spacing(-1),\n\n    ...(error === true && {\n      color: theme.palette.error.main,\n      borderLeftColor: theme.palette.error.main,\n    }),\n  },\n  ...(error === true && {\n    outline: `1px solid ${theme.palette.error.main}`,\n    outlineOffset: -1,\n  }),\n}));\n\nfunction PlaybackTimeMethodMenu({\n  timeFormat,\n  timeRawString,\n  timeOfDayString,\n  setTimeFormat,\n}: {\n  timeFormat: TimeDisplayMethod;\n  timeRawString?: string;\n  timeOfDayString?: string;\n  setTimeFormat: (format: TimeDisplayMethod) => Promise<void>;\n}): JSX.Element {\n  const [anchorEl, setAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const open = Boolean(anchorEl);\n\n  const handleClick = (event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  return (\n    <>\n      <IconButton\n        id=\"playback-time-display-toggle-button\"\n        aria-controls={open ? \"playback-time-display-toggle-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n      >\n        <ArrowDropDownIcon />\n      </IconButton>\n      <Menu\n        id=\"playback-time-display-toggle-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n        MenuListProps={{\n          \"aria-labelledby\": \"playback-time-display-toggle-button\",\n        }}\n        anchorOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\",\n        }}\n        transformOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }}\n      >\n        {[\n          { key: \"TOD\", label: timeOfDayString ?? \"Time of Day\" },\n          { key: \"SEC\", label: timeRawString ?? \"Seconds\" },\n        ].map((option) => (\n          <MenuItem\n            key={option.key}\n            selected={timeFormat === option.key}\n            onClick={async () => await setTimeFormat(option.key as TimeDisplayMethod)}\n          >\n            {timeFormat === option.key && (\n              <ListItemIcon>\n                <CheckIcon fontSize=\"small\" />\n              </ListItemIcon>\n            )}\n            <ListItemText\n              inset={timeFormat !== option.key}\n              primary={option.label}\n              primaryTypographyProps={{ variant: \"body2\" }}\n            />\n          </MenuItem>\n        ))}\n      </Menu>\n    </>\n  );\n}\n\nexport default function PlaybackTimeDisplayMethod({\n  currentTime,\n  startTime,\n  endTime,\n  timezone,\n  onSeek,\n  onPause,\n  isPlaying,\n}: PlaybackTimeDisplayMethodProps): JSX.Element {\n  const timeOutID = useRef<ReturnType<typeof setTimeout> | undefined>(undefined);\n  const timeFormat = useAppTimeFormat();\n  const timeRawString = useMemo(\n    () => (currentTime ? formatTimeRaw(currentTime) : undefined),\n    [currentTime],\n  );\n  const timeOfDayString = useMemo(\n    () => (currentTime ? formatTime(currentTime, timezone) : undefined),\n    [currentTime, timezone],\n  );\n  const currentTimeString = useMemo(\n    () => (timeFormat.timeFormat === \"SEC\" ? timeRawString : timeOfDayString),\n    [timeFormat.timeFormat, timeRawString, timeOfDayString],\n  );\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const [inputText, setInputText] = useState<string | undefined>(currentTimeString ?? undefined);\n  const [hasError, setHasError] = useState<boolean>(false);\n\n  const onSubmit = useCallback(\n    (e: React.FormEvent) => {\n      e.preventDefault();\n\n      if (inputText == undefined || inputText.length === 0) {\n        return;\n      }\n      if (!startTime || !currentTime || !endTime) {\n        return;\n      }\n\n      const validTimeAndMethod = getValidatedTimeAndMethodFromString({\n        text: inputText,\n        date: formatDate(currentTime, timezone),\n        timezone,\n      });\n\n      if (validTimeAndMethod == undefined) {\n        setHasError(true);\n        return;\n      }\n\n      // If input is valid, clear error state, exit edit mode, and seek to input timestamp\n      setHasError(false);\n\n      if (\n        validTimeAndMethod.time &&\n        isTimeInRangeInclusive(validTimeAndMethod.time, startTime, endTime)\n      ) {\n        onSeek(validTimeAndMethod.time);\n        if (validTimeAndMethod.method !== timeFormat.timeFormat) {\n          void timeFormat.setTimeFormat(validTimeAndMethod.method);\n        }\n      }\n    },\n    [inputText, startTime, currentTime, endTime, timezone, onSeek, timeFormat],\n  );\n\n  useEffect(() => {\n    // If user submits an empty input field or resumes playback, clear error state and show current timestamp\n    if (hasError && (inputText == undefined || inputText.length === 0 || isPlaying)) {\n      setIsEditing(false);\n      setHasError(false);\n    }\n\n    return () => {\n      if (timeOutID.current != undefined) {\n        clearTimeout(timeOutID.current);\n      }\n    };\n  }, [hasError, inputText, isPlaying]);\n\n  return (\n    <Stack direction=\"row\" alignItems=\"center\" flexGrow={0} gap={0.5}>\n      {currentTime ? (\n        <form onSubmit={onSubmit} style={{ width: \"100%\" }}>\n          <StyledTextField\n            aria-label=\"Playback Time Method\"\n            data-testid=\"PlaybackTime-text\"\n            value={isEditing ? inputText : currentTimeString}\n            error={hasError}\n            variant=\"filled\"\n            size=\"small\"\n            InputProps={{\n              startAdornment: hasError ? <WarningIcon color=\"error\" /> : undefined,\n              endAdornment: (\n                <PlaybackTimeMethodMenu\n                  {...{\n                    currentTime,\n                    timezone,\n                    timeOfDayString,\n                    timeRawString,\n                    timeFormat: timeFormat.timeFormat,\n                    setTimeFormat: timeFormat.setTimeFormat,\n                  }}\n                />\n              ),\n            }}\n            onFocus={(e) => {\n              onPause();\n              setHasError(false);\n              setIsEditing(true);\n              setInputText(currentTimeString);\n              e.target.select();\n            }}\n            onBlur={(e) => {\n              onSubmit(e);\n              setIsEditing(false);\n              timeOutID.current = setTimeout(() => setHasError(false), 600);\n            }}\n            onChange={(event) => setInputText(event.target.value)}\n          />\n        </form>\n      ) : (\n        <StyledTextField\n          className=\"Mui-disabled\"\n          disabled\n          variant=\"filled\"\n          size=\"small\"\n          defaultValue={timeFormat.timeFormat === \"SEC\" ? \"0000000000.000000000\" : \"00:00:00.000\"}\n          InputProps={{\n            endAdornment: (\n              <IconButton edge=\"end\" disabled>\n                <ArrowDropDownIcon />\n              </IconButton>\n            ),\n          }}\n        />\n      )}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Time } from \"@foxglove/rostime\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\n\nimport PlaybackTimeDisplayMethod from \"./PlaybackTimeDisplayMethod\";\n\ntype Props = {\n  onSeek: (seekTo: Time) => void;\n  onPause: () => void;\n};\n\nconst selectActiveData = (ctx: MessagePipelineContext) => ctx.playerState.activeData;\n\nexport default function PlaybackTimeDisplay(props: Props): JSX.Element {\n  const [timezone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n  const activeData = useMessagePipeline(selectActiveData);\n\n  const { isPlaying, startTime, endTime, currentTime } = activeData ?? {};\n\n  return (\n    <PlaybackTimeDisplayMethod\n      currentTime={currentTime}\n      startTime={startTime}\n      endTime={endTime}\n      onSeek={props.onSeek}\n      onPause={props.onPause}\n      isPlaying={isPlaying ?? false}\n      timezone={timezone}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useLayoutEffect } from \"react\";\n\nimport { compare, Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\n\ntype RepeatAdapterProps = {\n  repeatEnabled: boolean;\n  play: () => void;\n  seek: (to: Time) => void;\n};\n\nfunction activeDataSelector(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData;\n}\n\n/**\n * RepeatAdapter handled looping from the start of playback when playback reaches the end\n *\n * NOTE: Because repeat adapter receives every message pipeline frame, we isolate its logic inside\n * a separate component so it does not cause virtual DOM diffing on any children.\n */\nexport function RepeatAdapter(props: RepeatAdapterProps): JSX.Element {\n  const { play, seek, repeatEnabled } = props;\n\n  const activeData = useMessagePipeline(activeDataSelector);\n\n  useLayoutEffect(() => {\n    if (!repeatEnabled) {\n      return;\n    }\n\n    const currentTime = activeData?.currentTime;\n    const endTime = activeData?.endTime;\n    const startTime = activeData?.startTime;\n\n    // repeat logic could also live in messagePipeline but since it is only triggered\n    // from playback controls we've implemented it here for now - if there is demand\n    // to toggle repeat from elsewhere this logic can move\n    if (startTime && currentTime && endTime && compare(currentTime, endTime) >= 0) {\n      seek(startTime);\n      // if the user turns on repeat and we are at the end, we assume they want to play from start\n      // even if paused\n      play();\n    }\n  }, [activeData, play, repeatEnabled, seek]);\n\n  return <></>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { alpha } from \"@mui/material\";\nimport { clamp } from \"lodash\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport {\n  EventsStore,\n  TimelinePositionedEvent,\n  useEvents,\n} from \"@foxglove/studio-base/context/EventsContext\";\nimport {\n  TimelineInteractionStateStore,\n  useTimelineInteractionState,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\n\nconst useStyles = makeStyles()(({ transitions, palette }) => ({\n  root: {\n    inset: 0,\n    pointerEvents: \"none\",\n    position: \"absolute\",\n    display: \"flex\",\n    alignItems: \"center\",\n  },\n  tick: {\n    transition: transitions.create(\"height\", { duration: transitions.duration.shortest }),\n    backgroundBlendMode: \"overlay\",\n    backgroundColor: alpha(palette.info.main, 0.58),\n    position: \"absolute\",\n    height: 6,\n  },\n  tickHovered: {\n    transition: transitions.create(\"height\", { duration: transitions.duration.shortest }),\n    backgroundColor: alpha(palette.info.main, 0.58),\n    border: `1px solid ${palette.info.main}`,\n    height: 12,\n  },\n  tickSelected: {\n    transition: transitions.create(\"height\", {\n      duration: transitions.duration.shortest,\n    }),\n    backgroundColor: alpha(palette.info.main, 0.67),\n    height: 12,\n  },\n}));\n\nconst selectEvents = (store: EventsStore) => store.events;\nconst selectHoveredEvent = (store: TimelineInteractionStateStore) => store.hoveredEvent;\nconst selectEventsAtHoverValue = (store: TimelineInteractionStateStore) => store.eventsAtHoverValue;\nconst selectSelectedEventId = (store: EventsStore) => store.selectedEventId;\n\nfunction EventTick({ event }: { event: TimelinePositionedEvent }): JSX.Element {\n  const eventsAtHoverValue = useTimelineInteractionState(selectEventsAtHoverValue);\n  const hoveredEvent = useTimelineInteractionState(selectHoveredEvent);\n  const selectedEventId = useEvents(selectSelectedEventId);\n  const { classes, cx } = useStyles();\n\n  const left = `calc(${clamp(event.startPosition, 0, 1) * 100}% - 1px)`;\n  const right = `calc(100% - ${clamp(event.endPosition, 0, 1) * 100}% - 1px)`;\n\n  return (\n    <div\n      className={cx(classes.tick, {\n        [classes.tickHovered]: hoveredEvent\n          ? event.event.id === hoveredEvent.event.id\n          : eventsAtHoverValue[event.event.id] != undefined,\n        [classes.tickSelected]: selectedEventId === event.event.id,\n      })}\n      style={{ left, right }}\n    />\n  );\n}\n\nconst MemoEventTick = React.memo(EventTick);\n\nexport function EventsOverlay(): JSX.Element {\n  const events = useEvents(selectEvents);\n  const { classes } = useStyles();\n\n  return (\n    <div className={classes.root}>\n      {(events.value ?? []).map((event) => (\n        <MemoEventTick key={event.event.id} event={event} />\n      ))}\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Tooltip, Typography } from \"@mui/material\";\nimport { useMemo } from \"react\";\nimport { useResizeDetector } from \"react-resize-detector\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { add, fromSec, toSec } from \"@foxglove/rostime\";\nimport { RpcScales } from \"@foxglove/studio-base/components/Chart/types\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport HoverBar from \"@foxglove/studio-base/components/TimeBasedChart/HoverBar\";\nimport { useHoverValue } from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  tick: {\n    position: \"absolute\",\n    height: 16,\n    borderRadius: 1,\n    width: 2,\n    top: 8,\n    transform: \"translate(-50%, 0)\",\n    backgroundColor: theme.palette.warning.main,\n  },\n  tooltip: {\n    '&[data-popper-placement*=\"top\"] .MuiTooltip-tooltip': {\n      marginBottom: `${theme.spacing(1)} !important`,\n    },\n  },\n}));\n\nfunction getStartTime(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData?.startTime;\n}\n\nfunction getEndTime(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData?.endTime;\n}\n\ntype Props = {\n  componentId: string;\n};\n\nexport default function PlaybackBarHoverTicks(props: Props): JSX.Element {\n  const { componentId } = props;\n  const { classes } = useStyles();\n\n  const startTime = useMessagePipeline(getStartTime);\n  const endTime = useMessagePipeline(getEndTime);\n  const hoverValue = useHoverValue({ componentId, isTimestampScale: true });\n  const { formatTime } = useAppTimeFormat();\n\n  // Use a debounce and 0 refresh rate to avoid triggering a resize observation while handling\n  // an existing resize observation.\n  // https://github.com/maslianok/react-resize-detector/issues/45\n  const { width, ref } = useResizeDetector({\n    handleHeight: false,\n    refreshMode: \"debounce\",\n    refreshRate: 0,\n  });\n\n  const hoverTimeDisplay = useMemo(() => {\n    if (\n      !hoverValue ||\n      hoverValue.type !== \"PLAYBACK_SECONDS\" ||\n      !startTime ||\n      hoverValue.value < 0\n    ) {\n      return undefined;\n    }\n    const stamp = add(startTime, fromSec(hoverValue.value));\n    return formatTime(stamp);\n  }, [formatTime, hoverValue, startTime]);\n\n  const scaleBounds = useMemo<RpcScales | undefined>(() => {\n    if (startTime == undefined || endTime == undefined) {\n      return;\n    }\n\n    return {\n      x: {\n        min: 0,\n        max: toSec(endTime) - toSec(startTime),\n        pixelMin: 0,\n        pixelMax: width ?? 0,\n      },\n    };\n  }, [width, startTime, endTime]);\n\n  // Hover time is only displayed when the hover value originates from other components\n  const displayHoverTime = hoverValue != undefined && hoverValue.componentId !== componentId;\n\n  return (\n    <Stack ref={ref} flex=\"auto\">\n      {scaleBounds && (\n        <HoverBar componentId={componentId} scales={scaleBounds} isTimestampScale>\n          <Tooltip\n            arrow\n            classes={{ popper: classes.tooltip }}\n            placement=\"top\"\n            disableFocusListener\n            disableHoverListener\n            disableTouchListener\n            disableInteractive\n            TransitionProps={{ timeout: 0 }}\n            open={displayHoverTime}\n            title={\n              <Typography align=\"center\" variant=\"caption\" fontFamily={fonts.MONOSPACE} noWrap>\n                {hoverTimeDisplay}\n              </Typography>\n            }\n          >\n            <div className={classes.tick} />\n          </Tooltip>\n        </HoverBar>\n      )}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Divider, Typography } from \"@mui/material\";\nimport { isEmpty } from \"lodash\";\nimport { Fragment } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { subtract as subtractTimes, toSec, Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport {\n  TimelineInteractionStateStore,\n  useTimelineInteractionState,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nexport type PlaybackControlsTooltipItem =\n  | { type: \"divider\" }\n  | { type: \"item\"; title: string; value: string };\n\nconst useStyles = makeStyles()((theme) => ({\n  tooltipDivider: {\n    gridColumn: \"span 2\",\n    marginBlock: theme.spacing(0.5),\n    opacity: 0.5,\n  },\n  tooltipWrapper: {\n    fontFeatureSettings: `${theme.typography.fontFeatureSettings}, \"zero\"`,\n    fontFamily: fonts.SANS_SERIF,\n    whiteSpace: \"nowrap\",\n    columnGap: theme.spacing(0.5),\n    display: \"grid\",\n    alignItems: \"center\",\n    gridTemplateColumns: \"auto auto\",\n    width: \"100%\",\n    flexDirection: \"column\",\n  },\n  itemKey: {\n    fontSize: \"0.7rem\",\n    opacity: 0.7,\n    textAlign: \"end\",\n    textTransform: \"lowercase\",\n  },\n}));\n\nconst selectHoveredEvents = (store: TimelineInteractionStateStore) => store.eventsAtHoverValue;\nconst selectStartTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.startTime;\n\nexport function PlaybackControlsTooltipContent(params: { stamp: Time }): ReactNull | JSX.Element {\n  const { stamp } = params;\n  const { formatTime, timeFormat } = useAppTimeFormat();\n  const hoveredEvents = useTimelineInteractionState(selectHoveredEvents);\n  const startTime = useMessagePipeline(selectStartTime);\n  const { classes } = useStyles();\n\n  if (!startTime) {\n    return ReactNull;\n  }\n\n  const timeFromStart = subtractTimes(stamp, startTime);\n\n  const tooltipItems: PlaybackControlsTooltipItem[] = [];\n\n  if (!isEmpty(hoveredEvents)) {\n    Object.values(hoveredEvents).forEach(({ event }) => {\n      tooltipItems.push({\n        type: \"item\",\n        title: \"Start\",\n        value: formatTime(event.startTime),\n      });\n      tooltipItems.push({\n        type: \"item\",\n        title: \"End\",\n        value: formatTime(event.endTime),\n      });\n      if (!isEmpty(event.metadata)) {\n        Object.entries(event.metadata).forEach(([metaKey, metaValue]) => {\n          tooltipItems.push({ type: \"item\", title: metaKey, value: metaValue });\n        });\n      }\n      tooltipItems.push({ type: \"divider\" });\n    });\n  }\n\n  switch (timeFormat) {\n    case \"TOD\":\n      tooltipItems.push({ type: \"item\", title: \"Time\", value: formatTime(stamp) });\n      break;\n    case \"SEC\":\n      tooltipItems.push({ type: \"item\", title: \"SEC\", value: formatTime(stamp) });\n      break;\n  }\n\n  tooltipItems.push({\n    type: \"item\",\n    title: \"Elapsed\",\n    value: `${toSec(timeFromStart).toFixed(9)} sec`,\n  });\n\n  return (\n    <div className={classes.tooltipWrapper}>\n      {tooltipItems.map((item, idx) => {\n        if (item.type === \"divider\") {\n          return <Divider key={`divider_${idx}`} className={classes.tooltipDivider} />;\n        }\n        return (\n          <Fragment key={`${item.title}_${idx}`}>\n            <Typography className={classes.itemKey} noWrap>\n              {item.title}\n            </Typography>\n            <Typography variant=\"subtitle2\" noWrap>\n              {item.value}\n            </Typography>\n          </Fragment>\n        );\n      })}\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { keyframes } from \"@emotion/react\";\nimport { simplify } from \"intervals-fn\";\nimport { clamp } from \"lodash\";\nimport { useMemo } from \"react\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\n\ntype ProgressProps = {\n  loading: boolean;\n  availableRanges?: Range[];\n};\n\nconst STRIPE_WIDTH = 8;\n\nconst animatedBackground = keyframes`\n  0% { background-position: 0 0; }\n  100% { background-position: ${STRIPE_WIDTH * 2}px 0; }\n`;\n\nconst useStyles = makeStyles()((theme) => ({\n  loadingIndicator: {\n    label: \"ProgressPlot-loadingIndicator\",\n    position: \"absolute\",\n    width: \"100%\",\n    height: \"100%\",\n    animation: `${animatedBackground} 300ms linear infinite`,\n    backgroundRepeat: \"repeat-x\",\n    backgroundSize: `${STRIPE_WIDTH * 2}px 100%`,\n    backgroundImage: `repeating-linear-gradient(${[\n      \"90deg\",\n      `${theme.palette.background.paper}`,\n      `${theme.palette.background.paper} ${STRIPE_WIDTH / 2}px`,\n      `transparent ${STRIPE_WIDTH / 2}px`,\n      `transparent ${STRIPE_WIDTH}px`,\n    ].join(\",\")})`,\n  },\n  range: {\n    label: \"ProgressPlot-range\",\n    position: \"absolute\",\n    backgroundColor:\n      theme.palette.mode === \"dark\"\n        ? tinycolor(theme.palette.text.secondary).darken(25).toHexString()\n        : tinycolor(theme.palette.text.secondary).lighten(25).toHexString(),\n    height: \"100%\",\n  },\n}));\n\nexport function ProgressPlot(props: ProgressProps): JSX.Element {\n  const { availableRanges, loading } = props;\n  const { classes } = useStyles();\n\n  const clampedRanges = useMemo(() => {\n    if (!availableRanges) {\n      return undefined;\n    }\n\n    return availableRanges.map((range) => ({\n      start: clamp(range.start, 0, 1),\n      end: clamp(range.end, 0, 1),\n    }));\n  }, [availableRanges]);\n\n  const ranges = useMemo(() => {\n    if (!clampedRanges) {\n      return <></>;\n    }\n    const mergedRanges = simplify(clampedRanges);\n\n    return filterMap(mergedRanges, (range, idx) => {\n      const width = range.end - range.start;\n      if (width === 0) {\n        return;\n      }\n\n      return (\n        <div\n          className={classes.range}\n          key={idx}\n          style={{\n            width: `${width * 100}%`,\n            left: `${range.start * 100}%`,\n          }}\n        />\n      );\n    });\n  }, [clampedRanges, classes.range]);\n\n  return (\n    <Stack position=\"relative\" fullHeight>\n      {loading && <div className={classes.loadingIndicator} />}\n      {ranges}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Interolates betweem min and max. A value of 0 returns min and a value of\n * 1 returns max.\n */\nexport function interpolateValue(value: number, min: number, max: number): number {\n  return min + (max - min) * value;\n}\n\n/**\n * Scales value from its position in the range minA, maxA to the range\n * minB, maxB. A value of minA will return minB, A value of maxA will return maxB.\n */\nexport function scaleValue(\n  value: number,\n  minA: number,\n  maxA: number,\n  minB: number,\n  maxB: number,\n): number {\n  return interpolateValue((value - minA) / (maxA - minA), minB, maxB);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { clamp } from \"lodash\";\nimport { useCallback, useEffect, useRef, ReactNode, useState, useLayoutEffect } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { scaleValue } from \"@foxglove/den/math\";\n\ntype Props = {\n  fraction: number | undefined;\n  disabled?: boolean;\n  onChange: (value: number) => void;\n  onHoverOver?: (value: number) => void;\n  onHoverOut?: () => void;\n  renderSlider?: (value?: number) => ReactNode;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    label: \"Slider-root\",\n    display: \"flex\",\n    width: \"100%\",\n    height: \"100%\",\n    position: \"relative\",\n    alignItems: \"center\",\n    cursor: \"pointer\",\n  },\n  rootDisabled: {\n    label: \"Slider-rootDisabled\",\n    cursor: \"not-allowed\",\n    opacity: theme.palette.action.disabledOpacity,\n  },\n  range: {\n    label: \"Slider-range\",\n    backgroundColor: theme.palette.action.active,\n    position: \"absolute\",\n    height: \"100%\",\n  },\n}));\n\nfunction defaultRenderSlider(value: number | undefined, className: string): ReactNode {\n  if (value == undefined || isNaN(value)) {\n    return ReactNull;\n  }\n  return <div className={className} style={{ width: `${value * 100}%` }} />;\n}\n\nexport default function Slider(props: Props): JSX.Element {\n  const {\n    fraction,\n    disabled = false,\n    renderSlider = defaultRenderSlider,\n    onHoverOver,\n    onHoverOut,\n    onChange,\n  } = props;\n  const { classes, cx } = useStyles();\n\n  const elRef = useRef<HTMLDivElement | ReactNull>(ReactNull);\n\n  const getValueAtMouse = useCallback((ev: React.MouseEvent | MouseEvent): number => {\n    if (!elRef.current) {\n      return 0;\n    }\n    const { left, right } = elRef.current.getBoundingClientRect();\n    const scaled = scaleValue(ev.clientX, left, right, 0, 1);\n    return clamp(scaled, 0, 1);\n  }, []);\n\n  const [mouseDown, setMouseDown] = useState(false);\n  const mouseDownRef = useRef(mouseDown);\n  useLayoutEffect(() => {\n    mouseDownRef.current = mouseDown;\n  }, [mouseDown]);\n\n  const [mouseInside, setMouseInside] = useState(false);\n  const mouseInsideRef = useRef(mouseInside);\n  useLayoutEffect(() => {\n    mouseInsideRef.current = mouseInside;\n  }, [mouseInside]);\n\n  const onMouseEnter = useCallback(() => {\n    setMouseInside(true);\n  }, []);\n\n  const onMouseLeave = useCallback(() => {\n    setMouseInside(false);\n    if (!mouseDownRef.current) {\n      onHoverOut?.();\n    }\n  }, [onHoverOut]);\n\n  const onPointerUp = useCallback((): void => {\n    setMouseDown(false);\n    if (!mouseInsideRef.current) {\n      onHoverOut?.();\n    }\n  }, [onHoverOut]);\n\n  const onPointerMove = useCallback(\n    (ev: React.PointerEvent | PointerEvent): void => {\n      const val = getValueAtMouse(ev);\n      if (disabled) {\n        return;\n      }\n\n      if (elRef.current) {\n        onHoverOver?.(val);\n      }\n      if (!mouseDownRef.current) {\n        return;\n      }\n      onChange(val);\n    },\n    [disabled, getValueAtMouse, onChange, onHoverOver],\n  );\n\n  const onPointerDown = useCallback(\n    (ev: React.PointerEvent<HTMLDivElement>): void => {\n      if (disabled) {\n        return;\n      }\n      if (document.activeElement instanceof HTMLElement) {\n        document.activeElement.blur();\n      }\n      ev.preventDefault();\n      onChange(getValueAtMouse(ev));\n      setMouseDown(true);\n    },\n    [disabled, getValueAtMouse, onChange],\n  );\n\n  useEffect(() => {\n    if (mouseDown) {\n      window.addEventListener(\"pointerup\", onPointerUp);\n      return () => {\n        window.removeEventListener(\"pointerup\", onPointerUp);\n      };\n    }\n    return undefined;\n  }, [mouseDown, onPointerMove, onPointerUp]);\n\n  return (\n    <div\n      ref={elRef}\n      onPointerDown={onPointerDown}\n      onPointerMove={onPointerMove}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      className={cx(classes.root, {\n        [classes.rootDisabled]: disabled,\n      })}\n    >\n      {renderSlider(fraction, classes.range)}\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Fade, Tooltip } from \"@mui/material\";\nimport type { Instance } from \"@popperjs/core\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useLatest } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport {\n  subtract as subtractTimes,\n  add as addTimes,\n  toSec,\n  fromSec,\n  Time,\n} from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  useClearHoverValue,\n  useSetHoverValue,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\n\nimport { EventsOverlay } from \"./EventsOverlay\";\nimport PlaybackBarHoverTicks from \"./PlaybackBarHoverTicks\";\nimport { PlaybackControlsTooltipContent } from \"./PlaybackControlsTooltipContent\";\nimport { ProgressPlot } from \"./ProgressPlot\";\nimport Slider from \"./Slider\";\n\nconst useStyles = makeStyles()((theme) => ({\n  marker: {\n    backgroundColor: theme.palette.text.primary,\n    position: \"absolute\",\n    height: 16,\n    borderRadius: 1,\n    width: 2,\n    transform: \"translate(-50%, 0)\",\n  },\n  track: {\n    position: \"absolute\",\n    left: 0,\n    right: 0,\n    height: 6,\n    backgroundColor: theme.palette.action.focus,\n  },\n  trackDisabled: {\n    opacity: theme.palette.action.disabledOpacity,\n  },\n}));\n\nconst selectStartTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.startTime;\nconst selectCurrentTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.currentTime;\nconst selectEndTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.endTime;\nconst selectRanges = (ctx: MessagePipelineContext) =>\n  ctx.playerState.progress.fullyLoadedFractionRanges;\nconst selectPresence = (ctx: MessagePipelineContext) => ctx.playerState.presence;\n\ntype Props = {\n  onSeek: (seekTo: Time) => void;\n};\n\nexport default function Scrubber(props: Props): JSX.Element {\n  const { onSeek } = props;\n  const { classes, cx } = useStyles();\n\n  const [hoverComponentId] = useState<string>(() => uuidv4());\n  const hoverElRef = useRef<HTMLDivElement>(ReactNull);\n\n  const startTime = useMessagePipeline(selectStartTime);\n  const currentTime = useMessagePipeline(selectCurrentTime);\n  const endTime = useMessagePipeline(selectEndTime);\n  const presence = useMessagePipeline(selectPresence);\n  const ranges = useMessagePipeline(selectRanges);\n\n  const setHoverValue = useSetHoverValue();\n\n  const [hoverStamp, setHoverStamp] = useState<Time | undefined>();\n\n  const latestStartTime = useLatest(startTime);\n  const latestEndTime = useLatest(endTime);\n\n  const onChange = useCallback(\n    (fraction: number) => {\n      if (!latestStartTime.current || !latestEndTime.current) {\n        return;\n      }\n      onSeek(\n        addTimes(\n          latestStartTime.current,\n          fromSec(fraction * toSec(subtractTimes(latestEndTime.current, latestStartTime.current))),\n        ),\n      );\n    },\n    [onSeek, latestEndTime, latestStartTime],\n  );\n\n  const onHoverOver = useCallback(\n    (fraction: number) => {\n      if (!latestStartTime.current || !latestEndTime.current || hoverElRef.current == undefined) {\n        return;\n      }\n      const duration = toSec(subtractTimes(latestEndTime.current, latestStartTime.current));\n      const timeFromStart = fromSec(fraction * duration);\n      setHoverStamp(addTimes(latestStartTime.current, timeFromStart));\n      setHoverValue({\n        componentId: hoverComponentId,\n        type: \"PLAYBACK_SECONDS\",\n        value: toSec(timeFromStart),\n      });\n    },\n    [hoverComponentId, latestEndTime, latestStartTime, setHoverValue],\n  );\n\n  const clearHoverValue = useClearHoverValue();\n\n  const onHoverOut = useCallback(() => {\n    clearHoverValue(hoverComponentId);\n  }, [clearHoverValue, hoverComponentId]);\n\n  // Clean up the hover value when we are unmounted -- important for storybook.\n  useEffect(() => onHoverOut, [onHoverOut]);\n\n  const renderSlider = useCallback(\n    (val?: number) => {\n      if (val == undefined) {\n        return undefined;\n      }\n      return <div className={classes.marker} style={{ left: `${val * 100}%` }} />;\n    },\n    [classes.marker],\n  );\n\n  const min = startTime && toSec(startTime);\n  const max = endTime && toSec(endTime);\n  const fraction =\n    currentTime && startTime && endTime\n      ? toSec(subtractTimes(currentTime, startTime)) / toSec(subtractTimes(endTime, startTime))\n      : undefined;\n\n  const loading = presence === PlayerPresence.INITIALIZING || presence === PlayerPresence.BUFFERING;\n\n  const popperRef = React.useRef<Instance>(ReactNull);\n\n  const positionRef = React.useRef({ x: 0, y: 0 });\n\n  const handlePointerMove = (event: React.PointerEvent) => {\n    positionRef.current = { x: event.clientX, y: event.clientY };\n\n    if (popperRef.current != undefined) {\n      void popperRef.current.update();\n    }\n  };\n\n  return (\n    <Tooltip\n      title={hoverStamp != undefined ? <PlaybackControlsTooltipContent stamp={hoverStamp} /> : \"\"}\n      placement=\"top\"\n      disableInteractive\n      TransitionComponent={Fade}\n      TransitionProps={{ timeout: 0 }}\n      PopperProps={{\n        popperRef,\n        modifiers: [\n          {\n            name: \"computeStyles\",\n            options: {\n              gpuAcceleration: false, // Fixes hairline seam on arrow in chrome.\n            },\n          },\n          {\n            name: \"offset\",\n            options: {\n              // Offset popper to hug the track better.\n              offset: [0, -12],\n            },\n          },\n        ],\n        anchorEl: {\n          getBoundingClientRect: () => {\n            return new DOMRect(\n              positionRef.current.x,\n              hoverElRef.current?.getBoundingClientRect().y ?? 0,\n              0,\n              0,\n            );\n          },\n        },\n      }}\n    >\n      <Stack\n        ref={hoverElRef}\n        direction=\"row\"\n        flexGrow={1}\n        onPointerMove={handlePointerMove}\n        alignItems=\"center\"\n        position=\"relative\"\n        style={{ height: 32 }}\n      >\n        <div className={cx(classes.track, { [classes.trackDisabled]: !startTime })} />\n        <Stack position=\"absolute\" flex=\"auto\" fullWidth style={{ height: 6 }}>\n          <ProgressPlot loading={loading} availableRanges={ranges} />\n        </Stack>\n        <Stack fullHeight fullWidth position=\"absolute\" flex={1}>\n          <Slider\n            disabled={min == undefined || max == undefined}\n            fraction={fraction}\n            onHoverOver={onHoverOver}\n            onHoverOut={onHoverOut}\n            onChange={onChange}\n            renderSlider={renderSlider}\n          />\n        </Stack>\n        <EventsOverlay />\n        <PlaybackBarHoverTicks componentId={hoverComponentId} />\n      </Stack>\n    </Tooltip>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Time, toMillis, fromMillis } from \"@foxglove/rostime\";\n\nconst ARROW_SEEK_BIG_MS = 500;\nconst ARROW_SEEK_DEFAULT_MS = 100;\nconst ARROW_SEEK_SMALL_MS = 10;\nexport const DIRECTION = {\n  FORWARD: 1,\n  BACKWARD: -1,\n};\n\nexport const jumpSeek = (\n  directionSign: (typeof DIRECTION)[keyof typeof DIRECTION],\n  currentTime: Time,\n  modifierKeys?: { altKey: boolean; shiftKey: boolean },\n): Time => {\n  const timeMs = toMillis(currentTime);\n  const deltaMs =\n    modifierKeys?.altKey === true\n      ? ARROW_SEEK_BIG_MS\n      : modifierKeys?.shiftKey === true\n      ? ARROW_SEEK_SMALL_MS\n      : ARROW_SEEK_DEFAULT_MS;\n  return fromMillis(timeMs + deltaMs * directionSign);\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport {\n  Pause20Filled,\n  Pause20Regular,\n  Play20Filled,\n  Play20Regular,\n  Next20Filled,\n  Next20Regular,\n  Previous20Filled,\n  Previous20Regular,\n  Info24Regular,\n} from \"@fluentui/react-icons\";\nimport { Tooltip } from \"@mui/material\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { compare, Time } from \"@foxglove/rostime\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { CreateEventDialog } from \"@foxglove/studio-base/components/CreateEventDialog\";\nimport { DataSourceInfoView } from \"@foxglove/studio-base/components/DataSourceInfoView\";\nimport EventIcon from \"@foxglove/studio-base/components/EventIcon\";\nimport EventOutlinedIcon from \"@foxglove/studio-base/components/EventOutlinedIcon\";\nimport HoverableIconButton from \"@foxglove/studio-base/components/HoverableIconButton\";\nimport KeyListener from \"@foxglove/studio-base/components/KeyListener\";\nimport LoopIcon from \"@foxglove/studio-base/components/LoopIcon\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport PlaybackSpeedControls from \"@foxglove/studio-base/components/PlaybackSpeedControls\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport { Player, PlayerPresence } from \"@foxglove/studio-base/players/types\";\n\nimport PlaybackTimeDisplay from \"./PlaybackTimeDisplay\";\nimport { RepeatAdapter } from \"./RepeatAdapter\";\nimport Scrubber from \"./Scrubber\";\nimport { jumpSeek, DIRECTION } from \"./sharedHelpers\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    padding: theme.spacing(0.5, 1, 1, 1),\n    position: \"relative\",\n    backgroundColor: theme.palette.background.paper,\n    borderTop: `1px solid ${theme.palette.divider}`,\n    zIndex: 100000,\n  },\n  popper: {\n    \"&[data-popper-placement*=top] .MuiTooltip-tooltip\": {\n      margin: theme.spacing(0.5, 0.5, 0.75),\n    },\n  },\n}));\n\nconst selectPresence = (ctx: MessagePipelineContext) => ctx.playerState.presence;\nconst selectEventsSupported = (store: EventsStore) => store.eventsSupported;\n\nexport default function PlaybackControls(props: {\n  play: NonNullable<Player[\"startPlayback\"]>;\n  pause: NonNullable<Player[\"pausePlayback\"]>;\n  seek: NonNullable<Player[\"seekPlayback\"]>;\n  playUntil?: Player[\"playUntil\"];\n  isPlaying: boolean;\n  getTimeInfo: () => { startTime?: Time; endTime?: Time; currentTime?: Time };\n}): JSX.Element {\n  const { play, pause, seek, isPlaying, getTimeInfo, playUntil } = props;\n  const presence = useMessagePipeline(selectPresence);\n  const [enableNewTopNav = false] = useAppConfigurationValue<boolean>(AppSetting.ENABLE_NEW_TOPNAV);\n\n  const { classes } = useStyles();\n  const [repeat, setRepeat] = useState(false);\n  const [createEventDialogOpen, setCreateEventDialogOpen] = useState(false);\n  const { currentUser } = useCurrentUser();\n  const eventsSupported = useEvents(selectEventsSupported);\n\n  const toggleRepeat = useCallback(() => {\n    setRepeat((old) => !old);\n  }, []);\n\n  const togglePlayPause = useCallback(() => {\n    if (isPlaying) {\n      pause();\n    } else {\n      const { startTime: start, endTime: end, currentTime: current } = getTimeInfo();\n      // if we are at the end, we need to go back to start\n      if (current && end && start && compare(current, end) >= 0) {\n        seek(start);\n      }\n      play();\n    }\n  }, [isPlaying, pause, getTimeInfo, play, seek]);\n\n  const seekForwardAction = useCallback(\n    (ev?: KeyboardEvent) => {\n      const { currentTime } = getTimeInfo();\n      if (!currentTime) {\n        return;\n      }\n\n      // If playUntil is available, we prefer to use that rather than seek, which performs a jump\n      // seek.\n      //\n      // Playing forward up to the desired seek time will play all messages to the panels which\n      // mirrors the behavior panels would expect when playing without stepping. This behavior is\n      // important for some message types which convey state information.\n      //\n      // i.e. Skipping coordinate frame messages may result in incorrectly rendered markers or\n      // missing markers altogther.\n      const targetTime = jumpSeek(DIRECTION.FORWARD, currentTime, ev);\n\n      if (playUntil) {\n        playUntil(targetTime);\n      } else {\n        seek(targetTime);\n      }\n    },\n    [getTimeInfo, playUntil, seek],\n  );\n\n  const seekBackwardAction = useCallback(\n    (ev?: KeyboardEvent) => {\n      const { currentTime } = getTimeInfo();\n      if (!currentTime) {\n        return;\n      }\n      seek(jumpSeek(DIRECTION.BACKWARD, currentTime, ev));\n    },\n    [getTimeInfo, seek],\n  );\n\n  const keyDownHandlers = useMemo(\n    () => ({\n      \" \": togglePlayPause,\n      ArrowLeft: (ev: KeyboardEvent) => {\n        seekBackwardAction(ev);\n      },\n      ArrowRight: (ev: KeyboardEvent) => {\n        seekForwardAction(ev);\n      },\n    }),\n    [seekBackwardAction, seekForwardAction, togglePlayPause],\n  );\n\n  const toggleCreateEventDialog = useCallback(() => {\n    setCreateEventDialogOpen((open) => !open);\n  }, []);\n\n  const disableControls = presence === PlayerPresence.ERROR;\n\n  return (\n    <>\n      <RepeatAdapter play={play} seek={seek} repeatEnabled={repeat} />\n      <KeyListener global keyDownHandlers={keyDownHandlers} />\n      <div className={classes.root}>\n        <Scrubber onSeek={seek} />\n        <Stack direction=\"row\" alignItems=\"center\" flex={1} gap={1} overflowX=\"auto\">\n          <Stack direction=\"row\" flex={1} gap={0.5}>\n            {currentUser && eventsSupported && (\n              <HoverableIconButton\n                size=\"small\"\n                title=\"Create event\"\n                icon={<EventOutlinedIcon />}\n                activeIcon={<EventIcon />}\n                onClick={toggleCreateEventDialog}\n              />\n            )}\n            {enableNewTopNav && (\n              <Tooltip\n                classes={{ popper: classes.popper }}\n                title={\n                  <Stack paddingY={0.75}>\n                    <DataSourceInfoView disableSource />\n                  </Stack>\n                }\n              >\n                <HoverableIconButton\n                  disabled={presence !== PlayerPresence.PRESENT}\n                  size=\"small\"\n                  icon={<Info24Regular />}\n                  activeColor=\"info\"\n                />\n              </Tooltip>\n            )}\n            <PlaybackTimeDisplay onSeek={seek} onPause={pause} />\n          </Stack>\n          <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n            <HoverableIconButton\n              disabled={disableControls}\n              size=\"small\"\n              title=\"Seek backward\"\n              icon={<Previous20Regular />}\n              activeIcon={<Previous20Filled />}\n              onClick={() => seekBackwardAction()}\n            />\n            <HoverableIconButton\n              disabled={disableControls}\n              size=\"small\"\n              title={isPlaying ? \"Pause\" : \"Play\"}\n              onClick={togglePlayPause}\n              icon={isPlaying ? <Pause20Regular /> : <Play20Regular />}\n              activeIcon={isPlaying ? <Pause20Filled /> : <Play20Filled />}\n            />\n            <HoverableIconButton\n              disabled={disableControls}\n              size=\"small\"\n              title=\"Seek forward\"\n              icon={<Next20Regular />}\n              activeIcon={<Next20Filled />}\n              onClick={() => seekForwardAction()}\n            />\n          </Stack>\n          <Stack direction=\"row\" flex={1} alignItems=\"center\" justifyContent=\"flex-end\" gap={0.5}>\n            <HoverableIconButton\n              size=\"small\"\n              title=\"Loop playback\"\n              color={repeat ? \"primary\" : \"inherit\"}\n              onClick={toggleRepeat}\n              icon={repeat ? <LoopIcon strokeWidth={1.9375} /> : <LoopIcon strokeWidth={1.375} />}\n              activeIcon={<LoopIcon strokeWidth={1.875} />}\n            />\n            <PlaybackSpeedControls />\n          </Stack>\n        </Stack>\n        {createEventDialogOpen && eventsSupported && (\n          <CreateEventDialog onClose={toggleCreateEventDialog} />\n        )}\n      </div>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren, useCallback } from \"react\";\n\n/**\n * RemountOnValueChange will unmount and remount the children when _value_ changes.\n * This is used when you want to \"reset\" the component tree for a specific value change.\n *\n * Note: Use sparingly and prefer hook dependencies to manage state updates. This should be a\n * last resort nuclear option when you think that an entire subtree should be purged.\n */\nexport default function RemountOnValueChange(\n  props: PropsWithChildren<{ value: unknown }>,\n): JSX.Element {\n  // When the value changes, useCallback will create a new component by returning a new\n  // function instance. Since this is a completely new component it will remount its entire tree.\n  const Parent = useCallback(\n    ({ children }: PropsWithChildren<unknown>) => {\n      void props.value; // to suppress eslint complaining about the value in the deps list\n      return <>{children}</>;\n    },\n    [props.value],\n  );\n\n  return <Parent>{props.children}</Parent>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  ChatBubblesQuestion24Regular,\n  Cloud24Regular,\n  SlideLayout24Regular,\n} from \"@fluentui/react-icons\";\nimport {\n  Divider,\n  ListItemText,\n  ListSubheader,\n  Menu,\n  MenuItem,\n  PopoverOrigin,\n  PopoverPosition,\n  PopoverReference,\n} from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useCurrentUserType } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst useStyles = makeStyles()((theme) => ({\n  subheader: {\n    bgcolor: \"transparent\",\n    border: \"none\",\n  },\n  paper: {\n    width: 280,\n  },\n  icon: {\n    color: theme.palette.primary.main,\n    flex: \"none\",\n  },\n  menuItem: {\n    gap: theme.spacing(1),\n  },\n  menuText: {\n    whiteSpace: \"normal\",\n    flex: \"0 1 auto\",\n  },\n}));\n\ntype HelpMenuProps = {\n  anchorEl?: HTMLElement;\n  anchorOrigin?: PopoverOrigin;\n  anchorPosition?: PopoverPosition;\n  anchorReference?: PopoverReference;\n  disablePortal?: boolean;\n  handleClose: () => void;\n  open: boolean;\n  transformOrigin?: PopoverOrigin;\n};\n\nexport function HelpMenu(props: HelpMenuProps): JSX.Element {\n  const {\n    anchorEl,\n    anchorOrigin,\n    anchorPosition,\n    anchorReference,\n    disablePortal,\n    handleClose,\n    open,\n    transformOrigin,\n  } = props;\n  const { classes } = useStyles();\n  const currentUserType = useCurrentUserType();\n  const analytics = useAnalytics();\n\n  return (\n    <Menu\n      classes={{ paper: classes.paper }}\n      id=\"help-menu\"\n      anchorEl={anchorEl}\n      anchorOrigin={anchorOrigin}\n      anchorReference={anchorReference}\n      anchorPosition={anchorPosition}\n      disablePortal={disablePortal}\n      open={open}\n      onClose={handleClose}\n      transformOrigin={transformOrigin}\n      MenuListProps={{\n        \"aria-labelledby\": \"help-button\",\n      }}\n    >\n      <ListSubheader className={classes.subheader}>Documentation</ListSubheader>\n      <MenuItem\n        href=\"https://foxglove.dev/docs/studio\"\n        className={classes.menuItem}\n        component=\"a\"\n        target=\"_blank\"\n        onClick={() => {\n          void analytics.logEvent(AppEvent.HELP_MENU_CLICK_CTA, {\n            user: currentUserType,\n            cta: \"docs-studio\",\n          });\n          handleClose();\n        }}\n      >\n        <SlideLayout24Regular className={classes.icon} />\n        <ListItemText\n          primary=\"Studio\"\n          secondary=\"Open source robotics visualization and debugging\"\n          secondaryTypographyProps={{ className: classes.menuText }}\n        />\n      </MenuItem>\n      <MenuItem\n        href=\"https://foxglove.dev/docs/data-platform\"\n        className={classes.menuItem}\n        component=\"a\"\n        target=\"_blank\"\n        onClick={() => {\n          void analytics.logEvent(AppEvent.HELP_MENU_CLICK_CTA, {\n            user: currentUserType,\n            cta: \"docs-data-platform\",\n          });\n          handleClose();\n        }}\n      >\n        <Cloud24Regular className={classes.icon} />\n        <ListItemText\n          primary=\"Data Platform\"\n          secondary=\"Scalable data management platform\"\n          secondaryTypographyProps={{ className: classes.menuText }}\n        />\n      </MenuItem>\n      <Divider />\n      <ListSubheader className={classes.subheader}>Community</ListSubheader>\n      <MenuItem\n        href=\"https://foxglove.dev/slack\"\n        className={classes.menuItem}\n        component=\"a\"\n        target=\"_blank\"\n        onClick={() => {\n          void analytics.logEvent(AppEvent.HELP_MENU_CLICK_CTA, {\n            user: currentUserType,\n            cta: \"join-slack\",\n          });\n          handleClose();\n        }}\n      >\n        <ChatBubblesQuestion24Regular className={classes.icon} />\n        <ListItemText\n          primary=\"Join us on Slack\"\n          secondary=\"Give us feedback, ask questions, and collaborate with other users\"\n          secondaryTypographyProps={{ className: classes.menuText }}\n        />\n      </MenuItem>\n    </Menu>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Divider, IconButton, Tab, Tabs } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    boxSizing: \"content-box\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  anchorRight: {\n    borderLeft: `1px solid ${theme.palette.divider}`,\n  },\n  anchorLeft: {\n    borderRight: `1px solid ${theme.palette.divider}`,\n  },\n  tabs: {\n    minHeight: \"auto\",\n    flex: \"1 1 auto\",\n    overflow: \"hidden\",\n    paddingLeft: theme.spacing(0.25),\n\n    \".MuiTabs-indicator\": {\n      transform: \"scaleX(0.5)\",\n      height: 2,\n    },\n    \".MuiTab-root\": {\n      minHeight: 30,\n      minWidth: theme.spacing(4),\n      padding: theme.spacing(0, 1),\n      color: theme.palette.text.secondary,\n      fontSize: \"0.6875rem\",\n\n      \"&.Mui-selected\": {\n        color: theme.palette.text.primary,\n      },\n    },\n  },\n  iconButton: {\n    padding: theme.spacing(0.91125), // round out the overall height to 30px\n    color: theme.palette.text.secondary,\n    borderRadius: 0,\n\n    \":hover\": {\n      color: theme.palette.text.primary,\n    },\n  },\n  tabContent: {\n    flex: \"auto\",\n    overflow: \"auto\",\n  },\n}));\n\nexport type NewSidebarItem = {\n  title: string;\n  component: React.ComponentType;\n};\n\nfunction Noop(): ReactNull {\n  return ReactNull;\n}\n\nexport function NewSidebar<K extends string>({\n  items,\n  anchor,\n  onClose,\n  activeTab,\n  setActiveTab,\n}: {\n  items: Map<K, NewSidebarItem>;\n  anchor: \"right\" | \"left\";\n  onClose: () => void;\n  activeTab: K | undefined;\n  setActiveTab: (newValue: K) => void;\n}): JSX.Element {\n  const { classes, cx } = useStyles();\n\n  const SelectedComponent = (activeTab != undefined && items.get(activeTab)?.component) || Noop;\n\n  return (\n    <Stack\n      className={cx(classes.root, {\n        [classes.anchorLeft]: anchor === \"left\",\n        [classes.anchorRight]: anchor === \"right\",\n      })}\n      flexShrink={0}\n      overflow=\"hidden\"\n    >\n      <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\">\n        <Tabs\n          className={classes.tabs}\n          textColor=\"inherit\"\n          value={activeTab ?? false}\n          onChange={(_ev, newValue: K) => {\n            if (newValue !== activeTab) {\n              setActiveTab(newValue);\n            }\n          }}\n        >\n          {Array.from(items.entries(), ([key, item]) => (\n            <Tab key={key} label={item.title} value={key} data-testid={`${key}-${anchor}`} />\n          ))}\n        </Tabs>\n\n        <IconButton\n          className={classes.iconButton}\n          onClick={onClose}\n          size=\"small\"\n          data-testid={`sidebar-close-${anchor}`}\n        >\n          <CloseIcon fontSize=\"inherit\" />\n        </IconButton>\n      </Stack>\n      <Divider />\n      {activeTab != undefined && (\n        <div className={classes.tabContent}>\n          <SelectedComponent />\n        </div>\n      )}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * TabSpacer component fills space between <Tab> elements in a <Tabs> component\n *\n * We cannot use a <div> as a child of a Mui <Tabs> component because the <Tabs> component adds mui\n * specific properties to child elements (i.e. fullWidth, etc). This causes react console errors\n * when a <div> is used as a child since the div dom element does not have such properties.\n *\n * This component acts as a stand-in so the Tabs component can add the props and they are ignored.\n */\nexport function TabSpacer(): JSX.Element {\n  return <div style={{ height: \"100%\" }} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport HelpOutlineIcon from \"@mui/icons-material/HelpOutline\";\nimport { Badge, Paper, Tab, Tabs } from \"@mui/material\";\nimport {\n  ComponentProps,\n  MouseEvent,\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { MosaicNode, MosaicWithoutDragDropContext } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { HelpMenu } from \"@foxglove/studio-base/components/AppBar/HelpMenu\";\nimport { BuiltinIcon } from \"@foxglove/studio-base/components/BuiltinIcon\";\nimport ErrorBoundary from \"@foxglove/studio-base/components/ErrorBoundary\";\nimport { MemoryUseIndicator } from \"@foxglove/studio-base/components/MemoryUseIndicator\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nimport { NewSidebar, NewSidebarItem } from \"./NewSidebar\";\nimport { TabSpacer } from \"./TabSpacer\";\n\nfunction Noop(): ReactNull {\n  return ReactNull;\n}\n\ntype LayoutNode = \"leftbar\" | \"children\" | \"rightbar\";\n\nexport type SidebarItem = {\n  iconName: ComponentProps<typeof BuiltinIcon>[\"name\"];\n  title: string;\n  badge?: { count: number };\n  component?: React.ComponentType;\n  url?: string;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  leftNav: {\n    boxSizing: \"content-box\",\n    borderRight: `1px solid ${theme.palette.divider}`,\n    backgroundColor: theme.palette.background.paper,\n  },\n  tabs: {\n    flexGrow: 1,\n\n    \".MuiTabs-flexContainerVertical\": {\n      height: \"100%\",\n    },\n  },\n  tab: {\n    padding: theme.spacing(1.625),\n    minWidth: 50,\n  },\n  badge: {\n    \"> *:not(.MuiBadge-badge)\": {\n      width: \"1.5rem\",\n      height: \"1.5rem\",\n      fontSize: \"1.5rem\",\n      display: \"flex\",\n\n      \".root-span\": {\n        display: \"contents\",\n      },\n      svg: {\n        fontSize: \"inherit\",\n        width: \"auto\",\n        height: \"auto\",\n      },\n    },\n  },\n  mosaicWrapper: {\n    flex: \"1 1 100%\",\n\n    // Root drop targets in this top level sidebar mosaic interfere with drag/mouse events from the\n    // PanelList. We don't allow users to edit the mosaic since it's just used for the sidebar, so we\n    // can hide the drop targets.\n    \"& > .mosaic > .drop-target-container\": {\n      display: \"none !important\",\n    },\n  },\n}));\n\n/**\n * Extract existing left split percentage from a layout node or return the default.\n */\nfunction mosiacLeftSidebarSplitPercentage(node: MosaicNode<LayoutNode>): number | undefined {\n  if (typeof node !== \"object\") {\n    return undefined;\n  }\n  if (node.first === \"leftbar\") {\n    return node.splitPercentage;\n  } else {\n    return (\n      mosiacLeftSidebarSplitPercentage(node.first) ?? mosiacLeftSidebarSplitPercentage(node.second)\n    );\n  }\n}\n\n/**\n * Extract existing right split percentage from a layout node or return the default.\n */\nfunction mosiacRightSidebarSplitPercentage(node: MosaicNode<LayoutNode>): number | undefined {\n  if (typeof node !== \"object\") {\n    return undefined;\n  }\n  if (node.second === \"rightbar\") {\n    return node.splitPercentage;\n  } else {\n    return (\n      mosiacRightSidebarSplitPercentage(node.first) ??\n      mosiacRightSidebarSplitPercentage(node.second)\n    );\n  }\n}\n\ntype SidebarProps<OldLeftKey, LeftKey, RightKey> = PropsWithChildren<{\n  items: Map<OldLeftKey, SidebarItem>;\n  bottomItems: Map<OldLeftKey, SidebarItem>;\n  selectedKey: OldLeftKey | undefined;\n  onSelectKey: (key: OldLeftKey | undefined) => void;\n\n  leftItems: Map<LeftKey, NewSidebarItem>;\n  selectedLeftKey: LeftKey | undefined;\n  onSelectLeftKey: (key: LeftKey | undefined) => void;\n  leftSidebarSize: number | undefined;\n  setLeftSidebarSize: (size: number | undefined) => void;\n\n  rightItems: Map<RightKey, NewSidebarItem>;\n  selectedRightKey: RightKey | undefined;\n  onSelectRightKey: (key: RightKey | undefined) => void;\n  rightSidebarSize: number | undefined;\n  setRightSidebarSize: (size: number | undefined) => void;\n}>;\n\nexport default function Sidebars<\n  OldLeftKey extends string,\n  LeftKey extends string,\n  RightKey extends string,\n>(props: SidebarProps<OldLeftKey, LeftKey, RightKey>): JSX.Element {\n  const {\n    children,\n    items,\n    bottomItems,\n    selectedKey,\n    onSelectKey,\n    leftItems,\n    selectedLeftKey,\n    onSelectLeftKey,\n    leftSidebarSize,\n    setLeftSidebarSize,\n    rightItems,\n    selectedRightKey,\n    onSelectRightKey,\n    rightSidebarSize,\n    setRightSidebarSize,\n  } = props;\n  const [enableMemoryUseIndicator = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_MEMORY_USE_INDICATOR,\n  );\n  // Since we can't toggle the title bar on an electron window, keep the setting at its initial\n  // value until the app is reloaded/relaunched.\n  const [currentEnableNewTopNav = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_NEW_TOPNAV,\n  );\n  const [initialEnableNewTopNav] = useState(currentEnableNewTopNav);\n  const enableNewTopNav = isDesktopApp() ? initialEnableNewTopNav : currentEnableNewTopNav;\n\n  const [mosaicValue, setMosaicValue] = useState<MosaicNode<LayoutNode>>(\"children\");\n  const { classes } = useStyles();\n\n  const allOldLeftItems = useMemo(() => {\n    return new Map([...items, ...bottomItems]);\n  }, [bottomItems, items]);\n\n  const [helpAnchorEl, setHelpAnchorEl] = useState<undefined | HTMLElement>(undefined);\n\n  const helpMenuOpen = Boolean(helpAnchorEl);\n\n  const handleHelpClick = (event: MouseEvent<HTMLElement>) => {\n    setHelpAnchorEl(event.currentTarget);\n  };\n  const handleHelpClose = () => {\n    setHelpAnchorEl(undefined);\n  };\n\n  const oldLeftSidebarOpen = !enableNewTopNav\n    ? selectedKey != undefined && allOldLeftItems.has(selectedKey)\n    : false;\n  const leftSidebarOpen =\n    enableNewTopNav && selectedLeftKey != undefined && leftItems.has(selectedLeftKey);\n  const rightSidebarOpen =\n    enableNewTopNav && selectedRightKey != undefined && rightItems.has(selectedRightKey);\n\n  useEffect(() => {\n    const leftTargetWidth = enableNewTopNav ? 320 : 384;\n    const rightTargetWidth = 320;\n    const defaultLeftPercentage = 100 * (leftTargetWidth / window.innerWidth);\n    const defaultRightPercentage = 100 * (1 - rightTargetWidth / window.innerWidth);\n\n    setMosaicValue((oldValue) => {\n      let node: MosaicNode<LayoutNode> = \"children\";\n      if (rightSidebarOpen) {\n        node = {\n          direction: \"row\",\n          first: node,\n          second: \"rightbar\",\n          splitPercentage:\n            rightSidebarSize ??\n            mosiacRightSidebarSplitPercentage(oldValue) ??\n            defaultRightPercentage,\n        };\n      }\n      if (oldLeftSidebarOpen || leftSidebarOpen) {\n        node = {\n          direction: \"row\",\n          first: \"leftbar\",\n          second: node,\n          splitPercentage:\n            leftSidebarSize ?? mosiacLeftSidebarSplitPercentage(oldValue) ?? defaultLeftPercentage,\n        };\n      }\n      return node;\n    });\n  }, [\n    enableNewTopNav,\n    leftSidebarSize,\n    oldLeftSidebarOpen,\n    rightSidebarSize,\n    leftSidebarOpen,\n    rightSidebarOpen,\n  ]);\n\n  const SelectedLeftComponent =\n    (selectedKey != undefined && allOldLeftItems.get(selectedKey)?.component) || Noop;\n\n  const onClickTabAction = useCallback(\n    (key: OldLeftKey) => {\n      // toggle tab selected/unselected on click\n      if (selectedKey === key) {\n        onSelectKey(undefined);\n      } else {\n        onSelectKey(key);\n      }\n    },\n    [selectedKey, onSelectKey],\n  );\n\n  const topTabs = useMemo(() => {\n    return [...items.entries()].map(([key, item]) => (\n      <Tab\n        data-sidebar-key={key}\n        className={classes.tab}\n        value={key}\n        key={key}\n        title={item.title}\n        onClick={() => onClickTabAction(key)}\n        icon={\n          <Badge\n            className={classes.badge}\n            badgeContent={item.badge?.count}\n            invisible={item.badge == undefined}\n            color=\"error\"\n            anchorOrigin={{\n              vertical: \"bottom\",\n              horizontal: \"right\",\n            }}\n          >\n            <BuiltinIcon name={item.iconName} />\n          </Badge>\n        }\n      />\n    ));\n  }, [classes, items, onClickTabAction]);\n\n  const bottomTabs = useMemo(() => {\n    return [...bottomItems.entries()].map(([key, item]) => (\n      <Tab\n        className={classes.tab}\n        value={key}\n        key={key}\n        title={item.title}\n        onClick={() => onClickTabAction(key)}\n        icon={\n          <Badge\n            className={classes.badge}\n            badgeContent={item.badge?.count}\n            invisible={item.badge == undefined}\n            color=\"error\"\n            anchorOrigin={{\n              vertical: \"bottom\",\n              horizontal: \"right\",\n            }}\n          >\n            <BuiltinIcon name={item.iconName} />\n          </Badge>\n        }\n      />\n    ));\n  }, [bottomItems, classes, onClickTabAction]);\n\n  const onChangeMosaicValue = useCallback(\n    (newValue: ReactNull | MosaicNode<LayoutNode>) => {\n      if (newValue != undefined) {\n        setMosaicValue(newValue);\n        setLeftSidebarSize(mosiacLeftSidebarSplitPercentage(newValue));\n        setRightSidebarSize(mosiacRightSidebarSplitPercentage(newValue));\n      }\n    },\n    [setLeftSidebarSize, setRightSidebarSize],\n  );\n\n  return (\n    <Stack direction=\"row\" fullHeight overflow=\"hidden\">\n      {!enableNewTopNav && (\n        <Stack className={classes.leftNav} flexShrink={0} justifyContent=\"space-between\">\n          <Tabs\n            className={classes.tabs}\n            orientation=\"vertical\"\n            variant=\"scrollable\"\n            value={selectedKey ?? false}\n            scrollButtons={false}\n          >\n            {topTabs}\n            <TabSpacer />\n            {enableMemoryUseIndicator && <MemoryUseIndicator />}\n            <Tab\n              className={classes.tab}\n              color=\"inherit\"\n              id=\"help-button\"\n              aria-label=\"Help menu button\"\n              aria-controls={helpMenuOpen ? \"help-menu\" : undefined}\n              aria-haspopup=\"true\"\n              aria-expanded={helpMenuOpen ? \"true\" : undefined}\n              onClick={(event) => handleHelpClick(event)}\n              icon={<HelpOutlineIcon color={helpMenuOpen ? \"primary\" : \"inherit\"} />}\n            />\n            {bottomTabs}\n          </Tabs>\n          <HelpMenu\n            anchorEl={helpAnchorEl}\n            open={helpMenuOpen}\n            handleClose={handleHelpClose}\n            anchorOrigin={{\n              horizontal: \"right\",\n              vertical: \"bottom\",\n            }}\n            transformOrigin={{\n              vertical: \"bottom\",\n              horizontal: \"left\",\n            }}\n          />\n        </Stack>\n      )}\n      {\n        // By always rendering the mosaic, even if we are only showing children, we can prevent the\n        // children from having to re-mount each time the sidebar is opened/closed.\n      }\n      <div className={classes.mosaicWrapper}>\n        <MosaicWithoutDragDropContext<LayoutNode>\n          className=\"\"\n          value={mosaicValue}\n          onChange={onChangeMosaicValue}\n          renderTile={(id) => {\n            switch (id) {\n              case \"children\":\n                return <ErrorBoundary>{children as JSX.Element}</ErrorBoundary>;\n              case \"leftbar\":\n                return (\n                  <ErrorBoundary>\n                    {enableNewTopNav ? (\n                      <NewSidebar<LeftKey>\n                        anchor=\"left\"\n                        onClose={() => onSelectLeftKey(undefined)}\n                        items={leftItems}\n                        activeTab={selectedLeftKey}\n                        setActiveTab={onSelectLeftKey}\n                      />\n                    ) : (\n                      <Paper square elevation={0}>\n                        <SelectedLeftComponent />\n                      </Paper>\n                    )}\n                  </ErrorBoundary>\n                );\n              case \"rightbar\":\n                return (\n                  <ErrorBoundary>\n                    <NewSidebar<RightKey>\n                      anchor=\"right\"\n                      onClose={() => onSelectRightKey(undefined)}\n                      items={rightItems}\n                      activeTab={selectedRightKey}\n                      setActiveTab={onSelectRightKey}\n                    />\n                  </ErrorBoundary>\n                );\n            }\n          }}\n          resize={{ minimumPaneSizePercentage: 10 }}\n        />\n      </div>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Dialog, IconButton } from \"@mui/material\";\nimport { useState } from \"react\";\n\nimport SigninForm from \"@foxglove/studio-base/components/AccountSettingsSidebar/SigninForm\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nexport function SignInFormModal(): JSX.Element {\n  const [open, setOpen] = useState(true);\n\n  return (\n    <Dialog open={open} onClose={() => setOpen(false)}>\n      <Stack alignItems=\"end\">\n        <IconButton onClick={() => setOpen(false)}>\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <Stack padding={3}>\n        <SigninForm />\n      </Stack>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { extname } from \"path\";\nimport { useMemo } from \"react\";\n\nimport Log, { toLogLevel } from \"@foxglove/log\";\nimport { SettingsTree, SettingsTreeNode, SettingsTreeNodes } from \"@foxglove/studio\";\nimport { useStudioLogsSettings } from \"@foxglove/studio-base/context/StudioLogsSettingsContext\";\n\nconst log = Log.getLogger(__filename);\n\ntype ItemDetail = {\n  type: \"prefix\" | \"channel\";\n  fullPath: string;\n};\n\nfunction useStudioLogsSettingsTree(): SettingsTree {\n  const logsConfig = useStudioLogsSettings();\n\n  return useMemo<SettingsTree>(() => {\n    // When building the settings tree we strip away uninformative parts of the channel name (i.e.\n    // packages, src) to reduce the repetitive noise. However, to enable/disable channels and\n    // prefixes we need to know the original name or prefix. Here we store the stripped path to\n    // original path mapping.\n    const itemDetailByPath = new Map<string, ItemDetail>();\n\n    // Root node of all other settings nodes\n    const settingsRoot: SettingsTreeNodes = {\n      Settings: {\n        label: \"Settings\",\n        fields: {\n          level: {\n            label: \"level\",\n            input: \"select\",\n            value: logsConfig.globalLevel,\n            options: [\n              { label: \"error\", value: \"error\" },\n              { label: \"warn\", value: \"warn\" },\n              { label: \"info\", value: \"info\" },\n              { label: \"debug\", value: \"debug\" },\n            ],\n          },\n        },\n      },\n    };\n\n    // Channels are split into two buckets - \"packages\" and \"misc\". This is the root for \"misc\"\n    // channels.\n    const miscRoot: SettingsTreeNode = {\n      label: \"Misc\",\n      defaultExpansionState: \"expanded\",\n      children: {},\n    };\n\n    for (const channel of logsConfig.channels) {\n      const channelName = channel.name;\n\n      const parts = channelName.split(\"/\");\n\n      // Studio code may live in a `studio` workspace, and we'll still want the tree to work the same\n      const studioSpacePrefix = /^(studio\\/)/.test(channelName) ? `${parts.shift()}/` : \"\";\n\n      const [type, pkgName, srcPath, component, ...rest] = parts;\n\n      // misc entry\n      if (type !== \"packages\") {\n        miscRoot.children![channelName] = {\n          label: channelName,\n          visible: channel.enabled,\n        };\n\n        itemDetailByPath.set(`misc/${channelName}`, {\n          type: \"channel\",\n          fullPath: channel.name,\n        });\n        continue;\n      }\n\n      if (!pkgName) {\n        continue;\n      }\n\n      // The package doesn't keep src files in `src`, drop into the misc items section\n      if (srcPath !== \"src\" || !component) {\n        miscRoot.children![channel.name] = {\n          label: channel.name,\n          visible: channel.enabled,\n        };\n\n        itemDetailByPath.set(`misc/${channelName}`, {\n          type: \"channel\",\n          fullPath: channel.name,\n        });\n        continue;\n      }\n\n      // Setup the package name node\n      const pkgNode = (settingsRoot[pkgName] ??= {\n        label: pkgName,\n        visible: false,\n        children: {},\n      });\n\n      itemDetailByPath.set(pkgName, {\n        type: \"prefix\",\n        fullPath: `${studioSpacePrefix}packages/${pkgName}`,\n      });\n\n      const componentNode = (pkgNode.children![component] ??= {\n        label: component,\n        visible: false,\n      });\n\n      if (channel.enabled) {\n        pkgNode.visible = true;\n        componentNode.visible = true;\n      }\n\n      // The component has a file extension, no subtree is added under the component\n      if (extname(component)) {\n        itemDetailByPath.set(`${pkgName}/${component}`, {\n          type: \"channel\",\n          fullPath: `${studioSpacePrefix}packages/${pkgName}/src/${component}`,\n        });\n        continue;\n      }\n\n      itemDetailByPath.set(`${pkgName}/${component}`, {\n        type: \"prefix\",\n        fullPath: `${studioSpacePrefix}packages/${pkgName}/src/${component}`,\n      });\n\n      // If there are items under the component, add a children entry and add them to the children entry\n      if (rest.length > 0) {\n        // Component node is not a file so it might have children under it\n        componentNode.children ??= {};\n\n        const leafId = rest.join(\"/\");\n        componentNode.children[leafId] = {\n          label: leafId,\n          visible: channel.enabled,\n        };\n\n        itemDetailByPath.set(`${pkgName}/${component}/${leafId}`, {\n          type: \"channel\",\n          fullPath: `${studioSpacePrefix}packages/${pkgName}/src/${component}/${leafId}`,\n        });\n      }\n    }\n\n    // Add misc nodes at the end of root\n    settingsRoot[\"misc\"] = miscRoot;\n\n    return {\n      enableFilter: true,\n      actionHandler: (action) => {\n        log.debug(\"action\", action);\n\n        if (action.action === \"update\" && action.payload.path.join(\".\") === \"Settings.level\") {\n          if (typeof action.payload.value !== \"string\") {\n            return;\n          }\n          logsConfig.setGlobalLevel(toLogLevel(action.payload.value));\n          return;\n        }\n\n        // visibility toggle sends and update as if it was a boolean input\n        if (action.action !== \"update\" || action.payload.input !== \"boolean\") {\n          return;\n        }\n\n        // When using settings visibility toggle the last item of the path is the word \"visible\"\n        // Since that's our only action we ignore any other type of path\n        const path = action.payload.path;\n        const lastPathItem = path[path.length - 1];\n        if (lastPathItem !== \"visible\") {\n          return;\n        }\n\n        const enable = action.payload.value === true;\n\n        const remain = path.slice(0, path.length - 1);\n        const pathStr = remain.join(\"/\");\n\n        const item = itemDetailByPath.get(pathStr);\n        switch (item?.type) {\n          case \"prefix\":\n            if (enable) {\n              logsConfig.enablePrefix(item.fullPath);\n            } else {\n              logsConfig.disablePrefix(item.fullPath);\n            }\n            break;\n          case \"channel\":\n            if (enable) {\n              logsConfig.enableChannel(item.fullPath);\n            } else {\n              logsConfig.disableChannel(item.fullPath);\n            }\n            break;\n          default:\n            // no-op for undefined\n            break;\n        }\n      },\n      nodes: settingsRoot,\n    };\n  }, [logsConfig]);\n}\n\nexport { useStudioLogsSettingsTree };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport SettingsTreeEditor from \"@foxglove/studio-base/components/SettingsTreeEditor\";\nimport { SidebarContent } from \"@foxglove/studio-base/components/SidebarContent\";\n\nimport { useStudioLogsSettingsTree } from \"./useStudioLogsSettingsTree\";\n\nexport function StudioLogsSettings(): JSX.Element {\n  const logSettings = useStudioLogsSettingsTree();\n\n  return <SettingsTreeEditor settings={logSettings} />;\n}\n\nexport function StudioLogsSettingsSidebar(): JSX.Element {\n  return (\n    <SidebarContent overflow=\"auto\" title=\"Studio Logs Settings\" disablePadding>\n      <StudioLogsSettings />\n    </SidebarContent>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEmpty, omitBy } from \"lodash\";\n\nimport { fromRFC3339String, toRFC3339String, Time } from \"@foxglove/rostime\";\nimport { LayoutID } from \"@foxglove/studio-base/index\";\n\nexport type AppURLState = {\n  ds?: string;\n  dsParams?: Record<string, string>;\n  layoutId?: LayoutID;\n  time?: Time;\n};\n\n/**\n * Encodes app state in a URL's query params.\n *\n * @param url The base URL to encode params into.\n * @param urlState The player state to encode.\n * @returns A url with all app state stored as query pararms.\n */\nexport function updateAppURLState(url: URL, urlState: AppURLState): URL {\n  const newURL = new URL(url.href);\n\n  if (\"layoutId\" in urlState) {\n    if (urlState.layoutId) {\n      newURL.searchParams.set(\"layoutId\", urlState.layoutId);\n    } else {\n      newURL.searchParams.delete(\"layoutId\");\n    }\n  }\n\n  if (\"time\" in urlState) {\n    if (urlState.time) {\n      newURL.searchParams.set(\"time\", toRFC3339String(urlState.time));\n    } else {\n      newURL.searchParams.delete(\"time\");\n    }\n  }\n\n  if (\"ds\" in urlState) {\n    if (urlState.ds) {\n      newURL.searchParams.set(\"ds\", urlState.ds);\n    } else {\n      newURL.searchParams.delete(\"ds\");\n    }\n  }\n\n  if (\"dsParams\" in urlState) {\n    [...newURL.searchParams].forEach(([k, _]) => {\n      if (k.startsWith(\"ds.\")) {\n        newURL.searchParams.delete(k);\n      }\n    });\n\n    Object.entries(urlState.dsParams ?? \"\").forEach(([k, v]) => {\n      newURL.searchParams.set(\"ds.\" + k, v);\n    });\n  }\n\n  newURL.searchParams.sort();\n\n  return newURL;\n}\n\n/**\n * Tries to parse a state url into one of the types we know how to open.\n *\n * @param url URL to try to parse.\n * @returns Parsed URL type or undefined if the url is not a valid URL.\n * @throws Error if URL parsing fails.\n */\nexport function parseAppURLState(url: URL): AppURLState | undefined {\n  const ds = url.searchParams.get(\"ds\") ?? undefined;\n  const layoutId = url.searchParams.get(\"layoutId\");\n  const timeString = url.searchParams.get(\"time\");\n  const time = timeString == undefined ? undefined : fromRFC3339String(timeString);\n  const dsParams: Record<string, string> = {};\n  url.searchParams.forEach((v, k) => {\n    if (k && v && k.startsWith(\"ds.\")) {\n      const cleanKey = k.replace(/^ds./, \"\");\n      dsParams[cleanKey] = v;\n    }\n  });\n\n  const state: AppURLState = omitBy(\n    {\n      layoutId: layoutId ? (layoutId as LayoutID) : undefined,\n      time,\n      ds,\n      dsParams: isEmpty(dsParams) ? undefined : dsParams,\n    },\n    isEmpty,\n  );\n\n  return isEmpty(state) ? undefined : state;\n}\n\n/**\n * Tries to parse app url state from the window's current location.\n */\nexport function windowAppURLState(): AppURLState | undefined {\n  if (typeof window === \"undefined\") {\n    return undefined;\n  }\n\n  try {\n    return parseAppURLState(new URL(window.location.href));\n  } catch {\n    return undefined;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isString, pickBy } from \"lodash\";\nimport { useEffect } from \"react\";\nimport { useDebounce } from \"use-debounce\";\n\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport {\n  LayoutState,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport useDeepMemo from \"@foxglove/studio-base/hooks/useDeepMemo\";\nimport { PlayerCapabilities } from \"@foxglove/studio-base/players/types\";\nimport { AppURLState, updateAppURLState } from \"@foxglove/studio-base/util/appURLState\";\n\nconst selectCanSeek = (ctx: MessagePipelineContext) =>\n  ctx.playerState.capabilities.includes(PlayerCapabilities.playbackControl);\nconst selectCurrentTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.currentTime;\nconst selectUrlState = (ctx: MessagePipelineContext) => ctx.playerState.urlState;\nconst selectLayoutId = (layoutState: LayoutState) => layoutState.selectedLayout?.id;\nconst selectSelectedEventId = (store: EventsStore) => store.selectedEventId;\n\nfunction updateUrl(newState: AppURLState) {\n  const newStateUrl = updateAppURLState(new URL(window.location.href), newState);\n  window.history.replaceState(undefined, \"\", newStateUrl.href);\n}\n\n/**\n * Syncs our current player, layout and other state with the URL in the address bar.\n */\nexport function useStateToURLSynchronization(): void {\n  const playerUrlState = useMessagePipeline(selectUrlState);\n  const stablePlayerUrlState = useDeepMemo(playerUrlState);\n  const canSeek = useMessagePipeline(selectCanSeek);\n  const currentTime = useMessagePipeline(selectCurrentTime);\n  const layoutId = useCurrentLayoutSelector(selectLayoutId);\n  const [debouncedCurrentTime] = useDebounce(currentTime, 500, { maxWait: 500 });\n  const selectedEventId = useEvents(selectSelectedEventId);\n\n  // Sync current time with the url.\n  useEffect(() => {\n    updateUrl({\n      time: canSeek ? debouncedCurrentTime : undefined,\n    });\n  }, [canSeek, debouncedCurrentTime]);\n\n  // Sync layoutId with the url.\n  useEffect(() => {\n    if (layoutId == undefined) {\n      return;\n    }\n\n    updateUrl({ layoutId });\n  }, [layoutId]);\n\n  // Sync player state with the url.\n  useEffect(() => {\n    if (stablePlayerUrlState == undefined) {\n      return;\n    }\n\n    updateUrl({\n      ds: stablePlayerUrlState.sourceId,\n      dsParams: pickBy(\n        {\n          ...stablePlayerUrlState.parameters,\n          eventId: selectedEventId,\n        },\n        isString,\n      ),\n    });\n  }, [selectedEventId, stablePlayerUrlState]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useStateToURLSynchronization } from \"@foxglove/studio-base/hooks/useStateToURLSynchronization\";\n\n// This is in a simple subcomponent so it doesn't trigger rerenders of an entire expensive\n// component like Workspace while it's listening for time values.\nexport function URLStateSyncAdapter(): ReactNull {\n  useStateToURLSynchronization();\n\n  return ReactNull;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { URLStateSyncAdapter } from \"@foxglove/studio-base/components/URLStateSyncAdapter\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\n\nexport function SyncAdapters(): JSX.Element {\n  const { syncAdapters = [] } = useAppContext();\n  return (\n    <>\n      {...syncAdapters}\n      <URLStateSyncAdapter />\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDropDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport {\n  Divider,\n  IconButton,\n  Menu,\n  MenuItem,\n  ListItem,\n  ListItemButton,\n  ListItemButtonProps,\n  ListItemText,\n  Typography,\n  Tooltip,\n  InputBase,\n} from \"@mui/material\";\nimport { pick } from \"lodash\";\nimport { useMemo, useCallback, useState, useRef } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { VariableValue } from \"@foxglove/studio\";\nimport CopyButton from \"@foxglove/studio-base/components/CopyButton\";\nimport JsonInput from \"@foxglove/studio-base/components/JsonInput\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport useGlobalVariables, {\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst useStyles = makeStyles<void, \"copyButton\">()((theme, _params, classes) => ({\n  root: {\n    \"@media (pointer: fine)\": {\n      [`&:not(:hover) .${classes.copyButton}`]: {\n        visibility: \"hidden\",\n      },\n    },\n  },\n  copyButton: {\n    top: 0,\n    right: 0,\n    zIndex: theme.zIndex.mobileStepper,\n\n    \"&.MuiButton-root\": {\n      position: \"absolute\",\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n      margin: theme.spacing(0.75),\n      minWidth: \"auto\",\n    },\n  },\n  input: {\n    font: \"inherit\",\n    flex: \"auto\",\n\n    \".MuiInputBase-input\": {\n      padding: 0,\n    },\n    \"&.Mui-error\": {\n      color: theme.palette.error.main,\n    },\n  },\n  edgeEnd: {\n    marginRight: theme.spacing(-1.625),\n  },\n  editorWrapper: {\n    position: \"relative\",\n    backgroundColor: theme.palette.grey[50],\n  },\n  listItemButton: {\n    \"&:focus-within\": {\n      backgroundColor: \"transparent\",\n    },\n    \"&.Mui-selected\": {\n      color: theme.palette.primary.main,\n      transition: `background-color 300ms ease-in-out`,\n    },\n  },\n  listItemText: {\n    marginTop: theme.spacing(0.125),\n    marginBottom: theme.spacing(0.125),\n  },\n}));\n\nconst changeGlobalKey = (\n  newKey: string,\n  oldKey: string,\n  globalVariables: GlobalVariables,\n  idx: number,\n  overwriteGlobalVariables: (_: GlobalVariables) => void,\n) => {\n  const keys = Object.keys(globalVariables);\n  overwriteGlobalVariables({\n    ...pick(globalVariables, keys.slice(0, idx)),\n    [newKey]: globalVariables[oldKey],\n    ...pick(globalVariables, keys.slice(idx + 1)),\n  });\n};\n\nexport default function Variable(props: {\n  name: string;\n  selected?: ListItemButtonProps[\"selected\"];\n  index: number;\n}): JSX.Element {\n  const { name, selected = false, index } = props;\n\n  const { classes } = useStyles();\n\n  // When editing the variable name, the new name might collide with an existing variable name\n  // If the name matches an existing name, we set the edited name and show an error to the user\n  // indicating there is a name conflict. The user must resolve the name conflict or their edited\n  // name will be reset on blur.\n  const [editedName, setEditedName] = useState<string | undefined>();\n\n  const [expanded, setExpanded] = useState<boolean>(true);\n  const [anchorEl, setAnchorEl] = React.useState<undefined | HTMLElement>(undefined);\n  const [copied, setCopied] = useState(false);\n  const menuOpen = Boolean(anchorEl);\n\n  const { globalVariables, setGlobalVariables, overwriteGlobalVariables } = useGlobalVariables();\n\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  const analytics = useAnalytics();\n\n  const deleteVariable = useCallback(() => {\n    setGlobalVariables({ [name]: undefined });\n    void analytics.logEvent(AppEvent.VARIABLE_DELETE);\n    handleClose();\n  }, [analytics, name, setGlobalVariables]);\n\n  const value = useMemo(() => globalVariables[name], [globalVariables, name]);\n\n  const onChangeValue = useCallback(\n    (newVal: unknown) => {\n      setGlobalVariables({ [name]: newVal as VariableValue });\n      setCopied(false);\n    },\n    [name, setGlobalVariables],\n  );\n\n  const onBlur = () => {\n    if (\n      editedName != undefined &&\n      globalVariables[editedName] == undefined &&\n      name !== editedName\n    ) {\n      changeGlobalKey(editedName, name, globalVariables, index, overwriteGlobalVariables);\n    }\n    setEditedName(undefined);\n  };\n\n  const rootRef = useRef<HTMLDivElement>(ReactNull);\n\n  const activeElementIsChild = rootRef.current?.contains(document.activeElement) === true;\n\n  const isSelected = selected && !activeElementIsChild;\n  const isDuplicate =\n    editedName != undefined && editedName !== name && globalVariables[editedName] != undefined;\n\n  const getText = useCallback(() => JSON.stringify(value, undefined, 2) ?? \"\", [value]);\n\n  return (\n    <Stack className={classes.root} ref={rootRef}>\n      <ListItem\n        dense\n        disablePadding\n        secondaryAction={\n          <Stack className={classes.edgeEnd} direction=\"row\" alignItems=\"center\" gap={0.25}>\n            <IconButton\n              size=\"small\"\n              id=\"variable-action-button\"\n              data-testid=\"variable-action-button\"\n              aria-controls={expanded ? \"variable-action-menu\" : undefined}\n              aria-haspopup=\"true\"\n              aria-expanded={expanded ? \"true\" : undefined}\n              onClick={handleClick}\n            >\n              <MoreVertIcon fontSize=\"small\" />\n            </IconButton>\n            <Menu\n              id=\"variable-action-menu\"\n              anchorEl={anchorEl}\n              open={menuOpen}\n              onClose={handleClose}\n              MenuListProps={{\n                \"aria-labelledby\": \"variable-action-button\",\n                dense: true,\n              }}\n            >\n              <MenuItem onClick={deleteVariable}>\n                <Typography color=\"error.main\" variant=\"inherit\">\n                  Delete variable\n                </Typography>\n              </MenuItem>\n            </Menu>\n          </Stack>\n        }\n      >\n        <ListItemButton\n          className={classes.listItemButton}\n          selected={isSelected}\n          onClick={() => setExpanded(!expanded)}\n        >\n          <ListItemText\n            className={classes.listItemText}\n            primary={\n              <Stack direction=\"row\" alignItems=\"center\" style={{ marginLeft: -12 }}>\n                <ArrowDropDownIcon\n                  style={{ transform: !expanded ? \"rotate(-90deg)\" : undefined }}\n                />\n                <InputBase\n                  className={classes.input}\n                  autoFocus={name === \"\"}\n                  error={isDuplicate}\n                  value={editedName ?? name}\n                  placeholder=\"variable_name\"\n                  data-testid={`global-variable-key-input-${name}`}\n                  onClick={(e) => e.stopPropagation()}\n                  onFocus={() => editedName === \"\" && setExpanded(true)}\n                  onChange={(event) => setEditedName(event.target.value)}\n                  onBlur={onBlur}\n                  endAdornment={\n                    isDuplicate && (\n                      <Tooltip\n                        arrow\n                        title=\"A variable with this name already exists. Please select a unique variable name to save changes.\"\n                      >\n                        <ErrorIcon className={classes.edgeEnd} fontSize=\"small\" color=\"error\" />\n                      </Tooltip>\n                    )\n                  }\n                />\n              </Stack>\n            }\n            primaryTypographyProps={{\n              component: \"div\",\n              fontWeight: 600,\n              variant: \"body2\",\n            }}\n          />\n        </ListItemButton>\n      </ListItem>\n      {expanded && (\n        <div className={classes.editorWrapper}>\n          <Divider />\n          <CopyButton\n            className={classes.copyButton}\n            size=\"small\"\n            color={copied ? \"primary\" : \"inherit\"}\n            getText={getText}\n          >\n            {copied ? \"Copied\" : \"Copy\"}\n          </CopyButton>\n          <JsonInput value={value} onChange={onChangeValue} />\n        </div>\n      )}\n      <Divider />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button } from \"@mui/material\";\nimport { union } from \"lodash\";\nimport { useMemo, useRef, useState, ReactElement, useEffect } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport useGlobalVariables, {\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport Variable from \"./Variable\";\n\nconst ANIMATION_RESET_DELAY_MS = 1500;\n\nexport default function VariablesList(): ReactElement {\n  const { globalVariables, setGlobalVariables } = useGlobalVariables();\n  const globalVariableNames = useMemo(() => Object.keys(globalVariables), [globalVariables]);\n\n  // Don't run the animation when the sidebar first renders\n  const skipAnimation = useRef<boolean>(true);\n\n  const analytics = useAnalytics();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => (skipAnimation.current = false), ANIMATION_RESET_DELAY_MS);\n    return () => clearTimeout(timeoutId);\n  }, []);\n\n  const previousGlobalVariablesRef = useRef<GlobalVariables | undefined>(globalVariables);\n  const [changedVariables, setChangedVariables] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (skipAnimation.current) {\n      previousGlobalVariablesRef.current = globalVariables;\n      return;\n    }\n    const newChangedVariables = union(\n      Object.keys(globalVariables),\n      Object.keys(previousGlobalVariablesRef.current ?? {}),\n    ).filter((name) => {\n      const previousValue = previousGlobalVariablesRef.current?.[name];\n      return previousValue !== globalVariables[name];\n    });\n\n    setChangedVariables(newChangedVariables);\n    previousGlobalVariablesRef.current = globalVariables;\n    const timerId = setTimeout(() => setChangedVariables([]), ANIMATION_RESET_DELAY_MS);\n    return () => clearTimeout(timerId);\n  }, [globalVariables, skipAnimation]);\n\n  return (\n    <Stack flex=\"auto\" fullWidth overflowX=\"auto\">\n      {globalVariableNames.map((name, idx) => (\n        <Variable\n          key={name}\n          name={name}\n          selected={!skipAnimation.current && changedVariables.includes(name)}\n          index={idx}\n        />\n      ))}\n      <Stack direction=\"row\" padding={1}>\n        <Button\n          color=\"inherit\"\n          fullWidth\n          data-testid=\"add-variable-button\"\n          variant=\"contained\"\n          key=\"add-global-variable\"\n          disabled={globalVariables[\"\"] != undefined}\n          onClick={() => {\n            setGlobalVariables({ \"\": '\"\"' });\n            void analytics.logEvent(AppEvent.VARIABLE_ADD);\n          }}\n        >\n          Add variable\n        </Button>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport type { OsContext } from \"@foxglove/studio-base/OsContext\";\n\ntype GlobalWithCtx = typeof global & {\n  ctxbridge?: OsContext;\n};\n\n/** Global singleton of the OsContext provided by the bridge */\nconst OsContextSingleton = (global as GlobalWithCtx).ctxbridge;\nexport default OsContextSingleton;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Checkbox, FormControlLabel, Typography } from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nconst useStyles = makeStyles()({\n  checkbox: {\n    \"&.MuiCheckbox-root\": {\n      paddingTop: 0,\n    },\n  },\n  formControlLabel: {\n    \"&.MuiFormControlLabel-root\": {\n      alignItems: \"start\",\n    },\n  },\n});\n\ntype Feature = {\n  key: AppSetting;\n  name: string;\n  description: JSX.Element;\n};\n\nfunction useFeatures(): Feature[] {\n  const { t } = useTranslation(\"preferences\");\n\n  const features: Feature[] = [\n    {\n      key: AppSetting.SHOW_DEBUG_PANELS,\n      name: t(\"studioDebugPanels\"),\n      description: <>{t(\"studioDebugPanelsDescription\")}</>,\n    },\n    {\n      key: AppSetting.ENABLE_LEGACY_PLOT_PANEL,\n      name: t(\"legacyPlotPanel\"),\n      description: <>{t(\"legacyPlotPanelDescription\")}</>,\n    },\n    {\n      key: AppSetting.ENABLE_MEMORY_USE_INDICATOR,\n      name: t(\"memoryUseIndicator\"),\n      description: <>{t(\"memoryUseIndicatorDescription\")}</>,\n    },\n    {\n      key: AppSetting.ENABLE_NEW_TOPNAV,\n      name: t(\"newNavigation\"),\n      description: (\n        <>\n          {t(\"newNavigationDescription\")}\n          {isDesktopApp() && t(\"restartTheAppForChangesToTakeEffect\")}\n        </>\n      ),\n    },\n    {\n      key: AppSetting.ENABLE_NEW_IMAGE_PANEL,\n      name: t(\"newImagePanel\"),\n      description: <>{t(\"newImagePanelDescription\")}</>,\n    },\n  ];\n\n  if (isDesktopApp()) {\n    features.push({\n      key: AppSetting.ENABLE_ROS2_NATIVE_DATA_SOURCE,\n      name: t(\"ros2NativeConnection\"),\n      description: (\n        <>\n          {t(\"ros2NativeConnectionDescription\")} {t(\"restartTheAppForChangesToTakeEffect\")}\n        </>\n      ),\n    });\n  }\n\n  if (process.env.NODE_ENV === \"development\") {\n    features.push({\n      key: AppSetting.ENABLE_LAYOUT_DEBUGGING,\n      name: t(\"layoutDebugging\"),\n      description: <>{t(\"layoutDebuggingDescription\")}</>,\n    });\n  }\n\n  return features;\n}\n\nfunction ExperimentalFeatureItem(props: { feature: Feature }) {\n  const { feature } = props;\n  const { classes } = useStyles();\n  const analytics = useAnalytics();\n\n  const [enabled, setEnabled] = useAppConfigurationValue<boolean>(feature.key);\n  return (\n    <FormControlLabel\n      className={classes.formControlLabel}\n      control={\n        <Checkbox\n          className={classes.checkbox}\n          checked={enabled ?? false}\n          onChange={(_, checked) => {\n            void setEnabled(checked);\n            void analytics.logEvent(AppEvent.EXPERIMENTAL_FEATURE_TOGGLE, {\n              feature: feature.key,\n              checked,\n            });\n          }}\n        />\n      }\n      label={\n        <Stack gap={0.25} paddingLeft={0.5}>\n          <Typography fontWeight={600}>{feature.name}</Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            {feature.description}\n          </Typography>\n        </Stack>\n      }\n    />\n  );\n}\n\nexport const ExperimentalFeatureSettings = (): React.ReactElement => {\n  const features = useFeatures();\n  const { t } = useTranslation(\"preferences\");\n  return (\n    <Stack gap={2}>\n      {features.length === 0 && (\n        <Typography fontStyle=\"italic\">{t(\"noExperimentalFeatures\")}</Typography>\n      )}\n      {features.map((feature) => (\n        <ExperimentalFeatureItem key={feature.key} feature={feature} />\n      ))}\n    </Stack>\n  );\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/** Whether links should open in the web app or desktop app */\nexport enum LaunchPreferenceValue {\n  ASK = \"ask\",\n  WEB = \"web\",\n  DESKTOP = \"desktop\",\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Brightness5Icon from \"@mui/icons-material/Brightness5\";\nimport ComputerIcon from \"@mui/icons-material/Computer\";\nimport DarkModeIcon from \"@mui/icons-material/DarkMode\";\nimport QuestionAnswerOutlinedIcon from \"@mui/icons-material/QuestionAnswerOutlined\";\nimport WebIcon from \"@mui/icons-material/Web\";\nimport {\n  Autocomplete,\n  Checkbox,\n  Divider,\n  FormControl,\n  FormControlLabel,\n  FormLabel,\n  MenuItem,\n  Select,\n  SelectChangeEvent,\n  TextField,\n  ToggleButton,\n  ToggleButtonGroup,\n  ToggleButtonGroupProps,\n  Typography,\n} from \"@mui/material\";\nimport moment from \"moment-timezone\";\nimport { MouseEvent, useCallback, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { Language } from \"@foxglove/studio-base/i18n\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\nimport { formatTime } from \"@foxglove/studio-base/util/formatTime\";\nimport { formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\nconst MESSAGE_RATES = [1, 3, 5, 10, 15, 20, 30, 60];\nconst LANGUAGE_OPTIONS: { key: Language; value: string }[] = [\n  { key: \"en\", value: \"English\" },\n  { key: \"zh\", value: \"中文\" },\n];\n\nconst useStyles = makeStyles()((theme) => ({\n  autocompleteInput: {\n    \"&.MuiOutlinedInput-input\": {\n      padding: 0,\n    },\n  },\n  checkbox: {\n    \"&.MuiCheckbox-root\": {\n      paddingTop: 0,\n    },\n  },\n  formControlLabel: {\n    \"&.MuiFormControlLabel-root\": {\n      alignItems: \"start\",\n    },\n  },\n  toggleButton: {\n    display: \"flex !important\",\n    flexDirection: \"column\",\n    gap: theme.spacing(0.75),\n    lineHeight: \"1 !important\",\n  },\n}));\n\nfunction formatTimezone(name: string) {\n  const tz = moment.tz(name);\n  const zoneAbbr = tz.zoneAbbr();\n  const offset = tz.utcOffset();\n  const offsetStr =\n    (offset >= 0 ? \"+\" : \"\") + moment.duration(offset, \"minutes\").format(\"hh:mm\", { trim: false });\n  if (name === zoneAbbr) {\n    return `${zoneAbbr} (${offsetStr})`;\n  }\n  return `${name} (${zoneAbbr}, ${offsetStr})`;\n}\n\nexport function ColorSchemeSettings(): JSX.Element {\n  const { classes } = useStyles();\n  const [colorScheme = \"system\", setColorScheme] = useAppConfigurationValue<string>(\n    AppSetting.COLOR_SCHEME,\n  );\n  const { t } = useTranslation(\"preferences\");\n\n  const handleChange = useCallback(\n    (_event: MouseEvent<HTMLElement>, value?: string) => {\n      if (value != undefined) {\n        void setColorScheme(value);\n      }\n    },\n    [setColorScheme],\n  );\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"colorScheme\")}:</FormLabel>\n      <ToggleButtonGroup\n        color=\"primary\"\n        size=\"small\"\n        fullWidth\n        exclusive\n        value={colorScheme}\n        onChange={handleChange}\n      >\n        <ToggleButton className={classes.toggleButton} value=\"dark\">\n          <DarkModeIcon /> {t(\"dark\")}\n        </ToggleButton>\n        <ToggleButton className={classes.toggleButton} value=\"light\">\n          <Brightness5Icon /> {t(\"light\")}\n        </ToggleButton>\n        <ToggleButton className={classes.toggleButton} value=\"system\">\n          <ComputerIcon /> {t(\"followSystem\")}\n        </ToggleButton>\n      </ToggleButtonGroup>\n    </Stack>\n  );\n}\n\nexport function TimezoneSettings(): React.ReactElement {\n  type Option = { key: string; label: string; data?: string; divider?: boolean };\n\n  const { classes } = useStyles();\n\n  const { t } = useTranslation(\"preferences\");\n  const [timezone, setTimezone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n  const detectItem: Option = useMemo(\n    () => ({\n      key: \"detect\",\n      label: `Detect from system: ${formatTimezone(moment.tz.guess())}`,\n      data: undefined,\n    }),\n    [],\n  );\n  const fixedItems: Option[] = useMemo(\n    () => [\n      detectItem,\n      { key: \"zone:UTC\", label: `${formatTimezone(\"UTC\")}`, data: \"UTC\" },\n      {\n        key: \"sep\",\n        label: \"\",\n        divider: true,\n      },\n    ],\n    [detectItem],\n  );\n\n  const timezoneItems: Option[] = useMemo(\n    () =>\n      filterMap(moment.tz.names(), (name) => {\n        // UTC is always hoisted to the top in fixedItems\n        if (name === \"UTC\") {\n          return undefined;\n        }\n        return { key: `zone:${name}`, label: formatTimezone(name), data: name };\n      }),\n    [],\n  );\n\n  const allItems = useMemo(() => [...fixedItems, ...timezoneItems], [fixedItems, timezoneItems]);\n\n  const selectedItem = useMemo(\n    () => (timezone != undefined && allItems.find((item) => item.data === timezone)) || detectItem,\n    [allItems, detectItem, timezone],\n  );\n\n  return (\n    <FormControl fullWidth>\n      <Typography color=\"text.secondary\" marginBottom={0.5}>\n        {t(\"displayTimestampsIn\")}:\n      </Typography>\n      <Autocomplete\n        options={[...fixedItems, ...timezoneItems]}\n        value={selectedItem}\n        renderOption={(props, option: Option) =>\n          option.divider === true ? (\n            <Divider key={option.key} />\n          ) : (\n            <li {...props} key={option.key}>\n              {option.label}\n            </li>\n          )\n        }\n        renderInput={(params) => (\n          <TextField\n            {...params}\n            inputProps={{ ...params.inputProps, className: classes.autocompleteInput }}\n          />\n        )}\n        onChange={(_event, value) => void setTimezone(value?.data)}\n      />\n    </FormControl>\n  );\n}\n\nexport function TimeFormat({\n  orientation = \"vertical\",\n}: {\n  orientation?: ToggleButtonGroupProps[\"orientation\"];\n}): React.ReactElement {\n  const { timeFormat, setTimeFormat } = useAppTimeFormat();\n\n  const { t } = useTranslation(\"preferences\");\n\n  const [timezone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n\n  const exampleTime = { sec: 946713600, nsec: 0 };\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"timestampFormat\")}:</FormLabel>\n      <ToggleButtonGroup\n        color=\"primary\"\n        size=\"small\"\n        orientation={orientation}\n        fullWidth\n        exclusive\n        value={timeFormat}\n        onChange={(_, value?: TimeDisplayMethod) => value != undefined && void setTimeFormat(value)}\n      >\n        <ToggleButton value=\"SEC\" data-testid=\"timeformat-seconds\">\n          {formatTimeRaw(exampleTime)}\n        </ToggleButton>\n        <ToggleButton value=\"TOD\" data-testid=\"timeformat-local\">\n          {formatTime(exampleTime, timezone)}\n        </ToggleButton>\n      </ToggleButtonGroup>\n    </Stack>\n  );\n}\n\nexport function LaunchDefault(): React.ReactElement {\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"preferences\");\n  const [preference, setPreference] = useAppConfigurationValue<string | undefined>(\n    AppSetting.LAUNCH_PREFERENCE,\n  );\n  let sanitizedPreference: LaunchPreferenceValue;\n  switch (preference) {\n    case LaunchPreferenceValue.WEB:\n    case LaunchPreferenceValue.DESKTOP:\n    case LaunchPreferenceValue.ASK:\n      sanitizedPreference = preference;\n      break;\n    default:\n      sanitizedPreference = LaunchPreferenceValue.WEB;\n  }\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"openLinksIn\")}:</FormLabel>\n      <ToggleButtonGroup\n        color=\"primary\"\n        size=\"small\"\n        fullWidth\n        exclusive\n        value={sanitizedPreference}\n        onChange={(_, value?: string) => value != undefined && void setPreference(value)}\n      >\n        <ToggleButton value={LaunchPreferenceValue.WEB} className={classes.toggleButton}>\n          <WebIcon /> {t(\"webApp\")}\n        </ToggleButton>\n        <ToggleButton value={LaunchPreferenceValue.DESKTOP} className={classes.toggleButton}>\n          <ComputerIcon /> {t(\"desktopApp\")}\n        </ToggleButton>\n        <ToggleButton value={LaunchPreferenceValue.ASK} className={classes.toggleButton}>\n          <QuestionAnswerOutlinedIcon /> {t(\"askEachTime\")}\n        </ToggleButton>\n      </ToggleButtonGroup>\n    </Stack>\n  );\n}\n\nexport function MessageFramerate(): React.ReactElement {\n  const { t } = useTranslation(\"preferences\");\n  const [messageRate, setMessageRate] = useAppConfigurationValue<number>(AppSetting.MESSAGE_RATE);\n  const options = useMemo(\n    () => MESSAGE_RATES.map((rate) => ({ key: rate, text: `${rate}`, data: rate })),\n    [],\n  );\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"messageRate\")} (Hz):</FormLabel>\n      <Select\n        value={messageRate ?? 60}\n        fullWidth\n        onChange={(event) => void setMessageRate(event.target.value as number)}\n      >\n        {options.map((option) => (\n          <MenuItem key={option.key} value={option.key}>\n            {option.text}\n          </MenuItem>\n        ))}\n      </Select>\n    </Stack>\n  );\n}\n\nexport function AutoUpdate(): React.ReactElement {\n  const [updatesEnabled = true, setUpdatedEnabled] = useAppConfigurationValue<boolean>(\n    AppSetting.UPDATES_ENABLED,\n  );\n\n  const { classes } = useStyles();\n\n  return (\n    <>\n      <Typography color=\"text.secondary\" marginBottom={0.5}>\n        Updates:\n      </Typography>\n      <FormControlLabel\n        className={classes.formControlLabel}\n        control={\n          <Checkbox\n            className={classes.checkbox}\n            checked={updatesEnabled}\n            onChange={(_event, checked) => void setUpdatedEnabled(checked)}\n          />\n        }\n        label=\"Automatically install updates\"\n      />\n    </>\n  );\n}\n\nexport function RosPackagePath(): React.ReactElement {\n  const [rosPackagePath, setRosPackagePath] = useAppConfigurationValue<string>(\n    AppSetting.ROS_PACKAGE_PATH,\n  );\n\n  const rosPackagePathPlaceholder = useMemo(\n    () => OsContextSingleton?.getEnvVar(\"ROS_PACKAGE_PATH\"),\n    [],\n  );\n\n  return (\n    <TextField\n      fullWidth\n      label=\"ROS_PACKAGE_PATH\"\n      placeholder={rosPackagePathPlaceholder}\n      value={rosPackagePath ?? \"\"}\n      onChange={(event) => void setRosPackagePath(event.target.value)}\n    />\n  );\n}\n\nexport function LanguageSettings(): React.ReactElement {\n  const { t, i18n } = useTranslation(\"preferences\");\n  const [selectedLanguage = \"en\", setSelectedLanguage] = useAppConfigurationValue<Language>(\n    AppSetting.LANGUAGE,\n  );\n  const onChangeLanguage = useCallback(\n    (event: SelectChangeEvent<Language>) => {\n      const lang = event.target.value as Language;\n      void setSelectedLanguage(lang);\n      i18n.changeLanguage(lang).catch((error) => {\n        console.error(\"Failed to switch languages\", error);\n        reportError(error as Error);\n      });\n    },\n    [i18n, setSelectedLanguage],\n  );\n  const options: { key: string; text: string; data: string }[] = useMemo(\n    () =>\n      LANGUAGE_OPTIONS.map((language) => ({\n        key: language.key,\n        text: `${language.value}`,\n        data: language.key,\n      })),\n    [],\n  );\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"language\")}:</FormLabel>\n      <Select<Language> value={selectedLanguage} fullWidth onChange={onChangeLanguage}>\n        {options.map((option) => (\n          <MenuItem key={option.key} value={option.key}>\n            {option.text}\n          </MenuItem>\n        ))}\n      </Select>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport InfoOutlinedIcon from \"@mui/icons-material/InfoOutlined\";\nimport WarningAmberIcon from \"@mui/icons-material/WarningAmber\";\nimport {\n  Alert,\n  Button,\n  Checkbox,\n  Dialog,\n  DialogActions,\n  DialogProps,\n  FormControlLabel,\n  IconButton,\n  Link,\n  Tab,\n  Tabs,\n  Typography,\n  useMediaQuery,\n  useTheme,\n} from \"@mui/material\";\nimport { MouseEvent, SyntheticEvent, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport CopyButton from \"@foxglove/studio-base/components/CopyButton\";\nimport { ExperimentalFeatureSettings } from \"@foxglove/studio-base/components/ExperimentalFeatureSettings\";\nimport ExtensionsSettings from \"@foxglove/studio-base/components/ExtensionsSettings\";\nimport FoxgloveLogoText from \"@foxglove/studio-base/components/FoxgloveLogoText\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  useWorkspaceStore,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nimport {\n  AutoUpdate,\n  ColorSchemeSettings,\n  LanguageSettings,\n  LaunchDefault,\n  MessageFramerate,\n  RosPackagePath,\n  TimeFormat,\n  TimezoneSettings,\n} from \"./settings\";\n\nconst useStyles = makeStyles()((theme) => ({\n  layoutGrid: {\n    display: \"grid\",\n    gap: theme.spacing(2),\n    height: \"70vh\",\n    paddingLeft: theme.spacing(1),\n    overflowY: \"hidden\",\n    [theme.breakpoints.up(\"sm\")]: {\n      gridTemplateColumns: \"auto minmax(0, 1fr)\",\n    },\n  },\n  logo: {\n    width: 212,\n    height: \"auto\",\n    marginLeft: theme.spacing(-1),\n  },\n  tabPanel: {\n    display: \"none\",\n    marginRight: \"-100%\",\n    width: \"100%\",\n    padding: theme.spacing(0, 4, 4),\n  },\n  tabPanelActive: {\n    display: \"block\",\n  },\n  checkbox: {\n    \"&.MuiCheckbox-root\": {\n      paddingTop: 0,\n    },\n  },\n  dialogActions: {\n    position: \"sticky\",\n    backgroundColor: theme.palette.background.paper,\n    borderTop: `${theme.palette.divider} 1px solid`,\n    padding: theme.spacing(1),\n    bottom: 0,\n  },\n  formControlLabel: {\n    \"&.MuiFormControlLabel-root\": {\n      alignItems: \"start\",\n    },\n  },\n  tab: {\n    svg: {\n      fontSize: \"inherit\",\n    },\n    \"> span, > .MuiSvgIcon-root\": {\n      display: \"flex\",\n      color: theme.palette.primary.main,\n      marginRight: theme.spacing(1.5),\n      height: theme.typography.pxToRem(21),\n      width: theme.typography.pxToRem(21),\n    },\n    [theme.breakpoints.up(\"sm\")]: {\n      textAlign: \"right\",\n      flexDirection: \"row\",\n      justifyContent: \"flex-start\",\n      alignItems: \"center\",\n      minHeight: \"auto\",\n      paddingTop: theme.spacing(1.5),\n      paddingBottom: theme.spacing(1.5),\n    },\n  },\n  indicator: {\n    [theme.breakpoints.up(\"sm\")]: {\n      right: 0,\n      width: \"100%\",\n      backgroundColor: theme.palette.action.hover,\n      borderRadius: theme.shape.borderRadius,\n    },\n  },\n}));\n\ntype SectionKey = \"resources\" | \"products\" | \"contact\" | \"legal\";\n\nexport const aboutItems: Map<\n  SectionKey,\n  {\n    subheader: string;\n    links: { title: string; url?: string }[];\n  }\n> = new Map([\n  [\n    \"resources\",\n    {\n      subheader: \"External resources\",\n      links: [\n        ...(isDesktopApp() ? [] : [{ title: \"Desktop app\", url: \"https://foxglove.dev/download\" }]),\n        { title: \"Browse docs\", url: \"https://foxglove.dev/docs\" },\n        { title: \"Join our community\", url: \"https://foxglove.dev/community\" },\n      ],\n    },\n  ],\n  [\n    \"products\",\n    {\n      subheader: \"Products\",\n      links: [\n        { title: \"Foxglove Studio\", url: \"https://foxglove.dev/studio\" },\n        { title: \"Foxglove Data Platform\", url: \"https://foxglove.dev/data-platform\" },\n      ],\n    },\n  ],\n  [\n    \"contact\",\n    {\n      subheader: \"Contact\",\n      links: [\n        { title: \"Give feedback\", url: \"https://foxglove.dev/contact\" },\n        { title: \"Schedule a demo\", url: \"https://foxglove.dev/demo\" },\n      ],\n    },\n  ],\n  [\n    \"legal\",\n    {\n      subheader: \"Legal\",\n      links: [\n        { title: \"License terms\", url: \"https://foxglove.dev/legal/studio-license\" },\n        { title: \"Privacy policy\", url: \"https://foxglove.dev/legal/privacy\" },\n      ],\n    },\n  ],\n]);\n\nexport type PreferencesDialogTab =\n  | \"general\"\n  | \"privacy\"\n  | \"extensions\"\n  | \"experimental-features\"\n  | \"about\";\n\nconst selectWorkspaceInitialActiveTab = (store: WorkspaceContextStore) =>\n  store.prefsDialogState.initialTab;\n\nexport function PreferencesDialog(\n  props: DialogProps & { activeTab?: PreferencesDialogTab },\n): JSX.Element {\n  const { t } = useTranslation(\"preferences\");\n  const { activeTab: _activeTab } = props;\n  const initialActiveTab = useWorkspaceStore(selectWorkspaceInitialActiveTab);\n  const [activeTab, setActiveTab] = useState<PreferencesDialogTab>(\n    _activeTab ?? initialActiveTab ?? \"general\",\n  );\n  const [crashReportingEnabled, setCrashReportingEnabled] = useAppConfigurationValue<boolean>(\n    AppSetting.CRASH_REPORTING_ENABLED,\n  );\n  const [telemetryEnabled, setTelemetryEnabled] = useAppConfigurationValue<boolean>(\n    AppSetting.TELEMETRY_ENABLED,\n  );\n  const { classes, cx } = useStyles();\n  const theme = useTheme();\n  const smUp = useMediaQuery(theme.breakpoints.up(\"sm\"));\n\n  // automatic updates are a desktop-only setting\n  //\n  // electron-updater does not provide a way to detect if we are on a supported update platform\n  // so we hard-code linux as an _unsupported_ auto-update platform since we cannot auto-update\n  // with our .deb package install method on linux.\n  const supportsAppUpdates = isDesktopApp() && OsContextSingleton?.platform !== \"linux\";\n\n  const handleTabChange = (_event: SyntheticEvent, newValue: PreferencesDialogTab) => {\n    setActiveTab(newValue);\n  };\n\n  const handleClose = (event: MouseEvent<HTMLElement>) => {\n    if (props.onClose != undefined) {\n      props.onClose(event, \"backdropClick\");\n    }\n  };\n\n  return (\n    <Dialog {...props} fullWidth maxWidth=\"md\">\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        paddingX={3}\n        paddingY={2}\n      >\n        <Typography variant=\"h3\" fontWeight={600}>\n          {t(\"preferences\")}\n        </Typography>\n        <IconButton edge=\"end\" onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <div className={classes.layoutGrid}>\n        <Tabs\n          classes={{ indicator: classes.indicator }}\n          value={activeTab}\n          orientation={smUp ? \"vertical\" : \"horizontal\"}\n          onChange={handleTabChange}\n        >\n          <Tab className={classes.tab} label={t(\"general\")} value=\"general\" />\n          <Tab className={classes.tab} label={t(\"privacy\")} value=\"privacy\" />\n          <Tab className={classes.tab} label={t(\"extensions\")} value=\"extensions\" />\n          <Tab\n            className={classes.tab}\n            label={t(\"experimentalFeatures\")}\n            value=\"experimental-features\"\n          />\n          <Tab className={classes.tab} label={t(\"about\")} value=\"about\" />\n        </Tabs>\n        <Stack direction=\"row\" fullHeight overflowY=\"auto\">\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"general\",\n            })}\n          >\n            <Stack gap={2}>\n              <ColorSchemeSettings />\n              <TimezoneSettings />\n              <TimeFormat orientation={smUp ? \"horizontal\" : \"vertical\"} />\n              <MessageFramerate />\n              <LanguageSettings />\n              {supportsAppUpdates && <AutoUpdate />}\n              {!isDesktopApp() && <LaunchDefault />}\n              {isDesktopApp() && <RosPackagePath />}\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"privacy\",\n            })}\n          >\n            <Stack gap={2}>\n              <Alert color=\"info\" icon={<InfoOutlinedIcon />}>\n                {t(\"privacyDescription\")}\n              </Alert>\n              <Stack gap={0.5} paddingLeft={2}>\n                <FormControlLabel\n                  className={classes.formControlLabel}\n                  control={\n                    <Checkbox\n                      className={classes.checkbox}\n                      checked={telemetryEnabled ?? true}\n                      onChange={(_event, checked) => void setTelemetryEnabled(checked)}\n                    />\n                  }\n                  label={t(\"sendAnonymizedUsageData\")}\n                />\n                <FormControlLabel\n                  className={classes.formControlLabel}\n                  control={\n                    <Checkbox\n                      className={classes.checkbox}\n                      checked={crashReportingEnabled ?? true}\n                      onChange={(_event, checked) => void setCrashReportingEnabled(checked)}\n                    />\n                  }\n                  label={t(\"sendAnonymizedCrashReports\")}\n                />\n              </Stack>\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"extensions\",\n            })}\n          >\n            <Stack gap={2}>\n              <ExtensionsSettings />\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"experimental-features\",\n            })}\n          >\n            <Stack gap={2}>\n              <Alert color=\"warning\" icon={<WarningAmberIcon />}>\n                {t(\"experimentalFeaturesDescription\")}\n              </Alert>\n              <Stack paddingLeft={2}>\n                <ExperimentalFeatureSettings />\n              </Stack>\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, { [classes.tabPanelActive]: activeTab === \"about\" })}\n          >\n            <Stack gap={2} alignItems=\"flex-start\">\n              <header>\n                <FoxgloveLogoText color=\"primary\" className={classes.logo} />\n              </header>\n              <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n                <Typography variant=\"body2\">\n                  Foxglove Studio version {FOXGLOVE_STUDIO_VERSION}\n                </Typography>\n                <CopyButton\n                  size=\"small\"\n                  getText={() => FOXGLOVE_STUDIO_VERSION?.toString() ?? \"\"}\n                />\n              </Stack>\n              {[\n                aboutItems.get(\"resources\"),\n                aboutItems.get(\"products\"),\n                aboutItems.get(\"contact\"),\n                aboutItems.get(\"legal\"),\n              ].map((item) => {\n                return (\n                  <Stack key={item?.subheader} gap={1}>\n                    {item?.subheader && <Typography>{item.subheader}</Typography>}\n                    {item?.links.map((link) => (\n                      <Link\n                        variant=\"body2\"\n                        underline=\"hover\"\n                        key={link.title}\n                        data-testid={link.title}\n                        href={link.url}\n                        target=\"_blank\"\n                      >\n                        {link.title}\n                      </Link>\n                    ))}\n                  </Stack>\n                );\n              })}\n            </Stack>\n          </section>\n        </Stack>\n      </div>\n      <DialogActions className={classes.dialogActions}>\n        <Button onClick={handleClose}>Done</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PreferencesDialog } from \"@foxglove/studio-base/components/PreferencesDialog\";\nimport {\n  useWorkspaceActions,\n  useWorkspaceStore,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/WorkspaceContext\";\n\nconst selectWorkspacePrefsDialogOpen = (store: WorkspaceContextStore) =>\n  store.prefsDialogState.open;\n\n/**\n * Encapsulates dialogs shown and controlled at workspace level.\n */\nexport function WorkspaceDialogs(): JSX.Element {\n  const prefsDialogOpen = useWorkspaceStore(selectWorkspacePrefsDialogOpen);\n  const { prefsDialogActions } = useWorkspaceActions();\n\n  return (\n    <>\n      {prefsDialogOpen && (\n        <PreferencesDialog\n          id=\"preferences-dialog\"\n          open\n          onClose={() => prefsDialogActions.close()}\n        />\n      )}\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nexport type NativeAppMenuEvent =\n  | \"open-file\"\n  | \"open-remote-file\"\n  | \"open-sample-data\"\n  | \"open-layouts\"\n  | \"open-add-panel\"\n  | \"open-panel-settings\"\n  | \"open-variables\"\n  | \"open-extensions\"\n  | \"open-help\"\n  | \"open-account\"\n  | \"open-preferences\";\n\ntype Handler = () => void;\n\nexport interface INativeAppMenu {\n  addFileEntry(name: string, handler: Handler): void;\n  removeFileEntry(name: string): void;\n\n  on(name: NativeAppMenuEvent, handler: Handler): void;\n  off(name: NativeAppMenuEvent, handler: Handler): void;\n}\n\nconst NativeAppMenuContext = createContext<INativeAppMenu | undefined>(undefined);\nNativeAppMenuContext.displayName = \"NativeAppMenuContext\";\n\nexport function useNativeAppMenu(): INativeAppMenu | undefined {\n  return useContext(NativeAppMenuContext);\n}\n\nexport default NativeAppMenuContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect } from \"react\";\n\nfunction blockScrollEventPropagation(event: Event) {\n  if (\n    event.target instanceof HTMLElement &&\n    event.target.classList.contains(\"ReactVirtualized__List\")\n  ) {\n    event.stopImmediatePropagation();\n  }\n}\n\n/**\n * Installs a window level handler to get ahead of FluentUI's global\n * dismiss on scroll behavior for Callouts, Dropdowns etc. This prevents\n * scroll events from auto-scrolling windows like the log from dismissing\n * open widgets.\n *\n * This is necessary because the lists in react-virtualized generate a scroll\n * event every time they scroll to show to rows and FluentUI installs a window\n * level 'scroll' event handler with capture = true so it sees every scroll\n * event anywhere in the window. And by default on any scroll event it dismisses\n * any open widgets based around the FluentUI callout. This behavior is probably\n * reasonable for user-initiated scrolling but it's not what we want for\n * automatically scrolling elements.\n *\n * This should probably be considered to be a temporary workaround.\n *\n * See https://codesandbox.io/s/scroll-test-3prdt\n */\nexport function useCalloutDismissalBlocker(): void {\n  useEffect(() => {\n    window.addEventListener(\"scroll\", blockScrollEventPropagation, { capture: true });\n\n    return () =>\n      window.removeEventListener(\"scroll\", blockScrollEventPropagation, { capture: true });\n  }, []);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useEffect, useState } from \"react\";\n\n/**\n * This provides a convenience wrapper around sessionStorage and triggers\n * a react state change when values change.\n *\n * @param key sessionStorage key to manage.\n * @returns [value, setValue] tuple for that key.\n */\nexport function useSessionStorageValue(\n  key: string,\n): [value: string | undefined, setValue: (newValue: string | undefined) => void] {\n  const [value, updateValue] = useState<string | undefined>(\n    sessionStorage.getItem(key) ?? undefined,\n  );\n\n  const setValue = useCallback(\n    (newValue: string | undefined) => {\n      // Hack a manual event for now. Unfortunately the browser only fires \"storage\"\n      // events when triggered outside our current tab.\n      if (newValue) {\n        sessionStorage.setItem(key, newValue);\n        window.dispatchEvent(\n          new StorageEvent(\"storage\", { key, newValue, storageArea: sessionStorage }),\n        );\n      } else {\n        sessionStorage.removeItem(key);\n        window.dispatchEvent(\n          new StorageEvent(\"storage\", { key, newValue: undefined, storageArea: sessionStorage }),\n        );\n      }\n    },\n    [key],\n  );\n\n  const changeListener = useCallback(\n    (event: StorageEvent) => {\n      if (event.key === key) {\n        updateValue(event.newValue ?? undefined);\n      }\n    },\n    [key],\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"storage\", changeListener);\n    return () => window.removeEventListener(\"storage\", changeListener);\n  }, [changeListener]);\n\n  return [value ?? undefined, setValue];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect } from \"react\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useSessionStorageValue } from \"@foxglove/studio-base/hooks/useSessionStorageValue\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nconst selectHasUrlState = (ctx: MessagePipelineContext) => ctx.playerState.urlState != undefined;\n\nexport function useDefaultWebLaunchPreference(): void {\n  const hasUrlState = useMessagePipeline(selectHasUrlState);\n  const [launchPreference, setLaunchPreference] = useSessionStorageValue(\n    AppSetting.LAUNCH_PREFERENCE,\n  );\n\n  // Set a sessionStorage preference for web if we have a stable URL state.\n  // This allows us to avoid asking for the preference immediately on\n  // launch of an empty session and makes refreshes do the right thing.\n  useEffect(() => {\n    if (isDesktopApp()) {\n      return;\n    }\n\n    if (hasUrlState && !launchPreference) {\n      setLaunchPreference(LaunchPreferenceValue.WEB);\n    }\n  }, [launchPreference, setLaunchPreference, hasUrlState]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect, useState } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\n// Hook to get any files the main thread has told us to open\n// See the comments in main thread implementation on how the files are injected into this input\nexport default function useElectronFilesToOpen(): FileList | undefined {\n  const [input] = useState(() =>\n    document.querySelector<HTMLInputElement>(\"#electron-open-file-input\"),\n  );\n\n  const [fileList, setFileList] = useState<FileList | undefined>(input?.files ?? undefined);\n\n  useEffect(() => {\n    if (!input) {\n      log.info(\n        \"#electron-open-file-input not found - native open-file support will not be available\",\n      );\n      return;\n    }\n\n    const update = () => {\n      setFileList(input.files ?? undefined);\n    };\n\n    // handle any new file open requests\n    input.addEventListener(\"change\", update);\n    return () => {\n      input.removeEventListener(\"change\", update);\n    };\n  }, [input]);\n\n  return fileList;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect, useMemo, useState } from \"react\";\n\nimport Log from \"@foxglove/log\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\nimport { AppURLState, parseAppURLState } from \"@foxglove/studio-base/util/appURLState\";\n\nconst selectPlayerPresence = (ctx: MessagePipelineContext) => ctx.playerState.presence;\nconst selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\nconst selectSelectEvent = (store: EventsStore) => store.selectEvent;\n\nconst log = Log.getLogger(__filename);\n\n/*\n * Separation of sync functions is necessary to prevent memory leak from context kept in\n * useEffect closures. Notably `seekPlayback` being attached to the context of the `useEffect`\n * closures that don't use it and aren't updated when it changes. Otherwise the old memoized callbacks\n * of these functions are kept in React state with the context that includes the old player, preventing\n * garbage collection of the old player.\n */\n\nfunction useSyncSourceFromUrl(\n  targetUrlState: AppURLState | undefined,\n  { currentUserRequired }: { currentUserRequired: boolean },\n) {\n  const [unappliedSourceArgs, setUnappliedSourceArgs] = useState(\n    targetUrlState ? { ds: targetUrlState.ds, dsParams: targetUrlState.dsParams } : undefined,\n  );\n  const { selectSource } = usePlayerSelection();\n  const selectEvent = useEvents(selectSelectEvent);\n  const { currentUser } = useCurrentUser();\n  // Load data source from URL.\n  useEffect(() => {\n    if (!unappliedSourceArgs) {\n      return;\n    }\n\n    // Wait for current user session if one is required for this source.\n    if (currentUserRequired && !currentUser) {\n      return;\n    }\n\n    // Apply any available datasource args\n    if (unappliedSourceArgs.ds) {\n      log.debug(\"Initialising source from url\", unappliedSourceArgs);\n      selectSource(unappliedSourceArgs.ds, {\n        type: \"connection\",\n        params: unappliedSourceArgs.dsParams,\n      });\n      selectEvent(unappliedSourceArgs.dsParams?.eventId);\n      setUnappliedSourceArgs({ ds: undefined, dsParams: undefined });\n    }\n  }, [\n    currentUser,\n    currentUserRequired,\n    selectEvent,\n    selectSource,\n    unappliedSourceArgs,\n    setUnappliedSourceArgs,\n  ]);\n}\nfunction useSyncLayoutFromUrl(\n  targetUrlState: AppURLState | undefined,\n  { currentUserRequired }: { currentUserRequired: boolean },\n) {\n  const { setSelectedLayoutId } = useCurrentLayoutActions();\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const [unappliedLayoutArgs, setUnappliedLayoutArgs] = useState(\n    targetUrlState ? { layoutId: targetUrlState.layoutId } : undefined,\n  );\n  // Select layout from URL.\n  useEffect(() => {\n    if (!unappliedLayoutArgs?.layoutId) {\n      return;\n    }\n\n    // If our datasource requires a current user then wait until the player is\n    // available to load the layout since we may need to sync layouts first and\n    // that's only possible after the user has logged in.\n    if (currentUserRequired && playerPresence !== PlayerPresence.PRESENT) {\n      return;\n    }\n\n    log.debug(`Initializing layout from url: ${unappliedLayoutArgs.layoutId}`);\n    setSelectedLayoutId(unappliedLayoutArgs.layoutId);\n    setUnappliedLayoutArgs({ layoutId: undefined });\n  }, [currentUserRequired, playerPresence, setSelectedLayoutId, unappliedLayoutArgs?.layoutId]);\n}\n\nfunction useSyncTimeFromUrl(targetUrlState: AppURLState | undefined) {\n  const seekPlayback = useMessagePipeline(selectSeek);\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const [unappliedTime, setUnappliedTime] = useState(\n    targetUrlState ? { time: targetUrlState.time } : undefined,\n  );\n  // Seek to time in URL.\n  useEffect(() => {\n    if (unappliedTime?.time == undefined || !seekPlayback) {\n      return;\n    }\n\n    // Wait until player is ready before we try to seek.\n    if (playerPresence !== PlayerPresence.PRESENT) {\n      return;\n    }\n\n    log.debug(`Seeking to url time:`, unappliedTime.time);\n    seekPlayback(unappliedTime.time);\n    setUnappliedTime({ time: undefined });\n  }, [playerPresence, seekPlayback, unappliedTime]);\n}\n\n/**\n * Restores our session state from any deep link we were passed on startup.\n */\nexport function useInitialDeepLinkState(deepLinks: readonly string[]): {\n  currentUserRequired: boolean;\n} {\n  const { availableSources } = usePlayerSelection();\n  const targetUrlState = useMemo(\n    () => (deepLinks[0] ? parseAppURLState(new URL(deepLinks[0])) : undefined),\n    [deepLinks],\n  );\n\n  // Maybe this should be abstracted somewhere but that would require a\n  // more intimate interface with this hook and the player selection logic.\n  const currentUserRequiredParam = useMemo(() => {\n    let currentUserRequired = false;\n    const ds = targetUrlState?.ds;\n    const foundSource =\n      ds == undefined\n        ? undefined\n        : availableSources.find((source) => source.id === ds || source.legacyIds?.includes(ds));\n    if (foundSource) {\n      currentUserRequired = foundSource.currentUserRequired ?? false;\n    }\n\n    return { currentUserRequired };\n  }, [targetUrlState?.ds, availableSources]);\n  useSyncSourceFromUrl(targetUrlState, currentUserRequiredParam);\n  useSyncLayoutFromUrl(targetUrlState, currentUserRequiredParam);\n  useSyncTimeFromUrl(targetUrlState);\n  return currentUserRequiredParam;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect } from \"react\";\n\nimport {\n  NativeAppMenuEvent,\n  useNativeAppMenu,\n} from \"@foxglove/studio-base/context/NativeAppMenuContext\";\n\ntype EventHandler = () => void;\n\nexport default function useNativeAppMenuEvent(\n  eventName: NativeAppMenuEvent,\n  handler: EventHandler,\n): void {\n  const nativeAppMenu = useNativeAppMenu();\n\n  useEffect(() => {\n    if (!nativeAppMenu) {\n      return;\n    }\n\n    const fn = handler;\n    nativeAppMenu.on(eventName, fn);\n\n    return () => {\n      nativeAppMenu.off(eventName, fn);\n    };\n  }, [eventName, handler, nativeAppMenu]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ReactNode, useState } from \"react\";\nimport { createStore, StoreApi } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\n\nimport {\n  WorkspaceContext,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/WorkspaceContext\";\n\nfunction createWorkspaceContextStore(\n  initialState?: Partial<WorkspaceContextStore>,\n): StoreApi<WorkspaceContextStore> {\n  return createStore<WorkspaceContextStore>()(\n    persist(\n      () => {\n        const store: WorkspaceContextStore = {\n          leftSidebarItem: \"panel-settings\",\n          leftSidebarOpen: true,\n          leftSidebarSize: undefined,\n          prefsDialogState: {\n            initialTab: undefined,\n            open: false,\n          },\n          rightSidebarItem: undefined,\n          rightSidebarOpen: false,\n          rightSidebarSize: undefined,\n          sidebarItem: \"connection\",\n          ...initialState,\n        };\n        return store;\n      },\n      {\n        name: \"fox.workspace\",\n        partialize: (value) => {\n          return value;\n        },\n      },\n    ),\n  );\n}\n\nexport default function WorkspaceContextProvider({\n  children,\n  initialState,\n}: {\n  children?: ReactNode;\n  initialState?: Partial<WorkspaceContextStore>;\n}): JSX.Element {\n  const [store] = useState(() => createWorkspaceContextStore(initialState));\n\n  return <WorkspaceContext.Provider value={store}>{children}</WorkspaceContext.Provider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Link, Typography } from \"@mui/material\";\nimport { useSnackbar } from \"notistack\";\nimport { extname } from \"path\";\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Logger from \"@foxglove/log\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport AccountSettings from \"@foxglove/studio-base/components/AccountSettingsSidebar/AccountSettings\";\nimport { AppBar } from \"@foxglove/studio-base/components/AppBar\";\nimport { CustomWindowControlsProps } from \"@foxglove/studio-base/components/AppBar/CustomWindowControls\";\nimport { DataSourceSidebar } from \"@foxglove/studio-base/components/DataSourceSidebar\";\nimport { EventsList } from \"@foxglove/studio-base/components/DataSourceSidebar/EventsList\";\nimport { TopicList } from \"@foxglove/studio-base/components/DataSourceSidebar/TopicList\";\nimport DocumentDropListener from \"@foxglove/studio-base/components/DocumentDropListener\";\nimport ExtensionsSettings from \"@foxglove/studio-base/components/ExtensionsSettings\";\nimport KeyListener from \"@foxglove/studio-base/components/KeyListener\";\nimport LayoutBrowser from \"@foxglove/studio-base/components/LayoutBrowser\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n  useMessagePipelineGetter,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport MultiProvider from \"@foxglove/studio-base/components/MultiProvider\";\nimport { OpenDialog, OpenDialogViews } from \"@foxglove/studio-base/components/OpenDialog\";\nimport PanelLayout from \"@foxglove/studio-base/components/PanelLayout\";\nimport PanelList from \"@foxglove/studio-base/components/PanelList\";\nimport PanelSettings from \"@foxglove/studio-base/components/PanelSettings\";\nimport PlaybackControls from \"@foxglove/studio-base/components/PlaybackControls\";\nimport RemountOnValueChange from \"@foxglove/studio-base/components/RemountOnValueChange\";\nimport { SidebarContent } from \"@foxglove/studio-base/components/SidebarContent\";\nimport Sidebars, { SidebarItem } from \"@foxglove/studio-base/components/Sidebars\";\nimport { NewSidebarItem } from \"@foxglove/studio-base/components/Sidebars/NewSidebar\";\nimport { SignInFormModal } from \"@foxglove/studio-base/components/SignInFormModal\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  StudioLogsSettings,\n  StudioLogsSettingsSidebar,\n} from \"@foxglove/studio-base/components/StudioLogsSettings\";\nimport { SyncAdapters } from \"@foxglove/studio-base/components/SyncAdapters\";\nimport VariablesList from \"@foxglove/studio-base/components/VariablesList\";\nimport { WorkspaceDialogs } from \"@foxglove/studio-base/components/WorkspaceDialogs\";\nimport {\n  LayoutState,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport { useNativeAppMenu } from \"@foxglove/studio-base/context/NativeAppMenuContext\";\nimport {\n  IDataSourceFactory,\n  usePlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport {\n  LeftSidebarItemKey,\n  RightSidebarItemKey,\n  SidebarItemKey,\n  useWorkspaceActions,\n  useWorkspaceStore,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport useAddPanel from \"@foxglove/studio-base/hooks/useAddPanel\";\nimport { useCalloutDismissalBlocker } from \"@foxglove/studio-base/hooks/useCalloutDismissalBlocker\";\nimport { useDefaultWebLaunchPreference } from \"@foxglove/studio-base/hooks/useDefaultWebLaunchPreference\";\nimport useElectronFilesToOpen from \"@foxglove/studio-base/hooks/useElectronFilesToOpen\";\nimport { useInitialDeepLinkState } from \"@foxglove/studio-base/hooks/useInitialDeepLinkState\";\nimport useNativeAppMenuEvent from \"@foxglove/studio-base/hooks/useNativeAppMenuEvent\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\nimport { PanelStateContextProvider } from \"@foxglove/studio-base/providers/PanelStateContextProvider\";\nimport WorkspaceContextProvider from \"@foxglove/studio-base/providers/WorkspaceContextProvider\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nconst log = Logger.getLogger(__filename);\n\nconst useStyles = makeStyles()({\n  container: {\n    width: \"100%\",\n    height: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    flex: \"1 1 100%\",\n    outline: \"none\",\n    overflow: \"hidden\",\n  },\n});\n\nconst selectedLayoutIdSelector = (state: LayoutState) => state.selectedLayout?.id;\n\nfunction activeElementIsInput() {\n  return (\n    document.activeElement instanceof HTMLInputElement ||\n    document.activeElement instanceof HTMLTextAreaElement\n  );\n}\n\nfunction keyboardEventHasModifier(event: KeyboardEvent) {\n  if (navigator.userAgent.includes(\"Mac\")) {\n    return event.metaKey;\n  } else {\n    return event.ctrlKey;\n  }\n}\n\nfunction AddPanel() {\n  const addPanel = useAddPanel();\n  const { openLayoutBrowser } = useWorkspaceActions();\n  const selectedLayoutId = useCurrentLayoutSelector(selectedLayoutIdSelector);\n  const { t } = useTranslation(\"addPanel\");\n\n  return (\n    <SidebarContent disablePadding={selectedLayoutId != undefined} title={t(\"addPanel\")}>\n      {selectedLayoutId == undefined ? (\n        <Typography color=\"text.secondary\">\n          <Trans\n            t={t}\n            i18nKey=\"noLayoutSelected\"\n            components={{\n              selectLayoutLink: <Link onClick={openLayoutBrowser} />,\n            }}\n          />\n        </Typography>\n      ) : (\n        <PanelList onPanelSelect={addPanel} />\n      )}\n    </SidebarContent>\n  );\n}\n\nfunction ExtensionsSidebar() {\n  return (\n    <SidebarContent title=\"Extensions\" disablePadding>\n      <ExtensionsSettings />\n    </SidebarContent>\n  );\n}\n\ntype WorkspaceProps = CustomWindowControlsProps & {\n  deepLinks?: string[];\n  appBarLeftInset?: number;\n  onAppBarDoubleClick?: () => void;\n};\n\nconst DEFAULT_DEEPLINKS = Object.freeze([]);\n\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectPlayerProblems = ({ playerState }: MessagePipelineContext) => playerState.problems;\nconst selectIsPlaying = (ctx: MessagePipelineContext) =>\n  ctx.playerState.activeData?.isPlaying === true;\nconst selectPause = (ctx: MessagePipelineContext) => ctx.pausePlayback;\nconst selectPlay = (ctx: MessagePipelineContext) => ctx.startPlayback;\nconst selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\nconst selectPlayUntil = (ctx: MessagePipelineContext) => ctx.playUntil;\nconst selectPlayerId = (ctx: MessagePipelineContext) => ctx.playerState.playerId;\nconst selectEventsSupported = (store: EventsStore) => store.eventsSupported;\nconst selectWorkspaceSidebarItem = (store: WorkspaceContextStore) => store.sidebarItem;\nconst selectWorkspaceLeftSidebarItem = (store: WorkspaceContextStore) => store.leftSidebarItem;\nconst selectWorkspaceLeftSidebarOpen = (store: WorkspaceContextStore) => store.leftSidebarOpen;\nconst selectWorkspaceLeftSidebarSize = (store: WorkspaceContextStore) => store.leftSidebarSize;\nconst selectWorkspaceRightSidebarItem = (store: WorkspaceContextStore) => store.rightSidebarItem;\nconst selectWorkspaceRightSidebarOpen = (store: WorkspaceContextStore) => store.rightSidebarOpen;\nconst selectWorkspaceRightSidebarSize = (store: WorkspaceContextStore) => store.rightSidebarSize;\n\nfunction WorkspaceContent(props: WorkspaceProps): JSX.Element {\n  const { classes } = useStyles();\n  const containerRef = useRef<HTMLDivElement>(ReactNull);\n  const { availableSources, selectSource } = usePlayerSelection();\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const playerProblems = useMessagePipeline(selectPlayerProblems);\n\n  const sidebarItem = useWorkspaceStore(selectWorkspaceSidebarItem);\n  const leftSidebarItem = useWorkspaceStore(selectWorkspaceLeftSidebarItem);\n  const leftSidebarOpen = useWorkspaceStore(selectWorkspaceLeftSidebarOpen);\n  const leftSidebarSize = useWorkspaceStore(selectWorkspaceLeftSidebarSize);\n  const rightSidebarItem = useWorkspaceStore(selectWorkspaceRightSidebarItem);\n  const rightSidebarOpen = useWorkspaceStore(selectWorkspaceRightSidebarOpen);\n  const rightSidebarSize = useWorkspaceStore(selectWorkspaceRightSidebarSize);\n\n  const {\n    prefsDialogActions,\n    setLeftSidebarOpen,\n    setRightSidebarOpen,\n    selectLeftSidebarItem,\n    selectRightSidebarItem,\n    setLeftSidebarSize,\n    setRightSidebarSize,\n    selectSidebarItem,\n  } = useWorkspaceActions();\n\n  // file types we support for drag/drop\n  const allowedDropExtensions = useMemo(() => {\n    const extensions = [\".foxe\"];\n    for (const source of availableSources) {\n      if (source.type === \"file\" && source.supportedFileTypes) {\n        extensions.push(...source.supportedFileTypes);\n      }\n    }\n    return extensions;\n  }, [availableSources]);\n\n  // We use playerId to detect when a player changes for RemountOnValueChange below\n  // see comment below above the RemountOnValueChange component\n  const playerId = useMessagePipeline(selectPlayerId);\n\n  const isPlayerPresent = playerPresence !== PlayerPresence.NOT_PRESENT;\n\n  const { currentUser, signIn } = useCurrentUser();\n  const supportsAccountSettings = signIn != undefined;\n\n  const { currentUserRequired } = useInitialDeepLinkState(props.deepLinks ?? DEFAULT_DEEPLINKS);\n\n  useDefaultWebLaunchPreference();\n\n  const [showOpenDialogOnStartup = true] = useAppConfigurationValue<boolean>(\n    AppSetting.SHOW_OPEN_DIALOG_ON_STARTUP,\n  );\n  const [enableStudioLogsSidebar = false] = useAppConfigurationValue<boolean>(\n    AppSetting.SHOW_DEBUG_PANELS,\n  );\n  // Since we can't toggle the title bar on an electron window, keep the setting at its initial\n  // value until the app is reloaded/relaunched.\n  const [currentEnableNewTopNav = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_NEW_TOPNAV,\n  );\n\n  const [initialEnableNewTopNav] = useState(currentEnableNewTopNav);\n  const enableNewTopNav = isDesktopApp() ? initialEnableNewTopNav : currentEnableNewTopNav;\n\n  const showSignInForm = currentUserRequired && currentUser == undefined;\n\n  const [showOpenDialog, setShowOpenDialog] = useState<\n    { view: OpenDialogViews; activeDataSource?: IDataSourceFactory } | undefined\n  >(isPlayerPresent || !showOpenDialogOnStartup || showSignInForm ? undefined : { view: \"start\" });\n\n  // When a player is activated, hide the open dialog.\n  useLayoutEffect(() => {\n    if (\n      playerPresence === PlayerPresence.PRESENT ||\n      playerPresence === PlayerPresence.INITIALIZING\n    ) {\n      setShowOpenDialog(undefined);\n    }\n  }, [playerPresence]);\n\n  useEffect(() => {\n    // Focus on page load to enable keyboard interaction.\n    if (containerRef.current) {\n      containerRef.current.focus();\n    }\n  }, []);\n\n  useCalloutDismissalBlocker();\n\n  useNativeAppMenuEvent(\n    \"open-layouts\",\n    useCallback(() => {\n      selectSidebarItem(\"layouts\");\n    }, [selectSidebarItem]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-add-panel\",\n    useCallback(() => {\n      selectSidebarItem(\"add-panel\");\n    }, [selectSidebarItem]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-panel-settings\",\n    useCallback(() => {\n      selectSidebarItem(\"panel-settings\");\n    }, [selectSidebarItem]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-variables\",\n    useCallback(() => {\n      selectSidebarItem(\"variables\");\n    }, [selectSidebarItem]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-extensions\",\n    useCallback(() => {\n      selectSidebarItem(\"extensions\");\n    }, [selectSidebarItem]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-account\",\n    useCallback(() => {\n      selectSidebarItem(\"account\");\n    }, [selectSidebarItem]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-preferences\",\n    useCallback(() => {\n      prefsDialogActions.open();\n    }, [prefsDialogActions]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-file\",\n    useCallback(() => {\n      setShowOpenDialog({ view: \"file\" });\n    }, []),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-remote-file\",\n    useCallback(() => {\n      setShowOpenDialog({ view: \"remote\" });\n    }, []),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-sample-data\",\n    useCallback(() => {\n      setShowOpenDialog({ view: \"demo\" });\n    }, []),\n  );\n\n  const nativeAppMenu = useNativeAppMenu();\n\n  const connectionSources = useMemo(() => {\n    return availableSources.filter((source) => source.type === \"connection\");\n  }, [availableSources]);\n\n  useEffect(() => {\n    if (!nativeAppMenu) {\n      return;\n    }\n\n    for (const item of connectionSources) {\n      nativeAppMenu.addFileEntry(item.displayName, () => {\n        setShowOpenDialog({ view: \"connection\", activeDataSource: item });\n      });\n    }\n\n    return () => {\n      for (const item of connectionSources) {\n        nativeAppMenu.removeFileEntry(item.displayName);\n      }\n    };\n  }, [connectionSources, nativeAppMenu, selectSource]);\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const installExtension = useExtensionCatalog((state) => state.installExtension);\n\n  const openHandle = useCallback(\n    async (\n      handle: FileSystemFileHandle /* foxglove-depcheck-used: @types/wicg-file-system-access */,\n    ) => {\n      log.debug(\"open handle\", handle);\n      const file = await handle.getFile();\n\n      if (file.name.endsWith(\".foxe\")) {\n        // Extension installation\n        try {\n          const arrayBuffer = await file.arrayBuffer();\n          const data = new Uint8Array(arrayBuffer);\n          const extension = await installExtension(\"local\", data);\n          enqueueSnackbar(`Installed extension ${extension.id}`, { variant: \"success\" });\n        } catch (err) {\n          log.error(err);\n          enqueueSnackbar(`Failed to install extension ${file.name}: ${err.message}`, {\n            variant: \"error\",\n          });\n        }\n      }\n\n      // Look for a source that supports the file extensions\n      const matchedSource = availableSources.find((source) => {\n        const ext = extname(file.name);\n        return source.supportedFileTypes?.includes(ext);\n      });\n      if (matchedSource) {\n        selectSource(matchedSource.id, { type: \"file\", handle });\n      }\n    },\n    [availableSources, enqueueSnackbar, installExtension, selectSource],\n  );\n\n  const openFiles = useCallback(\n    async (files: File[]) => {\n      const otherFiles: File[] = [];\n      log.debug(\"open files\", files);\n\n      for (const file of files) {\n        if (file.name.endsWith(\".foxe\")) {\n          // Extension installation\n          try {\n            const arrayBuffer = await file.arrayBuffer();\n            const data = new Uint8Array(arrayBuffer);\n            const extension = await installExtension(\"local\", data);\n            enqueueSnackbar(`Installed extension ${extension.id}`, { variant: \"success\" });\n          } catch (err) {\n            log.error(err);\n            enqueueSnackbar(`Failed to install extension ${file.name}: ${err.message}`, {\n              variant: \"error\",\n            });\n          }\n        } else {\n          otherFiles.push(file);\n        }\n      }\n\n      if (otherFiles.length > 0) {\n        // Look for a source that supports the dragged file extensions\n        for (const source of availableSources) {\n          const filteredFiles = otherFiles.filter((file) => {\n            const ext = extname(file.name);\n            return source.supportedFileTypes?.includes(ext);\n          });\n\n          // select the first source that has files that match the supported extensions\n          if (filteredFiles.length > 0) {\n            selectSource(source.id, { type: \"file\", files: otherFiles });\n            break;\n          }\n        }\n      }\n    },\n    [availableSources, enqueueSnackbar, installExtension, selectSource],\n  );\n\n  // files the main thread told us to open\n  const filesToOpen = useElectronFilesToOpen();\n  useEffect(() => {\n    if (filesToOpen) {\n      void openFiles(Array.from(filesToOpen));\n    }\n  }, [filesToOpen, openFiles]);\n\n  const dropHandler = useCallback(\n    (event: { files?: File[]; handles?: FileSystemFileHandle[] }) => {\n      const handle = event.handles?.[0];\n      // When selecting sources with handles we can only select with a single handle since we haven't\n      // written the code to store multiple handles for recents. When there are multiple handles, we\n      // fall back to opening regular files.\n      if (handle && event.handles?.length === 1) {\n        void openHandle(handle);\n      } else if (event.files) {\n        void openFiles(event.files);\n      }\n    },\n    [openFiles, openHandle],\n  );\n\n  // Since the _component_ field of a sidebar item entry is a component and accepts no additional\n  // props we need to wrap our DataSourceSidebar component to connect the open data source action to\n  // open the data source dialog.\n  const DataSourceSidebarItem = useMemo(() => {\n    return function DataSourceSidebarItemImpl() {\n      return (\n        <DataSourceSidebar\n          disableToolbar={enableNewTopNav}\n          onSelectDataSourceAction={() => setShowOpenDialog({ view: \"start\" })}\n        />\n      );\n    };\n  }, [enableNewTopNav]);\n\n  const PanelSettingsSidebar = useMemo(() => {\n    return function PanelSettingsSidebarImpl() {\n      return <PanelSettings disableToolbar />;\n    };\n  }, []);\n\n  const [sidebarItems, sidebarBottomItems] = useMemo(() => {\n    const topItems = new Map<SidebarItemKey, SidebarItem>([\n      [\n        \"connection\",\n        {\n          iconName: \"DatabaseSettings\",\n          title: \"Data source\",\n          component: DataSourceSidebarItem,\n          badge:\n            playerProblems && playerProblems.length > 0\n              ? { count: playerProblems.length }\n              : undefined,\n        },\n      ],\n    ]);\n\n    if (!enableNewTopNav) {\n      topItems.set(\"layouts\", {\n        iconName: \"FiveTileGrid\",\n        title: \"Layouts\",\n        component: LayoutBrowser,\n      });\n      topItems.set(\"add-panel\", {\n        iconName: \"RectangularClipping\",\n        title: \"Add panel\",\n        component: AddPanel,\n      });\n    }\n    topItems.set(\"panel-settings\", {\n      iconName: \"PanelSettings\",\n      title: \"Panel settings\",\n      component: PanelSettings,\n    });\n    if (!enableNewTopNav) {\n      topItems.set(\"variables\", {\n        iconName: \"Variable2\",\n        title: \"Variables\",\n        component: VariablesList,\n      });\n      topItems.set(\"extensions\", {\n        iconName: \"AddIn\",\n        title: \"Extensions\",\n        component: ExtensionsSidebar,\n      });\n    }\n    if (enableStudioLogsSidebar) {\n      topItems.set(\"studio-logs-settings\", {\n        iconName: \"BacklogList\",\n        title: \"Studio logs settings\",\n        component: StudioLogsSettingsSidebar,\n      });\n    }\n\n    const bottomItems = new Map<SidebarItemKey, SidebarItem>([]);\n\n    if (!enableNewTopNav) {\n      if (supportsAccountSettings) {\n        bottomItems.set(\"account\", {\n          iconName: currentUser != undefined ? \"BlockheadFilled\" : \"Blockhead\",\n          title: currentUser != undefined ? `Signed in as ${currentUser.email}` : \"Account\",\n          component: AccountSettings,\n        });\n      }\n\n      bottomItems.set(\"preferences\", {\n        iconName: \"Settings\",\n        title: \"Preferences\",\n      });\n    }\n\n    return [topItems, bottomItems];\n  }, [\n    DataSourceSidebarItem,\n    playerProblems,\n    enableStudioLogsSidebar,\n    enableNewTopNav,\n    supportsAccountSettings,\n    currentUser,\n  ]);\n\n  const eventsSupported = useEvents(selectEventsSupported);\n  const showEventsTab = currentUser != undefined && eventsSupported;\n\n  const leftSidebarItems = useMemo(() => {\n    const items = new Map<LeftSidebarItemKey, NewSidebarItem>([\n      [\"panel-settings\", { title: \"Panel\", component: PanelSettingsSidebar }],\n      [\"topics\", { title: \"Topics\", component: TopicList }],\n    ]);\n    return items;\n  }, [PanelSettingsSidebar]);\n\n  const rightSidebarItems = useMemo(() => {\n    const items = new Map<RightSidebarItemKey, NewSidebarItem>([\n      [\"variables\", { title: \"Variables\", component: VariablesList }],\n    ]);\n    if (enableStudioLogsSidebar) {\n      items.set(\"studio-logs-settings\", { title: \"Studio Logs\", component: StudioLogsSettings });\n    }\n    if (showEventsTab) {\n      items.set(\"events\", { title: \"Events\", component: EventsList });\n    }\n    return items;\n  }, [enableStudioLogsSidebar, showEventsTab]);\n\n  const keyDownHandlers = useMemo(() => {\n    return {\n      b: (ev: KeyboardEvent) => {\n        if (!keyboardEventHasModifier(ev) || activeElementIsInput() || sidebarItem == undefined) {\n          return;\n        }\n\n        ev.preventDefault();\n        selectSidebarItem(undefined);\n      },\n      \"[\": () => setLeftSidebarOpen((oldValue) => !oldValue),\n      \"]\": () => setRightSidebarOpen((oldValue) => !oldValue),\n    };\n  }, [sidebarItem, setLeftSidebarOpen, setRightSidebarOpen, selectSidebarItem]);\n\n  const play = useMessagePipeline(selectPlay);\n  const playUntil = useMessagePipeline(selectPlayUntil);\n  const pause = useMessagePipeline(selectPause);\n  const seek = useMessagePipeline(selectSeek);\n  const isPlaying = useMessagePipeline(selectIsPlaying);\n  const getMessagePipeline = useMessagePipelineGetter();\n  const getTimeInfo = useCallback(\n    () => getMessagePipeline().playerState.activeData ?? {},\n    [getMessagePipeline],\n  );\n\n  return (\n    <MultiProvider\n      providers={[\n        /* eslint-disable react/jsx-key */\n        <PanelStateContextProvider />,\n        /* eslint-enable react/jsx-key */\n      ]}\n    >\n      {showSignInForm && <SignInFormModal />}\n      {showOpenDialog != undefined && (\n        <OpenDialog\n          activeView={showOpenDialog.view}\n          activeDataSource={showOpenDialog.activeDataSource}\n          onDismiss={() => setShowOpenDialog(undefined)}\n        />\n      )}\n      <DocumentDropListener onDrop={dropHandler} allowedExtensions={allowedDropExtensions} />\n      <SyncAdapters />\n      <KeyListener global keyDownHandlers={keyDownHandlers} />\n      <div className={classes.container} ref={containerRef} tabIndex={0}>\n        {enableNewTopNav && (\n          <AppBar\n            leftInset={props.appBarLeftInset}\n            onDoubleClick={props.onAppBarDoubleClick}\n            showCustomWindowControls={props.showCustomWindowControls}\n            isMaximized={props.isMaximized}\n            onMinimizeWindow={props.onMinimizeWindow}\n            onMaximizeWindow={props.onMaximizeWindow}\n            onUnmaximizeWindow={props.onUnmaximizeWindow}\n            onCloseWindow={props.onCloseWindow}\n            onSelectDataSourceAction={() => setShowOpenDialog({ view: \"start\" })}\n          />\n        )}\n        <Sidebars\n          items={sidebarItems}\n          bottomItems={sidebarBottomItems}\n          selectedKey={sidebarItem}\n          onSelectKey={selectSidebarItem}\n          leftItems={leftSidebarItems}\n          selectedLeftKey={leftSidebarOpen ? leftSidebarItem : undefined}\n          onSelectLeftKey={selectLeftSidebarItem}\n          leftSidebarSize={leftSidebarSize}\n          setLeftSidebarSize={setLeftSidebarSize}\n          rightItems={rightSidebarItems}\n          selectedRightKey={rightSidebarOpen ? rightSidebarItem : undefined}\n          onSelectRightKey={selectRightSidebarItem}\n          rightSidebarSize={rightSidebarSize}\n          setRightSidebarSize={setRightSidebarSize}\n        >\n          {/* To ensure no stale player state remains, we unmount all panels when players change */}\n          <RemountOnValueChange value={playerId}>\n            <Stack>\n              <PanelLayout />\n            </Stack>\n          </RemountOnValueChange>\n        </Sidebars>\n        {play && pause && seek && (\n          <div style={{ flexShrink: 0 }}>\n            <PlaybackControls\n              play={play}\n              pause={pause}\n              seek={seek}\n              playUntil={playUntil}\n              isPlaying={isPlaying}\n              getTimeInfo={getTimeInfo}\n            />\n          </div>\n        )}\n      </div>\n      <WorkspaceDialogs />\n    </MultiProvider>\n  );\n}\n\nexport default function Workspace(props: WorkspaceProps): JSX.Element {\n  return (\n    <WorkspaceContextProvider>\n      <WorkspaceContent {...props} />\n    </WorkspaceContextProvider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useMedia } from \"react-use\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport ThemeProvider from \"@foxglove/studio-base/theme/ThemeProvider\";\n\nexport function ColorSchemeThemeProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const [colorScheme = \"system\"] = useAppConfigurationValue<string>(AppSetting.COLOR_SCHEME);\n  const systemSetting = useMedia(\"(prefers-color-scheme: dark)\");\n  const isDark = colorScheme === \"dark\" || (colorScheme === \"system\" && systemSetting);\n  return <ThemeProvider isDark={isDark}>{children}</ThemeProvider>;\n}\n","\n      import API from \"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[9]!../../../../../node_modules/esbuild-loader/dist/index.js??ruleSet[1].rules[10]!./inter.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[9]!../../../../../node_modules/esbuild-loader/dist/index.js??ruleSet[1].rules[10]!./inter.css\";\n       export default content && content.locals ? content.locals : undefined;\n","\n      import API from \"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[9]!../../../../../node_modules/esbuild-loader/dist/index.js??ruleSet[1].rules[10]!./plex-mono.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[9]!../../../../../node_modules/esbuild-loader/dist/index.js??ruleSet[1].rules[10]!./plex-mono.css\";\n       export default content && content.locals ? content.locals : undefined;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { alpha } from \"@mui/material\";\nimport { PropsWithChildren } from \"react\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport \"@foxglove/studio-base/styles/assets/inter.css\";\nimport \"@foxglove/studio-base/styles/assets/plex-mono.css\";\n\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()(({ palette, typography }) => ({\n  root: {\n    // container styling\n    height: \"100%\",\n    width: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    flex: \"1 1 100%\",\n    overflow: \"hidden\",\n    background: palette.background.default,\n    color: palette.text.primary,\n    font: \"inherit\",\n    fontSize: typography.body2.fontSize,\n    fontFeatureSettings: typography.fontFeatureSettings,\n    fontFamily: typography.body2.fontFamily,\n    fontWeight: typography.body2.fontWeight,\n    zIndex: 0,\n\n    // Prevent scroll \"bouncing\" since the app workspace is not scrollable. Allows individual\n    // scrollable elements to be scrolled without the whole page moving (even if they don't\n    // preventDefault on scroll events).\n    overscrollBehavior: \"none\",\n\n    // https://github.com/necolas/normalize.css/blob/master/normalize.css#L12\n    lineHeight: 1.15,\n\n    /// --- child and element styling follows ---\n    \"code, pre, tt\": {\n      fontFamily: fonts.MONOSPACE,\n      overflowWrap: \"break-word\",\n    },\n    mark: {\n      color: palette.info.main,\n      fontWeight: 700,\n      backgroundColor: \"transparent\",\n    },\n    div: {\n      \"::-webkit-scrollbar\": {\n        width: 6,\n        height: 6,\n      },\n      \"::-webkit-scrollbar-corner\": {\n        background: \"transparent\",\n      },\n      \"::-webkit-scrollbar-track\": {\n        background: \"transparent\",\n      },\n      \"::-webkit-scrollbar-thumb\": {\n        background: palette.action.focus,\n        borderRadius: 0,\n      },\n    },\n    \"p:not([class^='Mui')\": {\n      margin: \"1em 0\",\n\n      \"&:last-child\": {\n        marginBottom: 0,\n      },\n    },\n    \"b, strong\": {\n      fontWeight: 700,\n    },\n    canvas: {\n      outline: \"none\",\n    },\n\n    // mosaic styling\n    \".mosaic\": {\n      \".mosaic-root\": {\n        top: 0,\n        left: 0,\n        bottom: 0,\n        right: 0,\n\n        \".drop-target-container .drop-target\": {\n          backgroundColor: palette.action.hover,\n          border: `2px solid ${alpha(palette.divider, 0.5)}`,\n        },\n        \".drop-target-container .drop-target-hover\": {\n          opacity: 1,\n        },\n      },\n      \".mosaic-tile\": {\n        margin: 0,\n      },\n      \".mosaic-tile:first-of-type\": {\n        // make room for splitters - unfortunately this means the background color will show\n        // through even if the tile has its own background color set\n        gap: 1,\n      },\n      // The last tile does not need a bottom margin\n      \".mosaic-tile:last-child\": {\n        marginBottom: 0,\n      },\n      // If there is only one tile in the container there are no splitters and no margin is needed\n      \".mosaic-tile:only-child\": {\n        margin: 0,\n      },\n      // tile immediately after a row splitter needs 1px margin so the splitter doesn't overlap the tile content\n      \".-row + .mosaic-tile\": {\n        gap: 1,\n      },\n      // tile immediately after a column splitter needs 1px margin so the splitter doesn't overlap the tile content\n      \".-column + .mosaic-tile\": {\n        gap: 1,\n      },\n      \".mosaic-window\": {\n        boxShadow: \"none\",\n        width: \"100%\",\n\n        // we use custom toolbars\n        \".mosaic-window-toolbar\": {\n          display: \"none\",\n        },\n        \".mosaic-window-body\": {\n          flex: \"1 1 auto\",\n          display: \"flex\",\n          background: \"unset\",\n          zIndex: \"unset\",\n        },\n      },\n      \".mosaic-preview\": {\n        maxHeight: \"none\",\n\n        // we use custom toolbars\n        \".mosaic-window-toolbar\": {\n          display: \"none\",\n        },\n        \".mosaic-window-body\": {\n          flex: \"1 1 auto\",\n          display: \"flex\",\n          background: \"unset\",\n          zIndex: \"unset\",\n        },\n      },\n      \".mosaic-window-toolbar\": {\n        display: \"none\",\n      },\n      \".mosaic-window-body\": {\n        flex: \"1 1 auto\",\n        display: \"flex\",\n        background: \"unset\",\n        zIndex: \"unset\",\n      },\n      \".mosaic-window-title\": {\n        fontSize: 12,\n        lineHeight: \"30px\",\n        paddingLeft: 5,\n      },\n      \".mosaic-split\": {\n        background: \"none !important\",\n        zIndex: 99,\n\n        \".mosaic-split-line\": {\n          boxShadow: `0 0 0 1px ${palette.divider}`,\n        },\n        \"&:hover .mosaic-split-line\": {\n          boxShadow: `0 0 0 1px ${\n            palette.mode === \"dark\"\n              ? tinycolor(palette.divider).lighten().toHexString()\n              : tinycolor(palette.divider).darken().toHexString()\n          }`,\n        },\n      },\n      \"&.borderless\": {\n        \".mosaic-split\": {\n          opacity: 0,\n\n          \"&:hover\": {\n            opacity: 1,\n          },\n        },\n        \".mosaic-tile\": {\n          margin: 0,\n        },\n      },\n    },\n\n    // leaflet GUI styling\n    \".leaflet-bar\": {\n      userSelect: \"none\",\n      backgroundColor: palette.background.paper,\n      borderRadius: 4,\n\n      a: {\n        lineHeight: 1.2,\n        backgroundColor: \"transparent\",\n        color: palette.text.primary,\n        borderBottomColor: palette.divider,\n\n        \"&:hover\": {\n          backgroundColor: palette.action.hover,\n          color: palette.text.primary,\n          borderBottomColor: palette.divider,\n        },\n        \"&:focus\": {\n          color: palette.text.primary,\n        },\n        \"&:active\": {\n          color: palette.text.primary,\n        },\n      },\n    },\n    \".leaflet-bar a.leaflet-disabled\": {\n      backgroundColor: palette.action.disabledBackground,\n      color: palette.text.disabled,\n\n      \"&:hover\": {\n        backgroundColor: palette.action.disabledBackground,\n      },\n    },\n  },\n}));\n\nexport default function CssBaseline(props: PropsWithChildren<unknown>): JSX.Element {\n  const { classes } = useStyles();\n\n  return <div className={classes.root}>{props.children}</div>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect } from \"react\";\n\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\n\nconst selectPlayerName = (ctx: MessagePipelineContext) => ctx.playerState.name;\n\n/**\n * DocumentTitleAdapter sets the document title based on the currently selected player\n */\nexport default function DocumentTitleAdapter(): JSX.Element {\n  const playerName = useMessagePipeline(selectPlayerName);\n\n  useEffect(() => {\n    if (!playerName) {\n      window.document.title = \"Foxglove Studio\";\n      return;\n    }\n    window.document.title = navigator.userAgent.includes(\"Mac\")\n      ? playerName\n      : `${playerName} – Foxglove Studio`;\n  }, [playerName]);\n\n  return <></>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nexport type NativeWindowEvent = \"enter-full-screen\" | \"leave-full-screen\";\n\ntype Handler = () => void;\nexport interface INativeWindow {\n  /** https://www.electronjs.org/docs/tutorial/represented-file */\n  setRepresentedFilename(filename: string | undefined): Promise<void>;\n\n  on(name: NativeWindowEvent, handler: Handler): void;\n  off(name: NativeWindowEvent, handler: Handler): void;\n}\n\nconst NativeWindowContext = createContext<INativeWindow | undefined>(undefined);\nNativeWindowContext.displayName = \"NativeWindowContext\";\n\nexport function useNativeWindow(): INativeWindow | undefined {\n  return useContext(NativeWindowContext);\n}\n\nexport default NativeWindowContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { set as idbSet, get as idbGet, createStore as idbCreateStore } from \"idb-keyval\";\nimport { isEqual } from \"lodash\";\nimport { useCallback, useLayoutEffect, useMemo, useRef, useState } from \"react\";\nimport { useAsync } from \"react-use\";\nimport { v4 as uuid } from \"uuid\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\nconst IDB_KEY = \"recents\";\nconst IDB_STORE = idbCreateStore(\"foxglove-recents\", \"recents\");\n\ntype RecentRecordCommon = {\n  // Record id - use IndexedDbRecentsStore.GenerateRecordId() to generate\n  id: string;\n\n  // The source id\n  sourceId: string;\n\n  // The primary text for the recent record\n  title: string;\n\n  // Optional label for the recent record\n  label?: string;\n};\n\ntype RecentConnectionRecord = RecentRecordCommon & {\n  type: \"connection\";\n  // Optional arguments stored with the recent entry\n  extra?: Record<string, string | undefined>;\n};\n\ntype RecentFileRecord = RecentRecordCommon & {\n  type: \"file\";\n  handle: FileSystemFileHandle; // foxglove-depcheck-used: @types/wicg-file-system-access\n};\n\ntype UnsavedRecentRecord = Omit<RecentConnectionRecord, \"id\"> | Omit<RecentFileRecord, \"id\">;\n\nexport type RecentRecord = RecentConnectionRecord | RecentFileRecord;\n\ninterface IRecentsStore {\n  // Recent records\n  recents: RecentRecord[];\n\n  // Add a new recent\n  addRecent: (newRecent: UnsavedRecentRecord) => void;\n\n  // Save changes\n  save: () => Promise<void>;\n}\n\nfunction useIndexedDbRecents(): IRecentsStore {\n  const { value: initialRecents, loading } = useAsync(\n    async () => await idbGet<RecentRecord[] | undefined>(IDB_KEY, IDB_STORE),\n    [],\n  );\n\n  const [recents, setRecents] = useState<RecentRecord[]>([]);\n\n  // Track new recents in a ref and update the state after persisting\n  const newRecentsRef = useRef<RecentRecord[]>([]);\n\n  const save = useCallback(async () => {\n    // We don't save until we've loaded our existing recents. This ensures we include stored recents when we save\n    if (loading) {\n      return;\n    }\n\n    // The new recent appears at the start of the list\n    const recentsToSave: RecentRecord[] = [];\n\n    // For every ref in newRecentsRef, we need to eliminate any potential duplicates already in\n    // recentsToSave\n    for (const newRecent of newRecentsRef.current) {\n      let exists = false;\n      for (const savedRecent of recentsToSave) {\n        if (exists) {\n          continue;\n        }\n\n        // Filter file recents to ignore any previous recent that match this record.\n        // This happens if we want to add a file to recents that we already have\n        if (\n          savedRecent.type === \"file\" &&\n          newRecent.type === savedRecent.type &&\n          (await savedRecent.handle.isSameEntry(newRecent.handle))\n        ) {\n          exists = true;\n        }\n\n        // Filter connection recents which match the same sourceId and extra args\n        if (\n          savedRecent.type === \"connection\" &&\n          newRecent.type === savedRecent.type &&\n          savedRecent.sourceId === newRecent.sourceId &&\n          isEqual(newRecent.extra, savedRecent.extra)\n        ) {\n          exists = true;\n        }\n      }\n\n      // Max 5 entries\n      if (!exists && recentsToSave.length < 5) {\n        recentsToSave.push(newRecent);\n      }\n    }\n\n    setRecents(recentsToSave);\n    idbSet(IDB_KEY, recentsToSave, IDB_STORE).catch((err) => {\n      log.error(err);\n    });\n  }, [loading]);\n\n  // Set the first load records from the store to the state\n  useLayoutEffect(() => {\n    if (loading) {\n      return;\n    }\n\n    const haveUnsavedRecents = newRecentsRef.current.length > 0;\n\n    if (initialRecents) {\n      newRecentsRef.current.push(...initialRecents);\n    }\n\n    if (haveUnsavedRecents) {\n      void save();\n    } else {\n      // No new recents by the time we loaded our initial recents so we don't need to save\n      // Normally a save invokes set - but since we don't need to save we set here\n      setRecents(newRecentsRef.current);\n    }\n  }, [loading, initialRecents, save]);\n\n  const addRecent = useCallback(\n    (record: UnsavedRecentRecord) => {\n      const fullRecord: RecentRecord = {\n        id: uuid(),\n        ...record,\n      };\n      newRecentsRef.current.unshift(fullRecord);\n      void save();\n    },\n    [save],\n  );\n\n  return useMemo<IRecentsStore>(() => {\n    return {\n      recents,\n      addRecent,\n      save,\n    };\n  }, [addRecent, recents, save]);\n}\n\nexport default useIndexedDbRecents;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useLayoutEffect, useRef } from \"react\";\n\nimport Log from \"@foxglove/log\";\n\nconst log = Log.getLogger(__filename);\n\n// useWarnImmediateReRender will warn if the component re-renders before the next animation frame\n// This typically indicates that the component state is changing in rapid succession and more\n// work is being done than necessary.\n//\n// Note: This detects state change triggers in useLayoutEffect. It does not detect state changes from\n// useEffect which run on the next animation frame.\nconst useWarnImmediateReRender =\n  process.env.NODE_ENV !== \"development\"\n    ? () => {}\n    : () => {\n        const renderedRef = useRef(false);\n        useLayoutEffect(() => {\n          if (renderedRef.current) {\n            log.warn(\"Component re-rendered immediately\");\n          }\n          renderedRef.current = true;\n          const raf = requestAnimationFrame(() => {\n            renderedRef.current = false;\n          });\n          return () => cancelAnimationFrame(raf);\n        });\n      };\n\nexport default useWarnImmediateReRender;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Log from \"@foxglove/log\";\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  PlayerMetricsCollectorInterface,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\nimport IAnalytics, { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst log = Log.getLogger(__filename);\n\ntype EventData = { [key: string]: string | number | boolean };\n\nexport default class AnalyticsMetricsCollector implements PlayerMetricsCollectorInterface {\n  private metadata: EventData = {};\n  private _analytics: IAnalytics;\n\n  public constructor(analytics: IAnalytics) {\n    log.debug(\"New AnalyticsMetricsCollector\");\n    this._analytics = analytics;\n  }\n\n  public setProperty(key: string, value: string | number | boolean): void {\n    this.metadata[key] = value;\n  }\n\n  public logEvent(event: AppEvent, data?: EventData): void {\n    void this._analytics.logEvent(event, { ...this.metadata, ...data });\n  }\n\n  public playerConstructed(): void {\n    this.logEvent(AppEvent.PLAYER_CONSTRUCTED);\n  }\n\n  public play(speed: number): void {\n    this.logEvent(AppEvent.PLAYER_PLAY, { speed });\n  }\n\n  public seek(_time: Time): void {\n    // NOTE: This event fires in more cases than user interaction\n  }\n\n  public setSpeed(_speed: number): void {\n    // NOTE: This event fires in more cases than user interaction\n  }\n\n  public pause(): void {\n    this.logEvent(AppEvent.PLAYER_PAUSE);\n  }\n\n  public close(): void {\n    this.logEvent(AppEvent.PLAYER_CLOSE);\n  }\n\n  public setSubscriptions(_subscriptions: SubscribePayload[]): void {}\n\n  public recordBytesReceived(_bytes: number): void {}\n\n  public recordPlaybackTime(_time: Time, _params: { stillLoadingData: boolean }): void {}\n\n  public recordDataProviderPerformance(\n    _metadata: Readonly<{\n      type: \"average_throughput\";\n      totalSizeOfMessages: number;\n      numberOfMessages: number;\n      requestedRangeDuration: Time;\n      receivedRangeDuration: Time;\n      topics: readonly string[];\n      totalTransferTime: Time;\n    }>,\n  ): void {}\n\n  public recordUncachedRangeRequest(): void {}\n\n  public recordTimeToFirstMsgs(): void {}\n\n  public recordDataProviderInitializePerformance(\n    _metadata: Readonly<{\n      type: \"initializationPerformance\";\n      dataProviderType: string;\n      metrics: { [metricName: string]: string | number };\n    }>,\n  ): void {}\n\n  public recordDataProviderStall(\n    _metadata: Readonly<{\n      type: \"data_provider_stall\";\n      stallDuration: Time;\n      requestTimeUntilStall: Time;\n      transferTimeUntilStall: Time;\n      bytesReceivedBeforeStall: number;\n    }>,\n  ): void {}\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\ntype Args = { topics: Topic[]; datatypes: RosDatatypes };\ntype LibGeneratorFn = (args: Args) => Promise<string>;\n\n/**\n * LibGenerator memoizes generating a library from topics and datatypes.\n *\n * Calling `update` returns a boolean to indicate if the library was re-generated and the\n * library source code.\n *\n * If the args to update are unchanged (same topics and datatyes), then the previously\n * generated value from `fn` is returned.\n */\nclass MemoizedLibGenerator {\n  private datatypes?: RosDatatypes;\n  private topics?: Topic[];\n  private fn: LibGeneratorFn;\n  private cached?: string;\n\n  public constructor(fn: LibGeneratorFn) {\n    this.fn = fn;\n  }\n\n  /**\n   * Update the library with new args.\n   * If the arg fields have changed, the generator function is run to make a new library.\n   *\n   * Return whether the cached value was updated and the cached value.\n   */\n  public async update(args: Args): Promise<{ didUpdate: boolean; lib: string }> {\n    if (\n      args.topics === this.topics &&\n      args.datatypes === this.datatypes &&\n      this.cached != undefined\n    ) {\n      return { didUpdate: false, lib: this.cached };\n    }\n\n    const lib = await this.fn(args);\n    this.topics = args.topics;\n    this.datatypes = args.datatypes;\n    this.cached = lib;\n    return { didUpdate: true, lib };\n  }\n}\n\nexport { MemoizedLibGenerator };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2020-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { DiagnosticSeverity, NodeData } from \"@foxglove/studio-base/players/UserNodePlayer/types\";\n\nexport const hasTransformerErrors = (nodeData: NodeData): boolean =>\n  nodeData.diagnostics.some(({ severity }) => severity === DiagnosticSeverity.Error);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ros1, ros2galactic } from \"@foxglove/rosmsg-msgs-common\";\nimport { foxgloveMessageSchemas, generateRosMsgDefinition } from \"@foxglove/schemas/internal\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\n/**\n * basicDatatypes is a map containing definitions for ROS common datatypes and foxglove datatypes\n * from the following packages:\n *\n * - @foxglove/rosmsgs-msg-common\n * - @foxglove/schemas\n */\nexport const basicDatatypes: RosDatatypes = new Map();\n\n// Add ROS2 message schemas\nfor (const [name, def] of Object.entries(ros2galactic)) {\n  basicDatatypes.set(name, def);\n}\n\n// Add ROS1 message schemas\nfor (const [name, def] of Object.entries(ros1)) {\n  basicDatatypes.set(name, def);\n}\n\n// Add foxglove message schemas\nfor (const schema of Object.values(foxgloveMessageSchemas)) {\n  const definition = generateRosMsgDefinition(schema, { rosVersion: 1 });\n  basicDatatypes.set(definition.rosMsgInterfaceName, {\n    name: definition.rosMsgInterfaceName,\n    definitions: definition.fields,\n  });\n  basicDatatypes.set(`foxglove.${schema.name}`, {\n    name: `foxglove.${schema.name}`,\n    definitions: definition.fields,\n  });\n}\n\n// Add the legacy foxglove_msgs/ImageMarkerArray message definition\nbasicDatatypes.set(\"foxglove_msgs/ImageMarkerArray\", {\n  definitions: [\n    { name: \"markers\", type: \"visualization_msgs/ImageMarker\", isComplex: true, isArray: true },\n  ],\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { isEqual, uniq } from \"lodash\";\nimport memoizeWeak from \"memoize-weak\";\nimport ReactDOM from \"react-dom\";\nimport shallowequal from \"shallowequal\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { Condvar, MutexLocked } from \"@foxglove/den/async\";\nimport Log from \"@foxglove/log\";\nimport { Time, compare } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { MemoizedLibGenerator } from \"@foxglove/studio-base/players/UserNodePlayer/MemoizedLibGenerator\";\nimport { generateTypesLib } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/generateTypesLib\";\nimport { TransformArgs } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/types\";\nimport {\n  Diagnostic,\n  DiagnosticSeverity,\n  ErrorCodes,\n  NodeData,\n  NodeRegistration,\n  ProcessMessageOutput,\n  RegistrationOutput,\n  Sources,\n  UserNodeLog,\n} from \"@foxglove/studio-base/players/UserNodePlayer/types\";\nimport { hasTransformerErrors } from \"@foxglove/studio-base/players/UserNodePlayer/utils\";\nimport {\n  AdvertiseOptions,\n  Player,\n  PlayerState,\n  PlayerStateActiveData,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  MessageEvent,\n  PlayerProblem,\n  MessageBlock,\n} from \"@foxglove/studio-base/players/types\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { UserNode, UserNodes } from \"@foxglove/studio-base/types/panels\";\nimport Rpc from \"@foxglove/studio-base/util/Rpc\";\nimport { basicDatatypes } from \"@foxglove/studio-base/util/basicDatatypes\";\n\nconst log = Log.getLogger(__filename);\n\n// TypeScript's built-in lib only accepts strings for the scriptURL. However, webpack only\n// understands `new URL()` to properly build the worker entry point:\n// https://github.com/webpack/webpack/issues/13043\ndeclare let SharedWorker: {\n  prototype: SharedWorker;\n  new (scriptURL: URL, options?: string | WorkerOptions): SharedWorker;\n};\n\ntype UserNodeActions = {\n  setUserNodeDiagnostics: (nodeId: string, diagnostics: readonly Diagnostic[]) => void;\n  addUserNodeLogs: (nodeId: string, logs: readonly UserNodeLog[]) => void;\n  setUserNodeRosLib: (rosLib: string) => void;\n  setUserNodeTypesLib: (lib: string) => void;\n};\n\ntype NodeRegistrationCacheItem = {\n  nodeId: string;\n  userNode: UserNode;\n  result: NodeRegistration;\n};\n\nfunction maybePlainObject(rawVal: unknown) {\n  if (typeof rawVal === \"object\" && rawVal && \"toJSON\" in rawVal) {\n    return (rawVal as { toJSON: () => unknown }).toJSON();\n  }\n  return rawVal;\n}\n\n/** Mutable state protected by a mutex lock */\ntype ProtectedState = {\n  nodeRegistrationCache: NodeRegistrationCacheItem[];\n  nodeRegistrations: readonly NodeRegistration[];\n  lastPlayerStateActiveData?: PlayerStateActiveData;\n  userNodes: UserNodes;\n\n  /**\n   * Map of output topics to input topics. To produce an output we need to know the input topics\n   * that a script requires. When subscribers subscribe to the output topic, the user node player\n   * subscribes to the underlying input topics.\n   */\n  inputsByOutputTopic: Map<string, readonly string[]>;\n};\n\nexport default class UserNodePlayer implements Player {\n  private _player: Player;\n\n  // Datatypes and topics are derived from nodeRegistrations, but memoized so they only change when needed\n  private _memoizedNodeDatatypes: readonly RosDatatypes[] = [];\n  private _memoizedNodeTopics: readonly Topic[] = [];\n\n  private _subscriptions: SubscribePayload[] = [];\n  private _nodeSubscriptions: Record<string, SubscribePayload> = {};\n\n  // listener for state updates\n  private _listener?: (arg0: PlayerState) => Promise<void>;\n\n  // Not sure if there is perf issue with unused workers (may just go idle) - requires more research\n  private _unusedNodeRuntimeWorkers: Rpc[] = [];\n  private _setUserNodeDiagnostics: (nodeId: string, diagnostics: readonly Diagnostic[]) => void;\n  private _addUserNodeLogs: (nodeId: string, logs: UserNodeLog[]) => void;\n  private _nodeTransformRpc?: Rpc;\n  private _globalVariables: GlobalVariables = {};\n  private _userNodeActions: UserNodeActions;\n  private _rosLibGenerator: MemoizedLibGenerator;\n  private _typesLibGenerator: MemoizedLibGenerator;\n\n  // Player state changes when the child player invokes our player state listener\n  // we may also emit state changes on internal errors\n  private _playerState?: PlayerState;\n\n  // The store tracks problems for individual userspace nodes\n  // a node may set its own problem or clear its problem\n  private _problemStore = new Map<string, PlayerProblem>();\n\n  // keep track of last message on all topics to recompute output topic messages when user nodes change\n  private _lastMessageByInputTopic = new Map<string, MessageEvent<unknown>>();\n  private _userNodeIdsNeedUpdate = new Set<string>();\n  private _globalVariablesChanged = false;\n\n  private _protectedState = new MutexLocked<ProtectedState>({\n    userNodes: {},\n    nodeRegistrations: [],\n    nodeRegistrationCache: [],\n    lastPlayerStateActiveData: undefined,\n    inputsByOutputTopic: new Map(),\n  });\n\n  // exposed as a static to allow testing to mock/replace\n  private static CreateNodeTransformWorker = (): SharedWorker => {\n    // foxglove-depcheck-used: babel-plugin-transform-import-meta\n    return new SharedWorker(new URL(\"./nodeTransformerWorker/index\", import.meta.url), {\n      // Although we are using SharedWorkers, we do not actually want to share worker instances\n      // between tabs. We achieve this by passing in a unique name.\n      name: uuidv4(),\n    });\n  };\n\n  // exposed as a static to allow testing to mock/replace\n  private static CreateNodeRuntimeWorker = (): SharedWorker => {\n    // foxglove-depcheck-used: babel-plugin-transform-import-meta\n    return new SharedWorker(new URL(\"./nodeRuntimeWorker/index\", import.meta.url), {\n      // Although we are using SharedWorkers, we do not actually want to share worker instances\n      // between tabs. We achieve this by passing in a unique name.\n      name: uuidv4(),\n    });\n  };\n\n  public constructor(player: Player, userNodeActions: UserNodeActions) {\n    this._player = player;\n    this._userNodeActions = userNodeActions;\n    const { setUserNodeDiagnostics, addUserNodeLogs } = userNodeActions;\n\n    this._setUserNodeDiagnostics = (nodeId: string, diagnostics: readonly Diagnostic[]) => {\n      setUserNodeDiagnostics(nodeId, diagnostics);\n    };\n    this._addUserNodeLogs = (nodeId: string, logs: UserNodeLog[]) => {\n      if (logs.length > 0) {\n        addUserNodeLogs(nodeId, logs);\n      }\n    };\n\n    this._typesLibGenerator = new MemoizedLibGenerator(async (args) => {\n      const lib = generateTypesLib({\n        topics: args.topics,\n        datatypes: new Map([...basicDatatypes, ...args.datatypes]),\n      });\n\n      // Do not prettify the types library as it can cause severe performance\n      // degradations. This is OK because the generated types library is\n      // read-only and should be rarely read by a human. Further, the\n      // not-prettified code is not that bad either. It just lacks the\n      // appropriate indentations.\n      return lib;\n    });\n\n    this._rosLibGenerator = new MemoizedLibGenerator(async (args) => {\n      const transformWorker = this._getTransformWorker();\n      return await transformWorker.send(\"generateRosLib\", {\n        topics: args.topics,\n        // Include basic datatypes along with any custom datatypes.\n        // Custom datatypes appear as the second array items to override any basicDatatype items\n        datatypes: new Map([...basicDatatypes, ...args.datatypes]),\n      });\n    });\n  }\n\n  private _getTopics = memoizeWeak(\n    (topics: readonly Topic[], nodeTopics: readonly Topic[]): Topic[] => [...topics, ...nodeTopics],\n  );\n\n  private _getDatatypes = memoizeWeak(\n    (datatypes: RosDatatypes, nodeDatatypes: readonly RosDatatypes[]): RosDatatypes => {\n      return nodeDatatypes.reduce(\n        (allDatatypes, userNodeDatatypes) => new Map([...allDatatypes, ...userNodeDatatypes]),\n        new Map([...datatypes, ...basicDatatypes]),\n      );\n    },\n  );\n\n  private _lastBlockRequest: {\n    input?: {\n      blocks: readonly (MessageBlock | undefined)[];\n      globalVariables: GlobalVariables;\n      nodeRegistrations: readonly NodeRegistration[];\n    };\n    result: (MessageBlock | undefined)[];\n  } = { result: [] };\n\n  // Basic memoization by remembering the last values passed to getMessages\n  private _lastGetMessagesInput: {\n    parsedMessages: readonly MessageEvent<unknown>[];\n    globalVariables: GlobalVariables;\n    nodeRegistrations: readonly NodeRegistration[];\n  } = { parsedMessages: [], globalVariables: {}, nodeRegistrations: [] };\n  private _lastGetMessagesResult: { parsedMessages: readonly MessageEvent<unknown>[] } = {\n    parsedMessages: [],\n  };\n\n  // Processes input messages through nodes to create messages on output topics\n  // Memoized to prevent reprocessing on same input\n  private async _getMessages(\n    parsedMessages: readonly MessageEvent<unknown>[],\n    globalVariables: GlobalVariables,\n    nodeRegistrations: readonly NodeRegistration[],\n  ): Promise<{\n    parsedMessages: readonly MessageEvent<unknown>[];\n  }> {\n    // prevents from memoizing results for empty requests\n    if (parsedMessages.length === 0) {\n      return { parsedMessages };\n    }\n    if (\n      shallowequal(this._lastGetMessagesInput, {\n        parsedMessages,\n        globalVariables,\n        nodeRegistrations,\n      })\n    ) {\n      return this._lastGetMessagesResult;\n    }\n    const parsedMessagesPromises: Promise<MessageEvent<unknown> | undefined>[] = [];\n    for (const message of parsedMessages) {\n      const messagePromises = [];\n      for (const nodeRegistration of nodeRegistrations) {\n        if (\n          this._nodeSubscriptions[nodeRegistration.output.name] &&\n          nodeRegistration.inputs.includes(message.topic)\n        ) {\n          const messagePromise = nodeRegistration.processMessage(message, globalVariables);\n          messagePromises.push(messagePromise);\n          parsedMessagesPromises.push(messagePromise);\n        }\n      }\n      await Promise.all(messagePromises);\n    }\n\n    const nodeParsedMessages = (await Promise.all(parsedMessagesPromises)).filter(\n      (value): value is MessageEvent<unknown> => value != undefined,\n    );\n\n    const result = {\n      parsedMessages: parsedMessages\n        .concat(nodeParsedMessages)\n        .sort((a, b) => compare(a.receiveTime, b.receiveTime)),\n    };\n    this._lastGetMessagesInput = { parsedMessages, globalVariables, nodeRegistrations };\n    this._lastGetMessagesResult = result;\n    return result;\n  }\n\n  private async _getBlocks(\n    blocks: readonly (MessageBlock | undefined)[],\n    globalVariables: GlobalVariables,\n    nodeRegistrations: readonly NodeRegistration[],\n  ): Promise<readonly (MessageBlock | undefined)[]> {\n    if (\n      shallowequal(this._lastBlockRequest.input, {\n        blocks,\n        globalVariables,\n        nodeRegistrations,\n      })\n    ) {\n      return this._lastBlockRequest.result;\n    }\n\n    // If no downstream subscriptions want blocks for our output topics we can just pass through\n    // the blocks from the underlying player.\n    const fullRegistrations = nodeRegistrations.filter(\n      (reg) => this._nodeSubscriptions[reg.output.name]?.preloadType === \"full\",\n    );\n    if (fullRegistrations.length === 0) {\n      return blocks;\n    }\n\n    const allInputTopics = uniq(fullRegistrations.flatMap((reg) => reg.inputs));\n\n    const outputBlocks: (MessageBlock | undefined)[] = [];\n    for (const block of blocks) {\n      if (!block) {\n        outputBlocks.push(block);\n        continue;\n      }\n\n      // Flatten and re-sort block messages so that nodes see them in the same order\n      // as the non-block nodes.\n      const messagesByTopic = { ...block.messagesByTopic };\n      const blockMessages = allInputTopics\n        .flatMap((topic) => messagesByTopic[topic] ?? [])\n        .sort((a, b) => compare(a.receiveTime, b.receiveTime));\n      for (const nodeRegistration of fullRegistrations) {\n        const outTopic = nodeRegistration.output.name;\n        // Clear out any previously processed messages that were previously in the output topic.\n        // otherwise it will contain duplicates.\n        if (messagesByTopic[outTopic] != undefined) {\n          messagesByTopic[outTopic] = [];\n        }\n\n        for (const message of blockMessages) {\n          if (nodeRegistration.inputs.includes(message.topic)) {\n            const outputMessage = await nodeRegistration.processMessage(message, globalVariables);\n            if (outputMessage) {\n              // https://github.com/typescript-eslint/typescript-eslint/issues/6632\n              if (!messagesByTopic[outTopic]) {\n                messagesByTopic[outTopic] = [];\n              }\n              messagesByTopic[outTopic]?.push(outputMessage);\n            }\n          }\n        }\n      }\n\n      // Note that this size doesn't include the new processed messqges. We may need\n      // to recalculate this if it turns out to be important for good cache eviction\n      // behavior.\n      outputBlocks.push({\n        messagesByTopic,\n        sizeInBytes: block.sizeInBytes,\n      });\n    }\n\n    this._lastBlockRequest = {\n      input: { blocks, globalVariables, nodeRegistrations },\n      result: outputBlocks,\n    };\n\n    return outputBlocks;\n  }\n\n  public setGlobalVariables(globalVariables: GlobalVariables): void {\n    this._globalVariables = globalVariables;\n    this._globalVariablesChanged = true;\n  }\n\n  // Called when userNode state is updated.\n  public async setUserNodes(userNodes: UserNodes): Promise<void> {\n    await this._protectedState.runExclusive(async (state) => {\n      for (const nodeId of Object.keys(userNodes)) {\n        const prevNode = state.userNodes[nodeId];\n        const newNode = userNodes[nodeId];\n        if (prevNode && newNode && prevNode.sourceCode !== newNode.sourceCode) {\n          // if source code of a userNode changed then we need to mark it for re-processing input messages\n          this._userNodeIdsNeedUpdate.add(nodeId);\n        }\n      }\n      state.userNodes = userNodes;\n\n      // Prune the node registration cache so it doesn't grow forever.\n      // We add one to the count so we don't have to recompile nodes if users undo/redo node changes.\n      const maxNodeRegistrationCacheCount = Object.keys(userNodes).length + 1;\n      state.nodeRegistrationCache.splice(maxNodeRegistrationCacheCount);\n      // This code causes us to reset workers twice because the seeking resets the workers too\n      await this._resetWorkersUnlocked(state);\n      this._setSubscriptionsUnlocked(this._subscriptions, state);\n    });\n  }\n\n  // Defines the inputs/outputs and worker interface of a user node.\n  private async _createNodeRegistration(\n    nodeId: string,\n    userNode: UserNode,\n    state: ProtectedState,\n    rosLib: string,\n    typesLib: string,\n  ): Promise<NodeRegistration> {\n    for (const cacheEntry of state.nodeRegistrationCache) {\n      if (nodeId === cacheEntry.nodeId && isEqual(userNode, cacheEntry.userNode)) {\n        return cacheEntry.result;\n      }\n    }\n    // Pass all the nodes a set of basic datatypes that we know how to render.\n    // These could be overwritten later by bag datatypes, but these datatype definitions should be very stable.\n    const { topics = [], datatypes = new Map() } = state.lastPlayerStateActiveData ?? {};\n    const nodeDatatypes: RosDatatypes = new Map([...basicDatatypes, ...datatypes]);\n\n    const { name, sourceCode } = userNode;\n    const transformMessage: TransformArgs = {\n      name,\n      sourceCode,\n      topics,\n      rosLib,\n      typesLib,\n      datatypes: nodeDatatypes,\n    };\n    const transformWorker = this._getTransformWorker();\n    const nodeData = await transformWorker.send<NodeData>(\"transform\", transformMessage);\n    const { inputTopics, outputTopic, transpiledCode, projectCode, outputDatatype } = nodeData;\n\n    let rpc: Rpc | undefined;\n    const terminateCondvar = new Condvar();\n\n    // problemKey is a unique identifier for each userspace node so we can manage problems from\n    // a specific node. A node may have a problem that may later clear. Using the key we can add/remove\n    // problems for specific userspace nodes independently of other userspace nodes.\n    const problemKey = `node-id-${nodeId}`;\n    const buildMessageProcessor = (): NodeRegistration[\"processMessage\"] => {\n      return async (msgEvent: MessageEvent<unknown>, globalVariables: GlobalVariables) => {\n        const terminateSignal = terminateCondvar.wait();\n\n        // Register the node within a web worker to be executed.\n        if (!rpc) {\n          rpc = this._unusedNodeRuntimeWorkers.pop();\n\n          // initialize a new worker since no unused one is available\n          if (!rpc) {\n            const worker = UserNodePlayer.CreateNodeRuntimeWorker();\n\n            worker.onerror = (event) => {\n              log.error(event);\n\n              this._problemStore.set(problemKey, {\n                message: `User script runtime error: ${event.message}`,\n                severity: \"error\",\n              });\n\n              // trigger listener updates\n              void this._emitState();\n            };\n\n            const port: MessagePort = worker.port;\n            port.onmessageerror = (event) => {\n              log.error(event);\n\n              this._problemStore.set(problemKey, {\n                severity: \"error\",\n                message: `User script runtime error: ${String(event.data)}`,\n              });\n\n              void this._emitState();\n            };\n            port.start();\n            rpc = new Rpc(port);\n\n            rpc.receive(\"error\", (msg) => {\n              log.error(msg);\n\n              this._problemStore.set(problemKey, {\n                severity: \"error\",\n                message: `User script runtime error: ${msg}`,\n              });\n\n              void this._emitState();\n            });\n          }\n\n          const { error, userNodeDiagnostics, userNodeLogs } = await rpc.send<RegistrationOutput>(\n            \"registerNode\",\n            {\n              projectCode,\n              nodeCode: transpiledCode,\n            },\n          );\n          if (error != undefined) {\n            this._setUserNodeDiagnostics(nodeId, [\n              ...userNodeDiagnostics,\n              {\n                source: Sources.Runtime,\n                severity: DiagnosticSeverity.Error,\n                message: error,\n                code: ErrorCodes.RUNTIME,\n              },\n            ]);\n            return;\n          }\n          this._addUserNodeLogs(nodeId, userNodeLogs);\n        }\n\n        // To send the message over RPC we invoke maybePlainObject which calls toJSON on the message\n        // and builds a plain js object of the entire message. This is expensive so a future enhancement\n        // would be to send the underlying message array and build a lazy message reader\n        const result = await Promise.race([\n          rpc.send<ProcessMessageOutput>(\"processMessage\", {\n            message: {\n              topic: msgEvent.topic,\n              receiveTime: msgEvent.receiveTime,\n              message: maybePlainObject(msgEvent.message),\n              datatype: msgEvent.schemaName,\n            },\n            globalVariables,\n          }),\n          terminateSignal,\n        ]);\n\n        if (!result) {\n          this._problemStore.set(problemKey, {\n            message: `User Script ${nodeId} timed out`,\n            severity: \"warn\",\n          });\n          return;\n        }\n\n        const allDiagnostics = result.userNodeDiagnostics;\n        if (result.error) {\n          allDiagnostics.push({\n            source: Sources.Runtime,\n            severity: DiagnosticSeverity.Error,\n            message: result.error,\n            code: ErrorCodes.RUNTIME,\n          });\n        }\n\n        this._addUserNodeLogs(nodeId, result.userNodeLogs);\n\n        if (allDiagnostics.length > 0) {\n          this._problemStore.set(problemKey, {\n            severity: \"error\",\n            message: `User Script ${nodeId} encountered an error.`,\n            tip: \"Open the User Scripts panel and check the Problems tab for errors.\",\n          });\n\n          this._setUserNodeDiagnostics(nodeId, allDiagnostics);\n          return;\n        }\n\n        if (!result.message) {\n          this._problemStore.set(problemKey, {\n            severity: \"warn\",\n            message: `User Script ${nodeId} did not produce a message.`,\n            tip: \"Check that all code paths in the user script return a message.\",\n          });\n          return;\n        }\n\n        // At this point we've received a message successfully from the userspace node, therefore\n        // we clear any previous problem from this node.\n        this._problemStore.delete(problemKey);\n\n        return {\n          topic: outputTopic,\n          receiveTime: msgEvent.receiveTime,\n          message: result.message,\n          sizeInBytes: msgEvent.sizeInBytes,\n          schemaName: outputDatatype,\n        };\n      };\n    };\n\n    const terminate = () => {\n      this._problemStore.delete(problemKey);\n      terminateCondvar.notifyAll();\n      if (rpc) {\n        this._unusedNodeRuntimeWorkers.push(rpc);\n        rpc = undefined;\n      }\n    };\n\n    const result: NodeRegistration = {\n      nodeId,\n      nodeData,\n      inputs: inputTopics,\n      output: { name: outputTopic, schemaName: outputDatatype },\n      processMessage: buildMessageProcessor(),\n      processBlockMessage: buildMessageProcessor(),\n      terminate,\n    };\n    state.nodeRegistrationCache.push({ nodeId, userNode, result });\n    return result;\n  }\n\n  private _getTransformWorker(): Rpc {\n    if (!this._nodeTransformRpc) {\n      const worker = UserNodePlayer.CreateNodeTransformWorker();\n\n      // The errors below persist for the lifetime of the player.\n      // They are not cleared because they are irrecoverable.\n\n      worker.onerror = (event) => {\n        log.error(event);\n\n        this._problemStore.set(\"worker-error\", {\n          severity: \"error\",\n          message: `User Script error: ${event.message}`,\n        });\n\n        void this._emitState();\n      };\n\n      const port: MessagePort = worker.port;\n      port.onmessageerror = (event) => {\n        log.error(event);\n\n        this._problemStore.set(\"worker-error\", {\n          severity: \"error\",\n          message: `User Script error: ${String(event.data)}`,\n        });\n\n        void this._emitState();\n      };\n      port.start();\n      const rpc = new Rpc(port);\n\n      rpc.receive(\"error\", (msg) => {\n        log.error(msg);\n\n        this._problemStore.set(\"worker-error\", {\n          severity: \"error\",\n          message: `User Script error: ${msg}`,\n        });\n\n        void this._emitState();\n      });\n\n      this._nodeTransformRpc = rpc;\n    }\n    return this._nodeTransformRpc;\n  }\n\n  // We need to reset workers in a variety of circumstances:\n  // - When a user node is updated, added or deleted\n  // - When we seek (in order to reset state)\n  // - When a new child player is added\n  private async _resetWorkersUnlocked(state: ProtectedState): Promise<void> {\n    if (!state.lastPlayerStateActiveData) {\n      return;\n    }\n\n    // This early return is an optimization measure so that the\n    // `nodeRegistrations` array is not re-defined, which will invalidate\n    // downstream caches. (i.e. `this._getTopics`)\n    if (state.nodeRegistrations.length === 0 && Object.entries(state.userNodes).length === 0) {\n      return;\n    }\n\n    for (const nodeRegistration of state.nodeRegistrations) {\n      nodeRegistration.terminate();\n    }\n\n    const rosLib = await this._getRosLib(state);\n    const typesLib = await this._getTypesLib(state);\n\n    const allNodeRegistrations = await Promise.all(\n      Object.entries(state.userNodes).map(\n        async ([nodeId, userNode]) =>\n          await this._createNodeRegistration(nodeId, userNode, state, rosLib, typesLib),\n      ),\n    );\n\n    const validNodeRegistrations: NodeRegistration[] = [];\n    const playerTopics = new Set(state.lastPlayerStateActiveData.topics.map((topic) => topic.name));\n    const allNodeOutputs = new Set(\n      allNodeRegistrations.map(({ nodeData }) => nodeData.outputTopic),\n    );\n\n    // Clear the output -> input map and re-populate it again with with all the node registrations\n    state.inputsByOutputTopic.clear();\n\n    for (const nodeRegistration of allNodeRegistrations) {\n      const { nodeData, nodeId } = nodeRegistration;\n\n      if (!nodeData.outputTopic) {\n        this._setUserNodeDiagnostics(nodeId, [\n          ...nodeData.diagnostics,\n          {\n            severity: DiagnosticSeverity.Error,\n            message: `Output topic cannot be an empty string.`,\n            source: Sources.OutputTopicChecker,\n            code: ErrorCodes.OutputTopicChecker.NOT_UNIQUE,\n          },\n        ]);\n        continue;\n      }\n\n      // Create diagnostic errors if more than one node outputs to the same topic\n      if (state.inputsByOutputTopic.has(nodeData.outputTopic)) {\n        this._setUserNodeDiagnostics(nodeId, [\n          ...nodeData.diagnostics,\n          {\n            severity: DiagnosticSeverity.Error,\n            message: `Output \"${nodeData.outputTopic}\" must be unique`,\n            source: Sources.OutputTopicChecker,\n            code: ErrorCodes.OutputTopicChecker.NOT_UNIQUE,\n          },\n        ]);\n        continue;\n      }\n\n      // Record the required input topics to service this output topic\n      state.inputsByOutputTopic.set(nodeData.outputTopic, nodeData.inputTopics);\n\n      // Create diagnostic errors if node outputs overlap with real topics\n      if (playerTopics.has(nodeData.outputTopic)) {\n        this._setUserNodeDiagnostics(nodeId, [\n          ...nodeData.diagnostics,\n          {\n            severity: DiagnosticSeverity.Error,\n            message: `Output topic \"${nodeData.outputTopic}\" is already present in the data source`,\n            source: Sources.OutputTopicChecker,\n            code: ErrorCodes.OutputTopicChecker.EXISTING_TOPIC,\n          },\n        ]);\n        continue;\n      }\n\n      // Filter out nodes with compilation errors\n      if (hasTransformerErrors(nodeData)) {\n        this._setUserNodeDiagnostics(nodeId, nodeData.diagnostics);\n        continue;\n      }\n\n      // Throw if nodes use other nodes' outputs as inputs. We should never get here because we\n      // already prevent outputs from being the same as real topics in the data source, and we\n      // already filter out input topics that aren't present in the data source.\n      for (const input of nodeData.inputTopics) {\n        if (allNodeOutputs.has(input)) {\n          throw new Error(`Input \"${input}\" cannot equal another node's output`);\n        }\n      }\n\n      validNodeRegistrations.push(nodeRegistration);\n    }\n\n    state.nodeRegistrations = validNodeRegistrations;\n    const nodeTopics = state.nodeRegistrations.map(({ output }) => output);\n    if (!isEqual(nodeTopics, this._memoizedNodeTopics)) {\n      this._memoizedNodeTopics = nodeTopics;\n    }\n    const nodeDatatypes = state.nodeRegistrations.map(({ nodeData: { datatypes } }) => datatypes);\n    if (!isEqual(nodeDatatypes, this._memoizedNodeDatatypes)) {\n      this._memoizedNodeDatatypes = nodeDatatypes;\n    }\n\n    // We need to set the user node diagnostics, which is a react set state\n    // function. This is called once per user script. Since this is in an async\n    // function, the state updates will not be batched below React 18 and React\n    // will update components synchronously during the set state. In a complex\n    // layout, each of the following _setUserNodeDiagnostics call result in\n    // ~100ms of latency. With many scripts, this can turn into a multi-second\n    // stall during layout switching.\n    //\n    // By batching the state update, unnecessary component updates are avoided\n    // and performance is improved for layout switching and initial loading.\n    //\n    // Moving to React 18 should remove the need for this call.\n    ReactDOM.unstable_batchedUpdates(() => {\n      for (const nodeRegistration of state.nodeRegistrations) {\n        this._setUserNodeDiagnostics(nodeRegistration.nodeId, []);\n      }\n    });\n  }\n\n  private async _getRosLib(state: ProtectedState): Promise<string> {\n    if (!state.lastPlayerStateActiveData) {\n      throw new Error(\"_getRosLib was called before `_lastPlayerStateActiveData` set\");\n    }\n\n    const { topics, datatypes } = state.lastPlayerStateActiveData;\n    const { didUpdate, lib } = await this._rosLibGenerator.update({ topics, datatypes });\n    if (didUpdate) {\n      this._userNodeActions.setUserNodeRosLib(lib);\n    }\n\n    return lib;\n  }\n\n  private async _getTypesLib(state: ProtectedState): Promise<string> {\n    if (!state.lastPlayerStateActiveData) {\n      throw new Error(\"_getTypesLib was called before `_lastPlayerStateActiveData` set\");\n    }\n\n    const { topics, datatypes } = state.lastPlayerStateActiveData;\n    const { didUpdate, lib } = await this._typesLibGenerator.update({ topics, datatypes });\n    if (didUpdate) {\n      this._userNodeActions.setUserNodeTypesLib(lib);\n    }\n\n    return lib;\n  }\n\n  // invoked when our child player state changes\n  private async _onPlayerState(playerState: PlayerState) {\n    try {\n      const globalVariables = this._globalVariables;\n      const { activeData } = playerState;\n      if (!activeData) {\n        this._playerState = playerState;\n        await this._emitState();\n        return;\n      }\n\n      const { messages, topics, datatypes } = activeData;\n\n      // If we do not have active player data from a previous call, then our\n      // player just spun up, meaning we should re-run our user nodes in case\n      // they have inputs that now exist in the current player context.\n      const newPlayerState = await this._protectedState.runExclusive(async (state) => {\n        if (!state.lastPlayerStateActiveData) {\n          state.lastPlayerStateActiveData = activeData;\n          await this._resetWorkersUnlocked(state);\n          this._setSubscriptionsUnlocked(this._subscriptions, state);\n        } else {\n          // Reset node state after seeking\n          let shouldReset =\n            activeData.lastSeekTime !== state.lastPlayerStateActiveData.lastSeekTime;\n\n          // When topics or datatypes change we also need to re-build the nodes so we clear the cache\n          if (\n            activeData.topics !== state.lastPlayerStateActiveData.topics ||\n            activeData.datatypes !== state.lastPlayerStateActiveData.datatypes\n          ) {\n            shouldReset = true;\n            state.nodeRegistrationCache = [];\n          }\n\n          state.lastPlayerStateActiveData = activeData;\n          if (shouldReset) {\n            await this._resetWorkersUnlocked(state);\n          }\n        }\n\n        const allDatatypes = this._getDatatypes(datatypes, this._memoizedNodeDatatypes);\n\n        /**\n         * if nodes have been updated we need to add their previous input messages\n         * to our list of messages to be parsed so that subscribers can refresh with\n         * the new output topic messages\n         */\n        const inputTopicsForRecompute = new Set<string>();\n\n        for (const userNodeId of this._userNodeIdsNeedUpdate) {\n          const nodeRegistration = state.nodeRegistrations.find(\n            ({ nodeId }) => nodeId === userNodeId,\n          );\n          if (!nodeRegistration) {\n            continue;\n          }\n          const inputTopics = nodeRegistration.inputs;\n\n          for (const topic of inputTopics) {\n            inputTopicsForRecompute.add(topic);\n          }\n        }\n\n        // if the globalVariables have changed recompute all last messages for the current frame\n        // there's no way to know which nodes are affected by the globalVariables change to make this more specific\n        if (this._globalVariablesChanged) {\n          this._globalVariablesChanged = false;\n          for (const inputTopic of this._lastMessageByInputTopic.keys()) {\n            inputTopicsForRecompute.add(inputTopic);\n          }\n        }\n\n        // remove topics that already have messages in state, because we won't need to take their last message to process\n        // this also removes possible duplicate messages to be parsed\n        for (const message of messages) {\n          if (inputTopicsForRecompute.has(message.topic)) {\n            inputTopicsForRecompute.delete(message.topic);\n          }\n        }\n\n        const messagesForRecompute: MessageEvent<unknown>[] = [];\n        for (const topic of inputTopicsForRecompute) {\n          const messageForRecompute = this._lastMessageByInputTopic.get(topic);\n          if (messageForRecompute) {\n            messagesForRecompute.push(messageForRecompute);\n          }\n        }\n\n        this._userNodeIdsNeedUpdate.clear();\n\n        for (const message of messages) {\n          this._lastMessageByInputTopic.set(message.topic, message);\n        }\n\n        const messagesToBeParsed =\n          messagesForRecompute.length > 0 ? messages.concat(messagesForRecompute) : messages;\n        const { parsedMessages } = await this._getMessages(\n          messagesToBeParsed,\n          globalVariables,\n          state.nodeRegistrations,\n        );\n\n        const playerProgress = {\n          ...playerState.progress,\n        };\n\n        if (playerProgress.messageCache) {\n          const newBlocks = await this._getBlocks(\n            playerProgress.messageCache.blocks,\n            globalVariables,\n            state.nodeRegistrations,\n          );\n\n          playerProgress.messageCache = {\n            startTime: playerProgress.messageCache.startTime,\n            blocks: newBlocks,\n          };\n        }\n\n        return {\n          ...playerState,\n          progress: playerProgress,\n          activeData: {\n            ...activeData,\n            messages: parsedMessages,\n            topics: this._getTopics(topics, this._memoizedNodeTopics),\n            datatypes: allDatatypes,\n          },\n        };\n      });\n\n      this._playerState = newPlayerState;\n\n      // clear any previous problem we had from making a new player state\n      this._problemStore.delete(\"player-state-update\");\n    } catch (err) {\n      this._problemStore.set(\"player-state-update\", {\n        severity: \"error\",\n        message: err.message,\n        error: err,\n      });\n\n      this._playerState = playerState;\n    } finally {\n      await this._emitState();\n    }\n  }\n\n  private async _emitState() {\n    if (!this._playerState) {\n      return;\n    }\n\n    // only augment child problems if we have our own problems\n    // if neither child or parent have problems we do nothing\n    let problems = this._playerState.problems;\n    if (this._problemStore.size > 0) {\n      problems = (problems ?? []).concat(Array.from(this._problemStore.values()));\n    }\n\n    const playerState: PlayerState = {\n      ...this._playerState,\n      problems,\n    };\n\n    if (this._listener) {\n      await this._listener(playerState);\n    }\n  }\n\n  public setListener(listener: NonNullable<UserNodePlayer[\"_listener\"]>): void {\n    this._listener = listener;\n\n    // Delay _player.setListener until our setListener is called because setListener in some cases\n    // triggers initialization logic and remote requests. This is an unfortunate API behavior and\n    // naming choice, but it's better for us not to do trigger this logic in the constructor.\n    this._player.setListener(async (state) => await this._onPlayerState(state));\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this._subscriptions = subscriptions;\n    this._protectedState\n      .runExclusive(async (state) => {\n        this._setSubscriptionsUnlocked(subscriptions, state);\n      })\n      .catch((err) => {\n        log.error(err);\n        reportError(err as Error);\n      });\n  }\n\n  private _setSubscriptionsUnlocked(\n    subscriptions: SubscribePayload[],\n    state: ProtectedState,\n  ): void {\n    const nodeSubscriptions: Record<string, SubscribePayload> = {};\n    const realTopicSubscriptions: SubscribePayload[] = [];\n\n    // For each subscription, identify required input topics by looking up the subscribed topic in\n    // the map of output topics -> inputs. Add these required input topics to the set of topic\n    // subscriptions to the underlying player.\n    for (const subscription of subscriptions) {\n      const inputs = state.inputsByOutputTopic.get(subscription.topic);\n      if (!inputs) {\n        nodeSubscriptions[subscription.topic] = subscription;\n        realTopicSubscriptions.push(subscription);\n        continue;\n      }\n\n      // If the inputs array is empty then we don't have anything to subscribe to for this output\n      if (inputs.length === 0) {\n        continue;\n      }\n\n      nodeSubscriptions[subscription.topic] = subscription;\n      for (const inputTopic of inputs) {\n        realTopicSubscriptions.push({\n          topic: inputTopic,\n          preloadType: subscription.preloadType ?? \"partial\",\n        });\n      }\n    }\n\n    this._nodeSubscriptions = nodeSubscriptions;\n    this._player.setSubscriptions(realTopicSubscriptions);\n  }\n\n  public close = (): void => {\n    void this._protectedState.runExclusive(async (state) => {\n      for (const nodeRegistration of state.nodeRegistrations) {\n        nodeRegistration.terminate();\n      }\n    });\n    this._player.close();\n    if (this._nodeTransformRpc) {\n      void this._nodeTransformRpc.send(\"close\");\n    }\n  };\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    this._player.setPublishers(publishers);\n  }\n\n  public setParameter(key: string, value: ParameterValue): void {\n    this._player.setParameter(key, value);\n  }\n\n  public publish(request: PublishPayload): void {\n    this._player.publish(request);\n  }\n\n  public async callService(service: string, request: unknown): Promise<unknown> {\n    return await this._player.callService(service, request);\n  }\n\n  public startPlayback(): void {\n    this._player.startPlayback?.();\n  }\n\n  public pausePlayback(): void {\n    this._player.pausePlayback?.();\n  }\n\n  public playUntil(time: Time): void {\n    if (this._player.playUntil) {\n      this._player.playUntil(time);\n      return;\n    }\n    this._player.seekPlayback?.(time);\n  }\n\n  public setPlaybackSpeed(speed: number): void {\n    this._player.setPlaybackSpeed?.(speed);\n  }\n\n  public seekPlayback(time: Time, backfillDuration?: Time): void {\n    this._player.seekPlayback?.(time, backfillDuration);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useSnackbar } from \"notistack\";\nimport { PropsWithChildren, useCallback, useLayoutEffect, useMemo, useState } from \"react\";\nimport { useLatest, useMountedState } from \"react-use\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { MessagePipelineProvider } from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { useNativeWindow } from \"@foxglove/studio-base/context/NativeWindowContext\";\nimport PlayerSelectionContext, {\n  DataSourceArgs,\n  IDataSourceFactory,\n  PlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { useUserNodeState } from \"@foxglove/studio-base/context/UserNodeStateContext\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport useIndexedDbRecents, { RecentRecord } from \"@foxglove/studio-base/hooks/useIndexedDbRecents\";\nimport useWarnImmediateReRender from \"@foxglove/studio-base/hooks/useWarnImmediateReRender\";\nimport AnalyticsMetricsCollector from \"@foxglove/studio-base/players/AnalyticsMetricsCollector\";\nimport UserNodePlayer from \"@foxglove/studio-base/players/UserNodePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\nimport { UserNodes } from \"@foxglove/studio-base/types/panels\";\n\nconst log = Logger.getLogger(__filename);\n\nconst EMPTY_USER_NODES: UserNodes = Object.freeze({});\nconst EMPTY_GLOBAL_VARIABLES: GlobalVariables = Object.freeze({});\n\ntype PlayerManagerProps = {\n  playerSources: IDataSourceFactory[];\n};\n\nconst userNodesSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.userNodes ?? EMPTY_USER_NODES;\nconst globalVariablesSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.globalVariables ?? EMPTY_GLOBAL_VARIABLES;\n\nexport default function PlayerManager(props: PropsWithChildren<PlayerManagerProps>): JSX.Element {\n  const { children, playerSources } = props;\n\n  useWarnImmediateReRender();\n\n  const { setUserNodeDiagnostics, addUserNodeLogs, setUserNodeRosLib, setUserNodeTypesLib } =\n    useUserNodeState();\n  const userNodeActions = useShallowMemo({\n    setUserNodeDiagnostics,\n    addUserNodeLogs,\n    setUserNodeRosLib,\n    setUserNodeTypesLib,\n  });\n\n  const nativeWindow = useNativeWindow();\n\n  const isMounted = useMountedState();\n\n  const analytics = useAnalytics();\n  const metricsCollector = useMemo(() => new AnalyticsMetricsCollector(analytics), [analytics]);\n\n  const layoutStorage = useLayoutManager();\n  const { setSelectedLayoutId } = useCurrentLayoutActions();\n\n  const [basePlayer, setBasePlayer] = useState<Player | undefined>();\n\n  const userNodes = useCurrentLayoutSelector(userNodesSelector);\n  const globalVariables = useCurrentLayoutSelector(globalVariablesSelector);\n\n  const { recents, addRecent } = useIndexedDbRecents();\n\n  // We don't want to recreate the player when the these variables change, but we do want to\n  // initialize it with the right order, so make a variable for its initial value we can use in the\n  // dependency array to the player useMemo.\n  //\n  // Updating the player with new values in handled by effects below the player useMemo or within\n  // the message pipeline\n  const globalVariablesRef = useLatest(globalVariables);\n\n  const player = useMemo(() => {\n    if (!basePlayer) {\n      return undefined;\n    }\n\n    const userNodePlayer = new UserNodePlayer(basePlayer, userNodeActions);\n    userNodePlayer.setGlobalVariables(globalVariablesRef.current);\n    return userNodePlayer;\n  }, [basePlayer, globalVariablesRef, userNodeActions]);\n\n  useLayoutEffect(() => void player?.setUserNodes(userNodes), [player, userNodes]);\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const selectSource = useCallback(\n    async (sourceId: string, args?: DataSourceArgs) => {\n      log.debug(`Select Source: ${sourceId}`);\n\n      // Clear any previous represented filename\n      void nativeWindow?.setRepresentedFilename(undefined);\n\n      const foundSource = playerSources.find(\n        (source) => source.id === sourceId || source.legacyIds?.includes(sourceId),\n      );\n      if (!foundSource) {\n        enqueueSnackbar(`Unknown data source: ${sourceId}`, { variant: \"warning\" });\n        return;\n      }\n\n      metricsCollector.setProperty(\"player\", sourceId);\n\n      // Sample sources don't need args or prompts to initialize\n      if (foundSource.type === \"sample\") {\n        const newPlayer = foundSource.initialize({\n          metricsCollector,\n        });\n\n        setBasePlayer(newPlayer);\n\n        if (foundSource.sampleLayout) {\n          try {\n            const layouts = await layoutStorage.getLayouts();\n            let sourceLayout = layouts.find((layout) => layout.name === foundSource.displayName);\n            if (sourceLayout == undefined) {\n              sourceLayout = await layoutStorage.saveNewLayout({\n                name: foundSource.displayName,\n                data: foundSource.sampleLayout,\n                permission: \"CREATOR_WRITE\",\n              });\n            }\n\n            if (isMounted()) {\n              setSelectedLayoutId(sourceLayout.id);\n            }\n          } catch (err) {\n            enqueueSnackbar((err as Error).message, { variant: \"error\" });\n          }\n        }\n\n        return;\n      }\n\n      if (!args) {\n        enqueueSnackbar(\"Unable to initialize player: no args\", { variant: \"error\" });\n        return;\n      }\n\n      try {\n        switch (args.type) {\n          case \"connection\": {\n            const newPlayer = foundSource.initialize({\n              metricsCollector,\n              params: args.params,\n            });\n            setBasePlayer(newPlayer);\n\n            if (args.params?.url) {\n              addRecent({\n                type: \"connection\",\n                sourceId: foundSource.id,\n                title: args.params.url,\n                label: foundSource.displayName,\n                extra: args.params,\n              });\n            }\n\n            return;\n          }\n          case \"file\": {\n            const handle = args.handle;\n            const files = args.files;\n\n            // files we can try loading immediately\n            // We do not add these to recents entries because putting File in indexedb results in\n            // the entire file being stored in the database.\n            if (files) {\n              let file = files[0];\n              const fileList: File[] = [];\n\n              for (const curFile of files) {\n                file ??= curFile;\n                fileList.push(curFile);\n              }\n              const multiFile = foundSource.supportsMultiFile === true && fileList.length > 1;\n\n              const newPlayer = foundSource.initialize({\n                file: multiFile ? undefined : file,\n                files: multiFile ? fileList : undefined,\n                metricsCollector,\n              });\n\n              // If we are selecting a single file, the desktop environment might have features to\n              // show the user which file they've selected (i.e. macOS proxy icon)\n              if (file) {\n                void nativeWindow?.setRepresentedFilename((file as { path?: string }).path); // File.path is added by Electron\n              }\n\n              setBasePlayer(newPlayer);\n              return;\n            } else if (handle) {\n              const permission = await handle.queryPermission({ mode: \"read\" });\n              if (!isMounted()) {\n                return;\n              }\n\n              if (permission !== \"granted\") {\n                const newPerm = await handle.requestPermission({ mode: \"read\" });\n                if (newPerm !== \"granted\") {\n                  throw new Error(`Permission denied: ${handle.name}`);\n                }\n              }\n\n              const file = await handle.getFile();\n              if (!isMounted()) {\n                return;\n              }\n\n              // If we are selecting a single file, the desktop environment might have features to\n              // show the user which file they've selected (i.e. macOS proxy icon)\n              void nativeWindow?.setRepresentedFilename((file as { path?: string }).path); // File.path is added by Electron\n\n              const newPlayer = foundSource.initialize({\n                file,\n                metricsCollector,\n              });\n\n              setBasePlayer(newPlayer);\n              addRecent({\n                type: \"file\",\n                title: handle.name,\n                sourceId: foundSource.id,\n                handle,\n              });\n\n              return;\n            }\n          }\n        }\n\n        enqueueSnackbar(\"Unable to initialize player\", { variant: \"error\" });\n      } catch (error) {\n        enqueueSnackbar((error as Error).message, { variant: \"error\" });\n      }\n    },\n    [\n      playerSources,\n      metricsCollector,\n      enqueueSnackbar,\n      layoutStorage,\n      isMounted,\n      setSelectedLayoutId,\n      addRecent,\n      nativeWindow,\n    ],\n  );\n\n  // Select a recent entry by id\n  // necessary to pull out callback creation to avoid capturing the initial player in closure context\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const selectRecent = useCallback(\n    createSelectRecentCallback(recents, selectSource, enqueueSnackbar),\n    [recents, enqueueSnackbar, selectSource],\n  );\n\n  // Make a RecentSources array for the PlayerSelectionContext\n  const recentSources = useMemo(() => {\n    return recents.map((item) => {\n      return { id: item.id, title: item.title, label: item.label };\n    });\n  }, [recents]);\n\n  const value: PlayerSelection = {\n    selectSource,\n    selectRecent,\n    availableSources: playerSources,\n    recentSources,\n  };\n\n  return (\n    <>\n      <PlayerSelectionContext.Provider value={value}>\n        <MessagePipelineProvider player={player} globalVariables={globalVariablesRef.current}>\n          {children}\n        </MessagePipelineProvider>\n      </PlayerSelectionContext.Provider>\n    </>\n  );\n}\n\n/**\n * This was moved out of the PlayerManager function due to a memory leak occurring in memoized state of Start.tsx\n * that was retaining old player instances. Having this callback be defined within the PlayerManager makes it store the\n * player at instantiation within the closure context. That callback is then stored in the memoized state with its closure context.\n * The callback is updated when the player changes but part of the `Start.tsx` holds onto the formerly memoized state for an\n * unknown reason.\n * To make this function safe from storing old closure contexts in old memoized state in components where it\n * is used, it has been moved out of the PlayerManager function.\n */\nfunction createSelectRecentCallback(\n  recents: RecentRecord[],\n  selectSource: (sourceId: string, dataSourceArgs: DataSourceArgs) => Promise<void>,\n  enqueueSnackbar: ReturnType<typeof useSnackbar>[\"enqueueSnackbar\"],\n) {\n  return (recentId: string) => {\n    // find the recent from the list and initialize\n    const foundRecent = recents.find((value) => value.id === recentId);\n    if (!foundRecent) {\n      enqueueSnackbar(`Failed to restore recent: ${recentId}`, { variant: \"error\" });\n      return;\n    }\n\n    switch (foundRecent.type) {\n      case \"connection\": {\n        void selectSource(foundRecent.sourceId, {\n          type: \"connection\",\n          params: foundRecent.extra,\n        });\n        break;\n      }\n      case \"file\": {\n        void selectSource(foundRecent.sourceId, {\n          type: \"file\",\n          handle: foundRecent.handle,\n        });\n      }\n    }\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link } from \"@mui/material\";\nimport { useSnackbar, VariantType } from \"notistack\";\nimport { useLayoutEffect, useState } from \"react\";\n\nimport NotificationModal from \"@foxglove/studio-base/components/NotificationModal\";\nimport {\n  DetailsType,\n  NotificationType,\n  setNotificationHandler,\n  unsetNotificationHandler,\n  NotificationSeverity,\n  NotificationMessage,\n} from \"@foxglove/studio-base/util/sendNotification\";\n\nconst severityToToastAppearance = (severity: NotificationSeverity): VariantType => {\n  switch (severity) {\n    case \"error\":\n      return \"error\";\n    case \"warn\":\n      return \"warning\";\n    case \"info\":\n      return \"default\";\n    default:\n      return \"default\";\n  }\n};\n\nexport default function SendNotificationToastAdapter(): JSX.Element {\n  const { enqueueSnackbar } = useSnackbar();\n  const [notificationDetails, setNotificationDetails] = useState<NotificationMessage | undefined>(\n    undefined,\n  );\n\n  useLayoutEffect(() => {\n    setNotificationHandler(\n      (\n        message: string,\n        details: DetailsType,\n        _type: NotificationType,\n        severity: NotificationSeverity,\n      ): void => {\n        enqueueSnackbar(\n          <div>\n            {message}{\" \"}\n            <Link\n              onClick={() => setNotificationDetails({ message, details, severity })}\n              variant=\"inherit\"\n              fontStyle=\"italic\"\n              color=\"inherit\"\n              underline=\"hover\"\n            >\n              (see details)\n            </Link>\n          </div>,\n          {\n            variant: severityToToastAppearance(severity),\n            persist: severity === \"error\",\n          },\n        );\n      },\n    );\n\n    return () => {\n      unsetNotificationHandler();\n    };\n  }, [enqueueSnackbar]);\n\n  if (notificationDetails == undefined) {\n    return <></>;\n  }\n\n  return (\n    <NotificationModal\n      notification={notificationDetails}\n      onRequestClose={() => setNotificationDetails(undefined)}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  CheckmarkCircle20Regular,\n  DismissCircle20Regular,\n  Dismiss16Filled,\n  Info20Regular,\n  Warning20Regular,\n} from \"@fluentui/react-icons\";\nimport { Grow, IconButton, useTheme } from \"@mui/material\";\nimport { SnackbarProvider, SnackbarKey, useSnackbar } from \"notistack\";\nimport { PropsWithChildren } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { APP_BAR_HEIGHT } from \"@foxglove/studio-base/components/AppBar/constants\";\n\nconst anchorWithOffset = (origin: \"top\" | \"bottom\") => ({\n  \"&.SnackbarContainer-root\": {\n    top: origin === \"top\" ? APP_BAR_HEIGHT : undefined,\n  },\n});\n\nconst useStyles = makeStyles()((theme) => ({\n  /* eslint-disable tss-unused-classes/unused-classes */\n  root: {\n    \"&.SnackbarContainer-root\": {\n      maxHeight: `calc(100% - ${APP_BAR_HEIGHT}px)`,\n    },\n    \".SnackbarContent-root\": {\n      padding: theme.spacing(0.5, 1.5, 0.5, 1),\n\n      \".MuiIconButton-root svg\": {\n        height: \"1em\",\n        width: \"1em\",\n        fontSize: \"1rem\",\n      },\n    },\n    \".SnackbarItem-message\": {\n      padding: 0,\n      gap: theme.spacing(1),\n    },\n  },\n  container: {\n    zIndex: theme.zIndex.tooltip,\n  },\n  containerAnchorOriginTopCenter: anchorWithOffset(\"top\"),\n  containerAnchorOriginTopRight: anchorWithOffset(\"top\"),\n  containerAnchorOriginTopLeft: anchorWithOffset(\"top\"),\n  variantDefault: {\n    \"&.SnackbarContent-root\": {\n      backgroundColor: theme.palette.background.paper,\n      color: theme.palette.text.primary,\n    },\n  },\n  variantSuccess: {\n    \"&.SnackbarContent-root\": { backgroundColor: theme.palette.success.main },\n  },\n  variantError: {\n    \"&.SnackbarContent-root\": { backgroundColor: theme.palette.error.main },\n  },\n  variantInfo: {\n    \"&.SnackbarContent-root\": { backgroundColor: theme.palette.info.main },\n  },\n  variantWarning: {\n    \"&.SnackbarContent-root\": { backgroundColor: theme.palette.warning.main },\n  },\n  /* eslint-enable tss-unused-classes/unused-classes */\n}));\n\nconst CloseSnackbarAction = ({ id }: { id: SnackbarKey }) => {\n  const { closeSnackbar } = useSnackbar();\n  return (\n    <IconButton size=\"small\" color=\"inherit\" onClick={() => closeSnackbar(id)}>\n      <Dismiss16Filled />\n    </IconButton>\n  );\n};\n\nexport default function StudioToastProvider(props: PropsWithChildren<unknown>): JSX.Element {\n  const { classes } = useStyles();\n  const theme = useTheme();\n  return (\n    <SnackbarProvider\n      action={(id) => <CloseSnackbarAction id={id} />}\n      iconVariant={{\n        default: <Info20Regular primaryFill={theme.palette.primary.main} />,\n        info: <Info20Regular />,\n        error: <DismissCircle20Regular />,\n        warning: <Warning20Regular />,\n        success: <CheckmarkCircle20Regular />,\n      }}\n      anchorOrigin={{ vertical: \"top\", horizontal: \"center\" }}\n      maxSnack={5}\n      preventDuplicate\n      TransitionComponent={Grow}\n      classes={classes}\n    >\n      {props.children}\n    </SnackbarProvider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { ILayoutStorage } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\nconst LayoutStorageContext = createContext<ILayoutStorage | undefined>(undefined);\nLayoutStorageContext.displayName = \"LayoutStorageContext\";\n\nexport function useLayoutStorage(): ILayoutStorage {\n  const ctx = useContext(LayoutStorageContext);\n  if (ctx == undefined) {\n    throw new Error(\"A LayoutStorage provider is required to useLayoutStorage\");\n  }\n  return ctx;\n}\n\nexport default LayoutStorageContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { defaultPlaybackConfig } from \"@foxglove/studio-base/providers/CurrentLayoutProvider/reducers\";\n\n/**\n * This is loaded when the user has no layout selected on application launch\n * to avoid presenting the user with a blank layout.\n */\nexport const defaultLayout: LayoutData = {\n  configById: {\n    \"3D!18i6zy7\": {\n      layers: {\n        \"845139cb-26bc-40b3-8161-8ab60af4baf5\": {\n          visible: true,\n          frameLocked: true,\n          label: \"Grid\",\n          instanceId: \"845139cb-26bc-40b3-8161-8ab60af4baf5\",\n          layerId: \"foxglove.Grid\",\n          size: 10,\n          divisions: 10,\n          lineWidth: 1,\n          color: \"#248eff\",\n          position: [0, 0, 0],\n          rotation: [0, 0, 0],\n          order: 1,\n        },\n      },\n    },\n    \"RawMessages!os6rgs\": {},\n    \"ImageViewPanel!3mnp456\": {},\n  },\n  globalVariables: {},\n  userNodes: {},\n  playbackConfig: { ...defaultPlaybackConfig },\n  layout: {\n    first: \"3D!18i6zy7\",\n    second: {\n      first: \"ImageViewPanel!3mnp456\",\n      second: \"RawMessages!os6rgs\",\n      direction: \"column\",\n      splitPercentage: 30,\n    },\n    direction: \"row\",\n    splitPercentage: 70,\n  },\n} as const;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { difference, isEqual } from \"lodash\";\nimport { useSnackbar } from \"notistack\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { getNodeAtPath } from \"react-mosaic-component\";\nimport { useAsync, useAsyncFn, useMountedState } from \"react-use\";\nimport shallowequal from \"shallowequal\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { VariableValue } from \"@foxglove/studio\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport CurrentLayoutContext, {\n  ICurrentLayout,\n  LayoutState,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport {\n  AddPanelPayload,\n  ChangePanelLayoutPayload,\n  ClosePanelPayload,\n  CreateTabPanelPayload,\n  DropPanelPayload,\n  EndDragPayload,\n  MoveTabPayload,\n  PanelsActions,\n  LayoutData,\n  SaveConfigsPayload,\n  SplitPanelPayload,\n  StartDragPayload,\n  SwapPanelPayload,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { useUserProfileStorage } from \"@foxglove/studio-base/context/UserProfileStorageContext\";\nimport { defaultLayout } from \"@foxglove/studio-base/providers/CurrentLayoutProvider/defaultLayout\";\nimport panelsReducer from \"@foxglove/studio-base/providers/CurrentLayoutProvider/reducers\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport { LayoutManagerEventTypes } from \"@foxglove/studio-base/services/ILayoutManager\";\nimport { LayoutID } from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport { PanelConfig, UserNodes, PlaybackConfig } from \"@foxglove/studio-base/types/panels\";\nimport { windowAppURLState } from \"@foxglove/studio-base/util/appURLState\";\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nconst log = Logger.getLogger(__filename);\n\nconst SAVE_INTERVAL_MS = 1000;\n\n/**\n * Concrete implementation of CurrentLayoutContext.Provider which handles automatically saving and\n * restoring the current layout from LayoutStorage.\n */\nexport default function CurrentLayoutProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const { enqueueSnackbar } = useSnackbar();\n  const { getUserProfile, setUserProfile } = useUserProfileStorage();\n  const layoutManager = useLayoutManager();\n  const analytics = useAnalytics();\n  const isMounted = useMountedState();\n\n  const [mosaicId] = useState(() => uuidv4());\n\n  const layoutStateListeners = useRef(new Set<(_: LayoutState) => void>());\n  const addLayoutStateListener = useCallback((listener: (_: LayoutState) => void) => {\n    layoutStateListeners.current.add(listener);\n  }, []);\n  const removeLayoutStateListener = useCallback((listener: (_: LayoutState) => void) => {\n    layoutStateListeners.current.delete(listener);\n  }, []);\n\n  const [layoutState, setLayoutStateInternal] = useState<LayoutState>({\n    selectedLayout: undefined,\n  });\n  const layoutStateRef = useRef(layoutState);\n  const setLayoutState = useCallback((newState: LayoutState) => {\n    setLayoutStateInternal(newState);\n\n    // listeners rely on being able to getCurrentLayoutState() inside effects that may run before we re-render\n    layoutStateRef.current = newState;\n\n    for (const listener of [...layoutStateListeners.current]) {\n      listener(newState);\n    }\n  }, []);\n\n  const selectedPanelIds = useRef<readonly string[]>([]);\n  const selectedPanelIdsListeners = useRef(new Set<(_: readonly string[]) => void>());\n  const addSelectedPanelIdsListener = useCallback((listener: (_: readonly string[]) => void) => {\n    selectedPanelIdsListeners.current.add(listener);\n  }, []);\n  const removeSelectedPanelIdsListener = useCallback((listener: (_: readonly string[]) => void) => {\n    selectedPanelIdsListeners.current.delete(listener);\n  }, []);\n\n  const getSelectedPanelIds = useCallback(() => selectedPanelIds.current, []);\n  const setSelectedPanelIds = useCallback(\n    (value: readonly string[] | ((prevState: readonly string[]) => readonly string[])): void => {\n      const newValue = typeof value === \"function\" ? value(selectedPanelIds.current) : value;\n      if (!shallowequal(newValue, selectedPanelIds.current)) {\n        selectedPanelIds.current = newValue;\n        for (const listener of [...selectedPanelIdsListeners.current]) {\n          listener(selectedPanelIds.current);\n        }\n      }\n    },\n    [],\n  );\n\n  const [, setSelectedLayoutId] = useAsyncFn(\n    async (\n      id: LayoutID | undefined,\n      { saveToProfile = true }: { saveToProfile?: boolean } = {},\n    ) => {\n      if (id == undefined) {\n        setLayoutState({ selectedLayout: undefined });\n        return;\n      }\n      try {\n        setLayoutState({ selectedLayout: { id, loading: true, data: undefined } });\n        const layout = await layoutManager.getLayout(id);\n        if (!isMounted()) {\n          return;\n        }\n        if (layout == undefined) {\n          setLayoutState({ selectedLayout: undefined });\n        } else {\n          setLayoutState({\n            selectedLayout: {\n              loading: false,\n              id: layout.id,\n              data: layout.working?.data ?? layout.baseline.data,\n              name: layout.name,\n            },\n          });\n          if (saveToProfile) {\n            setUserProfile({ currentLayoutId: id }).catch((error) => {\n              console.error(error);\n              enqueueSnackbar(`The current layout could not be saved. ${error.toString()}`, {\n                variant: \"error\",\n              });\n            });\n          }\n        }\n      } catch (error) {\n        console.error(error);\n        enqueueSnackbar(`The layout could not be loaded. ${error.toString()}`, {\n          variant: \"error\",\n        });\n        setLayoutState({ selectedLayout: undefined });\n      }\n    },\n    [enqueueSnackbar, isMounted, layoutManager, setLayoutState, setUserProfile],\n  );\n\n  type UpdateLayoutParams = { id: LayoutID; data: LayoutData };\n  const unsavedLayoutsRef = useRef(new Map<LayoutID, UpdateLayoutParams>());\n\n  // When the user performs an action, we immediately setLayoutState to update the UI. Saving back\n  // to the LayoutManager is debounced.\n  const debouncedSaveTimeout = useRef<ReturnType<typeof setTimeout> | undefined>();\n  const performAction = useCallback(\n    (action: PanelsActions) => {\n      if (\n        layoutStateRef.current.selectedLayout?.data == undefined ||\n        layoutStateRef.current.selectedLayout.loading === true\n      ) {\n        return;\n      }\n      const oldData = layoutStateRef.current.selectedLayout.data;\n      const newData = panelsReducer(oldData, action);\n\n      // the panel state did not change, so no need to perform layout state updates or layout manager updates\n      if (isEqual(oldData, newData)) {\n        log.warn(\"Panel action resulted in identical config:\", action);\n        return;\n      }\n\n      const newLayout = {\n        id: layoutStateRef.current.selectedLayout.id,\n        data: newData,\n        name: layoutStateRef.current.selectedLayout.name,\n      };\n\n      // store the layout for saving\n      unsavedLayoutsRef.current.set(newLayout.id, newLayout);\n\n      debouncedSaveTimeout.current ??= setTimeout(() => {\n        const layoutsToSave = [...unsavedLayoutsRef.current.values()];\n        unsavedLayoutsRef.current.clear();\n\n        debouncedSaveTimeout.current = undefined;\n        for (const params of layoutsToSave) {\n          void analytics.logEvent(AppEvent.LAYOUT_UPDATE);\n          layoutManager.updateLayout(params).catch((error) => {\n            log.error(error);\n            if (isMounted()) {\n              enqueueSnackbar(`Your changes could not be saved. ${error.toString()}`, {\n                variant: \"error\",\n                id: \"CurrentLayoutProvider.throttledSave\",\n              });\n            }\n          });\n        }\n      }, SAVE_INTERVAL_MS);\n\n      // Some actions like CHANGE_PANEL_LAYOUT will cause further downstream effects to update panel\n      // configs (i.e. set default configs). These result in calls to performAction. To ensure the\n      // debounced params are set in the proper order, we invoke setLayoutState at the end.\n      setLayoutState({ selectedLayout: { ...newLayout, loading: false } });\n    },\n    [analytics, enqueueSnackbar, isMounted, layoutManager, setLayoutState],\n  );\n\n  // Changes to the layout storage from external user actions (such as resetting a layout to a\n  // previous saved state) need to trigger setLayoutState.\n  useEffect(() => {\n    const listener: LayoutManagerEventTypes[\"change\"] = ({ updatedLayout }) => {\n      if (\n        updatedLayout &&\n        layoutStateRef.current.selectedLayout &&\n        updatedLayout.id === layoutStateRef.current.selectedLayout.id\n      ) {\n        setLayoutState({\n          selectedLayout: {\n            loading: false,\n            id: updatedLayout.id,\n            data: updatedLayout.working?.data ?? updatedLayout.baseline.data,\n            name: updatedLayout.name,\n          },\n        });\n      }\n    };\n    layoutManager.on(\"change\", listener);\n    return () => {\n      layoutManager.off(\"change\", listener);\n      if (debouncedSaveTimeout.current) {\n        clearTimeout(debouncedSaveTimeout.current);\n      }\n    };\n  }, [layoutManager, setLayoutState]);\n\n  // Make sure our layout still exists after changes. If not deselect it.\n  useEffect(() => {\n    const listener: LayoutManagerEventTypes[\"change\"] = async (event) => {\n      if (event.type !== \"delete\" || !layoutStateRef.current.selectedLayout?.id) {\n        return;\n      }\n\n      if (event.layoutId === layoutStateRef.current.selectedLayout.id) {\n        const layouts = await layoutManager.getLayouts();\n        await setSelectedLayoutId(layouts[0]?.id);\n      }\n    };\n\n    layoutManager.on(\"change\", listener);\n    return () => layoutManager.off(\"change\", listener);\n  }, [enqueueSnackbar, layoutManager, setSelectedLayoutId]);\n\n  // Load initial state by re-selecting the last selected layout from the UserProfile.\n  useAsync(async () => {\n    // Don't restore the layout if there's one specified in the app state url.\n    if (windowAppURLState()?.layoutId) {\n      return;\n    }\n\n    // Retreive the selected layout id from the user's profile. If there's no layout specified\n    // or we can't load it then save and select a default layout.\n    const { currentLayoutId } = await getUserProfile();\n    const layout = currentLayoutId ? await layoutManager.getLayout(currentLayoutId) : undefined;\n    if (layout) {\n      await setSelectedLayoutId(currentLayoutId, { saveToProfile: false });\n    } else {\n      const newLayout = await layoutManager.saveNewLayout({\n        name: \"Default\",\n        data: defaultLayout,\n        permission: \"CREATOR_WRITE\",\n      });\n      await setSelectedLayoutId(newLayout.id);\n    }\n  }, [getUserProfile, layoutManager, setSelectedLayoutId]);\n\n  const actions: ICurrentLayout[\"actions\"] = useMemo(\n    () => ({\n      setSelectedLayoutId,\n      getCurrentLayoutState: () => layoutStateRef.current,\n\n      savePanelConfigs: (payload: SaveConfigsPayload) =>\n        performAction({ type: \"SAVE_PANEL_CONFIGS\", payload }),\n      updatePanelConfigs: (panelType: string, perPanelFunc: (config: PanelConfig) => PanelConfig) =>\n        performAction({ type: \"SAVE_FULL_PANEL_CONFIG\", payload: { panelType, perPanelFunc } }),\n      createTabPanel: (payload: CreateTabPanelPayload) => {\n        performAction({ type: \"CREATE_TAB_PANEL\", payload });\n        setSelectedPanelIds([]);\n        void analytics.logEvent(AppEvent.PANEL_ADD, { type: \"Tab\" });\n      },\n      changePanelLayout: (payload: ChangePanelLayoutPayload) =>\n        performAction({ type: \"CHANGE_PANEL_LAYOUT\", payload }),\n      overwriteGlobalVariables: (payload: Record<string, VariableValue>) =>\n        performAction({ type: \"OVERWRITE_GLOBAL_DATA\", payload }),\n      setGlobalVariables: (payload: Record<string, VariableValue>) =>\n        performAction({ type: \"SET_GLOBAL_DATA\", payload }),\n      setUserNodes: (payload: Partial<UserNodes>) =>\n        performAction({ type: \"SET_USER_NODES\", payload }),\n      setPlaybackConfig: (payload: Partial<PlaybackConfig>) =>\n        performAction({ type: \"SET_PLAYBACK_CONFIG\", payload }),\n      closePanel: (payload: ClosePanelPayload) => {\n        performAction({ type: \"CLOSE_PANEL\", payload });\n\n        const closedId = getNodeAtPath(payload.root, payload.path);\n        // Deselect the removed panel\n        setSelectedPanelIds((ids) => ids.filter((id) => id !== closedId));\n\n        void analytics.logEvent(\n          AppEvent.PANEL_DELETE,\n          typeof closedId === \"string\" ? { type: getPanelTypeFromId(closedId) } : undefined,\n        );\n      },\n      splitPanel: (payload: SplitPanelPayload) => performAction({ type: \"SPLIT_PANEL\", payload }),\n      swapPanel: (payload: SwapPanelPayload) => {\n        // Select the new panel if the original panel was selected. We don't know what\n        // the new panel id will be so we diff the panelIds of the old and\n        // new layout so we can select the new panel.\n        const originalIsSelected = selectedPanelIds.current.includes(payload.originalId);\n        const beforePanelIds = Object.keys(\n          layoutStateRef.current.selectedLayout?.data?.configById ?? {},\n        );\n        performAction({ type: \"SWAP_PANEL\", payload });\n        if (originalIsSelected) {\n          const afterPanelIds = Object.keys(\n            layoutStateRef.current.selectedLayout?.data?.configById ?? {},\n          );\n          setSelectedPanelIds(difference(afterPanelIds, beforePanelIds));\n        }\n        void analytics.logEvent(AppEvent.PANEL_ADD, { type: payload.type, action: \"swap\" });\n        void analytics.logEvent(AppEvent.PANEL_DELETE, {\n          type: getPanelTypeFromId(payload.originalId),\n          action: \"swap\",\n        });\n      },\n      moveTab: (payload: MoveTabPayload) => performAction({ type: \"MOVE_TAB\", payload }),\n      addPanel: (payload: AddPanelPayload) => {\n        performAction({ type: \"ADD_PANEL\", payload });\n        void analytics.logEvent(AppEvent.PANEL_ADD, { type: getPanelTypeFromId(payload.id) });\n      },\n      dropPanel: (payload: DropPanelPayload) => {\n        performAction({ type: \"DROP_PANEL\", payload });\n        void analytics.logEvent(AppEvent.PANEL_ADD, {\n          type: payload.newPanelType,\n          action: \"drop\",\n        });\n      },\n      startDrag: (payload: StartDragPayload) => performAction({ type: \"START_DRAG\", payload }),\n      endDrag: (payload: EndDragPayload) => performAction({ type: \"END_DRAG\", payload }),\n    }),\n    [analytics, performAction, setSelectedLayoutId, setSelectedPanelIds],\n  );\n\n  const value: ICurrentLayout = useShallowMemo({\n    addLayoutStateListener,\n    removeLayoutStateListener,\n    addSelectedPanelIdsListener,\n    removeSelectedPanelIdsListener,\n    mosaicId,\n    getSelectedPanelIds,\n    setSelectedPanelIds,\n    actions,\n  });\n\n  return <CurrentLayoutContext.Provider value={value}>{children}</CurrentLayoutContext.Provider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport React, { PropsWithChildren, useEffect, useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { createStore, StoreApi } from \"zustand\";\n\nimport Logger from \"@foxglove/log\";\nimport { ExtensionContext, ExtensionModule, RegisterMessageConverterArgs } from \"@foxglove/studio\";\nimport {\n  ExtensionCatalog,\n  ExtensionCatalogContext,\n  RegisteredPanel,\n} from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport { ExtensionLoader } from \"@foxglove/studio-base/services/ExtensionLoader\";\nimport { ExtensionInfo, ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nconst log = Logger.getLogger(__filename);\n\ntype ContributionPoints = {\n  panels: Record<string, RegisteredPanel>;\n  messageConverters: RegisterMessageConverterArgs<unknown>[];\n};\n\nfunction activateExtension(\n  extension: ExtensionInfo,\n  unwrappedExtensionSource: string,\n): ContributionPoints {\n  // registered panels stored by their fully qualified id\n  // the fully qualified id is the extension name + panel name\n  const panels: Record<string, RegisteredPanel> = {};\n\n  const messageConverters: RegisterMessageConverterArgs<unknown>[] = [];\n\n  log.debug(`Activating extension ${extension.qualifiedName}`);\n\n  const module = { exports: {} };\n  const require = (name: string) => {\n    return { react: React, \"react-dom\": ReactDOM }[name];\n  };\n\n  const extensionMode =\n    process.env.NODE_ENV === \"production\"\n      ? \"production\"\n      : process.env.NODE_ENV === \"test\"\n      ? \"test\"\n      : \"development\";\n\n  const ctx: ExtensionContext = {\n    mode: extensionMode,\n\n    registerPanel(params) {\n      log.debug(`Extension ${extension.qualifiedName} registering panel: ${params.name}`);\n\n      const fullId = `${extension.qualifiedName}.${params.name}`;\n      if (panels[fullId]) {\n        log.warn(`Panel ${fullId} is already registered`);\n        return;\n      }\n\n      panels[fullId] = {\n        extensionName: extension.qualifiedName,\n        extensionNamespace: extension.namespace,\n        registration: params,\n      };\n    },\n\n    registerMessageConverter<Src>(args: RegisterMessageConverterArgs<Src>) {\n      log.debug(\n        `Extension ${extension.qualifiedName} registering message converter from: ${args.fromSchemaName} to: ${args.toSchemaName}`,\n      );\n      messageConverters.push(args as RegisterMessageConverterArgs<unknown>);\n    },\n  };\n\n  try {\n    // eslint-disable-next-line no-new-func\n    const fn = new Function(\"module\", \"require\", unwrappedExtensionSource);\n\n    // load the extension module exports\n    fn(module, require, {});\n    const wrappedExtensionModule = module.exports as ExtensionModule;\n\n    wrappedExtensionModule.activate(ctx);\n  } catch (err) {\n    log.error(err);\n  }\n\n  return {\n    panels,\n    messageConverters,\n  };\n}\n\nexport function createExtensionRegistryStore(\n  loaders: readonly ExtensionLoader[],\n): StoreApi<ExtensionCatalog> {\n  return createStore((set, get) => ({\n    downloadExtension: async (url: string) => {\n      const res = await fetch(url);\n      return new Uint8Array(await res.arrayBuffer());\n    },\n\n    installExtension: async (namespace: ExtensionNamespace, foxeFileData: Uint8Array) => {\n      const namespacedLoader = loaders.find((loader) => loader.namespace === namespace);\n      if (namespacedLoader == undefined) {\n        throw new Error(\"No extension loader found for namespace \" + namespace);\n      }\n      const info = await namespacedLoader.installExtension(foxeFileData);\n      await get().refreshExtensions();\n      return info;\n    },\n\n    refreshExtensions: async () => {\n      if (loaders.length === 0) {\n        return;\n      }\n\n      const extensionList: ExtensionInfo[] = [];\n      const allContributionPoints: ContributionPoints = { panels: {}, messageConverters: [] };\n      for (const loader of loaders) {\n        try {\n          for (const extension of await loader.getExtensions()) {\n            try {\n              extensionList.push(extension);\n              const unwrappedExtensionSource = await loader.loadExtension(extension.id);\n              const contributionPoints = activateExtension(extension, unwrappedExtensionSource);\n              Object.assign(allContributionPoints.panels, contributionPoints.panels);\n              allContributionPoints.messageConverters.push(...contributionPoints.messageConverters);\n            } catch (err) {\n              log.error(\"Error loading extension\", err);\n            }\n          }\n        } catch (err) {\n          log.error(\"Error loading extension list\", err);\n        }\n      }\n      log.debug(`Found ${extensionList.length} extension(s)`);\n      set({\n        installedExtensions: extensionList,\n        installedPanels: allContributionPoints.panels,\n        installedMessageConverters: allContributionPoints.messageConverters,\n      });\n    },\n\n    // If there are no loaders then we know there will not be any installed extensions\n    installedExtensions: loaders.length === 0 ? [] : undefined,\n\n    installedPanels: {},\n\n    installedMessageConverters: [],\n\n    uninstallExtension: async (namespace: ExtensionNamespace, id: string) => {\n      const namespacedLoader = loaders.find((loader) => loader.namespace === namespace);\n      if (namespacedLoader == undefined) {\n        throw new Error(\"No extension loader found for namespace \" + namespace);\n      }\n      await namespacedLoader.uninstallExtension(id);\n      await get().refreshExtensions();\n    },\n  }));\n}\n\nexport default function ExtensionCatalogProvider({\n  children,\n  loaders,\n}: PropsWithChildren<{ loaders: readonly ExtensionLoader[] }>): JSX.Element {\n  const [store] = useState(createExtensionRegistryStore(loaders));\n\n  // Request an initial refresh on first mount\n  const refreshExtensions = store.getState().refreshExtensions;\n  useEffect(() => {\n    refreshExtensions().catch((err) => log.error(err));\n  }, [refreshExtensions]);\n\n  return (\n    <ExtensionCatalogContext.Provider value={store}>{children}</ExtensionCatalogContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport ExtensionMarketplaceContext, {\n  ExtensionMarketplaceDetail,\n} from \"@foxglove/studio-base/context/ExtensionMarketplaceContext\";\n\nconst MARKETPLACE_URL =\n  \"https://raw.githubusercontent.com/foxglove/studio-extension-marketplace/main/extensions.json\";\n\nexport default function ExtensionMarketplaceProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const getAvailableExtensions = useCallback(async (): Promise<ExtensionMarketplaceDetail[]> => {\n    const res = await fetch(MARKETPLACE_URL);\n    return (await res.json()) as ExtensionMarketplaceDetail[];\n  }, []);\n  const getMarkdown = useCallback(async (url: string): Promise<string> => {\n    const res = await fetch(url);\n    return await res.text();\n  }, []);\n  const marketplace = useShallowMemo({\n    getAvailableExtensions,\n    getMarkdown,\n  });\n  return (\n    <ExtensionMarketplaceContext.Provider value={marketplace}>\n      {children}\n    </ExtensionMarketplaceContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { IRemoteLayoutStorage } from \"@foxglove/studio-base/services/IRemoteLayoutStorage\";\n\nconst RemoteLayoutStorageContext = createContext<IRemoteLayoutStorage | undefined>(undefined);\nRemoteLayoutStorageContext.displayName = \"RemoteLayoutStorageContext\";\n\nexport function useRemoteLayoutStorage(): IRemoteLayoutStorage | undefined {\n  return useContext(RemoteLayoutStorageContext);\n}\n\n// ts-prune-ignore-next\nexport default RemoteLayoutStorageContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Logger from \"@foxglove/log\";\nimport { ILayoutStorage, Layout, LayoutID } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\nconst log = Logger.getLogger(__filename);\n\n/**\n * A wrapper around ILayoutStorage for a particular namespace.\n */\nexport class NamespacedLayoutStorage {\n  private migration: Promise<void>;\n  public constructor(\n    private storage: ILayoutStorage,\n    private namespace: string,\n    {\n      migrateUnnamespacedLayouts,\n      importFromNamespace,\n    }: { migrateUnnamespacedLayouts: boolean; importFromNamespace: string | undefined },\n  ) {\n    this.migration = (async function () {\n      if (migrateUnnamespacedLayouts) {\n        await storage\n          .migrateUnnamespacedLayouts?.(namespace)\n          .catch((error) => log.error(\"Migration failed:\", error));\n      }\n\n      if (importFromNamespace != undefined) {\n        await storage\n          .importLayouts({\n            fromNamespace: importFromNamespace,\n            toNamespace: namespace,\n          })\n          .catch((error) => log.error(\"Import failed:\", error));\n      }\n    })();\n  }\n\n  public async list(): Promise<readonly Layout[]> {\n    await this.migration;\n    return await this.storage.list(this.namespace);\n  }\n  public async get(id: LayoutID): Promise<Layout | undefined> {\n    await this.migration;\n    return await this.storage.get(this.namespace, id);\n  }\n  public async put(layout: Layout): Promise<Layout> {\n    await this.migration;\n    return await this.storage.put(this.namespace, layout);\n  }\n  public async delete(id: LayoutID): Promise<void> {\n    await this.migration;\n    await this.storage.delete(this.namespace, id);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { LazilyInitialized } from \"@foxglove/den/async\";\nimport { ILayoutStorage, Layout, LayoutID } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\n/**\n * A view of ILayoutCache which only calls the underlying list() once per namespace, and implements\n * all operations on the cached data in memory as well as writing through to the underlying storage.\n *\n * For this to be useful, we must assume nothing else is accessing the same underlying storage.\n */\nexport default class WriteThroughLayoutCache implements ILayoutStorage {\n  private cacheByNamespace = new Map<string, LazilyInitialized<Map<string, Layout>>>();\n\n  public constructor(private storage: ILayoutStorage) {}\n\n  private getOrCreateCache(namespace: string): LazilyInitialized<Map<string, Layout>> {\n    let cache = this.cacheByNamespace.get(namespace);\n    if (!cache) {\n      cache = new LazilyInitialized(\n        async () =>\n          await this.storage\n            .list(namespace)\n            .then((layouts) => new Map(layouts.map((layout) => [layout.id, layout]))),\n      );\n      this.cacheByNamespace.set(namespace, cache);\n    }\n    return cache;\n  }\n\n  public async importLayouts(params: {\n    fromNamespace: string;\n    toNamespace: string;\n  }): Promise<void> {\n    return await this.storage.importLayouts(params);\n  }\n\n  public async migrateUnnamespacedLayouts(namespace: string): Promise<void> {\n    await this.storage.migrateUnnamespacedLayouts?.(namespace);\n  }\n\n  public async list(namespace: string): Promise<readonly Layout[]> {\n    return Array.from((await this.getOrCreateCache(namespace).get()).values());\n  }\n\n  public async get(namespace: string, id: LayoutID): Promise<Layout | undefined> {\n    return (await this.getOrCreateCache(namespace).get()).get(id);\n  }\n\n  public async put(namespace: string, layout: Layout): Promise<Layout> {\n    const result = await this.storage.put(namespace, layout);\n    (await this.getOrCreateCache(namespace).get()).set(result.id, result);\n    return result;\n  }\n\n  public async delete(namespace: string, id: LayoutID): Promise<void> {\n    await this.storage.delete(namespace, id);\n    (await this.getOrCreateCache(namespace).get()).delete(id);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { diff } from \"just-diff\";\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\n\n/**\n * isLayoutEqual compares two LayoutData instances for \"equality\". If the two instances are\n * considered \"equal\" then the function returns true. If the two instances are not equal it returns\n * false.\n *\n * Layout instances are considered equal if they have all of the same fields and all of the same\n * values in those fields - recursively. An exception is made for where _b_ only differes from _a_\n * by introducing new fields which are _undefined_. If _b_ has an extra field with value undefined,\n * it will still be considered equal to _a_.\n */\nexport function isLayoutEqual(a: LayoutData, b: LayoutData): boolean {\n  const res = diff(a, b);\n  for (const item of res) {\n    // Any replace or remove is treated as a diff\n    if (item.op === \"replace\" || item.op === \"remove\") {\n      return false;\n    }\n\n    // If a field is added but the value is anything other than undefined, the layouts are not the same\n    if (item.value != undefined) {\n      return false;\n    }\n  }\n\n  // No actual diff, so the values are the same\n  return true;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Logger from \"@foxglove/log\";\nimport { Layout, layoutIsShared } from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport { RemoteLayout } from \"@foxglove/studio-base/services/IRemoteLayoutStorage\";\n\nconst log = Logger.getLogger(__filename);\n\nexport type SyncOperation =\n  | { local: true; type: \"add-to-cache\"; remoteLayout: RemoteLayout }\n  | { local: true; type: \"delete-local\"; localLayout: Layout }\n  | { local: true; type: \"mark-deleted\"; localLayout: Layout }\n  | { local: false; type: \"delete-remote\"; localLayout: Layout }\n  | { local: false; type: \"upload-new\"; localLayout: Layout }\n  | { local: false; type: \"upload-updated\"; localLayout: Layout }\n  | {\n      local: true;\n      type: \"update-baseline\";\n      localLayout: Layout & { syncInfo: NonNullable<Layout[\"syncInfo\"]> };\n      remoteLayout: RemoteLayout;\n    };\n\nexport default function computeLayoutSyncOperations(\n  localLayouts: readonly Layout[],\n  remoteLayouts: readonly RemoteLayout[],\n): SyncOperation[] {\n  const ops: SyncOperation[] = [];\n\n  const remoteLayoutsById = new Map(remoteLayouts.map((layout) => [layout.id, layout]));\n\n  for (const localLayout of localLayouts) {\n    const remoteLayout = remoteLayoutsById.get(localLayout.id);\n    if (remoteLayout) {\n      remoteLayoutsById.delete(localLayout.id);\n      switch (localLayout.syncInfo?.status) {\n        case undefined:\n        case \"new\":\n          log.warn(\n            `Remote layout is present but local has sync status: ${localLayout.syncInfo?.status}`,\n          );\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} shouldn't be untracked`);\n            continue;\n          }\n          ops.push({ local: false, type: \"upload-new\", localLayout });\n          break;\n        case \"updated\":\n          ops.push({ local: false, type: \"upload-updated\", localLayout });\n          break;\n        case \"tracked\":\n          // if the server doesn't provide a savedAt we consider the layout old and ignore it\n          if (!remoteLayout.savedAt) {\n            break;\n          }\n\n          if (localLayout.syncInfo.lastRemoteSavedAt !== remoteLayout.savedAt) {\n            ops.push({\n              local: true,\n              type: \"update-baseline\",\n              localLayout: { ...localLayout, syncInfo: localLayout.syncInfo },\n              remoteLayout,\n            });\n          }\n          break;\n        case \"locally-deleted\":\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} shouldn't be marked as locally deleted`);\n          }\n          ops.push({ local: false, type: \"delete-remote\", localLayout });\n          break;\n        case \"remotely-deleted\":\n          log.warn(\n            `Remote layout is present but cache is marked as remotely deleted: ${localLayout.id}`,\n          );\n          break;\n      }\n    } else {\n      switch (localLayout.syncInfo?.status) {\n        case undefined:\n        case \"new\":\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} should have been uploaded at creation`);\n            continue;\n          }\n          ops.push({ local: false, type: \"upload-new\", localLayout });\n          break;\n        case \"updated\":\n          if (!layoutIsShared(localLayout)) {\n            ops.push({ local: true, type: \"delete-local\", localLayout });\n          } else {\n            ops.push({ local: true, type: \"mark-deleted\", localLayout });\n          }\n          break;\n        case \"tracked\":\n          if (localLayout.working == undefined || !layoutIsShared(localLayout)) {\n            ops.push({ local: true, type: \"delete-local\", localLayout });\n          } else {\n            ops.push({ local: true, type: \"mark-deleted\", localLayout });\n          }\n          break;\n        case \"locally-deleted\":\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} shouldn't be marked as locally deleted`);\n          }\n          ops.push({ local: true, type: \"delete-local\", localLayout });\n          break;\n        case \"remotely-deleted\":\n          if (localLayout.working == undefined) {\n            ops.push({ local: true, type: \"delete-local\", localLayout });\n          }\n          break;\n      }\n    }\n  }\n\n  for (const remoteLayout of remoteLayoutsById.values()) {\n    ops.push({ local: true, type: \"add-to-cache\", remoteLayout });\n  }\n\n  return ops;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { round } from \"lodash\";\nimport { MosaicNode } from \"react-mosaic-component\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport type { RendererConfig } from \"@foxglove/studio-base/panels/ThreeDeeRender/Renderer\";\nimport { DEFAULT_CAMERA_STATE } from \"@foxglove/studio-base/panels/ThreeDeeRender/camera\";\nimport {\n  getAllPanelIds,\n  getPanelIdForType,\n  getPanelTypeFromId,\n  isTabPanel,\n  isTabPanelConfig,\n} from \"@foxglove/studio-base/util/layout\";\n\nconst DEFAULT_PUBLISH_SETTINGS: RendererConfig[\"publish\"] = {\n  type: \"point\",\n  poseTopic: \"/move_base_simple/goal\",\n  pointTopic: \"/clicked_point\",\n  poseEstimateTopic: \"/initialpose\",\n  poseEstimateXDeviation: 0.5,\n  poseEstimateYDeviation: 0.5,\n  poseEstimateThetaDeviation: round(Math.PI / 12, 8),\n};\ntype LegacyCameraState = {\n  distance: number;\n  perspective: boolean;\n  phi: number;\n  target: readonly [number, number, number];\n  targetOffset: readonly [number, number, number];\n  targetOrientation: readonly [number, number, number, number];\n  thetaOffset: number;\n  fovy: number;\n  near: number;\n  far: number;\n};\ntype Legacy3DConfig = {\n  cameraState: Partial<LegacyCameraState>;\n  checkedKeys: string[];\n  clickToPublishPoseTopic: string;\n  clickToPublishPointTopic: string;\n  clickToPublishPoseEstimateTopic: string;\n  clickToPublishPoseEstimateXDeviation: number;\n  clickToPublishPoseEstimateYDeviation: number;\n  clickToPublishPoseEstimateThetaDeviation: number;\n  followMode?: \"follow\" | \"follow-orientation\" | \"no-follow\";\n  followTf?: string;\n};\n\nfunction migrateLegacyToNew3DConfig(legacyConfig: Partial<Legacy3DConfig>): RendererConfig {\n  return {\n    followTf: legacyConfig.followTf,\n    followMode:\n      legacyConfig.followMode === \"follow-orientation\"\n        ? \"follow-pose\"\n        : legacyConfig.followMode === \"follow\"\n        ? \"follow-position\"\n        : \"follow-none\",\n    cameraState: {\n      ...DEFAULT_CAMERA_STATE,\n      ...legacyConfig.cameraState,\n      phi: ((legacyConfig.cameraState?.phi ?? Math.PI / 3) * 180) / Math.PI,\n      thetaOffset: ((legacyConfig.cameraState?.thetaOffset ?? 0) * 180) / Math.PI,\n      fovy: ((legacyConfig.cameraState?.fovy ?? Math.PI / 4) * 180) / Math.PI,\n    },\n    publish: {\n      type: \"point\",\n      poseTopic: legacyConfig.clickToPublishPoseTopic ?? DEFAULT_PUBLISH_SETTINGS.poseTopic,\n      pointTopic: legacyConfig.clickToPublishPointTopic ?? DEFAULT_PUBLISH_SETTINGS.pointTopic,\n      poseEstimateTopic:\n        legacyConfig.clickToPublishPoseEstimateTopic ?? DEFAULT_PUBLISH_SETTINGS.poseEstimateTopic,\n      poseEstimateXDeviation:\n        legacyConfig.clickToPublishPoseEstimateXDeviation ??\n        DEFAULT_PUBLISH_SETTINGS.poseEstimateXDeviation,\n      poseEstimateYDeviation:\n        legacyConfig.clickToPublishPoseEstimateYDeviation ??\n        DEFAULT_PUBLISH_SETTINGS.poseEstimateYDeviation,\n      poseEstimateThetaDeviation:\n        legacyConfig.clickToPublishPoseEstimateThetaDeviation ??\n        DEFAULT_PUBLISH_SETTINGS.poseEstimateThetaDeviation,\n    },\n    topics: Object.fromEntries(\n      filterMap(legacyConfig.checkedKeys ?? [], (key) =>\n        key.startsWith(\"t:\") ? [key.substring(\"t:\".length), { visible: true }] : undefined,\n      ),\n    ),\n    scene: {},\n    transforms: {},\n    layers: {},\n    imageMode: {},\n  };\n}\n\nfunction replacePanelInLayout(\n  layout: MosaicNode<string>,\n  oldId: string,\n  newId: string,\n): MosaicNode<string> {\n  if (typeof layout === \"string\") {\n    return layout === oldId ? newId : layout;\n  } else {\n    return {\n      ...layout,\n      first: replacePanelInLayout(layout.first, oldId, newId),\n      second: replacePanelInLayout(layout.second, oldId, newId),\n    };\n  }\n}\n\nfunction replacePanel(\n  panelsState: LayoutData,\n  oldId: string,\n  newId: string,\n  newConfig: Record<string, unknown>,\n): LayoutData {\n  const newPanelsState = {\n    ...panelsState,\n    configById: { ...panelsState.configById, [newId]: newConfig },\n  };\n  delete newPanelsState.configById[oldId];\n  if (newPanelsState.layout != undefined) {\n    newPanelsState.layout = replacePanelInLayout(newPanelsState.layout, oldId, newId);\n    const tabPanelIds = Object.keys(newPanelsState.configById).filter(isTabPanel);\n    for (const tabId of tabPanelIds) {\n      const tabConfig = newPanelsState.configById[tabId];\n      if (isTabPanelConfig(tabConfig)) {\n        newPanelsState.configById[tabId] = {\n          ...tabConfig,\n          tabs: tabConfig.tabs.map((tab) => ({\n            ...tab,\n            layout:\n              tab.layout != undefined ? replacePanelInLayout(tab.layout, oldId, newId) : undefined,\n          })),\n        };\n      }\n    }\n  }\n  return newPanelsState;\n}\n\nexport function migrateLegacyToNew3DPanels(layoutData: LayoutData): LayoutData {\n  if (layoutData.layout == undefined) {\n    return layoutData;\n  }\n\n  const legacy3DPanels = getAllPanelIds(layoutData.layout, layoutData.configById).filter(\n    (id) => getPanelTypeFromId(id) === \"3D Panel\",\n  );\n  let newState = layoutData;\n  for (const id of legacy3DPanels) {\n    const legacyConfig = layoutData.configById[id] as Legacy3DConfig | undefined;\n    if (legacyConfig != undefined) {\n      newState = replacePanel(\n        newState,\n        id,\n        getPanelIdForType(\"3D\"),\n        migrateLegacyToNew3DConfig(legacyConfig),\n      );\n    }\n  }\n  return newState;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { MarkOptional } from \"ts-essentials\";\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\n\nimport { Layout, ISO8601Timestamp } from \"./ILayoutStorage\";\nimport { migrateLegacyToNew3DPanels } from \"./migrateLegacyToNew3DPanels\";\n\n/**\n * Perform any necessary migrations on old layout data.\n */\nexport function migratePanelsState(data: MarkOptional<LayoutData, \"configById\">): LayoutData {\n  let result: LayoutData = { ...data, configById: data.configById ?? data.savedProps ?? {} };\n  delete result.savedProps;\n\n  result = migrateLegacyToNew3DPanels(result);\n\n  return result;\n}\n\n/**\n * Import a layout from storage, transferring old properties to the current expected format.\n *\n * Layouts created before we stored both working/baseline copies were stored with a \"data\" field;\n * migrate this to a baseline layout.\n */\n\nexport function migrateLayout(value: unknown): Layout {\n  if (typeof value !== \"object\" || value == undefined) {\n    throw new Error(\"Invariant violation - layout item is not an object\");\n  }\n  const layout = value as Partial<Layout>;\n  if (!(\"id\" in layout) || !layout.id) {\n    throw new Error(\"Invariant violation - layout item is missing an id\");\n  }\n\n  const now = new Date().toISOString() as ISO8601Timestamp;\n\n  let baseline = layout.baseline;\n  if (!baseline) {\n    if (layout.working) {\n      baseline = layout.working;\n    } else if (layout.data) {\n      baseline = { data: layout.data, savedAt: now };\n    } else if (layout.state) {\n      baseline = { data: layout.state, savedAt: now };\n    } else {\n      throw new Error(\"Invariant violation - layout item is missing data\");\n    }\n  }\n\n  return {\n    id: layout.id,\n    name: layout.name ?? `Unnamed (${now})`,\n    permission: layout.permission?.toUpperCase() ?? \"CREATOR_WRITE\",\n    working: layout.working\n      ? { ...layout.working, data: migratePanelsState(layout.working.data) }\n      : undefined,\n    baseline: { ...baseline, data: migratePanelsState(baseline.data) },\n    syncInfo: layout.syncInfo,\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport EventEmitter from \"eventemitter3\";\nimport { partition } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { MutexLocked } from \"@foxglove/den/async\";\nimport Logger from \"@foxglove/log\";\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport {\n  ILayoutManager,\n  LayoutManagerChangeEvent,\n  LayoutManagerEventTypes,\n} from \"@foxglove/studio-base/services/ILayoutManager\";\nimport {\n  ILayoutStorage,\n  Layout,\n  layoutAppearsDeleted,\n  LayoutID,\n  layoutIsShared,\n  LayoutPermission,\n  layoutPermissionIsShared,\n  ISO8601Timestamp,\n} from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport {\n  IRemoteLayoutStorage,\n  RemoteLayout,\n} from \"@foxglove/studio-base/services/IRemoteLayoutStorage\";\n\nimport { NamespacedLayoutStorage } from \"./NamespacedLayoutStorage\";\nimport WriteThroughLayoutCache from \"./WriteThroughLayoutCache\";\nimport { isLayoutEqual } from \"./compareLayouts\";\nimport computeLayoutSyncOperations, { SyncOperation } from \"./computeLayoutSyncOperations\";\nimport { migratePanelsState } from \"../migrateLayout\";\n\nconst log = Logger.getLogger(__filename);\n\n/**\n * Try to perform the given updateLayout operation on remote storage. If a conflict is returned,\n * fetch the most recent version of the layout and return that instead.\n */\nasync function updateOrFetchLayout(\n  remote: IRemoteLayoutStorage,\n  params: Parameters<IRemoteLayoutStorage[\"updateLayout\"]>[0],\n): Promise<RemoteLayout> {\n  const response = await remote.updateLayout(params);\n  switch (response.status) {\n    case \"success\":\n      return response.newLayout;\n    case \"conflict\": {\n      const remoteLayout = await remote.getLayout(params.id);\n      if (!remoteLayout) {\n        throw new Error(`Update rejected but layout is not present on server: ${params.id}`);\n      }\n      log.info(`Layout update rejected, using server version: ${params.id}`);\n      return remoteLayout;\n    }\n  }\n}\n\nexport default class LayoutManager implements ILayoutManager {\n  public static readonly LOCAL_STORAGE_NAMESPACE = \"local\";\n  public static readonly REMOTE_STORAGE_NAMESPACE_PREFIX = \"remote-\";\n\n  /**\n   * All access to storage is wrapped in a mutex to prevent multi-step operations (such as reading\n   * and then writing a single layout, or writing one and deleting another) from getting\n   * interleaved.\n   */\n  private local: MutexLocked<NamespacedLayoutStorage>;\n  private remote: IRemoteLayoutStorage | undefined;\n\n  public readonly supportsSharing: boolean;\n\n  private emitter = new EventEmitter<LayoutManagerEventTypes>();\n\n  private busyCount = 0;\n\n  /**\n   * A decorator to emit busy events before and after an async operation so the UI can show that the\n   * operation is in progress.\n   */\n  private static withBusyStatus<Args extends unknown[], Ret>(\n    _prototype: typeof LayoutManager.prototype,\n    _propertyKey: string,\n    descriptor: TypedPropertyDescriptor<(this: LayoutManager, ...args: Args) => Promise<Ret>>,\n  ) {\n    const method = descriptor.value!;\n    descriptor.value = async function (...args) {\n      try {\n        this.busyCount++;\n        this.emitter.emit(\"busychange\");\n        return await method.apply(this, args);\n      } finally {\n        this.busyCount--;\n        this.emitter.emit(\"busychange\");\n      }\n    };\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  public get isBusy(): boolean {\n    return this.busyCount > 0;\n  }\n\n  public isOnline = false;\n\n  public error: undefined | Error = undefined;\n\n  // eslint-disable-next-line @foxglove/no-boolean-parameters\n  public setOnline(online: boolean): void {\n    this.isOnline = online;\n    this.emitter.emit(\"onlinechange\");\n  }\n\n  public setError(error: undefined | Error): void {\n    this.error = error;\n    this.emitter.emit(\"errorchange\");\n  }\n\n  public constructor({\n    local,\n    remote,\n  }: {\n    local: ILayoutStorage;\n    remote: IRemoteLayoutStorage | undefined;\n  }) {\n    this.local = new MutexLocked(\n      new NamespacedLayoutStorage(\n        new WriteThroughLayoutCache(local),\n        remote\n          ? LayoutManager.REMOTE_STORAGE_NAMESPACE_PREFIX + remote.namespace\n          : LayoutManager.LOCAL_STORAGE_NAMESPACE,\n        {\n          migrateUnnamespacedLayouts: true,\n\n          // Convert existing local layouts into cloud personal layouts\n          importFromNamespace: remote ? LayoutManager.LOCAL_STORAGE_NAMESPACE : undefined,\n        },\n      ),\n    );\n    this.remote = remote;\n    this.supportsSharing = remote != undefined;\n  }\n\n  public on<E extends EventEmitter.EventNames<LayoutManagerEventTypes>>(\n    name: E,\n    listener: EventEmitter.EventListener<LayoutManagerEventTypes, E>,\n  ): void {\n    this.emitter.on(name, listener);\n  }\n  public off<E extends EventEmitter.EventNames<LayoutManagerEventTypes>>(\n    name: E,\n    listener: EventEmitter.EventListener<LayoutManagerEventTypes, E>,\n  ): void {\n    this.emitter.off(name, listener);\n  }\n\n  private notifyChangeListeners(event: LayoutManagerChangeEvent) {\n    queueMicrotask(() => this.emitter.emit(\"change\", event));\n  }\n\n  public async getLayouts(): Promise<readonly Layout[]> {\n    return await this.local.runExclusive(async (local) => {\n      const layouts = await local.list();\n      return layouts.filter((layout) => !layoutAppearsDeleted(layout));\n    });\n  }\n\n  public async getLayout(id: LayoutID): Promise<Layout | undefined> {\n    const existingLocal = await this.local.runExclusive(async (local) => {\n      return await local.get(id);\n    });\n\n    if (existingLocal) {\n      return layoutAppearsDeleted(existingLocal) ? undefined : existingLocal;\n    }\n\n    log.debug(`No local layout id:${id}.`);\n\n    // If we are offline, there's nothing else we can do to load the layout\n    if (!this.isOnline) {\n      log.debug(\"LayoutManager offline\");\n      return undefined;\n    }\n\n    log.debug(`Attempting to fetch from remote id:${id}`);\n    // We couldn't find an existing local layout for our id, so we attempt to load the remote one\n    const remoteLayout = await this.remote?.getLayout(id);\n    if (!remoteLayout) {\n      log.debug(`No remote layout with id:${id}`);\n      return undefined;\n    }\n\n    return await this.local.runExclusive(async (local) => {\n      // Layout sync may have happened while we fetched the remote layout.\n      // We see if we have the layout locally and use that before caching the fetched remote layout.\n      const localLayout = await local.get(id);\n      if (localLayout) {\n        log.debug(`Local layout loaded while fetching remote id:${id}`);\n        return localLayout;\n      }\n\n      log.debug(`Adding layout to cache from getLayout: ${remoteLayout.id}`);\n      return await local.put({\n        id: remoteLayout.id,\n        name: remoteLayout.name,\n        permission: remoteLayout.permission,\n        baseline: { data: remoteLayout.data, savedAt: remoteLayout.savedAt },\n        working: undefined,\n        syncInfo: { status: \"tracked\", lastRemoteSavedAt: remoteLayout.savedAt },\n      });\n    });\n  }\n\n  @LayoutManager.withBusyStatus\n  public async saveNewLayout({\n    name,\n    data: unmigratedData,\n    permission,\n  }: {\n    name: string;\n    data: LayoutData;\n    permission: LayoutPermission;\n  }): Promise<Layout> {\n    const data = migratePanelsState(unmigratedData);\n    if (layoutPermissionIsShared(permission)) {\n      if (!this.remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (!this.isOnline) {\n        throw new Error(\"Cannot share a layout while offline\");\n      }\n      const newLayout = await this.remote.saveNewLayout({\n        id: uuidv4() as LayoutID,\n        name,\n        data,\n        permission,\n        savedAt: new Date().toISOString() as ISO8601Timestamp,\n      });\n      const result = await this.local.runExclusive(\n        async (local) =>\n          await local.put({\n            id: newLayout.id,\n            name: newLayout.name,\n            permission: newLayout.permission,\n            baseline: { data: newLayout.data, savedAt: newLayout.savedAt },\n            working: undefined,\n            syncInfo: { status: \"tracked\", lastRemoteSavedAt: newLayout.savedAt },\n          }),\n      );\n      this.notifyChangeListeners({ type: \"change\", updatedLayout: undefined });\n      return result;\n    }\n\n    const newLayout = await this.local.runExclusive(\n      async (local) =>\n        await local.put({\n          id: uuidv4() as LayoutID,\n          name,\n          permission,\n          baseline: { data, savedAt: new Date().toISOString() as ISO8601Timestamp },\n          working: undefined,\n          syncInfo: this.remote ? { status: \"new\", lastRemoteSavedAt: undefined } : undefined,\n        }),\n    );\n    this.notifyChangeListeners({ type: \"change\", updatedLayout: newLayout });\n    return newLayout;\n  }\n\n  @LayoutManager.withBusyStatus\n  public async updateLayout({\n    id,\n    name,\n    data,\n  }: {\n    id: LayoutID;\n    name: string | undefined;\n    data: LayoutData | undefined;\n  }): Promise<Layout> {\n    const now = new Date().toISOString() as ISO8601Timestamp;\n    const localLayout = await this.local.runExclusive(async (local) => await local.get(id));\n    if (!localLayout) {\n      throw new Error(`Cannot update layout ${id} because it does not exist`);\n    }\n\n    // If the modifications result in the same layout data, set the working copy to undefined so the\n    // layout appears unmodified.\n    const newWorking =\n      data == undefined\n        ? localLayout.working\n        : isLayoutEqual(localLayout.baseline.data, data)\n        ? undefined\n        : { data, savedAt: now };\n\n    // Renames of shared layouts go directly to the server\n    if (name != undefined && layoutIsShared(localLayout)) {\n      if (!this.remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (!this.isOnline) {\n        throw new Error(\"Cannot update a shared layout while offline\");\n      }\n      const updatedBaseline = await updateOrFetchLayout(this.remote, { id, name, savedAt: now });\n      const result = await this.local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            name: updatedBaseline.name,\n            baseline: { data: updatedBaseline.data, savedAt: updatedBaseline.savedAt },\n            working: newWorking,\n            syncInfo: { status: \"tracked\", lastRemoteSavedAt: updatedBaseline.savedAt },\n          }),\n      );\n      this.notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    } else {\n      const isRename =\n        this.remote != undefined &&\n        name != undefined &&\n        localLayout.syncInfo != undefined &&\n        localLayout.syncInfo.status !== \"new\";\n      const result = await this.local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            name: name ?? localLayout.name,\n            working: newWorking,\n\n            // If the name is being changed, we will need to upload to the server with a new savedAt\n            baseline: isRename ? { ...localLayout.baseline, savedAt: now } : localLayout.baseline,\n            syncInfo: isRename\n              ? { status: \"updated\", lastRemoteSavedAt: localLayout.syncInfo?.lastRemoteSavedAt }\n              : localLayout.syncInfo,\n          }),\n      );\n      this.notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    }\n  }\n\n  @LayoutManager.withBusyStatus\n  public async deleteLayout({ id }: { id: LayoutID }): Promise<void> {\n    const localLayout = await this.local.runExclusive(async (local) => await local.get(id));\n    if (!localLayout) {\n      throw new Error(`Cannot update layout ${id} because it does not exist`);\n    }\n    if (layoutIsShared(localLayout)) {\n      if (!this.remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (localLayout.syncInfo?.status !== \"remotely-deleted\") {\n        if (!this.isOnline) {\n          throw new Error(\"Cannot delete a shared layout while offline\");\n        }\n        await this.remote.deleteLayout(id);\n      }\n    }\n    await this.local.runExclusive(async (local) => {\n      if (this.remote && !layoutIsShared(localLayout)) {\n        await local.put({\n          ...localLayout,\n          working: {\n            data: localLayout.working?.data ?? localLayout.baseline.data,\n            savedAt: new Date().toISOString() as ISO8601Timestamp,\n          },\n          syncInfo: {\n            status: \"locally-deleted\",\n            lastRemoteSavedAt: localLayout.syncInfo?.lastRemoteSavedAt,\n          },\n        });\n      } else {\n        // Don't have remote storage, or already deleted on remote\n        await local.delete(id);\n      }\n    });\n    this.notifyChangeListeners({ type: \"delete\", layoutId: id });\n  }\n\n  @LayoutManager.withBusyStatus\n  public async overwriteLayout({ id }: { id: LayoutID }): Promise<Layout> {\n    const localLayout = await this.local.runExclusive(async (local) => await local.get(id));\n    if (!localLayout) {\n      throw new Error(`Cannot overwrite layout ${id} because it does not exist`);\n    }\n    const now = new Date().toISOString() as ISO8601Timestamp;\n    if (layoutIsShared(localLayout)) {\n      if (!this.remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (!this.isOnline) {\n        throw new Error(\"Cannot save a shared layout while offline\");\n      }\n      const updatedBaseline = await updateOrFetchLayout(this.remote, {\n        id,\n        data: localLayout.working?.data ?? localLayout.baseline.data,\n        savedAt: now,\n      });\n      const result = await this.local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            baseline: { data: updatedBaseline.data, savedAt: updatedBaseline.savedAt },\n            working: undefined,\n            syncInfo: { status: \"tracked\", lastRemoteSavedAt: updatedBaseline.savedAt },\n          }),\n      );\n      this.notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    } else {\n      const result = await this.local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            baseline: {\n              data: localLayout.working?.data ?? localLayout.baseline.data,\n              savedAt: now,\n            },\n            working: undefined,\n            syncInfo:\n              this.remote && localLayout.syncInfo?.status !== \"new\"\n                ? { status: \"updated\", lastRemoteSavedAt: localLayout.syncInfo?.lastRemoteSavedAt }\n                : localLayout.syncInfo,\n          }),\n      );\n      this.notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    }\n  }\n\n  @LayoutManager.withBusyStatus\n  public async revertLayout({ id }: { id: LayoutID }): Promise<Layout> {\n    const result = await this.local.runExclusive(async (local) => {\n      const layout = await local.get(id);\n      if (!layout) {\n        throw new Error(`Cannot revert layout id ${id} because it does not exist`);\n      }\n      return await local.put({\n        ...layout,\n        working: undefined,\n      });\n    });\n    this.notifyChangeListeners({ type: \"change\", updatedLayout: result });\n    return result;\n  }\n\n  @LayoutManager.withBusyStatus\n  public async makePersonalCopy({ id, name }: { id: LayoutID; name: string }): Promise<Layout> {\n    const now = new Date().toISOString() as ISO8601Timestamp;\n    const result = await this.local.runExclusive(async (local) => {\n      const layout = await local.get(id);\n      if (!layout) {\n        throw new Error(`Cannot make a personal copy of layout id ${id} because it does not exist`);\n      }\n      const newLayout = await local.put({\n        id: uuidv4() as LayoutID,\n        name,\n        permission: \"CREATOR_WRITE\",\n        baseline: { data: layout.working?.data ?? layout.baseline.data, savedAt: now },\n        working: undefined,\n        syncInfo: { status: \"new\", lastRemoteSavedAt: now },\n      });\n      await local.put({ ...layout, working: undefined });\n      return newLayout;\n    });\n    this.notifyChangeListeners({ type: \"change\", updatedLayout: undefined });\n    return result;\n  }\n\n  /** Ensures at most one sync operation is in progress at a time */\n  private currentSync?: Promise<void>;\n\n  /**\n   * Attempt to synchronize the local cache with remote storage. At minimum this incurs a fetch of\n   * the cached and remote layout lists; it may also involve modifications to the cache, remote\n   * storage, or both.\n   */\n  @LayoutManager.withBusyStatus\n  public async syncWithRemote(abortSignal: AbortSignal): Promise<void> {\n    if (this.currentSync) {\n      log.debug(\"Layout sync is already in progress\");\n      return await this.currentSync;\n    }\n    const start = performance.now();\n    try {\n      log.debug(\"Starting layout sync\");\n      this.currentSync = this.syncWithRemoteImpl(abortSignal);\n      await this.currentSync;\n      this.notifyChangeListeners({ type: \"change\", updatedLayout: undefined });\n      if (this.error) {\n        this.setError(undefined);\n      }\n    } catch (error) {\n      this.setError(error);\n      throw error;\n    } finally {\n      this.currentSync = undefined;\n      log.debug(`Completed sync in ${((performance.now() - start) / 1000).toFixed(2)}s`);\n    }\n  }\n\n  private async syncWithRemoteImpl(abortSignal: AbortSignal): Promise<void> {\n    if (!this.remote || !this.isOnline) {\n      return;\n    }\n\n    const [localLayouts, remoteLayouts] = await Promise.all([\n      this.local.runExclusive(async (local) => await local.list()),\n      this.remote.getLayouts(),\n    ]);\n    if (abortSignal.aborted) {\n      return;\n    }\n\n    const syncOperations = computeLayoutSyncOperations(localLayouts, remoteLayouts);\n    const [localOps, remoteOps] = partition(\n      syncOperations,\n      (op): op is typeof op & { local: true } => op.local,\n    );\n    await Promise.all([\n      this.performLocalSyncOperations(localOps, abortSignal),\n      this.performRemoteSyncOperations(remoteOps, abortSignal),\n    ]);\n  }\n\n  private async performLocalSyncOperations(\n    operations: readonly (SyncOperation & { local: true })[],\n    abortSignal: AbortSignal,\n  ): Promise<void> {\n    await this.local.runExclusive(async (local) => {\n      for (const operation of operations) {\n        if (abortSignal.aborted) {\n          return;\n        }\n        switch (operation.type) {\n          case \"mark-deleted\": {\n            const { localLayout } = operation;\n            log.debug(`Marking layout as remotely deleted: ${localLayout.id}`);\n            await local.put({\n              ...localLayout,\n              syncInfo: { status: \"remotely-deleted\", lastRemoteSavedAt: undefined },\n            });\n            break;\n          }\n\n          case \"delete-local\":\n            log.debug(\n              `Deleting local layout ${operation.localLayout.id}, whose sync status was ${operation.localLayout.syncInfo?.status}`,\n            );\n            await local.delete(operation.localLayout.id);\n            this.notifyChangeListeners({ type: \"delete\", layoutId: operation.localLayout.id });\n            break;\n\n          case \"add-to-cache\": {\n            const { remoteLayout } = operation;\n            log.debug(`Adding layout to cache: ${remoteLayout.id}`);\n            await local.put({\n              id: remoteLayout.id,\n              name: remoteLayout.name,\n              permission: remoteLayout.permission,\n              baseline: { data: remoteLayout.data, savedAt: remoteLayout.savedAt },\n              working: undefined,\n              syncInfo: { status: \"tracked\", lastRemoteSavedAt: remoteLayout.savedAt },\n            });\n            break;\n          }\n\n          case \"update-baseline\": {\n            const { localLayout, remoteLayout } = operation;\n            log.debug(`Updating baseline for ${localLayout.id}`);\n            await local.put({\n              id: remoteLayout.id,\n              name: remoteLayout.name,\n              permission: remoteLayout.permission,\n              baseline: { data: remoteLayout.data, savedAt: remoteLayout.savedAt },\n              working: localLayout.working,\n              syncInfo: {\n                status: localLayout.syncInfo.status,\n                lastRemoteSavedAt: remoteLayout.savedAt,\n              },\n            });\n            break;\n          }\n        }\n      }\n    });\n  }\n\n  private async performRemoteSyncOperations(\n    operations: readonly (SyncOperation & { local: false })[],\n    abortSignal: AbortSignal,\n  ): Promise<void> {\n    const { remote } = this;\n    if (!remote) {\n      return;\n    }\n\n    // Any necessary local cleanups are performed all at once after the server operations, so the\n    // server ops can be done without blocking other local sync operations.\n    type CleanupFunction = (local: NamespacedLayoutStorage) => Promise<void>;\n\n    const cleanups = await Promise.all(\n      operations.map(async (operation): Promise<CleanupFunction> => {\n        switch (operation.type) {\n          case \"delete-remote\": {\n            const { localLayout } = operation;\n            log.debug(`Deleting remote layout ${localLayout.id}`);\n            if (!(await remote.deleteLayout(localLayout.id))) {\n              log.warn(`Deleting layout ${localLayout.id} which was not present in remote storage`);\n            }\n            return async (local) => {\n              if (abortSignal.aborted) {\n                return;\n              }\n              await local.delete(localLayout.id);\n            };\n          }\n\n          case \"upload-new\": {\n            const { localLayout } = operation;\n            log.debug(`Uploading new layout ${localLayout.id}`);\n            const newBaseline = await remote.saveNewLayout({\n              id: localLayout.id,\n              name: localLayout.name,\n              data: localLayout.baseline.data,\n              permission: localLayout.permission,\n              savedAt:\n                localLayout.baseline.savedAt ?? (new Date().toISOString() as ISO8601Timestamp),\n            });\n            return async (local) => {\n              // Don't check abortSignal; we need the cache to be updated to show the layout is tracked\n              await local.put({\n                ...localLayout,\n                baseline: { ...localLayout.baseline, savedAt: newBaseline.savedAt },\n                syncInfo: { status: \"tracked\", lastRemoteSavedAt: newBaseline.savedAt },\n              });\n            };\n          }\n\n          case \"upload-updated\": {\n            const { localLayout } = operation;\n            log.debug(`Uploading updated layout ${localLayout.id}`);\n            const newBaseline = await updateOrFetchLayout(remote, {\n              id: localLayout.id,\n              name: localLayout.name,\n              data: localLayout.baseline.data,\n              savedAt:\n                localLayout.baseline.savedAt ?? (new Date().toISOString() as ISO8601Timestamp),\n            });\n            return async (local) => {\n              // Don't check abortSignal; we need the cache to be updated to show the layout is tracked\n              await local.put({\n                ...localLayout,\n                name: newBaseline.name,\n                baseline: { ...localLayout.baseline, savedAt: newBaseline.savedAt },\n                syncInfo: { status: \"tracked\", lastRemoteSavedAt: newBaseline.savedAt },\n              });\n            };\n          }\n        }\n      }),\n    );\n\n    await this.local.runExclusive(async (local) => {\n      await Promise.all(cleanups.map(async (cleanup) => await cleanup(local)));\n    });\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n/** Return a Promise resolved after @param ms milliseconds */\nexport default async function delay(ms: number): Promise<void> {\n  return await new Promise((resolve) => setTimeout(resolve, ms));\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useEffect, useMemo } from \"react\";\nimport { useNetworkState } from \"react-use\";\n\nimport { useShallowMemo, useVisibilityState } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport LayoutManagerContext from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { useLayoutStorage } from \"@foxglove/studio-base/context/LayoutStorageContext\";\nimport LayoutStorageDebuggingContext from \"@foxglove/studio-base/context/LayoutStorageDebuggingContext\";\nimport { useRemoteLayoutStorage } from \"@foxglove/studio-base/context/RemoteLayoutStorageContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport useCallbackWithToast from \"@foxglove/studio-base/hooks/useCallbackWithToast\";\nimport { ISO8601Timestamp, LayoutID } from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport LayoutManager from \"@foxglove/studio-base/services/LayoutManager/LayoutManager\";\nimport delay from \"@foxglove/studio-base/util/delay\";\n\nconst log = Logger.getLogger(__filename);\n\nconst SYNC_INTERVAL_BASE_MS = 30_000;\nconst SYNC_INTERVAL_MAX_MS = 3 * 60_000;\n\nexport default function LayoutManagerProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const layoutStorage = useLayoutStorage();\n  const remoteLayoutStorage = useRemoteLayoutStorage();\n  const [enableLayoutDebugging = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_LAYOUT_DEBUGGING,\n  );\n\n  const layoutManager = useMemo(\n    () => new LayoutManager({ local: layoutStorage, remote: remoteLayoutStorage }),\n    [layoutStorage, remoteLayoutStorage],\n  );\n\n  const { online = false } = useNetworkState();\n  const visibilityState = useVisibilityState();\n  useEffect(() => {\n    layoutManager.setOnline(online);\n  }, [layoutManager, online]);\n\n  // Sync periodically when logged in, online, and the app is not hidden\n  const enableSyncing = remoteLayoutStorage != undefined && online && visibilityState === \"visible\";\n  useEffect(() => {\n    if (!enableSyncing) {\n      return;\n    }\n    const controller = new AbortController();\n    void (async () => {\n      let failures = 0;\n      while (!controller.signal.aborted) {\n        try {\n          await layoutManager.syncWithRemote(controller.signal);\n          failures = 0;\n        } catch (error) {\n          log.error(\"Sync failed:\", error);\n          failures++;\n        }\n        // Exponential backoff with jitter:\n        // https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/\n        const duration =\n          Math.random() * Math.min(SYNC_INTERVAL_MAX_MS, SYNC_INTERVAL_BASE_MS * 2 ** failures);\n        log.debug(\"Waiting\", (duration / 1000).toFixed(2), \"sec for next sync\", { failures });\n        await delay(duration);\n      }\n    })();\n    return () => {\n      log.debug(\"Canceling layout sync due to effect cleanup callback\");\n      controller.abort();\n    };\n  }, [enableSyncing, layoutManager]);\n\n  const syncNow = useCallbackWithToast(async () => {\n    await layoutManager.syncWithRemote(new AbortController().signal);\n  }, [layoutManager]);\n\n  const injectEdit = useCallback(\n    async (id: LayoutID) => {\n      const layout = await remoteLayoutStorage?.getLayout(id);\n      if (!layout) {\n        throw new Error(\"This layout doesn't exist on the server\");\n      }\n      await remoteLayoutStorage?.updateLayout({\n        id: layout.id,\n        name: layout.name,\n        data: {\n          ...layout.data,\n          layout: {\n            direction: \"row\",\n            first: `onboarding.welcome!${Math.round(Math.random() * 1e6).toString(36)}`,\n            second: layout.data.layout ?? \"unknown\",\n            splitPercentage: 33,\n          },\n        },\n        savedAt: new Date().toISOString() as ISO8601Timestamp,\n      });\n    },\n    [remoteLayoutStorage],\n  );\n\n  const injectRename = useCallback(\n    async (id: LayoutID) => {\n      const layout = await remoteLayoutStorage?.getLayout(id);\n      if (!layout) {\n        throw new Error(\"This layout doesn't exist on the server\");\n      }\n      await remoteLayoutStorage?.updateLayout({\n        id,\n        name: `${layout.name} renamed`,\n        savedAt: new Date().toISOString() as ISO8601Timestamp,\n      });\n    },\n    [remoteLayoutStorage],\n  );\n\n  const injectDelete = useCallback(\n    async (id: LayoutID) => {\n      await remoteLayoutStorage?.deleteLayout(id);\n    },\n    [remoteLayoutStorage],\n  );\n\n  const setOnline = useCallback(\n    // eslint-disable-next-line @foxglove/no-boolean-parameters\n    (newValue: boolean) => layoutManager.setOnline(newValue),\n    [layoutManager],\n  );\n\n  const debugging = useShallowMemo({\n    syncNow,\n    setOnline,\n    injectEdit,\n    injectRename,\n    injectDelete,\n  });\n\n  return (\n    <LayoutStorageDebuggingContext.Provider\n      value={process.env.NODE_ENV !== \"production\" && enableLayoutDebugging ? debugging : undefined}\n    >\n      <LayoutManagerContext.Provider value={layoutManager}>\n        {children}\n      </LayoutManagerContext.Provider>\n    </LayoutStorageDebuggingContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { TFunction } from \"i18next\";\n\nimport { PanelInfo } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\n\nimport dataSourceInfoThumbnail from \"./DataSourceInfo/thumbnail.png\";\nimport gaugeThumbnail from \"./Gauge/thumbnail.png\";\nimport imageViewThumbnail from \"./Image/thumbnail.png\";\nimport indicatorThumbnail from \"./Indicator/thumbnail.png\";\nimport logThumbnail from \"./Log/thumbnail.png\";\nimport mapThumbnail from \"./Map/thumbnail.png\";\nimport nodePlaygroundThumbnail from \"./NodePlayground/thumbnail.png\";\nimport parametersThumbnail from \"./Parameters/thumbnail.png\";\nimport plotThumbnail from \"./Plot/thumbnail.png\";\nimport publishThumbnail from \"./Publish/thumbnail.png\";\nimport rawMessagesThumbnail from \"./RawMessages/thumbnail.png\";\nimport stateTransitionsThumbnail from \"./StateTransitions/thumbnail.png\";\nimport tabThumbnail from \"./Tab/thumbnail.png\";\nimport tableThumbnail from \"./Table/thumbnail.png\";\nimport teleopThumbnail from \"./Teleop/thumbnail.png\";\nimport threeDeeRenderThumbnail from \"./ThreeDeeRender/thumbnail.png\";\nimport topicGraphThumbnail from \"./TopicGraph/thumbnail.png\";\nimport variableSliderThumbnail from \"./VariableSlider/thumbnail.png\";\nimport diagnosticStatusThumbnail from \"./diagnostics/thumbnails/diagnostic-status.png\";\nimport diagnosticSummaryThumbnail from \"./diagnostics/thumbnails/diagnostic-summary.png\";\n\nexport const getBuiltin: (t: TFunction<\"panels\">) => PanelInfo[] = (t) => [\n  {\n    title: t(\"3D\"),\n    type: \"3D\",\n    description: t(\"3DPanelDescription\"),\n    thumbnail: threeDeeRenderThumbnail,\n    module: async () => ({ default: (await import(\"./ThreeDeeRender\")).ThreeDeePanel }),\n    settingsOnboardingTooltip: t(\"3DPanelSettingsOnboardingTooltip\"),\n  },\n  {\n    title: t(\"ROSDiagnosticsDetail\"),\n    type: \"DiagnosticStatusPanel\",\n    description: t(\"ROSDiagnosticsDetailDescription\"),\n    thumbnail: diagnosticStatusThumbnail,\n    module: async () => await import(\"./diagnostics/DiagnosticStatusPanel\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"ROSDiagnosticSummary\"),\n    type: \"DiagnosticSummary\",\n    description: t(\"ROSDiagnosticSummaryDescription\"),\n    thumbnail: diagnosticSummaryThumbnail,\n    module: async () => await import(\"./diagnostics/DiagnosticSummary\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"image\"),\n    type: \"ImageViewPanel\",\n    description: t(\"imageDescription\"),\n    thumbnail: imageViewThumbnail,\n    module: async () => await import(\"./Image\"),\n  },\n  {\n    title: t(\"indicator\"),\n    type: \"Indicator\",\n    description: t(\"indicatorDescription\"),\n    thumbnail: indicatorThumbnail,\n    module: async () => await import(\"./Indicator\"),\n  },\n  {\n    title: t(\"gauge\"),\n    type: \"Gauge\",\n    description: t(\"gaugeDescription\"),\n    thumbnail: gaugeThumbnail,\n    module: async () => await import(\"./Gauge\"),\n  },\n  {\n    title: t(\"teleop\"),\n    type: \"Teleop\",\n    description: t(\"teleopDescription\"),\n    thumbnail: teleopThumbnail,\n    module: async () => await import(\"./Teleop\"),\n  },\n  {\n    title: t(\"map\"),\n    type: \"map\",\n    description: t(\"mapDescription\"),\n    thumbnail: mapThumbnail,\n    module: async () => await import(\"./Map\"),\n  },\n  {\n    title: t(\"parameters\"),\n    type: \"Parameters\",\n    description: t(\"parametersDescription\"),\n    thumbnail: parametersThumbnail,\n    module: async () => await import(\"./Parameters\"),\n  },\n  {\n    title: t(\"plot\"),\n    type: \"Plot\",\n    description: t(\"plotDescription\"),\n    thumbnail: plotThumbnail,\n    module: async () => await import(\"./Plot\"),\n  },\n  {\n    title: t(\"publish\"),\n    type: \"Publish\",\n    description: t(\"publishDescription\"),\n    thumbnail: publishThumbnail,\n    module: async () => await import(\"./Publish\"),\n  },\n  {\n    title: t(\"rawMessages\"),\n    type: \"RawMessages\",\n    description: t(\"rawMessagesDescription\"),\n    thumbnail: rawMessagesThumbnail,\n    module: async () => await import(\"./RawMessages\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"log\"),\n    type: \"RosOut\",\n    description: t(\"logDescription\"),\n    thumbnail: logThumbnail,\n    module: async () => await import(\"./Log\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"stateTransitions\"),\n    type: \"StateTransitions\",\n    description: t(\"stateTransitionsDescription\"),\n    thumbnail: stateTransitionsThumbnail,\n    module: async () => await import(\"./StateTransitions\"),\n  },\n  {\n    title: t(\"table\"),\n    type: \"Table\",\n    description: t(\"tableDescription\"),\n    thumbnail: tableThumbnail,\n    module: async () => await import(\"./Table\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"topicGraph\"),\n    type: \"TopicGraph\",\n    description: t(\"topicGraphDescription\"),\n    thumbnail: topicGraphThumbnail,\n    module: async () => await import(\"./TopicGraph\"),\n  },\n  {\n    title: t(\"dataSourceInfo\"),\n    type: \"SourceInfo\",\n    description: t(\"dataSourceInfoDescription\"),\n    thumbnail: dataSourceInfoThumbnail,\n    module: async () => await import(\"./DataSourceInfo\"),\n  },\n  {\n    title: t(\"variableSlider\"),\n    type: \"GlobalVariableSliderPanel\",\n    description: t(\"variableSliderDescription\"),\n    thumbnail: variableSliderThumbnail,\n    module: async () => await import(\"./VariableSlider\"),\n  },\n  {\n    title: t(\"userScripts\"),\n    type: \"NodePlayground\",\n    description: t(\"userScriptsDescription\"),\n    thumbnail: nodePlaygroundThumbnail,\n    module: async () => await import(\"./NodePlayground\"),\n  },\n  {\n    title: t(\"tab\"),\n    type: TAB_PANEL_TYPE,\n    description: t(\"tabDescription\"),\n    thumbnail: tabThumbnail,\n    module: async () => await import(\"./Tab\"),\n    hasCustomToolbar: true,\n  },\n];\n\nexport const getDebug: (t: TFunction<\"panels\">) => PanelInfo[] = (t) => [\n  {\n    title: t(\"studioPlaybackPerformance\"),\n    type: \"PlaybackPerformance\",\n    description: t(\"studioPlaybackPerformanceDescription\"),\n    module: async () => await import(\"./PlaybackPerformance\"),\n  },\n];\n\nexport const getLegacyPlot: (t: TFunction<\"panels\">) => PanelInfo = (t) => ({\n  title: t(\"legacyPlot\"),\n  type: \"LegacyPlot\",\n  module: async () => await import(\"./LegacyPlot\"),\n});\n\nexport const getNewImage: (t: TFunction<\"panels\">) => PanelInfo = (t) => ({\n  title: t(\"newImage\"),\n  type: \"Image\",\n  module: async () => ({ default: (await import(\"./ThreeDeeRender\")).ImagePanel }),\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Panel from \"@foxglove/studio-base/components/Panel\";\nimport { PanelExtensionAdapter } from \"@foxglove/studio-base/components/PanelExtensionAdapter\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport PanelCatalogContext, {\n  PanelCatalog,\n  PanelInfo,\n} from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport * as panels from \"@foxglove/studio-base/panels\";\nimport { SaveConfig } from \"@foxglove/studio-base/types/panels\";\n\ntype PanelProps = {\n  config: unknown;\n  saveConfig: SaveConfig<unknown>;\n};\n\nexport default function PanelCatalogProvider(\n  props: PropsWithChildren<unknown>,\n): React.ReactElement {\n  const [showDebugPanels = false] = useAppConfigurationValue<boolean>(AppSetting.SHOW_DEBUG_PANELS);\n  const [enableLegacyPlotPanel = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_LEGACY_PLOT_PANEL,\n  );\n  const [enableNewImagePanel = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_NEW_IMAGE_PANEL,\n  );\n  const { t } = useTranslation(\"panels\");\n\n  const extensionPanels = useExtensionCatalog((state) => state.installedPanels);\n\n  const wrappedExtensionPanels = useMemo<PanelInfo[]>(() => {\n    return Object.values(extensionPanels ?? {}).map((panel) => {\n      const panelType = `${panel.extensionName}.${panel.registration.name}`;\n      const PanelWrapper = (panelProps: PanelProps) => {\n        return (\n          <>\n            <PanelExtensionAdapter\n              config={panelProps.config}\n              saveConfig={panelProps.saveConfig}\n              initPanel={panel.registration.initPanel}\n            />\n          </>\n        );\n      };\n      PanelWrapper.panelType = panelType;\n      PanelWrapper.defaultConfig = {};\n      return {\n        category: \"misc\",\n        title: panel.registration.name,\n        type: panelType,\n        module: async () => ({ default: Panel(PanelWrapper) }),\n        extensionNamespace: panel.extensionNamespace,\n      };\n    });\n  }, [extensionPanels]);\n\n  // Re-call the function when the language changes to ensure that the panel's information is successfully translated\n  const allPanelsInfo = useMemo(() => {\n    return {\n      builtin: panels.getBuiltin(t),\n      debug: panels.getDebug(t),\n      legacyPlot: panels.getLegacyPlot(t),\n      newImage: panels.getNewImage(t),\n    };\n  }, [t]);\n\n  const allPanels = useMemo(() => {\n    return [\n      ...allPanelsInfo.builtin,\n      ...allPanelsInfo.debug,\n      allPanelsInfo.newImage,\n      allPanelsInfo.legacyPlot,\n      ...wrappedExtensionPanels,\n    ];\n  }, [wrappedExtensionPanels, allPanelsInfo]);\n\n  const visiblePanels = useMemo(() => {\n    const panelList = [...allPanelsInfo.builtin];\n    if (showDebugPanels) {\n      panelList.push(...allPanelsInfo.debug);\n    }\n    if (enableLegacyPlotPanel) {\n      panelList.push(allPanelsInfo.legacyPlot);\n    }\n    if (enableNewImagePanel) {\n      panelList.push(allPanelsInfo.newImage);\n    }\n    panelList.push(...wrappedExtensionPanels);\n    return panelList;\n  }, [\n    enableLegacyPlotPanel,\n    enableNewImagePanel,\n    showDebugPanels,\n    wrappedExtensionPanels,\n    allPanelsInfo,\n  ]);\n\n  const panelsByType = useMemo(() => {\n    const byType = new Map<string, PanelInfo>();\n\n    for (const panel of allPanels) {\n      const type = panel.type;\n      byType.set(type, panel);\n    }\n    return byType;\n  }, [allPanels]);\n\n  const provider = useMemo<PanelCatalog>(() => {\n    return {\n      getPanels() {\n        return visiblePanels;\n      },\n      getPanelByType(type: string) {\n        return panelsByType.get(type);\n      },\n    };\n  }, [panelsByType, visiblePanels]);\n\n  return (\n    <PanelCatalogContext.Provider value={provider}>{props.children}</PanelCatalogContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { merge } from \"lodash\";\nimport { useCallback } from \"react\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport {\n  UserProfile,\n  UserProfileStorageContext,\n} from \"@foxglove/studio-base/context/UserProfileStorageContext\";\n\nconst DEFAULT_PROFILE: UserProfile = {};\nconst LOCAL_STORAGE_KEY = \"studio.profile-data\";\n\n/**\n * A provider for UserProfileStorage that stores data in localStorage.\n */\nexport default function UserProfileLocalStorageProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const getUserProfile = useCallback(async (): Promise<UserProfile> => {\n    const item = localStorage.getItem(LOCAL_STORAGE_KEY);\n    return item != undefined ? (JSON.parse(item) as UserProfile) : DEFAULT_PROFILE;\n  }, []);\n  const setUserProfile = useCallback(\n    async (value: UserProfile | ((prev: UserProfile) => UserProfile)) => {\n      const item = localStorage.getItem(LOCAL_STORAGE_KEY);\n      const prev = item != undefined ? (JSON.parse(item) as UserProfile) : DEFAULT_PROFILE;\n      const newProfile = typeof value === \"function\" ? value(prev) : merge(prev, value);\n      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newProfile) ?? \"\");\n    },\n    [],\n  );\n  const storage = useShallowMemo({\n    getUserProfile,\n    setUserProfile,\n  });\n  return (\n    <UserProfileStorageContext.Provider value={storage}>\n      {children}\n    </UserProfileStorageContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Button,\n  Checkbox,\n  Dialog,\n  DialogContent,\n  FormControlLabel,\n  Grid,\n  Typography,\n} from \"@mui/material\";\nimport { ReactElement, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport { useSessionStorageValue } from \"@foxglove/studio-base/hooks/useSessionStorageValue\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\n\nconst useStyles = makeStyles()((theme) => ({\n  button: {\n    textAlign: \"left\",\n    justifyContent: \"flex-start\",\n    padding: theme.spacing(2),\n    gap: theme.spacing(1.5),\n    borderColor: theme.palette.divider,\n    height: \"100%\",\n  },\n  paper: {\n    maxWidth: 480,\n  },\n}));\n\nexport function LaunchPreferenceScreen(): ReactElement {\n  const { classes } = useStyles();\n  const [globalPreference, setGlobalPreference] = useAppConfigurationValue<string | undefined>(\n    AppSetting.LAUNCH_PREFERENCE,\n  );\n  const [_, setSessionPreference] = useSessionStorageValue(AppSetting.LAUNCH_PREFERENCE);\n  const [rememberPreference, setRememberPreference] = useState(globalPreference != undefined);\n\n  async function launchInWeb() {\n    setSessionPreference(LaunchPreferenceValue.WEB); // always set session preference to allow overriding the URL param\n    if (rememberPreference) {\n      await setGlobalPreference(LaunchPreferenceValue.WEB);\n    }\n  }\n\n  async function launchInDesktop() {\n    setSessionPreference(LaunchPreferenceValue.DESKTOP); // always set session preference to allow overriding the URL param\n    if (rememberPreference) {\n      await setGlobalPreference(LaunchPreferenceValue.DESKTOP);\n    }\n  }\n\n  async function toggleRememberPreference() {\n    if (rememberPreference) {\n      await setGlobalPreference(undefined);\n    }\n    setRememberPreference(!rememberPreference);\n  }\n\n  const actions = [\n    {\n      key: LaunchPreferenceValue.WEB,\n      primary: \"Web\",\n      secondary: \"Requires Chrome v76+\",\n      onClick: () => void launchInWeb(),\n    },\n    {\n      key: LaunchPreferenceValue.DESKTOP,\n      primary: \"Desktop App\",\n      secondary: \"For Linux, Windows, and macOS\",\n      onClick: () => void launchInDesktop(),\n    },\n  ];\n\n  return (\n    <Dialog open classes={{ paper: classes.paper }}>\n      <Stack paddingX={2} paddingTop={3}>\n        <Typography align=\"center\" variant=\"h2\" fontWeight={600}>\n          Launch Foxglove Studio\n        </Typography>\n      </Stack>\n      <DialogContent>\n        <Grid container spacing={1}>\n          {actions.map((action) => (\n            <Grid key={action.key} item xs={12} sm={6}>\n              <Button\n                className={classes.button}\n                fullWidth\n                color=\"inherit\"\n                variant=\"outlined\"\n                size=\"large\"\n                onClick={action.onClick}\n              >\n                <Stack flex=\"auto\" zeroMinWidth>\n                  <Typography variant=\"subtitle1\" color=\"text.primary\">\n                    {action.primary}\n                  </Typography>\n                  <Typography variant=\"body2\" color=\"text.secondary\">\n                    {action.secondary}\n                  </Typography>\n                </Stack>\n              </Button>\n            </Grid>\n          ))}\n          <Grid item xs={12}>\n            <FormControlLabel\n              label=\"Remember my preference\"\n              control={\n                <Checkbox\n                  color=\"primary\"\n                  checked={rememberPreference}\n                  onChange={toggleRememberPreference}\n                />\n              }\n            />\n          </Grid>\n        </Grid>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link, Typography } from \"@mui/material\";\nimport { ReactElement, useEffect } from \"react\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useSessionStorageValue } from \"@foxglove/studio-base/hooks/useSessionStorageValue\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\n\nexport function LaunchingInDesktopScreen(): ReactElement {\n  const [, setLaunchPreference] = useSessionStorageValue(AppSetting.LAUNCH_PREFERENCE);\n\n  const cleanWebURL = new URL(window.location.href);\n  cleanWebURL.searchParams.delete(\"openIn\");\n\n  function openWeb() {\n    setLaunchPreference(LaunchPreferenceValue.WEB);\n    window.location.href = cleanWebURL.href;\n  }\n\n  useEffect(() => {\n    const desktopURL = new URL(\"foxglove://open\");\n    cleanWebURL.searchParams.forEach((v, k) => {\n      if (k && v) {\n        desktopURL.searchParams.set(k, v);\n\n        // Temporarily send both sets of params until desktop app is updated to\n        // use new ds.* parameters.\n        switch (k) {\n          case \"ds\":\n            desktopURL.searchParams.set(\"type\", v);\n            break;\n          case \"ds.deviceId\":\n            desktopURL.searchParams.set(\"deviceId\", v);\n            break;\n          case \"ds.importId\":\n            desktopURL.searchParams.set(\"importId\", v);\n            break;\n          case \"ds.end\":\n            desktopURL.searchParams.set(\"end\", v);\n            break;\n          case \"ds.start\":\n            desktopURL.searchParams.set(\"start\", v);\n            break;\n          case \"ds.url\":\n            desktopURL.searchParams.set(\"url\", v);\n            break;\n          case \"time\":\n            desktopURL.searchParams.set(\"seekTo\", v);\n            break;\n        }\n      }\n    });\n\n    window.location.href = desktopURL.href;\n  });\n\n  return (\n    <Stack alignItems=\"center\" justifyContent=\"center\" fullHeight>\n      <Stack\n        alignItems=\"center\"\n        justifyContent=\"center\"\n        fullHeight\n        gap={2.5}\n        style={{ maxWidth: 480 }}\n      >\n        <Typography align=\"center\" variant=\"h2\" fontWeight={600}>\n          Launching Foxglove Studio…\n        </Typography>\n        <Typography align=\"center\" fontWeight={600}>\n          We’ve directed you to the desktop app.\n        </Typography>\n        <Stack gap={0.5}>\n          <Typography align=\"center\">\n            You can also{\" \"}\n            <Link color=\"primary\" underline=\"hover\" onClick={openWeb}>\n              open this link in your browser\n            </Link>\n            .\n          </Typography>\n          <Typography align=\"center\">\n            Don’t have the app installed?&nbsp;\n            <Link\n              color=\"primary\"\n              underline=\"hover\"\n              href=\"https://foxglove.dev/download\"\n              target=\"_blank\"\n            >\n              Download Foxglove Studio\n            </Link>\n          </Typography>\n        </Stack>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren } from \"react\";\n\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\n\nimport { LaunchPreferenceScreen } from \"./LaunchPreferenceScreen\";\nimport { LaunchingInDesktopScreen } from \"./LaunchingInDesktopScreen\";\nimport { AppSetting } from \"../AppSetting\";\nimport { useAppConfigurationValue } from \"../hooks\";\nimport { useSessionStorageValue } from \"../hooks/useSessionStorageValue\";\n\nexport function LaunchPreference(props: PropsWithChildren<unknown>): JSX.Element {\n  const [globalLaunchPreference] = useAppConfigurationValue<string>(AppSetting.LAUNCH_PREFERENCE);\n  const [sessionLaunchPreference] = useSessionStorageValue(AppSetting.LAUNCH_PREFERENCE);\n\n  const url = new URL(window.location.href);\n\n  // Session preferences take priority over URL and global preferences. This allows the button in\n  // LaunchPreferenceScreen to override the url when clicked.\n  let activePreference =\n    sessionLaunchPreference ?? url.searchParams.get(\"openIn\") ?? globalLaunchPreference;\n  switch (activePreference) {\n    case LaunchPreferenceValue.WEB:\n    case LaunchPreferenceValue.DESKTOP:\n    case LaunchPreferenceValue.ASK:\n      break;\n    default:\n      activePreference = LaunchPreferenceValue.WEB;\n  }\n\n  const hasParams = Array.from(url.searchParams.entries()).length > 0;\n  // Ask the user in which environment they want to open this session.\n  if (activePreference === LaunchPreferenceValue.ASK && hasParams) {\n    return <LaunchPreferenceScreen />;\n  } else if (activePreference === LaunchPreferenceValue.DESKTOP && hasParams) {\n    return <LaunchingInDesktopScreen />;\n  } else {\n    return <>{props.children}</>;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Suspense, Fragment, useEffect } from \"react\";\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\n\nimport GlobalCss from \"@foxglove/studio-base/components/GlobalCss\";\nimport EventsProvider from \"@foxglove/studio-base/providers/EventsProvider\";\nimport { StudioLogsSettingsProvider } from \"@foxglove/studio-base/providers/StudioLogsSettingsProvider\";\nimport TimelineInteractionStateProvider from \"@foxglove/studio-base/providers/TimelineInteractionStateProvider\";\n\nimport Workspace from \"./Workspace\";\nimport { CustomWindowControlsProps } from \"./components/AppBar/CustomWindowControls\";\nimport { ColorSchemeThemeProvider } from \"./components/ColorSchemeThemeProvider\";\nimport CssBaseline from \"./components/CssBaseline\";\nimport DocumentTitleAdapter from \"./components/DocumentTitleAdapter\";\nimport ErrorBoundary from \"./components/ErrorBoundary\";\nimport MultiProvider from \"./components/MultiProvider\";\nimport PlayerManager from \"./components/PlayerManager\";\nimport SendNotificationToastAdapter from \"./components/SendNotificationToastAdapter\";\nimport StudioToastProvider from \"./components/StudioToastProvider\";\nimport AppConfigurationContext, { IAppConfiguration } from \"./context/AppConfigurationContext\";\nimport LayoutStorageContext from \"./context/LayoutStorageContext\";\nimport NativeAppMenuContext, { INativeAppMenu } from \"./context/NativeAppMenuContext\";\nimport NativeWindowContext, { INativeWindow } from \"./context/NativeWindowContext\";\nimport { IDataSourceFactory } from \"./context/PlayerSelectionContext\";\nimport { UserNodeStateProvider } from \"./context/UserNodeStateContext\";\nimport CurrentLayoutProvider from \"./providers/CurrentLayoutProvider\";\nimport ExtensionCatalogProvider from \"./providers/ExtensionCatalogProvider\";\nimport ExtensionMarketplaceProvider from \"./providers/ExtensionMarketplaceProvider\";\nimport LayoutManagerProvider from \"./providers/LayoutManagerProvider\";\nimport PanelCatalogProvider from \"./providers/PanelCatalogProvider\";\nimport UserProfileLocalStorageProvider from \"./providers/UserProfileLocalStorageProvider\";\nimport { LaunchPreference } from \"./screens/LaunchPreference\";\nimport { ExtensionLoader } from \"./services/ExtensionLoader\";\nimport { ILayoutStorage } from \"./services/ILayoutStorage\";\n\ntype AppProps = CustomWindowControlsProps & {\n  deepLinks: string[];\n  appConfiguration: IAppConfiguration;\n  dataSources: IDataSourceFactory[];\n  layoutStorage: ILayoutStorage;\n  extensionLoaders: readonly ExtensionLoader[];\n  nativeAppMenu?: INativeAppMenu;\n  nativeWindow?: INativeWindow;\n  enableLaunchPreferenceScreen?: boolean;\n  enableGlobalCss?: boolean;\n  appBarLeftInset?: number;\n  extraProviders?: JSX.Element[];\n  onAppBarDoubleClick?: () => void;\n};\n\n// Suppress context menu for the entire app except on inputs & textareas.\nfunction contextMenuHandler(event: MouseEvent) {\n  if (event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement) {\n    return;\n  }\n\n  event.preventDefault();\n  return false;\n}\n\nexport function App(props: AppProps): JSX.Element {\n  const {\n    appConfiguration,\n    dataSources,\n    layoutStorage,\n    extensionLoaders,\n    nativeAppMenu,\n    nativeWindow,\n    deepLinks,\n    enableLaunchPreferenceScreen,\n    enableGlobalCss = false,\n    extraProviders,\n  } = props;\n\n  const providers = [\n    /* eslint-disable react/jsx-key */\n    <StudioLogsSettingsProvider />,\n    <StudioToastProvider />,\n    <LayoutStorageContext.Provider value={layoutStorage} />,\n    <UserProfileLocalStorageProvider />,\n    <LayoutManagerProvider />,\n    <TimelineInteractionStateProvider />,\n    <UserNodeStateProvider />,\n    <CurrentLayoutProvider />,\n    <ExtensionMarketplaceProvider />,\n    <ExtensionCatalogProvider loaders={extensionLoaders} />,\n    <PlayerManager playerSources={dataSources} />,\n    <EventsProvider />,\n    /* eslint-enable react/jsx-key */\n  ];\n\n  if (nativeAppMenu) {\n    providers.push(<NativeAppMenuContext.Provider value={nativeAppMenu} />);\n  }\n\n  if (nativeWindow) {\n    providers.push(<NativeWindowContext.Provider value={nativeWindow} />);\n  }\n\n  if (extraProviders) {\n    providers.unshift(...extraProviders);\n  }\n\n  const MaybeLaunchPreference = enableLaunchPreferenceScreen === true ? LaunchPreference : Fragment;\n\n  useEffect(() => {\n    document.addEventListener(\"contextmenu\", contextMenuHandler);\n    return () => document.removeEventListener(\"contextmenu\", contextMenuHandler);\n  }, []);\n\n  return (\n    <AppConfigurationContext.Provider value={appConfiguration}>\n      <ColorSchemeThemeProvider>\n        {enableGlobalCss && <GlobalCss />}\n        <CssBaseline>\n          <ErrorBoundary>\n            <MaybeLaunchPreference>\n              <MultiProvider providers={providers}>\n                <DocumentTitleAdapter />\n                <SendNotificationToastAdapter />\n                <DndProvider backend={HTML5Backend}>\n                  <Suspense fallback={<></>}>\n                    <PanelCatalogProvider>\n                      <Workspace\n                        deepLinks={deepLinks}\n                        appBarLeftInset={props.appBarLeftInset}\n                        onAppBarDoubleClick={props.onAppBarDoubleClick}\n                        showCustomWindowControls={props.showCustomWindowControls}\n                        isMaximized={props.isMaximized}\n                        onMinimizeWindow={props.onMinimizeWindow}\n                        onMaximizeWindow={props.onMaximizeWindow}\n                        onUnmaximizeWindow={props.onUnmaximizeWindow}\n                        onCloseWindow={props.onCloseWindow}\n                      />\n                    </PanelCatalogProvider>\n                  </Suspense>\n                </DndProvider>\n              </MultiProvider>\n            </MaybeLaunchPreference>\n          </ErrorBoundary>\n        </CssBaseline>\n      </ColorSchemeThemeProvider>\n    </AppConfigurationContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// Custom formatters for Chrome dev tools. See documentation: http://bit.ly/object-formatters\n// Note that the \"Enable custom formatters\" setting must be turned on in order to use these formatters.\n\nimport seedrandom from \"seedrandom\";\n\nimport { isTime } from \"@foxglove/rostime\";\nimport { mightActuallyBePartial } from \"@foxglove/studio-base/util/mightActuallyBePartial\";\n\ntype HtmlTemplate = unknown;\ntype DevtoolFormatterConfig = {\n  key: unknown;\n};\n\ninterface DevtoolFormatter {\n  header: (object: Record<string, unknown>, config: DevtoolFormatterConfig) => HtmlTemplate;\n  hasBody: (object: unknown) => boolean;\n  body?: (object: Record<string, unknown>) => HtmlTemplate;\n}\n\ndeclare global {\n  interface Window {\n    devtoolsFormatters: DevtoolFormatter[];\n  }\n}\n\n// eslint-disable-next-line no-restricted-syntax\nconst USE_DEFAULT_FORMATTER = null;\n\nconst timeFormatter: DevtoolFormatter = (() => {\n  function groupDigits(str: string) {\n    const result = [\"span\", {}];\n    let start = 0;\n    let end = str.length % 3;\n    if (end === 0) {\n      end = 3;\n    }\n    while (start < str.length) {\n      result.push([\n        \"span\",\n        { style: end < str.length ? \"margin-right: 2px;\" : \"\" },\n        str.substring(start, end),\n      ]);\n      start = end;\n      end += 3;\n    }\n    return result;\n  }\n\n  const formatter: DevtoolFormatter = {\n    header(obj) {\n      const maybeTime = obj as {\n        sec: number;\n        nsec: number;\n      };\n      if (\n        !isTime(obj) ||\n        maybeTime.sec < 0 ||\n        maybeTime.nsec < 0 ||\n        maybeTime.nsec >= 1e9 ||\n        !Number.isInteger(maybeTime.sec) ||\n        !Number.isInteger(maybeTime.nsec)\n      ) {\n        return USE_DEFAULT_FORMATTER;\n      }\n      const nsec = maybeTime.nsec.toFixed().padStart(9, \"0\");\n      const rng = seedrandom(`${maybeTime.sec}.${nsec}`);\n      return [\n        \"span\",\n        { style: `color: hsl(${rng() * 360}deg, ${40 + rng() * 60}%, ${20 + rng() * 40}%);` },\n        groupDigits(String(maybeTime.sec)),\n        \".\",\n        groupDigits(nsec),\n      ];\n    },\n    hasBody() {\n      return false;\n    },\n  };\n\n  return formatter;\n})();\n\nexport default function installDevtoolsFormatters(): void {\n  window.devtoolsFormatters = mightActuallyBePartial(window).devtoolsFormatters ?? [];\n  window.devtoolsFormatters.push(timeFormatter);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n/**\n * Wait for the browser to load custom fonts that have already been added to the document (via CSS\n * or the FontFace API) and generic font families.\n */\nexport default async function waitForFonts(): Promise<unknown> {\n  return await Promise.all([...document.fonts].map(async (font) => await font.load()));\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const preferences = {\n  preferences: \"Preferences\",\n  colorScheme: \"Color scheme\",\n  dark: \"Dark\",\n  light: \"Light\",\n  followSystem: \"Follow system\",\n  language: \"Language\",\n  displayTimestampsIn: \"Display timestamps in\",\n  timestampFormat: \"Timestamp format\",\n  messageRate: \"Message rate\",\n  openLinksIn: \"Open links in\",\n  webApp: \"Web app\",\n  desktopApp: \"Desktop app\",\n  askEachTime: \"Ask each time\",\n  general: \"General\",\n  ros: \"ROS\",\n  privacy: \"Privacy\",\n  privacyDescription: \"Changes will take effect the next time Foxglove Studio is launched.\",\n  extensions: \"Extensions\",\n  about: \"About\",\n  sendAnonymizedUsageData: \"Send anonymized usage data to help us improve Foxglove Studio\",\n  sendAnonymizedCrashReports: \"Send anonymized crash reports\",\n  experimentalFeatures: \"Experimental features\",\n  experimentalFeaturesDescription: \"These features are unstable and not recommended for daily use.\",\n  noExperimentalFeatures: \"Currently there are no experimental features.\",\n  studioDebugPanels: \"Studio debug panels\",\n  studioDebugPanelsDescription: \"Show Foxglove Studio debug panels in the “Add panel” list.\",\n  legacyPlotPanel: \"Legacy Plot panel\",\n  legacyPlotPanelDescription: \"Enable the Legacy Plot panel.\",\n  memoryUseIndicator: \"Memory use indicator\",\n  memoryUseIndicatorDescription: \"Show the app memory use in the sidebar.\",\n  newNavigation: \"New navigation\",\n  newNavigationDescription: \"New top navigation bar.\",\n  restartTheAppForChangesToTakeEffect: \" Restart the app for changes to take effect.\",\n  ros2NativeConnection: \"ROS 2 native connection\",\n  ros2NativeConnectionDescription: \"Enable the deprecated ROS 2 native connector.\",\n  layoutDebugging: \"Layout debugging\",\n  layoutDebuggingDescription: \"Show extra controls for developing and debugging layout storage.\",\n  newImagePanel: \"New Image panel\",\n  newImagePanelDescription: \"Enable the experimental Image panel.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n// Generic global translation\nexport const general = {\n  foxglove: \"Foxglove\",\n  learnMore: \"Learn more\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const panels = {\n  \"3D\": \"3D\",\n  newImage: \"🚧 Image\",\n  \"3DPanelDescription\": \"Display markers, camera images, meshes, URDFs, and more in a 3D scene.\",\n  \"3DPanelSettingsOnboardingTooltip\": \"Open settings to configure topics and layers.\",\n  dataSourceInfo: \"Data Source Info\",\n  dataSourceInfoDescription: \"View details like topics and timestamps for the current data source.\",\n  gauge: \"Gauge\",\n  gaugeDescription: \"Display a colored gauge based on a continuous value.\",\n  image: \"Image\",\n  imageDescription: \"Display annotated images.\",\n  indicator: \"Indicator\",\n  indicatorDescription: \"Display a colored and/or textual indicator based on a threshold value.\",\n  legacyPlot: \"Legacy Plot\",\n  log: \"Log\",\n  logDescription: \"Display logs by node and severity level.\",\n  map: \"Map\",\n  mapDescription: \"Display points on a map.\",\n  parameters: \"Parameters\",\n  parametersDescription: \"Read and set parameters for a data source.\",\n  plot: \"Plot\",\n  plotDescription: \"Plot numerical values over time or other values.\",\n  publish: \"Publish\",\n  publishDescription: \"Publish messages to the data source (live connections only).\",\n  rawMessages: \"Raw Messages\",\n  rawMessagesDescription: \"Inspect topic messages.\",\n  ROSDiagnosticsDetail: \"Diagnostics – Detail (ROS)\",\n  ROSDiagnosticsDetailDescription:\n    \"Display ROS DiagnosticArray messages for a specific hardware_id.\",\n  ROSDiagnosticSummary: \"Diagnostics – Summary (ROS)\",\n  ROSDiagnosticSummaryDescription: \"Display a summary of all ROS DiagnosticArray messages.\",\n  stateTransitions: \"State Transitions\",\n  stateTransitionsDescription: \"Track when values change over time.\",\n  studioPlaybackPerformance: \"Studio - Playback Performance\",\n  studioPlaybackPerformanceDescription:\n    \"Display playback and data-streaming performance statistics.\",\n  tab: \"Tab\",\n  tabDescription: \"Group panels together in a tabbed interface.\",\n  table: \"Table\",\n  tableDescription: \"Display topic messages in a tabular format.\",\n  teleop: \"Teleop\",\n  teleopDescription: \"Teleoperate a robot over a live connection.\",\n  topicGraph: \"Topic Graph\",\n  topicGraphDescription: \"Display a graph of active nodes, topics, and services.\",\n  userScripts: \"User Scripts\",\n  userScriptsDescription:\n    \"Write custom data transformations in TypeScript. Previously known as Node Playground.\",\n  variableSlider: \"Variable Slider\",\n  variableSliderDescription: \"Update numerical variable values for a layout.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const addPanel = {\n  addPanel: \"Add panel\",\n  noLayoutSelected: \"<selectLayoutLink>Select a layout</selectLayoutLink> to get started!\",\n  noPanelsMatchSearchCriteria: \"No panels match search criteria.\",\n  searchPanels: \"Search panels\",\n  selectPanelToAddToLayout: \"Select a panel below to add it to your layout.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const panelSettings = {\n  importOrExportSettings: \"Import/export settings\",\n  importOrExportSettingsWithEllipsis: \"Import/export settings...\",\n  resetToDefaults: \"Reset to defaults\",\n  panelSettings: \"Panel settings\",\n  selectAPanelToEditItsSettings: \"Select a panel to edit its settings.\",\n  loadingPanelSettings: \"Loading panel settings...\",\n  currentSettingsPanelName: \"{{title}} panel settings\",\n  panelName: \"{{title}} panel\",\n  panelDoesNotHaveSettings: \"This panel does not have any settings\",\n  unknown: \"Unknown\",\n  noLayoutSelected: \"<selectLayoutLink>Select a layout</selectLayoutLink> to get started!\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const log = {\n  topicError: \"Topic {{topic}} is not available\",\n  topic: \"Topic\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const plot = {\n  deleteSeries: \"Delete series\",\n  messagePath: \"Message path\",\n  label: \"Label\",\n  color: \"Color\",\n  timestamp: \"Timestamp\",\n  receiveTime: \"Receive Time\",\n  headerStamp: \"Header Stamp\",\n  series: \"Series\",\n  addSeries: \"Add series\",\n  maxYError: \"Y max must be greater than Y min.\",\n  maxXError: \"X max must be greater than X min.\",\n  general: \"General\",\n  syncWithOtherPlots: \"Sync with other plots\",\n  legend: \"Legend\",\n  position: \"Position\",\n  floating: \"Floating\",\n  left: \"Left\",\n  top: \"Top\",\n  hidden: \"Hidden\",\n  showValues: \"Show values\",\n  yAxis: \"Y Axis\",\n  showLabels: \"Show labels\",\n  min: \"Min\",\n  max: \"Max\",\n  xAxis: \"X Axis\",\n  value: \"Value\",\n  index: \"Index\",\n  currentPath: \"Path (current)\",\n  accumulatedPath: \"Path (accumulated)\",\n  secondsRange: \"Range (seconds)\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const dataSourceInfo = {\n  dataSource: \"Data source\",\n  currentSource: \"Current source\",\n  waitingForConnection: \"Waiting for connection…\",\n  startTime: \"Start time\",\n  endTime: \"End time\",\n  duration: \"Duration\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const openDialog = {\n  // Start\n  newToFoxgloveStudio: \"New to Foxglove Studio?\",\n  newToFoxgloveStudioDescription:\n    \"Start by exploring a sample dataset or checking out our documentation.\",\n  exploreSampleData: \"Explore sample data\",\n  viewOurDocs: \"View our docs\",\n  joinOurCommunity: \"Join our community\",\n  joinOurCommunityDescription:\n    \"Join us on Slack or GitHub to get help, make feature requests, and report bugs.\",\n  joinOurSlack: \"Join our Slack\",\n  openAGitHubIssue: \"Open a GitHub issue\",\n  needHelp: \"Need help?\",\n  needHelpDescription: \"View our documentation, or check out the tutorials on the Foxglove blog.\",\n  seeTutorials: \"See tutorials\",\n  collaborateTitle: \"Accelerate development with Foxglove Data Platform\",\n  secureStorageOfData: \"Securely store petabytes of ROS or custom data\",\n  convenientWebInterface:\n    \"Use a convenient web interface to tag, search, and retrieve data at lightning speed\",\n  canBeShared: \"Share data files, visualization layouts, and custom extensions with teammates\",\n  createAFreeAccount: \"Create a free account\",\n  signIn: \"Sign in\",\n  learnMore: \"Learn more\",\n  startCollaborating: \"Start collaborating with your Foxglove organization\",\n  startCollaboratingDescription:\n    \"Make the most of your Foxglove account – whether you want to dive deep on your data or share tools with your teammates.\",\n  uploadToDataPlatform: \"Upload to Data Platform\",\n  shareLayouts: \"Share layouts\",\n  openLocalFile: \"Open local file\",\n  openLocalFileDescription: \"Visualize data directly from your local filesystem.\",\n  openUrl: \"Upload and share data\",\n  openUrlDescription: \"Use Foxglove Data Platform to share data with your team.\",\n  openConnection: \"Open connection\",\n  openConnectionDescription: \"Connect to a live robot or server.\",\n  openDataSource: \"Open data source\",\n  recentDataSources: \"Recent data sources\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const settingsEditor = {\n  searchPanelSettings: \"Search panel settings…\",\n  title: \"Title\",\n  clearSearch: \"Clear search\",\n  labels: \"Labels\",\n  showAll: \"Show All\",\n  hideAll: \"Hide All\",\n  filterList: \"Filter list\",\n  filterListHelp: \"Filter list by visibility\",\n  listAll: \"List all\",\n  listVisible: \"List visible\",\n  listInvisible: \"List invisible\",\n  general: \"General\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const threeDee = {\n  frame: \"Frame\",\n  color: \"Color\",\n  position: \"Position\",\n  lineWidth: \"Line width\",\n  rotation: \"Rotation\",\n  reset: \"Reset\",\n\n  // Frame\n  displayFrame: \"Display frame\",\n  displayFrameHelp:\n    \"The coordinate frame to place the camera in. The camera position and orientation will be relative to the origin of this frame.\",\n  followMode: \"Follow mode\",\n  followModeHelp: \"Change the camera behavior during playback to follow the display frame or not.\",\n  pose: \"Pose\",\n  fixed: \"Fixed\",\n  frameNotFound: \"Frame {{followFrameId}} not found\",\n  noCoordinateFramesFound: \"No coordinate frames found\",\n  enablePreloading: \"Enable preloading\",\n  lineColor: \"Line color\",\n  axisScale: \"Axis scale\",\n  labelSize: \"Label size\",\n  labels: \"Labels\",\n  editable: \"Editable\",\n  settings: \"Settings\",\n  transforms: \"Transforms\",\n  showAll: \"Show All\",\n  hideAll: \"Hide All\",\n\n  // Scene\n  scene: \"Scene\",\n  renderStats: \"Render stats\",\n  background: \"Background\",\n  labelScale: \"Label scale\",\n  labelScaleHelp: \"Scale factor to apply to all labels\",\n  ignoreColladaUpAxis: \"Ignore COLLADA <up_axis>\",\n  ignoreColladaUpAxisHelp:\n    \"Match the behavior of rviz by ignoring the <up_axis> tag in COLLADA files\",\n  takeEffectAfterReboot: \"This setting requires a restart to take effect\",\n  meshUpAxis: \"Mesh up axis\",\n  meshUpAxisHelp:\n    \"The direction to use as “up” when loading meshes without orientation info (STL and OBJ)\",\n  YUp: \"Y-up\",\n  ZUp: \"Z-up\",\n\n  // Camera\n  view: \"View\",\n  distance: \"Distance\",\n  perspective: \"Perspective\",\n  target: \"Target\",\n  theta: \"Theta\",\n  phi: \"Phi\",\n  fovy: \"Y-Axis FOV\",\n  near: \"Near\",\n  far: \"Far\",\n  syncCamera: \"Sync camera\",\n  syncCameraHelp: \"Sync the camera with other panels that also have this setting enabled.\",\n\n  // Topics\n  topics: \"Topics\",\n\n  // Custom layers\n  customLayers: \"Custom layers\",\n  addURDF: \"Add URDF\",\n  size: \"Size\",\n  divisions: \"Divisions\",\n  grid: \"Grid\",\n  delete: \"Delete\",\n  addGrid: \"Add Grid\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const appBar = {\n  openDataSource: \"Open data source…\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const preferences: TypeOptions[\"resources\"][\"preferences\"] = {\n  preferences: \"偏好\",\n  colorScheme: \"配色方案\",\n  dark: \"暗色\",\n  light: \"亮色\",\n  followSystem: \"跟随系统\",\n  language: \"语言\",\n  displayTimestampsIn: \"显示时间戳在\",\n  timestampFormat: \"时间戳格式\",\n  messageRate: \"消息速率\",\n  openLinksIn: \"打开链接\",\n  webApp: \"网页应用\",\n  desktopApp: \"桌面应用\",\n  askEachTime: \"每次询问\",\n  general: \"通用\",\n  ros: \"ROS\",\n  privacy: \"隐私\",\n  privacyDescription: \"更改将在下次启动 Foxglove Studio 时生效\",\n  sendAnonymizedUsageData: \"发送匿名使用数据以帮助我们改进 Foxglove Studio\",\n  sendAnonymizedCrashReports: \"发送匿名崩溃报告\",\n  experimentalFeatures: \"实验性功能\",\n  experimentalFeaturesDescription: \"这些功能不稳定，不建议日常使用。\",\n  studioDebugPanels: \"Studio 调试面板\",\n  studioDebugPanelsDescription: \"在“添加面板”列表中显示 Foxglove Studio 调试面板。\",\n  legacyPlotPanel: \"旧版绘图面板\",\n  legacyPlotPanelDescription: \"启用旧版绘图面板.\",\n  memoryUseIndicator: \"内存使用指示器\",\n  memoryUseIndicatorDescription: \"在侧边栏显示应用程序的内存使用情况。\",\n  newNavigation: \"新版导航栏\",\n  newNavigationDescription: \"使用新版导航栏。\",\n  restartTheAppForChangesToTakeEffect: \" 重新启动应用程序以使更改生效。\",\n  layoutDebugging: \"布局调试\",\n  layoutDebuggingDescription: \"显示用于开发和调试布局存储的额外控件。\",\n  extensions: \"扩展\",\n  about: \"关于\",\n  noExperimentalFeatures: \"目前没有实验性的功能。\",\n  ros2NativeConnection: \"ROS 2 的本地连接\",\n  ros2NativeConnectionDescription: \"启用已废弃的 ROS 2 本地连接器\",\n  newImagePanel: \"新图像面板\",\n  newImagePanelDescription: \"启用实验性图像面板。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\n// Generic global translation\nexport const general: TypeOptions[\"resources\"][\"general\"] = {\n  foxglove: \"Foxglove\",\n  learnMore: \"了解更多\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const panels: TypeOptions[\"resources\"][\"panels\"] = {\n  \"3D\": \"三维\",\n  newImage: \"🚧图像\",\n  \"3DPanelDescription\": \"在三维场景中显示标记、相机图像、网格、URDF 和其他内容。\",\n  \"3DPanelSettingsOnboardingTooltip\": \"打开设置以配置主题和层。\",\n  dataSourceInfo: \"数据源信息\",\n  dataSourceInfoDescription: \"查看当前数据源的主题和时间戳等详细信息。\",\n  gauge: \"仪表\",\n  gaugeDescription: \"基于连续值显示彩色仪表。\",\n  image: \"图像\",\n  imageDescription: \"显示带注释的图像。\",\n  indicator: \"指示器\",\n  indicatorDescription: \"基于阈值值显示彩色和/或文本指示器。\",\n  legacyPlot: \"传统图表\",\n  log: \"日志\",\n  logDescription: \"按节点和严重程度级别显示日志。\",\n  map: \"地图\",\n  mapDescription: \"在地图上显示点。\",\n  parameters: \"参数\",\n  parametersDescription: \"读取和设置数据源的参数。\",\n  plot: \"图表\",\n  plotDescription: \"绘制随时间或其他值变化的数字值。\",\n  publish: \"发布\",\n  publishDescription: \"向数据源发布消息（仅限实时连接）。\",\n  rawMessages: \"原始消息\",\n  rawMessagesDescription: \"检查主题消息。\",\n  ROSDiagnosticsDetail: \"诊断 - 详细信息（ROS）\",\n  ROSDiagnosticsDetailDescription: \"显示特定 hardware_id 的 ROS DiagnosticArray 消息。\",\n  ROSDiagnosticSummary: \"诊断 - 概要（ROS）\",\n  ROSDiagnosticSummaryDescription: \"显示所有 ROS DiagnosticArray 消息的摘要。\",\n  stateTransitions: \"状态转换\",\n  stateTransitionsDescription: \"跟踪值随时间变化的情况。\",\n  studioPlaybackPerformance: \"Studio - 播放性能\",\n  studioPlaybackPerformanceDescription: \"显示回放和数据流式处理性能统计信息。\",\n  tab: \"选项卡\",\n  tabDescription: \"将面板分组在选项卡界面中。\",\n  table: \"表格\",\n  tableDescription: \"以表格格式显示主题消息。\",\n  teleop: \"远程操纵\",\n  teleopDescription: \"通过实时连接远程操纵机器人。\",\n  topicGraph: \"主题图\",\n  topicGraphDescription: \"显示活动节点、主题和服务的图形。\",\n  userScripts: \"用户脚本\",\n  userScriptsDescription: \"使用 TypeScript 编写自定义数据转换。以前称为 Node Playground。\",\n  variableSlider: \"变量滑块\",\n  variableSliderDescription: \"更新布局的数字变量值。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { TypeOptions } from \"i18next\";\n\nexport const addPanel: TypeOptions[\"resources\"][\"addPanel\"] = {\n  addPanel: \"添加面板\",\n  noLayoutSelected: \"<selectLayoutLink>选择一个布局</selectLayoutLink>来开始使用!\",\n  noPanelsMatchSearchCriteria: \"没有符合搜索条件的面板。\",\n  searchPanels: \"搜索面板\",\n  selectPanelToAddToLayout: \"在下面选择一个面板，将其添加到你的布局中。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const panelSettings: TypeOptions[\"resources\"][\"panelSettings\"] = {\n  importOrExportSettings: \"导入/导出设置\",\n  importOrExportSettingsWithEllipsis: \"导入/导出设置……\",\n  panelSettings: \"面板设置\",\n  selectAPanelToEditItsSettings: \"选择一个面板来编辑其设置。\",\n  loadingPanelSettings: \"正在加载面板设置……\",\n  currentSettingsPanelName: \"{{title}}面板设置\",\n  panelName: \"{{title}}面板\",\n  panelDoesNotHaveSettings: \"此面板没有任何设置\",\n  resetToDefaults: \"重置为默认值\",\n  unknown: \"未知\",\n  noLayoutSelected: \"<selectLayoutLink>选择一个布局</selectLayoutLink> 开始使用！\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const log: TypeOptions[\"resources\"][\"log\"] = {\n  topicError: \"话题 {{topic}} 不可用\",\n  topic: \"话题\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const plot: TypeOptions[\"resources\"][\"plot\"] = {\n  deleteSeries: \"删除数据系列\",\n  messagePath: \"消息地址\",\n  label: \"标签\",\n  color: \"颜色\",\n  timestamp: \"时间戳\",\n  receiveTime: \"接收时间\",\n  headerStamp: \"头时间戳\",\n  series: \"数据系列\",\n  addSeries: \"添加数据系列\",\n  maxYError: \"Y 的最大值必须大于 Y 的最小值。\",\n  maxXError: \"X 的最大值必须大于 X 的最小值。\",\n  general: \"通用\",\n  syncWithOtherPlots: \"与其他图表同步\",\n  legend: \"图例\",\n  position: \"位置\",\n  floating: \"浮动\",\n  left: \"左\",\n  top: \"上\",\n  hidden: \"隐藏\",\n  showValues: \"显示值\",\n  yAxis: \"Y 轴\",\n  showLabels: \"显示标签\",\n  min: \"最小值\",\n  max: \"最大值\",\n  xAxis: \"X 轴\",\n  value: \"值\",\n  index: \"索引\",\n  currentPath: \"地址（当前）\",\n  accumulatedPath: \"地址（累积）\",\n  secondsRange: \"范围（秒）\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const dataSourceInfo: TypeOptions[\"resources\"][\"dataSourceInfo\"] = {\n  dataSource: \"数据源\",\n  currentSource: \"当前源\",\n  waitingForConnection: \"等待连接……\",\n  startTime: \"开始时间\",\n  endTime: \"结束时间\",\n  duration: \"持续时间\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const openDialog: TypeOptions[\"resources\"][\"openDialog\"] = {\n  // Start\n  newToFoxgloveStudio: \"第一次使用 Foxglove Studio？\",\n  newToFoxgloveStudioDescription: \"从探索一个样本数据集开始，或查看我们的文档。\",\n  exploreSampleData: \"探索样本数据\",\n  viewOurDocs: \"查看我们的文档\",\n  joinOurCommunity: \"加入我们的社区\",\n  joinOurCommunityDescription: \"在 Slack 上与我们的开发人员和用户交流，或在 GitHub 上提出问题。\",\n  joinOurSlack: \"加入我们的 Slack\",\n  openAGitHubIssue: \"打开 GitHub issue\",\n  needHelp: \"需要帮助？\",\n  needHelpDescription: \"查看我们的文档，或查看 Foxglove 博客上的教程。\",\n  seeTutorials: \"查看教程\",\n  collaborateTitle: \"使用 Foxglove 数据平台加速开发\",\n  secureStorageOfData: \"安全地存储 PB 级的 ROS 或自定义数据\",\n  convenientWebInterface: \"使用一个方便的网络界面，以闪电般的速度标记、搜索和检索数据\",\n  canBeShared: \"与队友分享数据文件、可视化布局和自定义扩展程序\",\n  createAFreeAccount: \"创建免费帐户\",\n  signIn: \"登录\",\n  learnMore: \"了解更多\",\n  startCollaborating: \"与您的 Foxglove 组织开始合作\",\n  startCollaboratingDescription:\n    \"充分利用你的 Foxglove 账户——无论你想深入研究你的数据还是与你的团队成员分享工具。\",\n  uploadToDataPlatform: \"上传到数据平台\",\n  shareLayouts: \"分享布局\",\n  openLocalFile: \"打开本地文件\",\n  openLocalFileDescription: \"直接从本地文件系统可视化数据。\",\n  openUrl: \"上传和共享数据\",\n  openUrlDescription: \"使用 Foxglove 数据平台与您的团队共享数据。\",\n  openConnection: \"打开连接\",\n  openConnectionDescription: \"连接到实时机器人或服务器。\",\n  openDataSource: \"打开数据源\",\n  recentDataSources: \"最近使用的数据源\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const settingsEditor: TypeOptions[\"resources\"][\"settingsEditor\"] = {\n  searchPanelSettings: \"搜索面板设置……\",\n  title: \"标题\",\n  clearSearch: \"清空搜索\",\n  labels: \"标签\",\n  showAll: \"显示全部\",\n  hideAll: \"隐藏全部\",\n  filterList: \"过滤列表\",\n  filterListHelp: \"按照可见性过滤列表\",\n  listAll: \"列出全部\",\n  listVisible: \"列出可见\",\n  listInvisible: \"列出不可见\",\n  general: \"通用\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const threeDee: TypeOptions[\"resources\"][\"threeDee\"] = {\n  frame: \"参考系\",\n  reset: \"重置\",\n  color: \"颜色\",\n  position: \"位置\",\n  lineWidth: \"线宽\",\n  rotation: \"旋转\",\n\n  // Frame\n  displayFrame: \"展示参考系\",\n  displayFrameHelp: \"放置相机用于显示坐标系。相机的位置和方向将相对于该坐标系的原点。\",\n  followMode: \"跟踪模式\",\n  followModeHelp: \"更改回放期间相机的行为，是否跟踪显示坐标系。\",\n  pose: \"姿态\",\n  fixed: \"固定\",\n  frameNotFound: \"未找到参考系 {{followFrameId}}\",\n  noCoordinateFramesFound: \"未找到坐标系\",\n  enablePreloading: \"启用预加载\",\n  lineColor: \"线颜色\",\n  axisScale: \"轴比例\",\n  labelSize: \"标签大小\",\n  labels: \"标签\",\n  editable: \"可编辑\",\n  settings: \"设置\",\n  transforms: \"变换\",\n  showAll: \"显示全部\",\n  hideAll: \"隐藏全部\",\n\n  // Scene\n  scene: \"场景\",\n  renderStats: \"渲染统计\",\n  background: \"背景\",\n  labelScale: \"标签比例\",\n  labelScaleHelp: \"应用于所有标签的比例因子\",\n  ignoreColladaUpAxis: \"忽略 COLLADA 的 <up_axis>\",\n  ignoreColladaUpAxisHelp: \"通过忽略 COLLADA 文件中的 <up_axis> 标记，匹配 rviz 的行为\",\n  takeEffectAfterReboot: \"此设置需要重新启动以生效\",\n  meshUpAxis: \"网格上轴\",\n  meshUpAxisHelp: \"加载缺少方向信息的网格（STL 和 OBJ）时使用的“上”方向\",\n  YUp: \"Y-up\",\n  ZUp: \"Z-up\",\n\n  // Camera\n  view: \"视图\",\n  distance: \"距离\",\n  perspective: \"透视\",\n  target: \"目标\",\n  theta: \"极角\",\n  phi: \"方向角\",\n  fovy: \"Y轴视野\",\n  near: \"近面\",\n  far: \"远面\",\n  syncCamera: \"同步相机\",\n  syncCameraHelp: \"将相机与其他启用此设置的面板同步。\",\n\n  // Topics\n  topics: \"话题\",\n\n  // Custom layers\n  customLayers: \"自定义图层\",\n  addURDF: \"添加 URDF\",\n  size: \"大小\",\n  divisions: \"划分\",\n  grid: \"网格\",\n  delete: \"删除\",\n  addGrid: \"添加网格\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const appBar: TypeOptions[\"resources\"][\"appBar\"] = {\n  openDataSource: \"打开数据源……\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport i18n from \"i18next\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\nimport { initReactI18next } from \"react-i18next\";\n\nimport * as en from \"./en\";\nimport * as zh from \"./zh\";\n\nexport const translations = { en, zh };\n\nexport type Language = keyof typeof translations;\n\nexport const defaultNS = \"general\";\n\nexport async function initI18n(): Promise<void> {\n  await i18n\n    .use(LanguageDetector)\n    .use(initReactI18next)\n    .init({\n      resources: translations,\n      detection: {\n        order: [\"localStorage\", \"navigator\"],\n        caches: [\"localStorage\"],\n      },\n      fallbackLng: \"en\",\n      defaultNS,\n      interpolation: {\n        escapeValue: false, // not needed for react as it escapes by default\n      },\n    });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as IDB from \"idb/with-async-ittr\";\n\nimport Log from \"@foxglove/log\";\nimport {\n  IExtensionStorage,\n  StoredExtension,\n} from \"@foxglove/studio-base/services/IExtensionStorage\";\nimport { ExtensionInfo } from \"@foxglove/studio-base/types/Extensions\";\n\nconst log = Log.getLogger(__filename);\n\nconst DATABASE_BASE_NAME = \"foxglove-extensions\";\nconst METADATA_STORE_NAME = \"metadata\";\nconst EXTENSION_STORE_NAME = \"extensions\";\n\ninterface ExtensionsDB extends IDB.DBSchema {\n  metadata: {\n    key: string;\n    value: ExtensionInfo;\n  };\n  extensions: {\n    key: string;\n    value: StoredExtension;\n  };\n}\n\nexport class IdbExtensionStorage implements IExtensionStorage {\n  #db: Promise<IDB.IDBPDatabase<ExtensionsDB>>;\n  public namespace: string;\n\n  public constructor(namespace: string) {\n    this.namespace = namespace;\n    this.#db = IDB.openDB<ExtensionsDB>([DATABASE_BASE_NAME, namespace].join(\"-\"), 1, {\n      upgrade: (db) => {\n        log.debug(\"Creating extension object stores\");\n\n        db.createObjectStore(METADATA_STORE_NAME, {\n          keyPath: \"id\",\n        });\n\n        db.createObjectStore(EXTENSION_STORE_NAME, {\n          keyPath: \"info.id\",\n        });\n      },\n    });\n  }\n\n  public async list(): Promise<ExtensionInfo[]> {\n    const records = await (await this.#db).getAll(METADATA_STORE_NAME);\n\n    log.debug(`Found ${records.length} extensions`);\n\n    return records;\n  }\n\n  public async get(id: string): Promise<undefined | StoredExtension> {\n    log.debug(\"Getting extension\", id);\n\n    return await (await this.#db).get(EXTENSION_STORE_NAME, id);\n  }\n\n  public async put(extension: StoredExtension): Promise<StoredExtension> {\n    log.debug(\"Storing extension\", { extension });\n\n    const transaction = (await this.#db).transaction(\n      [METADATA_STORE_NAME, EXTENSION_STORE_NAME],\n      \"readwrite\",\n    );\n    await Promise.all([\n      transaction.db.put(METADATA_STORE_NAME, extension.info),\n      transaction.db.put(EXTENSION_STORE_NAME, extension),\n      transaction.done,\n    ]);\n\n    return extension;\n  }\n\n  public async delete(id: string): Promise<void> {\n    log.debug(\"Deleting extension\", id);\n\n    const transaction = (await this.#db).transaction(\n      [METADATA_STORE_NAME, EXTENSION_STORE_NAME],\n      \"readwrite\",\n    );\n    await Promise.all([\n      transaction.db.delete(METADATA_STORE_NAME, id),\n      transaction.db.delete(EXTENSION_STORE_NAME, id),\n      transaction.done,\n    ]);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport JSZip from \"jszip\";\n\nimport Log from \"@foxglove/log\";\nimport { ExtensionLoader } from \"@foxglove/studio-base/services/ExtensionLoader\";\nimport { IExtensionStorage } from \"@foxglove/studio-base/services/IExtensionStorage\";\nimport { ExtensionInfo, ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nimport { IdbExtensionStorage } from \"./IdbExtensionStorage\";\n\nconst log = Log.getLogger(__filename);\n\nfunction parsePackageName(name: string): { publisher?: string; name: string } {\n  const res = /^@([^/]+)\\/(.+)/.exec(name);\n  if (res == undefined) {\n    return { name };\n  }\n  return { publisher: res[1], name: res[2] as string };\n}\n\nfunction qualifiedName(\n  namespace: ExtensionNamespace,\n  publisher: string,\n  info: ExtensionInfo,\n): string {\n  switch (namespace) {\n    case \"local\":\n      // For local namespace we follow the legacy naming convention of using displayName\n      // in order to stay compatible with existing layouts.\n      return info.displayName;\n    case \"org\":\n      // For private registry we use namespace and package name.\n      return [namespace, publisher, info.name].join(\":\");\n  }\n}\n\nfunction validatePackageInfo(info: Partial<ExtensionInfo>): ExtensionInfo {\n  if (info.name == undefined || info.name.length === 0) {\n    throw new Error(\"Invalid extension: missing name\");\n  }\n  const { publisher: parsedPublisher, name } = parsePackageName(info.name);\n  const publisher = info.publisher ?? parsedPublisher;\n  if (publisher == undefined || publisher.length === 0) {\n    throw new Error(\"Invalid extension: missing publisher\");\n  }\n\n  return { ...info, publisher, name: name.toLowerCase() } as ExtensionInfo;\n}\n\nexport class IdbExtensionLoader implements ExtensionLoader {\n  readonly #storage: IExtensionStorage;\n  public readonly namespace: ExtensionNamespace;\n\n  public constructor(namespace: ExtensionNamespace) {\n    this.namespace = namespace;\n    this.#storage = new IdbExtensionStorage(namespace);\n  }\n\n  public async getExtensions(): Promise<ExtensionInfo[]> {\n    log.debug(\"Listing extensions\");\n\n    return await this.#storage.list();\n  }\n\n  public async loadExtension(id: string): Promise<string> {\n    log.debug(\"Loading extension\", id);\n\n    const extension = await this.#storage.get(id);\n    const zip = new JSZip();\n\n    if (extension?.content == undefined) {\n      throw new Error(\"Extension is corrupted\");\n    }\n\n    const content = await zip.loadAsync(extension.content);\n    const srcText = await content.file(\"dist/extension.js\")?.async(\"string\");\n\n    if (srcText == undefined) {\n      throw new Error(\"Extension is corrupted\");\n    }\n\n    return srcText;\n  }\n\n  public async installExtension(foxeFileData: Uint8Array): Promise<ExtensionInfo> {\n    log.debug(\"Installing extension\");\n\n    const zip = new JSZip();\n    const content = await zip.loadAsync(foxeFileData);\n\n    const pkgInfoText = await content.file(\"package.json\")?.async(\"string\");\n    if (pkgInfoText == undefined) {\n      throw new Error(\"Invalid extension: missing package.json\");\n    }\n\n    const rawInfo = validatePackageInfo(JSON.parse(pkgInfoText) as Partial<ExtensionInfo>);\n    const normalizedPublisher = rawInfo.publisher.replace(/[^A-Za-z0-9_\\s]+/g, \"\");\n\n    const info: ExtensionInfo = {\n      ...rawInfo,\n      id: `${normalizedPublisher}.${rawInfo.name}`,\n      namespace: this.namespace,\n      qualifiedName: qualifiedName(this.namespace, normalizedPublisher, rawInfo),\n    };\n    await this.#storage.put({\n      content: foxeFileData,\n      info,\n    });\n\n    return info;\n  }\n\n  public async uninstallExtension(id: string): Promise<void> {\n    log.debug(\"Uninstalling extension\", id);\n\n    await this.#storage.delete(id);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PlayerProblem } from \"@foxglove/studio-base/players/types\";\n\n/**\n * Manages a set of PlayerProblems keyed by ID. Calls to problems() will return the same object as\n * long as problems have not been added/removed; this helps the player pipeline to know when it\n * needs to re-process player problems.\n */\nexport default class PlayerProblemManager {\n  private _problemsById = new Map<string, PlayerProblem>();\n  private _problems?: PlayerProblem[];\n\n  /**\n   * Returns the current set of problems. Subsequent calls will return the same object as long as\n   * problems have not been added/removed.\n   */\n  public problems(): PlayerProblem[] {\n    return (this._problems ??= Array.from(this._problemsById.values()));\n  }\n\n  public addProblem(id: string, problem: PlayerProblem): void {\n    console[problem.severity].call(console, \"Player problem\", id, problem);\n    this._problemsById.set(id, problem);\n    this._problems = undefined;\n  }\n\n  public hasProblem(id: string): boolean {\n    return this._problemsById.has(id);\n  }\n\n  public removeProblem(id: string): boolean {\n    const changed = this._problemsById.delete(id);\n    if (changed) {\n      this._problems = undefined;\n    }\n    return changed;\n  }\n\n  public removeProblems(predicate: (id: string, problem: PlayerProblem) => boolean): boolean {\n    let changed = false;\n    for (const [id, problem] of this._problemsById) {\n      if (predicate(id, problem)) {\n        if (this._problemsById.delete(id)) {\n          changed = true;\n        }\n      }\n    }\n    if (changed) {\n      this._problems = undefined;\n    }\n    return changed;\n  }\n\n  public clear(): void {\n    this._problemsById.clear();\n    this._problems = undefined;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\n// For one datatype in the datatypes, find the MessageDefinition that we can use\n// to either write or parse it. `datatypes` should contain the root datatype and\n// all complex sub-datatypes.\nexport default function rosDatatypesToMessageDefinition(\n  datatypes: RosDatatypes,\n  rootDatatypeName: string,\n): MessageDefinition[] {\n  const result = [];\n  const seenDatatypeNames = new Set([rootDatatypeName]);\n  // It doesn't matter if we use a stack or queue here, but we use a stack.\n  const datatypeNameStack = [rootDatatypeName];\n\n  while (datatypeNameStack.length > 0) {\n    const currentDatatypeName = datatypeNameStack.pop();\n    if (currentDatatypeName == undefined) {\n      throw new Error(`Invariant violation - Array.pop() when length > 0`);\n    }\n    const currentDatatype = datatypes.get(currentDatatypeName);\n    if (!currentDatatype) {\n      throw new Error(\n        `While searching datatypes for \"${rootDatatypeName}\", could not find datatype \"${currentDatatypeName}\"`,\n      );\n    }\n    // The root datatype has no name field.\n    const msgDefinition: MessageDefinition =\n      currentDatatypeName === rootDatatypeName\n        ? { definitions: currentDatatype.definitions }\n        : { name: currentDatatypeName, definitions: currentDatatype.definitions };\n    result.push(msgDefinition);\n    for (const field of currentDatatype.definitions) {\n      // Only search subfields if we haven't already seen it and it is \"complex\", IE it has its own fields and should\n      // be contained in `datatypes`.\n      if (field.isComplex === true && !seenDatatypeNames.has(field.type)) {\n        datatypeNameStack.push(field.type);\n        seenDatatypeNames.add(field.type);\n      }\n    }\n  }\n\n  return result;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { MessageWriter } from \"./MessageWriter\";\n\nexport class JsonMessageWriter implements MessageWriter {\n  public writeMessage(message: unknown): Uint8Array {\n    return new Uint8Array(Buffer.from(JSON.stringify(message) ?? \"\"));\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IWebSocket } from \"@foxglove/ws-protocol\";\n\nimport { FromWorkerMessage, ToWorkerMessage } from \"./worker\";\n\nexport default class WorkerSocketAdapter implements IWebSocket {\n  private worker: Worker;\n  private connectionClosed: boolean = false;\n  public binaryType: string = \"\";\n  public protocol: string = \"\";\n  public onerror: ((event: unknown) => void) | undefined = undefined;\n  public onopen: ((event: unknown) => void) | undefined = undefined;\n  public onclose: ((event: unknown) => void) | undefined = undefined;\n  public onmessage: ((event: unknown) => void) | undefined = undefined;\n\n  public constructor(wsUrl: string, protocols?: string[] | string) {\n    // foxglove-depcheck-used: babel-plugin-transform-import-meta\n    this.worker = new Worker(new URL(\"./worker\", import.meta.url));\n    this.sendToWorker({ type: \"open\", data: { wsUrl, protocols } });\n\n    this.worker.onerror = (ev) => {\n      if (this.onerror) {\n        this.onerror(ev);\n      }\n    };\n\n    this.worker.onmessage = (event: MessageEvent<FromWorkerMessage>) => {\n      switch (event.data.type) {\n        case \"open\":\n          if (this.onopen) {\n            this.protocol = event.data.protocol;\n            this.onopen(event.data);\n          }\n          break;\n        case \"close\":\n          // websocket connection got closed, we can terminate the worker\n          this.connectionClosed = true;\n          this.worker.terminate();\n\n          if (this.onclose) {\n            this.onclose(event.data);\n          }\n          break;\n        case \"error\":\n          if (this.onerror) {\n            this.onerror(event.data);\n          }\n          break;\n        case \"message\":\n          if (this.onmessage) {\n            this.onmessage(event.data);\n          }\n          break;\n      }\n    };\n  }\n\n  public close(): void {\n    if (!this.connectionClosed) {\n      this.sendToWorker({\n        type: \"close\",\n        data: undefined,\n      });\n    }\n  }\n\n  public send(data: string | ArrayBuffer | ArrayBufferView): void {\n    this.sendToWorker({ type: \"data\", data });\n  }\n\n  private sendToWorker(msg: ToWorkerMessage): void {\n    if (this.connectionClosed) {\n      throw Error(\"Can't send message over closed websocket connection\");\n    }\n    this.worker.postMessage(msg);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as base64 from \"@protobufjs/base64\";\nimport { isEqual } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport Log from \"@foxglove/log\";\nimport { parseChannel, ParsedChannel } from \"@foxglove/mcap-support\";\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport CommonRosTypes from \"@foxglove/rosmsg-msgs-common\";\nimport { MessageWriter as Ros1MessageWriter } from \"@foxglove/rosmsg-serialization\";\nimport { MessageWriter as Ros2MessageWriter } from \"@foxglove/rosmsg2-serialization\";\nimport { fromMillis, fromNanoSec, isGreaterThan, isLessThan, Time } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerCapabilities,\n  PlayerMetricsCollectorInterface,\n  PlayerPresence,\n  PlayerProblem,\n  PlayerState,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport rosDatatypesToMessageDefinition from \"@foxglove/studio-base/util/rosDatatypesToMessageDefinition\";\nimport {\n  Channel,\n  ChannelId,\n  ClientChannel,\n  FoxgloveClient,\n  ServerCapability,\n  SubscriptionId,\n  Service,\n  ServiceCallPayload,\n  ServiceCallRequest,\n  ServiceCallResponse,\n  Parameter,\n  StatusLevel,\n} from \"@foxglove/ws-protocol\";\n\nimport { JsonMessageWriter } from \"./JsonMessageWriter\";\nimport { MessageWriter } from \"./MessageWriter\";\nimport WorkerSocketAdapter from \"./WorkerSocketAdapter\";\n\nconst log = Log.getLogger(__dirname);\nconst textEncoder = new TextEncoder();\n\n/** Suppress warnings about messages on unknown subscriptions if the susbscription was recently canceled. */\nconst SUBSCRIPTION_WARNING_SUPPRESSION_MS = 2000;\n\nconst ZERO_TIME = Object.freeze({ sec: 0, nsec: 0 });\nconst GET_ALL_PARAMS_REQUEST_ID = \"get-all-params\";\nconst GET_ALL_PARAMS_PERIOD_MS = 15000;\nconst ROS_ENCODINGS = [\"ros1\", \"cdr\"];\nconst SUPPORTED_PUBLICATION_ENCODINGS = [\"json\", ...ROS_ENCODINGS];\nconst FALLBACK_PUBLICATION_ENCODING = \"json\";\nconst SUPPORTED_SERVICE_ENCODINGS = [\"json\", ...ROS_ENCODINGS];\n\ntype ResolvedChannel = { channel: Channel; parsedChannel: ParsedChannel };\ntype Publication = ClientChannel & { messageWriter?: Ros1MessageWriter | Ros2MessageWriter };\ntype ResolvedService = {\n  service: Service;\n  parsedResponse: ParsedChannel;\n  requestMessageWriter: MessageWriter;\n};\n\nexport default class FoxgloveWebSocketPlayer implements Player {\n  private readonly _sourceId: string;\n\n  private _url: string; // WebSocket URL.\n  private _name: string;\n  private _client?: FoxgloveClient; // The client when we're connected.\n  private _id: string = uuidv4(); // Unique ID for this player.\n  private _serverCapabilities: string[] = [];\n  private _playerCapabilities: (typeof PlayerCapabilities)[keyof typeof PlayerCapabilities][] = [];\n  private _supportedEncodings?: string[];\n  private _listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState().\n  private _closed: boolean = false; // Whether the player has been completely closed using close().\n  private _topics?: Topic[]; // Topics as published by the WebSocket.\n  private _topicsStats = new Map<string, TopicStats>(); // Topic names to topic statistics.\n  private _datatypes: RosDatatypes = new Map(); // Datatypes as published by the WebSocket.\n  private _parsedMessages: MessageEvent<unknown>[] = []; // Queue of messages that we'll send in next _emitState() call.\n  private _receivedBytes: number = 0;\n  private _metricsCollector: PlayerMetricsCollectorInterface;\n  private _hasReceivedMessage = false;\n  private _presence: PlayerPresence = PlayerPresence.INITIALIZING;\n  private _problems = new PlayerProblemManager();\n  private _numTimeSeeks = 0;\n  private _profile?: string;\n  private _urlState: PlayerState[\"urlState\"];\n\n  /** Earliest time seen */\n  private _startTime?: Time;\n  /** Latest time seen */\n  private _endTime?: Time;\n  /* The most recent published time, if available */\n  private _clockTime?: Time;\n  /* Flag indicating if the server publishes time messages */\n  private _serverPublishesTime = false;\n\n  private _unresolvedSubscriptions = new Set<string>();\n  private _resolvedSubscriptionsByTopic = new Map<string, SubscriptionId>();\n  private _resolvedSubscriptionsById = new Map<SubscriptionId, ResolvedChannel>();\n  private _channelsByTopic = new Map<string, ResolvedChannel>();\n  private _channelsById = new Map<ChannelId, ResolvedChannel>();\n  private _unsupportedChannelIds = new Set<ChannelId>();\n  private _recentlyCanceledSubscriptions = new Set<SubscriptionId>();\n  private _parameters = new Map<string, ParameterValue>();\n  private _getParameterInterval?: ReturnType<typeof setInterval>;\n  private _openTimeout?: ReturnType<typeof setInterval>;\n  private _connectionAttemptTimeout?: ReturnType<typeof setInterval>;\n  private _unresolvedPublications: AdvertiseOptions[] = [];\n  private _publicationsByTopic = new Map<string, Publication>();\n  private _serviceCallEncoding?: string;\n  private _servicesByName = new Map<string, ResolvedService>();\n  private _serviceResponseCbs = new Map<\n    ServiceCallRequest[\"callId\"],\n    (response: ServiceCallResponse) => void\n  >();\n  private _publishedTopics?: Map<string, Set<string>>;\n  private _subscribedTopics?: Map<string, Set<string>>;\n  private _advertisedServices?: Map<string, Set<string>>;\n  private _nextServiceCallId = 0;\n\n  public constructor({\n    url,\n    metricsCollector,\n    sourceId,\n  }: {\n    url: string;\n    metricsCollector: PlayerMetricsCollectorInterface;\n    sourceId: string;\n  }) {\n    this._metricsCollector = metricsCollector;\n    this._url = url;\n    this._name = url;\n    this._metricsCollector.playerConstructed();\n    this._sourceId = sourceId;\n    this._urlState = {\n      sourceId: this._sourceId,\n      parameters: { url: this._url },\n    };\n    this._open();\n  }\n\n  private _open = (): void => {\n    if (this._closed) {\n      return;\n    }\n    if (this._client != undefined) {\n      throw new Error(`Attempted to open a second Foxglove WebSocket connection`);\n    }\n    log.info(`Opening connection to ${this._url}`);\n\n    // Set a timeout to abort the connection if we are still not connected by then.\n    // This will abort hanging connection attempts that can for whatever reason not\n    // establish a connection with the server.\n    this._connectionAttemptTimeout = setTimeout(() => {\n      this._client?.close();\n    }, 10000);\n\n    this._client = new FoxgloveClient({\n      ws:\n        typeof Worker !== \"undefined\"\n          ? new WorkerSocketAdapter(this._url, [FoxgloveClient.SUPPORTED_SUBPROTOCOL])\n          : new WebSocket(this._url, [FoxgloveClient.SUPPORTED_SUBPROTOCOL]),\n    });\n\n    this._client.on(\"open\", () => {\n      if (this._closed) {\n        return;\n      }\n      if (this._connectionAttemptTimeout != undefined) {\n        clearTimeout(this._connectionAttemptTimeout);\n      }\n      this._presence = PlayerPresence.PRESENT;\n      this._problems.clear();\n      this._channelsById.clear();\n      this._channelsByTopic.clear();\n      this._setupPublishers();\n      this._servicesByName.clear();\n      this._serviceResponseCbs.clear();\n      this._parameters.clear();\n      this._profile = undefined;\n      this._publishedTopics = undefined;\n      this._subscribedTopics = undefined;\n      this._advertisedServices = undefined;\n\n      this._datatypes = new Map();\n\n      for (const topic of this._resolvedSubscriptionsByTopic.keys()) {\n        this._unresolvedSubscriptions.add(topic);\n      }\n      this._resolvedSubscriptionsById.clear();\n      this._resolvedSubscriptionsByTopic.clear();\n    });\n\n    this._client.on(\"error\", (err) => {\n      log.error(err);\n\n      if (\n        (err as unknown as undefined | { message?: string })?.message != undefined &&\n        err.message.includes(\"insecure WebSocket connection\")\n      ) {\n        this._problems.addProblem(\"ws:connection-failed\", {\n          severity: \"error\",\n          message: \"Insecure WebSocket connection\",\n          tip: `Check that the WebSocket server at ${this._url} is reachable and supports protocol version ${FoxgloveClient.SUPPORTED_SUBPROTOCOL}.`,\n        });\n        this._emitState();\n      }\n    });\n\n    // Note: We've observed closed being called not only when an already open connection is closed\n    // but also when a new connection fails to open\n    //\n    // Note: We explicitly avoid clearing state like start/end times, datatypes, etc to preserve\n    // this during a disconnect event. Any necessary state clearing is handled once a new connection\n    // is established\n    this._client.on(\"close\", (event) => {\n      log.info(\"Connection closed:\", event);\n      this._presence = PlayerPresence.RECONNECTING;\n\n      if (this._getParameterInterval != undefined) {\n        clearInterval(this._getParameterInterval);\n        this._getParameterInterval = undefined;\n      }\n      if (this._connectionAttemptTimeout != undefined) {\n        clearTimeout(this._connectionAttemptTimeout);\n      }\n\n      this._client?.close();\n      this._client = undefined;\n\n      this._problems.addProblem(\"ws:connection-failed\", {\n        severity: \"error\",\n        message: \"Connection failed\",\n        tip: `Check that the WebSocket server at ${this._url} is reachable and supports protocol version ${FoxgloveClient.SUPPORTED_SUBPROTOCOL}.`,\n      });\n\n      this._emitState();\n      this._openTimeout = setTimeout(this._open, 3000);\n    });\n\n    this._client.on(\"serverInfo\", (event) => {\n      if (!Array.isArray(event.capabilities)) {\n        this._problems.addProblem(\"ws:invalid-capabilities\", {\n          severity: \"warn\",\n          message: `Server sent an invalid or missing capabilities field: '${event.capabilities}'`,\n        });\n      }\n      this._name = `${this._url}\\n${event.name}`;\n      this._serverCapabilities = Array.isArray(event.capabilities) ? event.capabilities : [];\n      this._serverPublishesTime = this._serverCapabilities.includes(ServerCapability.time);\n      this._supportedEncodings = event.supportedEncodings;\n      this._datatypes = new Map();\n\n      // If the server publishes the time we clear any existing clockTime we might have and let the\n      // server override\n      if (this._serverPublishesTime) {\n        this._clockTime = undefined;\n      }\n\n      const maybeRosDistro = event.metadata?.[\"ROS_DISTRO\"];\n      if (maybeRosDistro) {\n        const rosDistro = maybeRosDistro;\n        const isRos1 = [\"melodic\", \"noetic\"].includes(rosDistro);\n        this._profile = isRos1 ? \"ros1\" : \"ros2\";\n\n        // Add common ROS message definitions\n        const rosDataTypes = isRos1\n          ? CommonRosTypes.ros1\n          : [\"foxy\", \"galactic\"].includes(rosDistro)\n          ? CommonRosTypes.ros2galactic\n          : CommonRosTypes.ros2humble;\n\n        for (const dataType in rosDataTypes) {\n          const msgDef = (rosDataTypes as Record<string, MessageDefinition>)[dataType]!;\n          this._datatypes.set(dataType, msgDef);\n          this._datatypes.set(dataTypeToFullName(dataType), msgDef);\n        }\n        this._datatypes = new Map(this._datatypes); // Signal that datatypes changed.\n      }\n\n      if (event.capabilities.includes(ServerCapability.clientPublish)) {\n        this._playerCapabilities = this._playerCapabilities.concat(PlayerCapabilities.advertise);\n      }\n      if (event.capabilities.includes(ServerCapability.services)) {\n        this._serviceCallEncoding = event.supportedEncodings?.find((e) =>\n          SUPPORTED_SERVICE_ENCODINGS.includes(e),\n        );\n\n        const problemId = \"callService:unsupportedEncoding\";\n        if (this._serviceCallEncoding) {\n          this._playerCapabilities = this._playerCapabilities.concat(\n            PlayerCapabilities.callServices,\n          );\n          this._problems.removeProblem(problemId);\n        } else {\n          this._problems.addProblem(problemId, {\n            severity: \"warn\",\n            message: `Calling services is disabled as no compatible encoding could be found. \\\n            The server supports [${event.supportedEncodings?.join(\", \")}], \\\n            but Studio only supports [${SUPPORTED_SERVICE_ENCODINGS.join(\", \")}]`,\n          });\n        }\n      }\n\n      if (event.capabilities.includes(ServerCapability.parameters)) {\n        this._playerCapabilities = this._playerCapabilities.concat(\n          PlayerCapabilities.getParameters,\n          PlayerCapabilities.setParameters,\n        );\n\n        // Periodically request all available parameters.\n        this._getParameterInterval = setInterval(() => {\n          this._client?.getParameters([], GET_ALL_PARAMS_REQUEST_ID);\n        }, GET_ALL_PARAMS_PERIOD_MS);\n\n        this._client?.getParameters([], GET_ALL_PARAMS_REQUEST_ID);\n      }\n\n      if (event.capabilities.includes(ServerCapability.connectionGraph)) {\n        this._client?.subscribeConnectionGraph();\n      }\n\n      this._emitState();\n    });\n\n    this._client.on(\"status\", (event) => {\n      const msg = `FoxgloveWebSocket: ${event.message}`;\n      if (event.level === StatusLevel.INFO) {\n        log.info(msg);\n      } else if (event.level === StatusLevel.WARNING) {\n        log.warn(msg);\n      } else {\n        log.error(msg);\n      }\n\n      const problem: PlayerProblem = {\n        message: event.message,\n        severity: statusLevelToProblemSeverity(event.level),\n      };\n\n      if (event.message === \"Send buffer limit reached\") {\n        problem.tip =\n          \"Server is dropping messages to the client. Check if you are subscribing to large or frequent topics or adjust your server send buffer limit.\";\n      }\n\n      this._problems.addProblem(event.message, problem);\n      this._emitState();\n    });\n\n    this._client.on(\"advertise\", (newChannels) => {\n      for (const channel of newChannels) {\n        let parsedChannel;\n        try {\n          let schemaEncoding;\n          let schemaData;\n          if (\n            channel.encoding === \"json\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"jsonschema\")\n          ) {\n            schemaEncoding = \"jsonschema\";\n            schemaData = textEncoder.encode(channel.schema);\n          } else if (\n            channel.encoding === \"protobuf\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"protobuf\")\n          ) {\n            schemaEncoding = \"protobuf\";\n            schemaData = new Uint8Array(base64.length(channel.schema));\n            if (base64.decode(channel.schema, schemaData, 0) !== schemaData.byteLength) {\n              throw new Error(`Failed to decode base64 schema on channel ${channel.id}`);\n            }\n          } else if (\n            channel.encoding === \"flatbuffer\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"flatbuffer\")\n          ) {\n            schemaEncoding = \"flatbuffer\";\n            schemaData = new Uint8Array(base64.length(channel.schema));\n            if (base64.decode(channel.schema, schemaData, 0) !== schemaData.byteLength) {\n              throw new Error(`Failed to decode base64 schema on channel ${channel.id}`);\n            }\n          } else if (\n            channel.encoding === \"ros1\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"ros1msg\")\n          ) {\n            schemaEncoding = \"ros1msg\";\n            schemaData = textEncoder.encode(channel.schema);\n          } else if (\n            channel.encoding === \"cdr\" &&\n            (channel.schemaEncoding == undefined ||\n              [\"ros2idl\", \"ros2msg\"].includes(channel.schemaEncoding))\n          ) {\n            schemaEncoding = channel.schemaEncoding ?? \"ros2msg\";\n            schemaData = textEncoder.encode(channel.schema);\n          } else {\n            const msg = channel.schemaEncoding\n              ? `Unsupported combination of message / schema encoding: (${channel.encoding} / ${channel.schemaEncoding})`\n              : `Unsupported message encoding ${channel.encoding}`;\n            throw new Error(msg);\n          }\n          parsedChannel = parseChannel({\n            messageEncoding: channel.encoding,\n            schema: { name: channel.schemaName, encoding: schemaEncoding, data: schemaData },\n          });\n        } catch (error) {\n          this._unsupportedChannelIds.add(channel.id);\n          this._problems.addProblem(`schema:${channel.topic}`, {\n            severity: \"error\",\n            message: `Failed to parse channel schema on ${channel.topic}`,\n            error,\n          });\n          this._emitState();\n          continue;\n        }\n        const existingChannel = this._channelsByTopic.get(channel.topic);\n        if (existingChannel && !isEqual(channel, existingChannel.channel)) {\n          this._problems.addProblem(`duplicate-topic:${channel.topic}`, {\n            severity: \"error\",\n            message: `Multiple channels advertise the same topic: ${channel.topic} (${existingChannel.channel.id} and ${channel.id})`,\n          });\n          this._emitState();\n          continue;\n        }\n        const resolvedChannel = { channel, parsedChannel };\n        this._channelsById.set(channel.id, resolvedChannel);\n        this._channelsByTopic.set(channel.topic, resolvedChannel);\n      }\n      this._updateTopicsAndDatatypes();\n      this._emitState();\n      this._processUnresolvedSubscriptions();\n    });\n\n    this._client.on(\"unadvertise\", (removedChannels) => {\n      for (const id of removedChannels) {\n        const chanInfo = this._channelsById.get(id);\n        if (!chanInfo) {\n          if (!this._unsupportedChannelIds.delete(id)) {\n            this._problems.addProblem(`unadvertise:${id}`, {\n              severity: \"error\",\n              message: `Server unadvertised channel ${id} that was not advertised`,\n            });\n            this._emitState();\n          }\n          continue;\n        }\n        for (const [subId, { channel }] of this._resolvedSubscriptionsById) {\n          if (channel.id === id) {\n            this._resolvedSubscriptionsById.delete(subId);\n            this._resolvedSubscriptionsByTopic.delete(channel.topic);\n            this._client?.unsubscribe(subId);\n            this._unresolvedSubscriptions.add(channel.topic);\n          }\n        }\n        this._channelsById.delete(id);\n        this._channelsByTopic.delete(chanInfo.channel.topic);\n      }\n      this._updateTopicsAndDatatypes();\n      this._emitState();\n    });\n\n    this._client.on(\"message\", ({ subscriptionId, data }) => {\n      if (!this._hasReceivedMessage) {\n        this._hasReceivedMessage = true;\n        this._metricsCollector.recordTimeToFirstMsgs();\n      }\n      const chanInfo = this._resolvedSubscriptionsById.get(subscriptionId);\n      if (!chanInfo) {\n        const wasRecentlyCanceled = this._recentlyCanceledSubscriptions.has(subscriptionId);\n        if (!wasRecentlyCanceled) {\n          this._problems.addProblem(`message-missing-subscription:${subscriptionId}`, {\n            severity: \"warn\",\n            message: `Received message on unknown subscription id: ${subscriptionId}. This might be a WebSocket server bug.`,\n          });\n          this._emitState();\n        }\n        return;\n      }\n\n      try {\n        this._receivedBytes += data.byteLength;\n        const receiveTime = this._getCurrentTime();\n        const topic = chanInfo.channel.topic;\n        this._parsedMessages.push({\n          topic,\n          receiveTime,\n          message: chanInfo.parsedChannel.deserialize(data),\n          sizeInBytes: data.byteLength,\n          schemaName: chanInfo.channel.schemaName,\n        });\n\n        // Update the message count for this topic\n        let stats = this._topicsStats.get(topic);\n        if (!stats) {\n          stats = { numMessages: 0 };\n          this._topicsStats.set(topic, stats);\n        }\n        stats.numMessages++;\n      } catch (error) {\n        this._problems.addProblem(`message:${chanInfo.channel.topic}`, {\n          severity: \"error\",\n          message: `Failed to parse message on ${chanInfo.channel.topic}`,\n          error,\n        });\n      }\n      this._emitState();\n    });\n\n    this._client.on(\"time\", ({ timestamp }) => {\n      if (!this._serverPublishesTime) {\n        return;\n      }\n\n      const time = fromNanoSec(timestamp);\n      if (this._clockTime != undefined && isLessThan(time, this._clockTime)) {\n        this._numTimeSeeks++;\n        this._parsedMessages = [];\n      }\n\n      this._clockTime = time;\n      this._emitState();\n    });\n\n    this._client.on(\"parameterValues\", ({ parameters, id }) => {\n      const newParameters = parameters.filter((param) => !this._parameters.has(param.name));\n\n      if (id === GET_ALL_PARAMS_REQUEST_ID) {\n        // Reset params\n        this._parameters = new Map(parameters.map((param) => [param.name, param.value]));\n      } else {\n        // Update params\n        parameters.forEach((param) => this._parameters.set(param.name, param.value));\n      }\n\n      this._emitState();\n\n      if (\n        newParameters.length > 0 &&\n        this._serverCapabilities.includes(ServerCapability.parametersSubscribe)\n      ) {\n        // Subscribe to value updates of new parameters\n        this._client?.subscribeParameterUpdates(newParameters.map((p) => p.name));\n      }\n    });\n\n    this._client.on(\"advertiseServices\", (services) => {\n      if (!this._serviceCallEncoding) {\n        return;\n      }\n\n      let schemaEncoding: string;\n      if (this._serviceCallEncoding === \"json\") {\n        schemaEncoding = \"jsonschema\";\n      } else if (this._serviceCallEncoding === \"ros1\") {\n        schemaEncoding = \"ros1msg\";\n      } else if (this._serviceCallEncoding === \"cdr\") {\n        schemaEncoding = \"ros2msg\";\n      } else {\n        throw new Error(`Unsupported encoding \"${this._serviceCallEncoding}\"`);\n      }\n\n      for (const service of services) {\n        const requestType = `${service.type}_Request`;\n        const responseType = `${service.type}_Response`;\n        const parsedRequest = parseChannel({\n          messageEncoding: this._serviceCallEncoding,\n          schema: {\n            name: requestType,\n            encoding: schemaEncoding,\n            data: textEncoder.encode(service.requestSchema),\n          },\n        });\n        const parsedResponse = parseChannel({\n          messageEncoding: this._serviceCallEncoding,\n          schema: {\n            name: responseType,\n            encoding: schemaEncoding,\n            data: textEncoder.encode(service.responseSchema),\n          },\n        });\n        const requestMsgDef = rosDatatypesToMessageDefinition(parsedRequest.datatypes, requestType);\n        const requestMessageWriter = ROS_ENCODINGS.includes(this._serviceCallEncoding)\n          ? this._serviceCallEncoding === \"ros1\"\n            ? new Ros1MessageWriter(requestMsgDef)\n            : new Ros2MessageWriter(requestMsgDef)\n          : new JsonMessageWriter();\n\n        // Add type definitions for service response and request\n        for (const [name, types] of [...parsedRequest.datatypes, ...parsedResponse.datatypes]) {\n          this._datatypes.set(name, types);\n        }\n        this._datatypes = new Map(this._datatypes); // Signal that datatypes changed.\n\n        const resolvedService: ResolvedService = {\n          service,\n          parsedResponse,\n          requestMessageWriter,\n        };\n        this._servicesByName.set(service.name, resolvedService);\n      }\n      this._emitState();\n    });\n\n    this._client.on(\"unadvertiseServices\", (serviceIds) => {\n      for (const serviceId of serviceIds) {\n        const service: ResolvedService | undefined = Object.values(this._servicesByName).find(\n          (srv) => srv.service.id === serviceId,\n        );\n        if (service) {\n          this._servicesByName.delete(service.service.name);\n        }\n      }\n    });\n\n    this._client.on(\"serviceCallResponse\", (response) => {\n      const responseCallback = this._serviceResponseCbs.get(response.callId);\n      if (!responseCallback) {\n        this._problems.addProblem(`callService:${response.callId}`, {\n          severity: \"error\",\n          message: `Received a response for a service for which no callback was registered`,\n        });\n        return;\n      }\n      responseCallback(response);\n      this._serviceResponseCbs.delete(response.callId);\n    });\n\n    this._client.on(\"connectionGraphUpdate\", (event) => {\n      if (event.publishedTopics.length > 0 || event.removedTopics.length > 0) {\n        const newMap: Map<string, Set<string>> = new Map(this._publishedTopics ?? new Map());\n        for (const { name, publisherIds } of event.publishedTopics) {\n          newMap.set(name, new Set(publisherIds));\n        }\n        event.removedTopics.forEach((topic) => newMap.delete(topic));\n        this._publishedTopics = newMap;\n      }\n      if (event.subscribedTopics.length > 0 || event.removedTopics.length > 0) {\n        const newMap: Map<string, Set<string>> = new Map(this._subscribedTopics ?? new Map());\n        for (const { name, subscriberIds } of event.subscribedTopics) {\n          newMap.set(name, new Set(subscriberIds));\n        }\n        event.removedTopics.forEach((topic) => newMap.delete(topic));\n        this._subscribedTopics = newMap;\n      }\n      if (event.advertisedServices.length > 0 || event.removedServices.length > 0) {\n        const newMap: Map<string, Set<string>> = new Map(this._advertisedServices ?? new Map());\n        for (const { name, providerIds } of event.advertisedServices) {\n          newMap.set(name, new Set(providerIds));\n        }\n        event.removedServices.forEach((service) => newMap.delete(service));\n        this._advertisedServices = newMap;\n      }\n\n      this._emitState();\n    });\n  };\n\n  private _updateTopicsAndDatatypes() {\n    // Build a new topics array from this._channelsById\n    const topics: Topic[] = Array.from(this._channelsById.values(), (chanInfo) => ({\n      name: chanInfo.channel.topic,\n      schemaName: chanInfo.channel.schemaName,\n    }));\n\n    // Remove stats entries for removed topics\n    const topicsSet = new Set<string>(topics.map((topic) => topic.name));\n    for (const topic of this._topicsStats.keys()) {\n      if (!topicsSet.has(topic)) {\n        this._topicsStats.delete(topic);\n      }\n    }\n\n    this._topics = topics;\n\n    // Update the _datatypes map;\n    for (const { parsedChannel } of this._channelsById.values()) {\n      for (const [name, types] of parsedChannel.datatypes) {\n        this._datatypes.set(name, types);\n      }\n    }\n    this._datatypes = new Map(this._datatypes); // Signal that datatypes changed.\n    this._emitState();\n  }\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  private _emitState = debouncePromise(() => {\n    if (!this._listener || this._closed) {\n      return Promise.resolve();\n    }\n\n    if (!this._topics) {\n      return this._listener({\n        name: this._name,\n        presence: this._presence,\n        progress: {},\n        capabilities: this._playerCapabilities,\n        profile: undefined,\n        playerId: this._id,\n        activeData: undefined,\n        problems: this._problems.problems(),\n        urlState: this._urlState,\n      });\n    }\n\n    const currentTime = this._getCurrentTime();\n    if (!this._startTime || isLessThan(currentTime, this._startTime)) {\n      this._startTime = currentTime;\n    }\n    if (!this._endTime || isGreaterThan(currentTime, this._endTime)) {\n      this._endTime = currentTime;\n    }\n\n    const messages = this._parsedMessages;\n    this._parsedMessages = [];\n    return this._listener({\n      name: this._name,\n      presence: this._presence,\n      progress: {},\n      capabilities: this._playerCapabilities,\n      profile: this._profile,\n      playerId: this._id,\n      problems: this._problems.problems(),\n      urlState: this._urlState,\n\n      activeData: {\n        messages,\n        totalBytesReceived: this._receivedBytes,\n        startTime: this._startTime,\n        endTime: this._endTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        lastSeekTime: this._numTimeSeeks,\n        topics: this._topics,\n        // Always copy topic stats since message counts and timestamps are being updated\n        topicStats: new Map(this._topicsStats),\n        datatypes: this._datatypes,\n        parameters: new Map(this._parameters),\n        publishedTopics: this._publishedTopics,\n        subscribedTopics: this._subscribedTopics,\n        services: this._advertisedServices,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this._listener = listener;\n    this._emitState();\n  }\n\n  public close(): void {\n    this._closed = true;\n    this._client?.close();\n    this._metricsCollector.close();\n    this._hasReceivedMessage = false;\n    if (this._openTimeout != undefined) {\n      clearTimeout(this._openTimeout);\n      this._openTimeout = undefined;\n    }\n    if (this._getParameterInterval != undefined) {\n      clearInterval(this._getParameterInterval);\n      this._getParameterInterval = undefined;\n    }\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    const newTopics = new Set(subscriptions.map(({ topic }) => topic));\n\n    if (!this._client || this._closed) {\n      // Remember requested subscriptions so we can retry subscribing when\n      // the client is available.\n      this._unresolvedSubscriptions = newTopics;\n      return;\n    }\n\n    for (const topic of newTopics) {\n      if (!this._resolvedSubscriptionsByTopic.has(topic)) {\n        this._unresolvedSubscriptions.add(topic);\n      }\n    }\n\n    for (const [topic, subId] of this._resolvedSubscriptionsByTopic) {\n      if (!newTopics.has(topic)) {\n        this._client.unsubscribe(subId);\n        this._resolvedSubscriptionsByTopic.delete(topic);\n        this._resolvedSubscriptionsById.delete(subId);\n        this._recentlyCanceledSubscriptions.add(subId);\n\n        // Reset the message count for this topic\n        this._topicsStats.delete(topic);\n\n        setTimeout(\n          () => this._recentlyCanceledSubscriptions.delete(subId),\n          SUBSCRIPTION_WARNING_SUPPRESSION_MS,\n        );\n      }\n    }\n    for (const topic of this._unresolvedSubscriptions) {\n      if (!newTopics.has(topic)) {\n        this._unresolvedSubscriptions.delete(topic);\n      }\n    }\n\n    this._processUnresolvedSubscriptions();\n  }\n\n  private _processUnresolvedSubscriptions() {\n    if (!this._client) {\n      return;\n    }\n\n    for (const topic of this._unresolvedSubscriptions) {\n      const chanInfo = this._channelsByTopic.get(topic);\n      if (chanInfo) {\n        const subId = this._client.subscribe(chanInfo.channel.id);\n        this._unresolvedSubscriptions.delete(topic);\n        this._resolvedSubscriptionsByTopic.set(topic, subId);\n        this._resolvedSubscriptionsById.set(subId, chanInfo);\n      }\n    }\n  }\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    // Since `setPublishers` is rarely called, we can get away with just unadvertising existing\n    // channels und re-advertising them again\n    for (const channel of this._publicationsByTopic.values()) {\n      this._client?.unadvertise(channel.id);\n    }\n    this._publicationsByTopic.clear();\n    this._unresolvedPublications = publishers;\n    this._setupPublishers();\n  }\n\n  public setParameter(key: string, value: ParameterValue): void {\n    if (!this._client) {\n      throw new Error(`Attempted to set parameters without a valid Foxglove WebSocket connection`);\n    }\n\n    log.debug(`FoxgloveWebSocketPlayer.setParameter(key=${key}, value=${value})`);\n    this._client.setParameters([{ name: key, value: value as Parameter[\"value\"] }], uuidv4());\n\n    // Pre-actively update our parameter map, such that a change is detected if our update failed\n    this._parameters.set(key, value);\n    this._emitState();\n  }\n\n  public publish({ topic, msg }: PublishPayload): void {\n    if (!this._client) {\n      throw new Error(`Attempted to publish without a valid Foxglove WebSocket connection`);\n    }\n\n    const clientChannel = this._publicationsByTopic.get(topic);\n    if (!clientChannel) {\n      throw new Error(`Tried to publish on topic '${topic}' that has not been advertised before.`);\n    }\n\n    if (clientChannel.encoding === \"json\") {\n      // Ensure that typed arrays are encoded as arrays and not objects.\n      const replacer = (_key: string, value: unknown) => {\n        return ArrayBuffer.isView(value)\n          ? Array.from(value as unknown as ArrayLike<unknown>)\n          : value;\n      };\n      const message = Buffer.from(JSON.stringify(msg, replacer) ?? \"\");\n      this._client.sendMessage(clientChannel.id, message);\n    } else if (\n      ROS_ENCODINGS.includes(clientChannel.encoding) &&\n      clientChannel.messageWriter != undefined\n    ) {\n      const message = clientChannel.messageWriter.writeMessage(msg);\n      this._client.sendMessage(clientChannel.id, message);\n    }\n  }\n\n  public async callService(serviceName: string, request: unknown): Promise<unknown> {\n    if (!this._client) {\n      throw new Error(\n        `Attempted to call service ${serviceName} without a valid Foxglove WebSocket connection.`,\n      );\n    }\n\n    if (request == undefined || typeof request !== \"object\") {\n      throw new Error(\"FoxgloveWebSocketPlayer#callService request must be an object.\");\n    }\n\n    const resolvedService = this._servicesByName.get(serviceName);\n    if (!resolvedService) {\n      throw new Error(\n        `Tried to call service '${serviceName}' that has not been advertised before.`,\n      );\n    }\n\n    const { service, parsedResponse, requestMessageWriter } = resolvedService;\n\n    const serviceCallRequest: ServiceCallPayload = {\n      serviceId: service.id,\n      callId: ++this._nextServiceCallId,\n      encoding: this._serviceCallEncoding!,\n      data: new DataView(new Uint8Array().buffer),\n    };\n\n    const message = requestMessageWriter.writeMessage(request);\n    serviceCallRequest.data = new DataView(message.buffer);\n    this._client.sendServiceCallRequest(serviceCallRequest);\n\n    return await new Promise<Record<string, unknown>>((resolve, reject) => {\n      this._serviceResponseCbs.set(serviceCallRequest.callId, (response: ServiceCallResponse) => {\n        try {\n          const data = parsedResponse.deserialize(response.data);\n          resolve(data as Record<string, unknown>);\n        } catch (error) {\n          reject(error);\n        }\n      });\n    });\n  }\n\n  public setGlobalVariables(): void {}\n\n  // Return the current time\n  //\n  // For servers which publish a clock, we return that time. If the server disconnects we continue\n  // to return the last known time. For servers which do not publish a clock, we use wall time.\n  private _getCurrentTime(): Time {\n    // If the server does not publish the time, then we set the clock time to realtime as long as\n    // the server is connected. When the server is not connected, time stops.\n    if (!this._serverPublishesTime) {\n      this._clockTime =\n        this._presence === PlayerPresence.PRESENT ? fromMillis(Date.now()) : this._clockTime;\n    }\n\n    return this._clockTime ?? ZERO_TIME;\n  }\n\n  private _setupPublishers(): void {\n    // This function will be called again once a connection is established\n    if (!this._client || this._closed) {\n      return;\n    }\n\n    if (this._unresolvedPublications.length === 0) {\n      return;\n    }\n\n    this._problems.removeProblems((id) => id.startsWith(\"pub:\"));\n\n    const encoding = this._supportedEncodings\n      ? this._supportedEncodings.find((e) => SUPPORTED_PUBLICATION_ENCODINGS.includes(e))\n      : FALLBACK_PUBLICATION_ENCODING;\n\n    for (const { topic, schemaName, options } of this._unresolvedPublications) {\n      const encodingProblemId = `pub:encoding:${topic}`;\n      const msgdefProblemId = `pub:msgdef:${topic}`;\n\n      if (!encoding) {\n        this._problems.addProblem(encodingProblemId, {\n          severity: \"warn\",\n          message: `Cannot advertise topic '${topic}': Server does not support one of the following encodings for client-side publishing: ${SUPPORTED_PUBLICATION_ENCODINGS}`,\n        });\n        continue;\n      }\n\n      let messageWriter: Publication[\"messageWriter\"] = undefined;\n      if (ROS_ENCODINGS.includes(encoding)) {\n        // Try to retrieve the ROS message definition for this topic\n        let msgdef: MessageDefinition[];\n        try {\n          const datatypes = options?.[\"datatypes\"] as RosDatatypes | undefined;\n          if (!datatypes || !(datatypes instanceof Map)) {\n            throw new Error(\"The datatypes option is required for publishing\");\n          }\n          msgdef = rosDatatypesToMessageDefinition(datatypes, schemaName);\n        } catch (error) {\n          log.debug(error);\n          this._problems.addProblem(msgdefProblemId, {\n            severity: \"warn\",\n            message: `Unknown message definition for \"${topic}\"`,\n            tip: `Try subscribing to the topic \"${topic}\" before publishing to it`,\n          });\n          continue;\n        }\n\n        messageWriter =\n          encoding === \"ros1\" ? new Ros1MessageWriter(msgdef) : new Ros2MessageWriter(msgdef);\n      }\n\n      const channelId = this._client.advertise(topic, encoding, schemaName);\n      this._publicationsByTopic.set(topic, {\n        id: channelId,\n        topic,\n        encoding,\n        schemaName,\n        messageWriter,\n      });\n    }\n\n    this._unresolvedPublications = [];\n    this._emitState();\n  }\n}\n\nfunction dataTypeToFullName(dataType: string): string {\n  const parts = dataType.split(\"/\");\n  if (parts.length === 2) {\n    return `${parts[0]}/msg/${parts[1]}`;\n  }\n  return dataType;\n}\n\nfunction statusLevelToProblemSeverity(level: StatusLevel): PlayerProblem[\"severity\"] {\n  if (level === StatusLevel.INFO) {\n    return \"info\";\n  } else if (level === StatusLevel.WARNING) {\n    return \"warn\";\n  } else {\n    return \"error\";\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport FoxgloveWebSocketPlayer from \"@foxglove/studio-base/players/FoxgloveWebSocketPlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nexport default class FoxgloveWebSocketDataSourceFactory implements IDataSourceFactory {\n  public id = \"foxglove-websocket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Foxglove WebSocket\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"Flow\";\n  public description =\n    \"Connect to a ROS 1, ROS 2, or custom system using the Foxglove WebSocket protocol. For ROS systems, be sure to first install the foxglove_bridge ROS package.\";\n  public docsLinks = [\n    {\n      label: \"ROS 1\",\n      url: \"https://foxglove.dev/docs/studio/connection/ros1#foxglove-websocket\",\n    },\n    {\n      label: \"ROS 2\",\n      url: \"https://foxglove.dev/docs/studio/connection/ros2#foxglove-websocket\",\n    },\n    {\n      label: \"custom data\",\n      url: \"https://foxglove.dev/docs/studio/connection/custom#foxglove-websocket\",\n    },\n  ];\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"WebSocket URL\",\n        defaultValue: \"ws://localhost:8765\",\n        validate: (newValue: string): Error | undefined => {\n          try {\n            const url = new URL(newValue);\n            if (url.protocol !== \"ws:\" && url.protocol !== \"wss:\") {\n              return new Error(`Invalid protocol: ${url.protocol}`);\n            }\n            return undefined;\n          } catch (err) {\n            return new Error(\"Enter a valid url\");\n          }\n        },\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      return;\n    }\n\n    return new FoxgloveWebSocketPlayer({\n      url,\n      metricsCollector: args.metricsCollector,\n      sourceId: this.id,\n    });\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  PlayerMetricsCollectorInterface,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\n\nexport default class NoopMetricsCollector implements PlayerMetricsCollectorInterface {\n  public setProperty(_key: string, _value: string | number | boolean): void {\n    // no-op\n  }\n  public playerConstructed(): void {\n    // no-op\n  }\n  public play(_speed: number): void {\n    // no-op\n  }\n  public seek(_time: Time): void {\n    // no-op\n  }\n  public setSpeed(_speed: number): void {\n    // no-op\n  }\n  public pause(): void {\n    // no-op\n  }\n  public close(): void {\n    // no-op\n  }\n  public setSubscriptions(_subscriptions: SubscribePayload[]): void {\n    // no-op\n  }\n  public recordPlaybackTime(_time: Time): void {\n    // no-op\n  }\n  public recordBytesReceived(_bytes: number): void {\n    // no-op\n  }\n  public recordDataProviderPerformance(): void {\n    // no-op\n  }\n  public recordUncachedRangeRequest(): void {\n    // no-op\n  }\n  public recordTimeToFirstMsgs(): void {\n    // no-op\n  }\n  public recordDataProviderInitializePerformance(): void {\n    // no-op\n  }\n  public recordDataProviderStall(): void {\n    // no-op\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { compare, add as addTime } from \"@foxglove/rostime\";\nimport { Time } from \"@foxglove/studio\";\n\nimport type { IMessageCursor, IteratorResult } from \"./IIterableSource\";\n\nconst TIME_ZERO = Object.freeze({ sec: 0, nsec: 0 });\n\n/// IteratorCursor implements a IMessageCursor interface on top of an AsyncIterable\nclass IteratorCursor implements IMessageCursor {\n  private _iter: AsyncIterableIterator<Readonly<IteratorResult>>;\n  // readUntil reads from the iterator inclusive of end time. To do this, it reads from the iterator\n  // until it receives a receiveTime after end time to signal it has received all the messages\n  // inclusive of end time. Since iterators are read once, this last result must be stored for the\n  // next readUntil call otherwise it would be lost.\n  private _lastIteratorResult?: IteratorResult;\n  private _abort?: AbortSignal;\n\n  public constructor(\n    iterator: AsyncIterableIterator<Readonly<IteratorResult>>,\n    abort?: AbortSignal,\n  ) {\n    this._iter = iterator;\n    this._abort = abort;\n  }\n\n  public async next(): ReturnType<IMessageCursor[\"next\"]> {\n    if (this._abort?.aborted === true) {\n      return undefined;\n    }\n\n    const result = await this._iter.next();\n    return result.value;\n  }\n\n  public async nextBatch(durationMs: number): Promise<IteratorResult[] | undefined> {\n    const firstResult = await this.next();\n    if (!firstResult) {\n      return undefined;\n    }\n\n    if (firstResult.type === \"problem\") {\n      return [firstResult];\n    }\n\n    const results: IteratorResult[] = [firstResult];\n\n    let cutoffTime: Time = TIME_ZERO;\n    switch (firstResult.type) {\n      case \"stamp\":\n        cutoffTime = addTime(firstResult.stamp, { sec: 0, nsec: durationMs * 1e6 });\n        break;\n      case \"message-event\":\n        cutoffTime = addTime(firstResult.msgEvent.receiveTime, { sec: 0, nsec: durationMs * 1e6 });\n        break;\n    }\n\n    for (;;) {\n      const result = await this.next();\n      if (!result) {\n        return results;\n      }\n\n      results.push(result);\n\n      if (result.type === \"problem\") {\n        break;\n      }\n      if (result.type === \"stamp\" && compare(result.stamp, cutoffTime) > 0) {\n        break;\n      }\n      if (result.type === \"message-event\" && compare(result.msgEvent.receiveTime, cutoffTime) > 0) {\n        break;\n      }\n    }\n    return results;\n  }\n\n  public async readUntil(end: Time): ReturnType<IMessageCursor[\"readUntil\"]> {\n    // Assign to a variable to fool typescript control flow analysis which does not understand\n    // that this value could change after the _await_\n    const isAborted = this._abort?.aborted;\n    if (isAborted === true) {\n      return undefined;\n    }\n\n    const results: IteratorResult[] = [];\n\n    // if the last result is still past end time, return empty results\n    if (\n      this._lastIteratorResult?.type === \"stamp\" &&\n      compare(this._lastIteratorResult.stamp, end) >= 0\n    ) {\n      return results;\n    }\n\n    if (\n      this._lastIteratorResult?.type === \"message-event\" &&\n      compare(this._lastIteratorResult.msgEvent.receiveTime, end) > 0\n    ) {\n      return results;\n    }\n\n    if (this._lastIteratorResult) {\n      results.push(this._lastIteratorResult);\n      this._lastIteratorResult = undefined;\n    }\n\n    for (;;) {\n      const result = await this._iter.next();\n      if (this._abort?.aborted === true) {\n        return undefined;\n      }\n\n      if (result.done === true) {\n        break;\n      }\n\n      const value = result.value;\n      if (value.type === \"stamp\" && compare(value.stamp, end) >= 0) {\n        this._lastIteratorResult = value;\n        break;\n      }\n      if (value.type === \"message-event\" && compare(value.msgEvent.receiveTime, end) > 0) {\n        this._lastIteratorResult = value;\n        break;\n      }\n      results.push(value);\n    }\n\n    return results;\n  }\n\n  public async end(): ReturnType<IMessageCursor[\"end\"]> {\n    await this._iter.return?.();\n  }\n}\n\nexport { IteratorCursor };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { simplify } from \"intervals-fn\";\nimport { isEqual } from \"lodash\";\n\nimport { Condvar } from \"@foxglove/den/async\";\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport {\n  Time,\n  subtract as subtractTimes,\n  toNanoSec,\n  add,\n  fromNanoSec,\n  clampTime,\n} from \"@foxglove/rostime\";\nimport { MessageEvent } from \"@foxglove/studio\";\nimport { IteratorCursor } from \"@foxglove/studio-base/players/IterablePlayer/IteratorCursor\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport { MessageBlock, Progress } from \"@foxglove/studio-base/players/types\";\n\nimport { IIterableSource, MessageIteratorArgs } from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\ntype BlockLoaderArgs = {\n  cacheSizeBytes: number;\n  source: IIterableSource;\n  start: Time;\n  end: Time;\n  maxBlocks: number;\n  minBlockDurationNs: number;\n  problemManager: PlayerProblemManager;\n};\n\ntype CacheBlock = MessageBlock & {\n  needTopics: Set<string>;\n};\n\ntype Blocks = (CacheBlock | undefined)[];\n\ntype LoadArgs = {\n  progress: (progress: Progress) => void;\n};\n\n/**\n * BlockLoader manages loading blocks from a source. Blocks are fixed time span containers for messages.\n */\nexport class BlockLoader {\n  private source: IIterableSource;\n  private blocks: Blocks = [];\n  private start: Time;\n  private end: Time;\n  private blockDurationNanos: number;\n  private topics: Set<string> = new Set();\n  private maxCacheSize: number = 0;\n  private problemManager: PlayerProblemManager;\n  private stopped: boolean = false;\n  private activeChangeCondvar: Condvar = new Condvar();\n  private abortController: AbortController;\n\n  public constructor(args: BlockLoaderArgs) {\n    this.source = args.source;\n    this.start = args.start;\n    this.end = args.end;\n    this.maxCacheSize = args.cacheSizeBytes;\n    this.problemManager = args.problemManager;\n    this.abortController = new AbortController();\n\n    const totalNs = Number(toNanoSec(subtractTimes(this.end, this.start))) + 1; // +1 since times are inclusive.\n    if (totalNs > Number.MAX_SAFE_INTEGER * 0.9) {\n      throw new Error(\"Time range is too long to be supported\");\n    }\n\n    this.blockDurationNanos = Math.ceil(\n      Math.max(args.minBlockDurationNs, totalNs / args.maxBlocks),\n    );\n\n    const blockCount = Math.ceil(totalNs / this.blockDurationNanos);\n\n    log.debug(`Block count: ${blockCount}`);\n    this.blocks = Array.from({ length: blockCount });\n  }\n\n  public setTopics(topics: Set<string>): void {\n    if (isEqual(topics, this.topics)) {\n      return;\n    }\n\n    this.abortController.abort();\n    this.topics = topics;\n    this.activeChangeCondvar.notifyAll();\n    log.debug(`Preloaded topics: ${[...topics].join(\", \")}`);\n\n    // Update all the blocks with any missing topics\n    for (const block of this.blocks) {\n      if (block) {\n        const blockTopics = Object.keys(block.messagesByTopic);\n        const needTopics = new Set(topics);\n        for (const topic of blockTopics) {\n          needTopics.delete(topic);\n        }\n        block.needTopics = needTopics;\n      }\n    }\n  }\n\n  /**\n   * Remove topics that are no longer requested to be preloaded from blocks to free up space\n   */\n  private _removeUnusedBlockTopics(): number {\n    const topics = this.topics;\n    let totalBytesRemoved = 0;\n    for (let i = 0; i < this.blocks.length; i++) {\n      const block = this.blocks[i];\n      if (block) {\n        let blockBytesRemoved = 0;\n        const newMessagesByTopic: Record<string, MessageEvent<unknown>[]> = {\n          ...block.messagesByTopic,\n        };\n        const blockTopics = Object.keys(newMessagesByTopic);\n        for (const topic of blockTopics) {\n          // remove topics that are no longer requested to be preloaded.\n          if (!topics.has(topic) && newMessagesByTopic[topic]) {\n            for (const msg of newMessagesByTopic[topic]!) {\n              blockBytesRemoved += msg.sizeInBytes;\n            }\n            delete newMessagesByTopic[topic];\n          }\n        }\n        if (blockBytesRemoved > 0) {\n          this.blocks[i] = {\n            ...block,\n            messagesByTopic: newMessagesByTopic,\n            sizeInBytes: block.sizeInBytes - blockBytesRemoved,\n          };\n          totalBytesRemoved += blockBytesRemoved;\n        }\n      }\n    }\n    return totalBytesRemoved;\n  }\n\n  public async stopLoading(): Promise<void> {\n    log.debug(\"Stop loading blocks\");\n    this.stopped = true;\n    this.activeChangeCondvar.notifyAll();\n  }\n\n  public async startLoading(args: LoadArgs): Promise<void> {\n    log.debug(\"Start loading process\");\n    this.stopped = false;\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    while (!this.stopped) {\n      this.abortController = new AbortController();\n\n      const topics = this.topics;\n\n      await this.load({ progress: args.progress });\n\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (this.stopped) {\n        break;\n      }\n\n      // Wait for topics to possibly change.\n      if (this.topics === topics) {\n        await this.activeChangeCondvar.wait();\n      }\n    }\n  }\n\n  private async load(args: { progress: LoadArgs[\"progress\"] }): Promise<void> {\n    const topics = this.topics;\n\n    // Ignore changing the blocks if the topic list is empty\n    if (topics.size === 0) {\n      args.progress(this.calculateProgress(topics));\n      return;\n    }\n\n    if (this.blocks.length === 0) {\n      return;\n    }\n\n    log.debug(\"loading blocks\", { topics });\n    const beginBlockId = 0;\n    const lastBlockId = this.blocks.length;\n\n    const { progress } = args;\n    let totalBlockSizeBytes = this.cacheSize();\n\n    for (let blockId = beginBlockId; blockId < lastBlockId; ++blockId) {\n      // Topics we will fetch for this range\n      let topicsToFetch = new Set<string>();\n\n      // Keep looking for a block that needs loading\n      {\n        const existingBlock = this.blocks[blockId];\n\n        // The current block has everything, so we can move to the next block\n        if (existingBlock?.needTopics.size === 0) {\n          continue;\n        }\n\n        // The current block needs some topics so those will be come the topics we need to fetch\n        topicsToFetch = existingBlock?.needTopics ?? topics;\n      }\n\n      // blockId is the first block that needs loading\n      // Now we look for the last block. We do this by finding blocks that need the same topics to fetch.\n      // This creates a continuous span of the same topics to fetch\n      let endBlockId = blockId;\n      for (let endIdx = blockId + 1; endIdx < this.blocks.length; ++endIdx) {\n        const nextBlock = this.blocks[endIdx];\n\n        const needTopics = nextBlock?.needTopics ?? topics;\n\n        // if needtopics is undefined cause there's no block, then needTopics is all topics\n\n        // The topics we need to fetch no longer match the topics we need so we stop the range\n        if (!isEqual(topicsToFetch, needTopics)) {\n          break;\n        }\n\n        endBlockId = endIdx;\n      }\n\n      const cursorStartTime = this.blockIdToStartTime(blockId);\n      const cursorEndTime = clampTime(this.blockIdToEndTime(endBlockId), this.start, this.end);\n\n      const iteratorArgs: MessageIteratorArgs = {\n        topics: Array.from(topicsToFetch),\n        start: cursorStartTime,\n        end: cursorEndTime,\n        consumptionType: \"full\",\n      };\n\n      // If the source provides a message cursor we use its message cursor, otherwise we make one\n      // using the source's message iterator.\n      const cursor =\n        this.source.getMessageCursor?.({ ...iteratorArgs, abort: this.abortController.signal }) ??\n        new IteratorCursor(this.source.messageIterator(iteratorArgs), this.abortController.signal);\n\n      for (let currentBlockId = blockId; currentBlockId <= endBlockId; ++currentBlockId) {\n        const untilTime = clampTime(this.blockIdToEndTime(currentBlockId), this.start, this.end);\n\n        const results = await cursor.readUntil(untilTime);\n        // No results means cursor aborted or eof\n        if (!results) {\n          return;\n        }\n\n        const messagesByTopic: Record<string, MessageEvent<unknown>[]> = {};\n\n        // Set all topics to empty arrays. Since our cursor requested all the topicsToFetch we either will\n        // have message on the topic or we don't have message on the topic. Either way the topic entry\n        // starts as an empty array.\n        for (const topic of topicsToFetch) {\n          messagesByTopic[topic] = [];\n        }\n\n        // Empty result set does not require further processing and does not change the size\n        if (results.length === 0) {\n          const existingBlock = this.blocks[currentBlockId];\n          this.blocks[currentBlockId] = {\n            needTopics: new Set(),\n            messagesByTopic: {\n              ...existingBlock?.messagesByTopic,\n              // Any new topics override the same previous topic\n              ...messagesByTopic,\n            },\n            sizeInBytes: existingBlock?.sizeInBytes ?? 0,\n          };\n          continue;\n        }\n\n        let sizeInBytes = 0;\n        for (const iterResult of results) {\n          if (iterResult.type === \"problem\") {\n            this.problemManager.addProblem(`connid-${iterResult.connectionId}`, iterResult.problem);\n            continue;\n          }\n\n          if (iterResult.type !== \"message-event\") {\n            continue;\n          }\n\n          const msgTopic = iterResult.msgEvent.topic;\n          const arr = messagesByTopic[msgTopic];\n\n          // Because we initialized all the topicsToFetch earlier we expect to have an array for each message\n          // topic in our results. If we don't, thats a problem.\n          const problemKey = `unexpected-topic-${msgTopic}`;\n          if (!arr) {\n            this.problemManager.addProblem(problemKey, {\n              severity: \"error\",\n              message: `Received a message on an unexpected topic: ${msgTopic}.`,\n            });\n\n            continue;\n          }\n          this.problemManager.removeProblem(problemKey);\n\n          const messageSizeInBytes = iterResult.msgEvent.sizeInBytes;\n          totalBlockSizeBytes += messageSizeInBytes;\n          arr.push(iterResult.msgEvent);\n\n          sizeInBytes += messageSizeInBytes;\n\n          if (totalBlockSizeBytes < this.maxCacheSize) {\n            this.problemManager.removeProblem(\"cache-full\");\n            continue;\n          }\n          // cache over capacity, try removing unused topics\n          const removedSize = this._removeUnusedBlockTopics();\n          totalBlockSizeBytes -= removedSize;\n          if (totalBlockSizeBytes > this.maxCacheSize) {\n            this.problemManager.addProblem(\"cache-full\", {\n              severity: \"error\",\n              message: `Cache is full. Preloading for topics [${Array.from(topicsToFetch).join(\n                \", \",\n              )}] has stopped on block ${currentBlockId + 1}/${this.blocks.length}.`,\n              tip: \"Try reducing the number of topics that require preloading at a given time (e.g. in plots), or try to reduce the time range of the file.\",\n            });\n            return;\n          }\n        }\n\n        const existingBlock = this.blocks[currentBlockId];\n        this.blocks[currentBlockId] = {\n          needTopics: new Set(),\n          messagesByTopic: {\n            ...existingBlock?.messagesByTopic,\n            // Any new topics override the same previous topic\n            ...messagesByTopic,\n          },\n          sizeInBytes: (existingBlock?.sizeInBytes ?? 0) + sizeInBytes,\n        };\n\n        progress(this.calculateProgress(topics));\n      }\n\n      await cursor.end();\n      blockId = endBlockId + 1;\n    }\n  }\n\n  private calculateProgress(topics: Set<string>): Progress {\n    const fullyLoadedFractionRanges = simplify(\n      filterMap(this.blocks, (thisBlock, blockIndex) => {\n        if (!thisBlock) {\n          return;\n        }\n\n        for (const topic of topics) {\n          if (!thisBlock.messagesByTopic[topic]) {\n            return;\n          }\n        }\n\n        return {\n          start: blockIndex,\n          end: blockIndex + 1,\n        };\n      }),\n    );\n\n    return {\n      fullyLoadedFractionRanges: fullyLoadedFractionRanges.map((range) => ({\n        // Convert block ranges into fractions.\n        start: range.start / this.blocks.length,\n        end: range.end / this.blocks.length,\n      })),\n      messageCache: {\n        blocks: this.blocks.slice(),\n        startTime: this.start,\n      },\n    };\n  }\n\n  private cacheSize(): number {\n    return this.blocks.reduce((prev, block) => {\n      if (!block) {\n        return prev;\n      }\n\n      return prev + block.sizeInBytes;\n    }, 0);\n  }\n\n  private blockIdToStartTime(id: number): Time {\n    return add(this.start, fromNanoSec(BigInt(id) * BigInt(this.blockDurationNanos)));\n  }\n\n  // The end time of a block is the start time of the next block minus 1 nanosecond\n  private blockIdToEndTime(id: number): Time {\n    return add(this.start, fromNanoSec(BigInt(id + 1) * BigInt(this.blockDurationNanos) - 1n));\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEqual, sortedIndexBy } from \"lodash\";\n\nimport { minIndexBy, sortedIndexByTuple } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport { subtract, add, toNanoSec, compare } from \"@foxglove/rostime\";\nimport { Time, MessageEvent } from \"@foxglove/studio\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\n\nimport {\n  GetBackfillMessagesArgs,\n  IIterableSource,\n  Initalization,\n  IteratorResult,\n  MessageIteratorArgs,\n} from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\n// An individual cache item represents a continuous range of CacheIteratorItems\ntype CacheBlock = {\n  // The start time of the cache item (inclusive).\n  //\n  // When reading a data source, the first message may come after the requested \"start\" time.\n  // The start field is the request start time while the first item in items would be the first message\n  // which may be after this time.\n  //\n  // The start time is <= first item time.\n  start: Time;\n\n  // The end time (inclusive) of the last message within the cache item. Similar to start, the data source\n  // may \"end\" after the last message so.\n  //\n  // The end time is >= last item time.\n  end: Time;\n\n  // Sorted cache item tuples. The first value is the timestamp of the iterator result and the second is the result.\n  items: [bigint, IteratorResult][];\n\n  // The last time this block was accessed.\n  lastAccess: number;\n\n  // The size of this block in bytes\n  size: number;\n};\n\ntype Options = {\n  maxBlockSize?: number;\n  maxTotalSize?: number;\n};\n\n/**\n * CachingIterableSource proxies access to IIterableSource through a memory buffer.\n *\n * Message reading occurs from the memory buffer containing previously read messages. If there is no\n * buffer for previously read messages, then the underlying source is used and the messages are\n * cached when read.\n */\nclass CachingIterableSource implements IIterableSource {\n  private source: IIterableSource;\n\n  // Stores which topics we have been caching. See notes at usage site for why we store this.\n  private cachedTopics: string[] = [];\n\n  // The producer loads results into the cache and the consumer reads from the cache.\n  private cache: CacheBlock[] = [];\n\n  // Cache of loaded ranges. Ranges correspond to the cache blocks and are normalized in [0, 1];\n  private loadedRangesCache: Range[] = [{ start: 0, end: 0 }];\n\n  private initResult?: Initalization;\n\n  private totalSizeBytes: number = 0;\n\n  // Maximum total cache size\n  private maxTotalSizeBytes: number;\n\n  // Maximum size per block\n  private maxBlockSizeBytes: number;\n\n  public constructor(source: IIterableSource, opt?: Options) {\n    this.source = source;\n    this.maxTotalSizeBytes = opt?.maxTotalSize ?? 1073741824; // 1GB\n    this.maxBlockSizeBytes = opt?.maxBlockSize ?? 52428800; // 50MB\n  }\n\n  public async initialize(): Promise<Initalization> {\n    this.initResult = await this.source.initialize();\n    return this.initResult;\n  }\n\n  public async terminate(): Promise<void> {\n    this.cache.length = 0;\n    this.cachedTopics.length = 0;\n  }\n\n  public loadedRanges(): Range[] {\n    return this.loadedRangesCache;\n  }\n\n  public async *messageIterator(\n    args: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> {\n    if (!this.initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    const maxEnd = args.end ?? this.initResult.end;\n    const maxEndNanos = toNanoSec(maxEnd);\n\n    const newTopics = [...args.topics].sort();\n\n    // When the list of topics we want changes we purge the entire cache and start again.\n    // This is heavy-handed but avoids dealing with how to handle disjoint cached ranges across topics.\n    if (!isEqual(newTopics, this.cachedTopics)) {\n      log.debug(\"topics changed - clearing cache, resetting range\");\n      this.cachedTopics = newTopics;\n      this.cache.length = 0;\n      this.totalSizeBytes = 0;\n      this.recomputeLoadedRangeCache();\n    }\n\n    // Where we want to read messages from. As we move through blocks and messages, the read head\n    // moves forward to track the next place we should be reading.\n    let readHead = args.start ?? this.initResult.start;\n\n    for (;;) {\n      if (compare(readHead, maxEnd) > 0) {\n        break;\n      }\n\n      const cacheBlockIndex = this.cache.findIndex((item) => {\n        return compare(item.start, readHead) <= 0 && compare(item.end, readHead) >= 0;\n      });\n\n      let block = this.cache[cacheBlockIndex];\n\n      // if the block start === end and done is false, then it could have been a new block we started but never\n      // got around to adding any messages into, we remove it.\n      if (block && compare(block.start, block.end) === 0 && block.items.length === 0) {\n        block = undefined;\n        this.cache.splice(cacheBlockIndex, 1);\n        continue;\n      }\n\n      // We've found a block containing our readHead, try reading items from the block\n      if (block) {\n        const cacheIndex = CachingIterableSource.FindStartCacheItemIndex(\n          block.items,\n          toNanoSec(readHead),\n        );\n\n        // We have a cached item, we can consume our cache until we've read to the end\n        for (let idx = cacheIndex; idx < block.items.length; ++idx) {\n          const cachedItem = block.items[idx];\n          if (!cachedItem) {\n            break;\n          }\n\n          // We may have found a cached time that is after our max iterator time.\n          // We bail with no return when that happens.\n          if (cachedItem[0] > maxEndNanos) {\n            return;\n          }\n\n          // update the last time this block was accessed\n          block.lastAccess = Date.now();\n\n          yield cachedItem[1];\n        }\n\n        // We've read all the messages cached for the block, this means our next read can start\n        // at 1 nanosecond after the end of the block because we know that block.end is inclusive\n        // of all the messages our block represents.\n        readHead = add(block.end, { sec: 0, nsec: 1 });\n        continue;\n      }\n\n      // We don't have a block for our readHead which meas we need to read from the source.\n      // We start reading from the source where the readHead is. We end reading from the source\n      // where the next block starts (or source.end if there is no next block)\n\n      // The block (and source) will start at the read head\n      const sourceReadStart = readHead;\n\n      // Look for the block that comes after our read head\n      const nextBlockIndex = this.cache.findIndex((item) => {\n        // Find the first index where readHead is less than an existing start\n        return compare(readHead, item.start) < 0;\n      });\n\n      // If we have a next block (this is the block ours would come before), then we only need\n      // to read up to that block.\n      const nextBlock = this.cache[nextBlockIndex];\n\n      let sourceReadEnd = nextBlock ? subtract(nextBlock.start, { sec: 0, nsec: 1 }) : maxEnd;\n\n      if (compare(sourceReadStart, sourceReadEnd) > 0) {\n        throw new Error(\"Invariant: sourceReadStart > sourceReadEnd\");\n      }\n\n      // When reading for our message iterator, we might have a nextBlock that starts\n      // after the end time we want to read. This limits our reading to the end time of the iterator.\n      if (compare(sourceReadEnd, maxEnd) > 0) {\n        sourceReadEnd = maxEnd;\n      }\n\n      const sourceMessageIterator = this.source.messageIterator({\n        topics: this.cachedTopics,\n        start: sourceReadStart,\n        end: sourceReadEnd,\n        consumptionType: args.consumptionType,\n      });\n\n      // The cache is indexed on time, but iterator results that are problems might not have a time.\n      // For these we use the lastTime that we knew about (or had a message for).\n      // This variable tracks the last known time from a read.\n      let lastTime = toNanoSec(sourceReadStart);\n\n      const pendingIterResults: [bigint, IteratorResult][] = [];\n\n      for await (const iterResult of sourceMessageIterator) {\n        // if there is no block, we make a new block\n        if (!block) {\n          const newBlock: CacheBlock = {\n            start: readHead,\n            end: readHead,\n            items: [],\n            size: 0,\n            lastAccess: Date.now(),\n          };\n\n          // Find where we need to insert our new block.\n          // It should come before any blocks with a start time > than new block start time.\n          const insertIndex = sortedIndexBy(this.cache, newBlock, (item) => toNanoSec(item.start));\n          this.cache.splice(insertIndex, 0, newBlock);\n\n          block = newBlock;\n          this.recomputeLoadedRangeCache();\n        }\n\n        // When receiving a message event or stamp, we update our known time on the block to the\n        // stamp or receiveTime because we know we've received all the results up to this time\n        if (iterResult.type === \"message-event\" || iterResult.type === \"stamp\") {\n          const receiveTime =\n            iterResult.type === \"stamp\" ? iterResult.stamp : iterResult.msgEvent.receiveTime;\n          const receiveTimeNs = toNanoSec(receiveTime);\n\n          // There might be multiple messages at the same time, and since block end time\n          // is inclusive we only update the end time once we've moved to the next time\n          if (receiveTimeNs > lastTime) {\n            // write any pending messages to the block\n            for (const pendingIterResult of pendingIterResults) {\n              const item = pendingIterResult[1];\n              const pendingSizeInBytes =\n                item.type === \"message-event\" ? item.msgEvent.sizeInBytes : 0;\n              block.items.push(pendingIterResult);\n              block.size += pendingSizeInBytes;\n            }\n\n            pendingIterResults.length = 0;\n\n            // update the last time this block was accessed\n            block.lastAccess = Date.now();\n\n            // Set the end time to 1 nanosecond before the current receive time since we know we've\n            // read up to this receive time.\n            block.end = subtract(receiveTime, { sec: 0, nsec: 1 });\n\n            lastTime = receiveTimeNs;\n            this.recomputeLoadedRangeCache();\n          }\n        }\n\n        // Block is too big so we close it and will start a new one next loop\n        if (block.size >= this.maxBlockSizeBytes) {\n          // The new block starts right after our previous one\n          readHead = add(block.end, { sec: 0, nsec: 1 });\n\n          // Will force creation of a new block on the next loop\n          block = undefined;\n        }\n\n        const sizeInBytes =\n          iterResult.type === \"message-event\" ? iterResult.msgEvent.sizeInBytes : 0;\n        if (this.maybePurgeCache({ activeBlock: block, sizeInBytes })) {\n          this.recomputeLoadedRangeCache();\n        }\n\n        // As we add items to pending we also consider them as part of the total size\n        this.totalSizeBytes += sizeInBytes;\n\n        // Store the latest message in pending results and flush to the block when time moves forward\n        pendingIterResults.push([lastTime, iterResult]);\n\n        yield iterResult;\n      }\n\n      // We've finished reading our source to the end, close out the block\n      if (block) {\n        block.end = sourceReadEnd;\n\n        // update the last time this block was accessed\n        block.lastAccess = Date.now();\n\n        // write any pending messages to the block\n        for (const pendingIterResult of pendingIterResults) {\n          const item = pendingIterResult[1];\n          const pendingSizeInBytes = item.type === \"message-event\" ? item.msgEvent.sizeInBytes : 0;\n          block.items.push(pendingIterResult);\n          block.size += pendingSizeInBytes;\n        }\n\n        this.recomputeLoadedRangeCache();\n      } else {\n        // We don't have a block after finishing our source. This can happen if the last\n        // thing we read in the source made our block be over size and we cycled to a new block.\n        // This can also happen if there were no messages in our source range.\n        //\n        // Since we never loop again we need to insert an empty block from the readHead\n        // to sourceReadEnd because we know there's nothing else in that range.\n        const newBlock: CacheBlock = {\n          start: readHead,\n          end: sourceReadEnd,\n          items: pendingIterResults,\n          size: 0,\n          lastAccess: Date.now(),\n        };\n\n        for (const pendingIterResult of pendingIterResults) {\n          const item = pendingIterResult[1];\n          const pendingSizeInBytes = item.type === \"message-event\" ? item.msgEvent.sizeInBytes : 0;\n          newBlock.size += pendingSizeInBytes;\n        }\n\n        // Find where we need to insert our new block.\n        // It should come before any blocks with a start time > than new block start time.\n        const insertIndex = sortedIndexBy(this.cache, newBlock, (item) => toNanoSec(item.start));\n        this.cache.splice(insertIndex, 0, newBlock);\n\n        this.recomputeLoadedRangeCache();\n      }\n\n      // We've read everything there was to read for this source, so our next read will be after\n      // the end of this source\n      readHead = add(sourceReadEnd, { sec: 0, nsec: 1 });\n    }\n  }\n\n  public async getBackfillMessages(\n    args: GetBackfillMessagesArgs,\n  ): Promise<MessageEvent<unknown>[]> {\n    if (!this.initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    // Find a block that contains args.time. We must find a block that contains args.time rather\n    // than one that occurs anytime before args.time to correctly get the last message before\n    // args.time rather than any message that occurs before args.time.\n    const cacheBlockIndex = this.cache.findIndex((item) => {\n      return compare(item.start, args.time) <= 0 && compare(item.end, args.time) >= 0;\n    });\n\n    const out: MessageEvent<unknown>[] = [];\n    const needsTopics = new Set(args.topics);\n\n    // Starting at the block we found for args.time, work backwards through blocks until:\n    // * we've loaded all the topics\n    // * we have a gap between our block and the previous block\n    //\n    // We must stop going backwards when we have a gap because we can no longer know if the source\n    // actually does have messages in the gap.\n    for (let idx = cacheBlockIndex; idx >= 0 && needsTopics.size > 0; --idx) {\n      const cacheBlock = this.cache[idx];\n      if (!cacheBlock) {\n        break;\n      }\n\n      const targetTime = toNanoSec(args.time);\n      let readIdx = sortedIndexByTuple(cacheBlock.items, targetTime);\n\n      // If readIdx is negative then we don't have an exact match, but readIdx does tell us what that is\n      // See the findCacheItem documentation for how to interpret it.\n      if (readIdx < 0) {\n        readIdx = ~readIdx;\n\n        // readIdx will point to the element after our time (or 1 past the end of the array)\n        // We subtract 1 to start reading from before that element or end of array\n        readIdx -= 1;\n      } else {\n        // When readIdx is an exact match we get a positive value. For an exact match we traverse\n        // forward linearly to find the last occurrence of the matching timestamp in our cache\n        // block. We can then read backwards in the block to find the last messages on all requested\n        // topics.\n        for (let i = readIdx + 1; i < cacheBlock.items.length; ++i) {\n          if (cacheBlock.items[i]?.[0] !== targetTime) {\n            break;\n          }\n          readIdx = i;\n        }\n      }\n\n      for (let i = readIdx; i >= 0; --i) {\n        const record = cacheBlock.items[i];\n        if (!record || record[1].type !== \"message-event\") {\n          continue;\n        }\n\n        const msgEvent = record[1].msgEvent;\n        if (needsTopics.has(msgEvent.topic)) {\n          needsTopics.delete(msgEvent.topic);\n          out.push(msgEvent);\n        }\n      }\n\n      const prevBlock = this.cache[idx - 1];\n      // If we have a gap between the start of our block and the previous block, then we must stop\n      // trying to read from the block cache\n      if (prevBlock && compare(add(prevBlock.end, { sec: 0, nsec: 1 }), cacheBlock.start) !== 0) {\n        break;\n      }\n    }\n\n    // If we found all our topics from our cache then we don't need to fallback to the source\n    if (needsTopics.size === 0) {\n      return out;\n    }\n\n    // fallback to the source for any topics we weren't able to load\n    const sourceBackfill = await this.source.getBackfillMessages({\n      ...args,\n      topics: Array.from(needsTopics),\n    });\n\n    out.push(...sourceBackfill);\n    out.sort((a, b) => compare(a.receiveTime, b.receiveTime));\n\n    return out;\n  }\n\n  private recomputeLoadedRangeCache(): void {\n    if (!this.initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    // The nanosecond time of the start of the source\n    const sourceStartNs = toNanoSec(this.initResult.start);\n\n    const rangeNs = Number(toNanoSec(subtract(this.initResult.end, this.initResult.start)));\n    if (rangeNs === 0) {\n      this.loadedRangesCache = [{ start: 0, end: 1 }];\n      return;\n    }\n\n    if (this.cache.length === 0) {\n      this.loadedRangesCache = [{ start: 0, end: 0 }];\n      return;\n    }\n\n    // Merge continuous ranges (i.e. a block that starts 1 nanosecond after previous ends)\n    // This avoids float rounding errors when computing loadedRangesCache and produces\n    // continuous ranges for continuous spans\n    const ranges: { start: number; end: number }[] = [];\n    let prevRange: { start: bigint; end: bigint } | undefined;\n    for (const block of this.cache) {\n      const range = {\n        start: toNanoSec(block.start),\n        end: toNanoSec(block.end),\n      };\n      if (!prevRange) {\n        prevRange = range;\n      } else if (prevRange.end + 1n === range.start) {\n        prevRange.end = range.end;\n      } else {\n        ranges.push({\n          start: Number(prevRange.start - sourceStartNs) / rangeNs,\n          end: Number(prevRange.end - sourceStartNs) / rangeNs,\n        });\n        prevRange = range;\n      }\n    }\n    if (prevRange) {\n      ranges.push({\n        start: Number(prevRange.start - sourceStartNs) / rangeNs,\n        end: Number(prevRange.end - sourceStartNs) / rangeNs,\n      });\n    }\n\n    this.loadedRangesCache = ranges;\n  }\n\n  // Purge the oldest cache block if adding sizeInBytes to the cache would exceed the maxTotalSizeBytes\n  // @return true if a block was purged\n  //\n  // Throws if the cache block we want to purge is the active block.\n  private maybePurgeCache(opt: { activeBlock?: CacheBlock; sizeInBytes: number }): boolean {\n    const { activeBlock, sizeInBytes } = opt;\n\n    // Determine if our total size would exceed max and purge the oldest block\n    if (this.totalSizeBytes + sizeInBytes <= this.maxTotalSizeBytes) {\n      return false;\n    }\n\n    // Find the oldest cache item\n    const oldestIdx = minIndexBy(this.cache, (a, b) => a.lastAccess - b.lastAccess);\n\n    const oldestBlock = this.cache[oldestIdx];\n    if (oldestBlock) {\n      if (oldestBlock === activeBlock) {\n        throw new Error(\"Cannot evict the active cache block.\");\n      }\n      this.totalSizeBytes -= oldestBlock.size;\n      this.cache.splice(oldestIdx, 1);\n      return true;\n    }\n\n    return false;\n  }\n\n  private static FindStartCacheItemIndex(items: [bigint, IteratorResult][], key: bigint) {\n    // A common case is to access consecutive blocks during playback. In that case, we expect to\n    // read from the first item in the block. We check this special case first to avoid a binary\n    // search if we are able to find the key in the first item.\n    if (items[0] != undefined && items[0][0] >= key) {\n      return 0;\n    }\n\n    let idx = sortedIndexByTuple(items, key);\n    if (idx < 0) {\n      return ~idx;\n    }\n\n    // An exact match just means we've found a matching item, not necessarily the first or last\n    // matching item. We want the first item so we linearly iterate backwards until we no longer have\n    // a match.\n    for (let i = idx - 1; i >= 0; --i) {\n      const prevItem = items[i];\n      if (prevItem != undefined && prevItem[0] !== key) {\n        break;\n      }\n      idx = i;\n    }\n\n    return idx;\n  }\n}\n\nexport { CachingIterableSource };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Condvar } from \"@foxglove/den/async\";\nimport { VecQueue } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport { add as addTime, compare, clampTime } from \"@foxglove/rostime\";\nimport { Time, MessageEvent } from \"@foxglove/studio\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\n\nimport { CachingIterableSource } from \"./CachingIterableSource\";\nimport {\n  GetBackfillMessagesArgs,\n  IIterableSource,\n  Initalization,\n  IteratorResult,\n  MessageIteratorArgs,\n} from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\nconst DEFAULT_READ_AHEAD_DURATION = { sec: 10, nsec: 0 };\n\ntype Options = {\n  // How far ahead to buffer\n  readAheadDuration?: Time;\n};\n\n/**\n * BufferedIterableSource proxies access to IIterableSource. It buffers the messageIterator by\n * reading ahead in the underlying source.\n *\n * The architecture of BufferedIterableSource follows a producer-consumer model. The messageIterator\n * is the consumer and reads messages from cache while the startProducer method produces messages by\n * reading from the underlying source and populating the cache.\n */\nclass BufferedIterableSource implements IIterableSource {\n  private source: CachingIterableSource;\n\n  private readDone = false;\n  private aborted = false;\n\n  // The producer uses this signal to notify a waiting consumer there is data to consume.\n  private readSignal = new Condvar();\n\n  // The consumer uses this signal to notify a waiting producer that something has been consumed.\n  private writeSignal = new Condvar();\n\n  // The producer loads results into the cache and the consumer reads from the cache.\n  private cache = new VecQueue<IteratorResult>();\n\n  // The location of the consumer read head\n  private readHead: Time = { sec: 0, nsec: 0 };\n\n  // The promise for the current producer. The message generator starts a producer and awaits the\n  // producer before exiting.\n  private producer?: Promise<void>;\n\n  private initResult?: Initalization;\n\n  // How far ahead of the read head we should try to keep buffering\n  private readAheadDuration: Time;\n\n  public constructor(source: IIterableSource, opt?: Options) {\n    this.readAheadDuration = opt?.readAheadDuration ?? DEFAULT_READ_AHEAD_DURATION;\n    this.source = new CachingIterableSource(source);\n  }\n\n  public async initialize(): Promise<Initalization> {\n    this.initResult = await this.source.initialize();\n    return this.initResult;\n  }\n\n  private async startProducer(args: MessageIteratorArgs): Promise<void> {\n    if (!this.initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    if (args.topics.length === 0) {\n      this.readDone = true;\n      return;\n    }\n\n    log.debug(\"Starting producer\");\n\n    // Clear the cache and start producing into an empty array, the consumer removes elements from\n    // the start of the array.\n    this.cache.clear();\n\n    try {\n      const sourceIterator = this.source.messageIterator({\n        topics: args.topics,\n        start: this.readHead,\n        consumptionType: \"partial\",\n      });\n\n      // Messages are read from the source until reaching the readUntil time. Then we wait for the read head\n      // to move forward and adjust readUntil\n      let readUntil = clampTime(\n        addTime(this.readHead, this.readAheadDuration),\n        this.initResult.start,\n        this.initResult.end,\n      );\n\n      for await (const result of sourceIterator) {\n        if (this.aborted) {\n          return;\n        }\n\n        // Update the target readUntil to be ahead of the latest readHead\n        //\n        // Since reading a result from the iterator is async, we update the readUntil after we have\n        // the result so we can have the latest readHead\n        readUntil = addTime(this.readHead, this.readAheadDuration);\n\n        // When receiving a stamp result we enqueue the result into the cache and notify a reader.\n        if (result.type === \"stamp\" && compare(result.stamp, readUntil) >= 0) {\n          // Continue to wait until our stamp time surpasses the readUntil and we know that\n          // we should read more data.\n          while (compare(result.stamp, readUntil) >= 0) {\n            // The producer may have aborted while we are waiting for the read head to progress\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n            if (this.aborted) {\n              return;\n            }\n\n            // enqueue the stamp and wakeup the reader\n            // but the reader might not be reading - cause it is not being read from\n            this.cache.enqueue(result);\n            this.readSignal.notifyAll();\n\n            await this.writeSignal.wait();\n            readUntil = addTime(this.readHead, this.readAheadDuration);\n          }\n          continue;\n        }\n\n        this.cache.enqueue(result);\n\n        // Indicate to the consumer that it can try reading again\n        this.readSignal.notifyAll();\n\n        // Keep reading while the messages we receive are <= the readUntil time.\n        if (\n          result.type === \"message-event\" &&\n          compare(result.msgEvent.receiveTime, readUntil) <= 0\n        ) {\n          continue;\n        }\n\n        // If we didn't load anything into the cache keep reading\n        if (this.cache.size() === 0) {\n          continue;\n        }\n\n        // Wait for consumer thread to read something before trying to load more data\n        await this.writeSignal.wait();\n      }\n    } finally {\n      // Indicate to the consumer that it can try reading again\n      this.readSignal.notifyAll();\n      this.readDone = true;\n    }\n\n    log.debug(\"producer done\");\n  }\n\n  public async terminate(): Promise<void> {\n    this.cache.clear();\n    await this.source.terminate();\n  }\n\n  public async stopProducer(): Promise<void> {\n    log.debug(\"Stopping producer\");\n    this.aborted = true;\n    this.writeSignal.notifyAll();\n    await this.producer;\n    this.producer = undefined;\n  }\n\n  public loadedRanges(): Range[] {\n    return this.source.loadedRanges();\n  }\n\n  public messageIterator(\n    args: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> {\n    if (!this.initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    if (this.producer) {\n      throw new Error(\"Invariant: BufferedIterableSource allows only one messageIterator\");\n    }\n\n    const start = args.start ?? this.initResult.start;\n\n    // Setup the initial cacheUntilTime to start buffing data\n    this.readHead = start;\n\n    this.aborted = false;\n    this.readDone = false;\n\n    // Create and start the producer when the messageIterator function is called.\n    this.producer = this.startProducer(args);\n\n    // Rather than messageIterator itself being a generator, we return a generator function. This is\n    // so the setup code above will run when the messageIterator is called rather than when .next()\n    // is called the first time. This behavior is important because we want the producer to start\n    // producing immediately.\n    //\n    // Alias `this` to `self` for use in the generator function because we can't make fat-arrow\n    // generator functions\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const self = this;\n    return (async function* bufferedIterableGenerator() {\n      try {\n        if (args.topics.length === 0) {\n          return;\n        }\n\n        for (;;) {\n          const item = self.cache.dequeue();\n          if (!item) {\n            if (self.readDone) {\n              break;\n            }\n\n            // Wait for more stuff to load\n            await self.readSignal.wait();\n            continue;\n          }\n\n          if (item.type === \"stamp\") {\n            self.readHead = item.stamp;\n          }\n\n          // When there is a new message update the readHead for the producer to know where we are\n          // currently reading\n          if (item.type === \"message-event\") {\n            self.readHead = item.msgEvent.receiveTime;\n          }\n\n          // Notify the producer thread that it can load more data. Since our producer and consumer are on the same _thread_\n          // this notification is picked up on the next tick.\n          self.writeSignal.notifyAll();\n\n          yield item;\n        }\n      } finally {\n        log.debug(\"ending buffered message iterator\");\n        await self.stopProducer();\n      }\n    })();\n  }\n\n  public async getBackfillMessages(\n    args: GetBackfillMessagesArgs,\n  ): Promise<MessageEvent<unknown>[]> {\n    return await this.source.getBackfillMessages(args);\n  }\n}\n\nexport { BufferedIterableSource };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEqual } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport {\n  Time,\n  add,\n  compare,\n  clampTime,\n  fromMillis,\n  fromNanoSec,\n  toString,\n  toRFC3339String,\n} from \"@foxglove/rostime\";\nimport { MessageEvent, ParameterValue } from \"@foxglove/studio\";\nimport NoopMetricsCollector from \"@foxglove/studio-base/players/NoopMetricsCollector\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  Player,\n  PlayerMetricsCollectorInterface,\n  PlayerState,\n  Progress,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  PlayerPresence,\n  PlayerCapabilities,\n  TopicStats,\n  PlayerStateActiveData,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport delay from \"@foxglove/studio-base/util/delay\";\n\nimport { BlockLoader } from \"./BlockLoader\";\nimport { BufferedIterableSource } from \"./BufferedIterableSource\";\nimport { IIterableSource, IteratorResult } from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\n// Number of bytes that we aim to keep in the cache.\n// Setting this to higher than 1.5GB caused the renderer process to crash on linux.\n// See: https://github.com/foxglove/studio/pull/1733\nconst DEFAULT_CACHE_SIZE_BYTES = 1.0e9;\n\n// Amount to wait until panels have had the chance to subscribe to topics before\n// we start playback\nconst START_DELAY_MS = 100;\n\n// Messages are laid out in blocks with a fixed number of milliseconds.\nconst MIN_MEM_CACHE_BLOCK_SIZE_NS = 0.1e9;\n\n// Original comment from webviz:\n// Preloading algorithms slow when there are too many blocks.\n// Adaptive block sizing is simpler than using a tree structure for immutable updates but\n// less flexible, so we may want to move away from a single-level block structure in the future.\nconst MAX_BLOCKS = 400;\n\n// Amount to seek into the data source from the start when loading the player. The purpose of this\n// is to provide some initial data to subscribers.\nconst SEEK_ON_START_NS = BigInt(99 * 1e6);\n\ntype IterablePlayerOptions = {\n  metricsCollector?: PlayerMetricsCollectorInterface;\n\n  source: IIterableSource;\n\n  // Optional player name\n  name?: string;\n\n  // Optional set of key/values to store with url handling\n  urlParams?: Record<string, string>;\n\n  // Source identifier used in constructing state urls.\n  sourceId: string;\n\n  isSampleDataSource?: boolean;\n\n  // Set to _false_ to disable preloading. (default: true)\n  enablePreload?: boolean;\n};\n\ntype IterablePlayerState =\n  | \"preinit\"\n  | \"initialize\"\n  | \"start-play\"\n  | \"idle\"\n  | \"seek-backfill\"\n  | \"play\"\n  | \"close\"\n  | \"reset-playback-iterator\";\n\n/**\n * IterablePlayer implements the Player interface for IIterableSource instances.\n *\n * The iterable player reads messages from an IIterableSource. The player is implemented as a state\n * machine. Each state runs until it finishes. A request to change state is handled by each state\n * detecting that there is another state waiting and cooperatively ending itself.\n */\nexport class IterablePlayer implements Player {\n  private _urlParams?: Record<string, string>;\n  private _name?: string;\n  private _nextState?: IterablePlayerState;\n  private _state: IterablePlayerState = \"preinit\";\n  private _runningState: boolean = false;\n\n  private _isPlaying: boolean = false;\n  private _listener?: (playerState: PlayerState) => Promise<void>;\n  private _speed: number = 1.0;\n  private _start?: Time;\n  private _end?: Time;\n  private _enablePreload = true;\n\n  // next read start time indicates where to start reading for the next tick\n  // after a tick read, it is set to 1nsec past the end of the read operation (preparing for the next tick)\n  private _lastTickMillis?: number;\n  // This is the \"lastSeekTime\" emitted in the playerState. This indicates the emit is due to a seek.\n  private _lastSeekEmitTime: number = Date.now();\n\n  private _providerTopics: Topic[] = [];\n  private _providerTopicStats = new Map<string, TopicStats>();\n  private _providerDatatypes: RosDatatypes = new Map();\n\n  private _capabilities: string[] = [\n    PlayerCapabilities.setSpeed,\n    PlayerCapabilities.playbackControl,\n  ];\n  private _profile: string | undefined;\n  private _metricsCollector: PlayerMetricsCollectorInterface;\n  private _subscriptions: SubscribePayload[] = [];\n  private _allTopics: Set<string> = new Set();\n  private _preloadTopics: Set<string> = new Set();\n\n  private _progress: Progress = {};\n  private _id: string = uuidv4();\n  private _messages: MessageEvent<unknown>[] = [];\n  private _receivedBytes: number = 0;\n  private _hasError = false;\n  private _lastRangeMillis?: number;\n  private _lastMessageEvent?: MessageEvent<unknown>;\n  private _lastStamp?: Time;\n  private _publishedTopics = new Map<string, Set<string>>();\n  private _seekTarget?: Time;\n  private _presence = PlayerPresence.INITIALIZING;\n\n  // To keep reference equality for downstream user memoization cache the currentTime provided in the last activeData update\n  // See additional comments below where _currentTime is set\n  private _currentTime?: Time;\n\n  private _problemManager = new PlayerProblemManager();\n\n  private _iterableSource: IIterableSource;\n  private _bufferedSource: BufferedIterableSource;\n\n  // Some states register an abort controller to signal they should abort\n  private _abort?: AbortController;\n\n  // The iterator for reading messages during playback\n  private _playbackIterator?: AsyncIterator<Readonly<IteratorResult>>;\n\n  private _blockLoader?: BlockLoader;\n  private _blockLoadingProcess?: Promise<void>;\n\n  private _queueEmitState: ReturnType<typeof debouncePromise>;\n\n  private readonly _sourceId: string;\n\n  private _untilTime?: Time;\n\n  public constructor(options: IterablePlayerOptions) {\n    const { metricsCollector, urlParams, source, name, enablePreload, sourceId } = options;\n\n    this._iterableSource = source;\n    this._bufferedSource = new BufferedIterableSource(source);\n    this._name = name;\n    this._urlParams = urlParams;\n    this._metricsCollector = metricsCollector ?? new NoopMetricsCollector();\n    this._metricsCollector.playerConstructed();\n    this._enablePreload = enablePreload ?? true;\n    this._sourceId = sourceId;\n\n    // Wrap emitStateImpl in a debouncePromise for our states to call. Since we can emit from states\n    // or from block loading updates we use debouncePromise to guard against concurrent emits.\n    this._queueEmitState = debouncePromise(this._emitStateImpl.bind(this));\n  }\n\n  public setListener(listener: (playerState: PlayerState) => Promise<void>): void {\n    if (this._listener) {\n      throw new Error(\"Cannot setListener again\");\n    }\n    this._listener = listener;\n    this._setState(\"initialize\");\n  }\n\n  public startPlayback(): void {\n    this.startPlayImpl();\n  }\n\n  public playUntil(time: Time): void {\n    this.startPlayImpl({ untilTime: time });\n  }\n\n  private startPlayImpl(opt?: { untilTime: Time }): void {\n    if (this._isPlaying || this._untilTime || !this._start || !this._end) {\n      return;\n    }\n\n    if (opt?.untilTime) {\n      if (this._currentTime && compare(opt.untilTime, this._currentTime) <= 0) {\n        throw new Error(\"Invariant: playUntil time must be after the current time\");\n      }\n      this._untilTime = clampTime(opt.untilTime, this._start, this._end);\n    }\n    this._metricsCollector.play(this._speed);\n    this._isPlaying = true;\n\n    // If we are idling we can start playing, if we have a next state queued we let that state\n    // finish and it will see that we should be playing\n    if (this._state === \"idle\" && (!this._nextState || this._nextState === \"idle\")) {\n      this._setState(\"play\");\n    }\n  }\n\n  public pausePlayback(): void {\n    if (!this._isPlaying) {\n      return;\n    }\n    this._metricsCollector.pause();\n    // clear out last tick millis so we don't read a huge chunk when we unpause\n    this._lastTickMillis = undefined;\n    this._isPlaying = false;\n    this._untilTime = undefined;\n    if (this._state === \"play\") {\n      this._setState(\"idle\");\n    }\n  }\n\n  public setPlaybackSpeed(speed: number): void {\n    delete this._lastRangeMillis;\n    this._speed = speed;\n    this._metricsCollector.setSpeed(speed);\n\n    // Queue event state update to update speed in player state to UI\n    this._queueEmitState();\n  }\n\n  public seekPlayback(time: Time): void {\n    // Wait to perform seek until initialization is complete\n    if (this._state === \"preinit\" || this._state === \"initialize\") {\n      log.debug(`Ignoring seek, state=${this._state}`);\n      this._seekTarget = time;\n      return;\n    }\n\n    if (!this._start || !this._end) {\n      throw new Error(\"invariant: initialized but no start/end set\");\n    }\n\n    // Limit seek to within the valid range\n    const targetTime = clampTime(time, this._start, this._end);\n\n    // We are already seeking to this time, no need to reset seeking\n    if (this._seekTarget && compare(this._seekTarget, targetTime) === 0) {\n      log.debug(`Ignoring seek, already seeking to this time`);\n      return;\n    }\n\n    // We are already at this time, no need to reset seeking\n    if (this._currentTime && compare(this._currentTime, targetTime) === 0) {\n      log.debug(`Ignoring seek, already at this time`);\n      return;\n    }\n\n    this._metricsCollector.seek(targetTime);\n    this._seekTarget = targetTime;\n    this._untilTime = undefined;\n\n    this._setState(\"seek-backfill\");\n  }\n\n  public setSubscriptions(newSubscriptions: SubscribePayload[]): void {\n    log.debug(\"set subscriptions\", newSubscriptions);\n    this._subscriptions = newSubscriptions;\n    this._metricsCollector.setSubscriptions(newSubscriptions);\n\n    const allTopics = new Set(this._subscriptions.map((subscription) => subscription.topic));\n    const preloadTopics = new Set(\n      filterMap(this._subscriptions, (sub) =>\n        sub.preloadType !== \"partial\" ? sub.topic : undefined,\n      ),\n    );\n\n    // If there are no changes to topics there's no reason to perform a \"seek\" to trigger loading\n    if (isEqual(allTopics, this._allTopics) && isEqual(preloadTopics, this._preloadTopics)) {\n      return;\n    }\n\n    this._allTopics = allTopics;\n    this._preloadTopics = preloadTopics;\n    this._blockLoader?.setTopics(this._preloadTopics);\n\n    // If the player is playing, the playing state will detect any subscription changes and adjust\n    // iterators accordignly. However if we are idle or already seeking then we need to manually\n    // trigger the backfill.\n    if (this._state === \"idle\" || this._state === \"seek-backfill\" || this._state === \"play\") {\n      if (!this._isPlaying && this._currentTime) {\n        this._seekTarget ??= this._currentTime;\n        this._untilTime = undefined;\n\n        // Trigger a seek backfill to load any missing messages and reset the forward iterator\n        this._setState(\"seek-backfill\");\n      }\n    }\n  }\n\n  public setPublishers(_publishers: AdvertiseOptions[]): void {\n    // no-op\n  }\n\n  public setParameter(_key: string, _value: ParameterValue): void {\n    throw new Error(\"Parameter editing is not supported by this data source\");\n  }\n\n  public publish(_payload: PublishPayload): void {\n    throw new Error(\"Publishing is not supported by this data source\");\n  }\n\n  public async callService(): Promise<unknown> {\n    throw new Error(\"Service calls are not supported by this data source\");\n  }\n\n  public close(): void {\n    this._setState(\"close\");\n  }\n\n  public setGlobalVariables(): void {\n    // no-op\n  }\n\n  /** Request the state to switch to newState */\n  private _setState(newState: IterablePlayerState) {\n    log.debug(`Set next state: ${newState}`);\n    this._nextState = newState;\n    this._abort?.abort();\n    this._abort = undefined;\n    void this._runState();\n  }\n\n  /**\n   * Run the requested state while there is a state to run.\n   *\n   * Ensures that only one state is running at a time.\n   * */\n  private async _runState() {\n    if (this._runningState) {\n      return;\n    }\n\n    this._runningState = true;\n    try {\n      while (this._nextState) {\n        const state = (this._state = this._nextState);\n        this._nextState = undefined;\n\n        log.debug(`Start state: ${state}`);\n\n        // If we are going into a state other than play or idle we throw away the playback iterator since\n        // we will need to make a new one.\n        if (state !== \"idle\" && state !== \"play\" && this._playbackIterator) {\n          log.debug(\"Ending playback iterator because next state is not IDLE or PLAY\");\n          await this._playbackIterator.return?.();\n          this._playbackIterator = undefined;\n        }\n\n        switch (state) {\n          case \"preinit\":\n            this._queueEmitState();\n            break;\n          case \"initialize\":\n            await this._stateInitialize();\n            break;\n          case \"start-play\":\n            await this._stateStartPlay();\n            break;\n          case \"idle\":\n            await this._stateIdle();\n            break;\n          case \"seek-backfill\":\n            // We allow aborting requests when moving on to the next state\n            await this._stateSeekBackfill();\n            break;\n          case \"play\":\n            await this._statePlay();\n            break;\n          case \"close\":\n            await this._stateClose();\n            break;\n          case \"reset-playback-iterator\":\n            await this._stateResetPlaybackIterator();\n        }\n\n        log.debug(`Done state ${state}`);\n      }\n    } catch (err) {\n      log.error(err);\n      this._setError((err as Error).message, err);\n      this._queueEmitState();\n    } finally {\n      this._runningState = false;\n    }\n  }\n\n  private _setError(message: string, error?: Error): void {\n    this._hasError = true;\n    this._problemManager.addProblem(\"global-error\", {\n      severity: \"error\",\n      message,\n      error,\n    });\n    this._isPlaying = false;\n  }\n\n  // Initialize the source and player members\n  private async _stateInitialize(): Promise<void> {\n    // emit state indicating start of initialization\n    this._queueEmitState();\n\n    try {\n      const {\n        start,\n        end,\n        topics,\n        profile,\n        topicStats,\n        problems,\n        publishersByTopic,\n        datatypes,\n        name,\n      } = await this._bufferedSource.initialize();\n\n      // Prior to initialization, the seekTarget may have been set to an out-of-bounds value\n      // This brings the value in bounds\n      if (this._seekTarget) {\n        this._seekTarget = clampTime(this._seekTarget, start, end);\n      }\n\n      this._profile = profile;\n      this._start = start;\n      this._currentTime = this._seekTarget ?? start;\n      this._end = end;\n      this._publishedTopics = publishersByTopic;\n      this._providerDatatypes = datatypes;\n      this._name = name ?? this._name;\n\n      // Studio does not like duplicate topics or topics with different datatypes\n      // Check for duplicates or for mismatched datatypes\n      const uniqueTopics = new Map<string, Topic>();\n      for (const topic of topics) {\n        const existingTopic = uniqueTopics.get(topic.name);\n        if (existingTopic) {\n          problems.push({\n            severity: \"warn\",\n            message: `Inconsistent datatype for topic: ${topic.name}`,\n            tip: `Topic ${topic.name} has messages with multiple datatypes: ${existingTopic.schemaName}, ${topic.schemaName}. This may result in errors during visualization.`,\n          });\n          continue;\n        }\n\n        uniqueTopics.set(topic.name, topic);\n      }\n\n      this._providerTopics = Array.from(uniqueTopics.values());\n      this._providerTopicStats = topicStats;\n\n      let idx = 0;\n      for (const problem of problems) {\n        this._problemManager.addProblem(`init-problem-${idx}`, problem);\n        idx += 1;\n      }\n\n      if (this._enablePreload) {\n        // --- setup block loader which loads messages for _full_ subscriptions in the \"background\"\n        try {\n          this._blockLoader = new BlockLoader({\n            cacheSizeBytes: DEFAULT_CACHE_SIZE_BYTES,\n            source: this._iterableSource,\n            start: this._start,\n            end: this._end,\n            maxBlocks: MAX_BLOCKS,\n            minBlockDurationNs: MIN_MEM_CACHE_BLOCK_SIZE_NS,\n            problemManager: this._problemManager,\n          });\n        } catch (err) {\n          log.error(err);\n\n          const startStr = toRFC3339String(this._start);\n          const endStr = toRFC3339String(this._end);\n\n          this._problemManager.addProblem(\"block-loader\", {\n            severity: \"warn\",\n            message: \"Failed to initialize message preloading\",\n            tip: `The start (${startStr}) and end (${endStr}) of your data is too far apart.`,\n            error: err,\n          });\n        }\n      }\n\n      this._presence = PlayerPresence.PRESENT;\n    } catch (error) {\n      this._setError(`Error initializing: ${error.message}`, error);\n    }\n    this._queueEmitState();\n\n    if (!this._hasError && this._start) {\n      // Wait a bit until panels have had the chance to subscribe to topics before we start\n      // playback.\n      await delay(START_DELAY_MS);\n\n      this._blockLoader?.setTopics(this._preloadTopics);\n\n      // Block loadings is constantly running and tries to keep the preloaded messages in memory\n      this._blockLoadingProcess = this.startBlockLoading();\n\n      this._setState(\"start-play\");\n    }\n  }\n\n  private async resetPlaybackIterator() {\n    if (!this._currentTime) {\n      throw new Error(\"Invariant: Tried to reset playback iterator with no current time.\");\n    }\n\n    const next = add(this._currentTime, { sec: 0, nsec: 1 });\n\n    log.debug(\"Ending previous iterator\");\n    await this._playbackIterator?.return?.();\n\n    // set the playIterator to the seek time\n    await this._bufferedSource.stopProducer();\n\n    log.debug(\"Initializing forward iterator from\", next);\n    this._playbackIterator = this._bufferedSource.messageIterator({\n      topics: Array.from(this._allTopics),\n      start: next,\n      consumptionType: \"partial\",\n    });\n  }\n\n  private async _stateResetPlaybackIterator() {\n    if (!this._currentTime) {\n      throw new Error(\"Invariant: Tried to reset playback iterator with no current time.\");\n    }\n\n    await this.resetPlaybackIterator();\n    this._setState(this._isPlaying ? \"play\" : \"idle\");\n  }\n\n  // Read a small amount of data from the datasource with the hope of producing a message or two.\n  // Without an initial read, the user would be looking at a blank layout since no messages have yet\n  // been delivered.\n  private async _stateStartPlay() {\n    if (!this._start || !this._end) {\n      throw new Error(\"Invariant: start and end must be set\");\n    }\n\n    // If we have a target seek time, the seekPlayback function will take care of backfilling messages.\n    if (this._seekTarget) {\n      this._setState(\"seek-backfill\");\n      return;\n    }\n\n    const stopTime = clampTime(\n      add(this._start, fromNanoSec(SEEK_ON_START_NS)),\n      this._start,\n      this._end,\n    );\n\n    log.debug(`Playing from ${toString(this._start)} to ${toString(stopTime)}`);\n\n    if (this._playbackIterator) {\n      throw new Error(\"Invariant. playbackIterator was already set\");\n    }\n\n    log.debug(\"Initializing forward iterator from\", this._start);\n    this._playbackIterator = this._bufferedSource.messageIterator({\n      topics: Array.from(this._allTopics),\n      start: this._start,\n      consumptionType: \"partial\",\n    });\n\n    this._lastMessageEvent = undefined;\n    this._messages = [];\n\n    const messageEvents: MessageEvent<unknown>[] = [];\n\n    // If we take too long to read the data, we set the player into a BUFFERING presence. This\n    // indicates that the player is waiting to load more data.\n    const tickTimeout = setTimeout(() => {\n      this._presence = PlayerPresence.BUFFERING;\n      this._queueEmitState();\n    }, 100);\n\n    try {\n      for (;;) {\n        const result = await this._playbackIterator.next();\n        if (result.done === true) {\n          break;\n        }\n        const iterResult = result.value;\n        // Bail if a new state is requested while we are loading messages\n        // This usually happens when seeking before the initial load is complete\n        if (this._nextState) {\n          return;\n        }\n\n        if (iterResult.type === \"problem\") {\n          this._problemManager.addProblem(`connid-${iterResult.connectionId}`, iterResult.problem);\n          continue;\n        }\n\n        if (iterResult.type === \"stamp\" && compare(iterResult.stamp, stopTime) >= 0) {\n          this._lastStamp = iterResult.stamp;\n          break;\n        }\n\n        if (iterResult.type === \"message-event\") {\n          // The message is past the tick end time, we need to save it for next tick\n          if (compare(iterResult.msgEvent.receiveTime, stopTime) > 0) {\n            this._lastMessageEvent = iterResult.msgEvent;\n            break;\n          }\n\n          messageEvents.push(iterResult.msgEvent);\n        }\n      }\n    } finally {\n      clearTimeout(tickTimeout);\n    }\n\n    this._currentTime = stopTime;\n    this._messages = messageEvents;\n    this._presence = PlayerPresence.PRESENT;\n    this._queueEmitState();\n    this._setState(\"idle\");\n  }\n\n  // Process a seek request. The seek is performed by requesting a getBackfillMessages from the source.\n  // This provides the last message on all subscribed topics.\n  private async _stateSeekBackfill() {\n    if (!this._start || !this._end) {\n      throw new Error(\"invariant: stateSeekBackfill prior to initialization\");\n    }\n\n    if (!this._seekTarget) {\n      return;\n    }\n\n    // Ensure the seek time is always within the data source bounds\n    const targetTime = clampTime(this._seekTarget, this._start, this._end);\n\n    this._lastMessageEvent = undefined;\n\n    // If the backfill does not complete within 100 milliseconds, we emit a seek event with no messages.\n    // This provides feedback to the user that we've acknowledged their seek request but haven't loaded the data.\n    const seekAckTimeout = setTimeout(() => {\n      this._presence = PlayerPresence.BUFFERING;\n      this._messages = [];\n      this._currentTime = targetTime;\n      this._lastSeekEmitTime = Date.now();\n      this._queueEmitState();\n    }, 100);\n\n    const topics = Array.from(this._allTopics);\n\n    try {\n      this._abort = new AbortController();\n      const messages = await this._bufferedSource.getBackfillMessages({\n        topics,\n        time: targetTime,\n        abortSignal: this._abort.signal,\n      });\n\n      // We've successfully loaded the messages and will emit those, no longer need the ackTimeout\n      clearTimeout(seekAckTimeout);\n\n      if (this._nextState) {\n        return;\n      }\n\n      this._messages = messages;\n      this._currentTime = targetTime;\n      this._lastSeekEmitTime = Date.now();\n      this._presence = PlayerPresence.PRESENT;\n      this._queueEmitState();\n      await this.resetPlaybackIterator();\n      this._setState(this._isPlaying ? \"play\" : \"idle\");\n    } catch (err) {\n      if (this._nextState && err instanceof DOMException && err.name === \"AbortError\") {\n        log.debug(\"Aborted backfill\");\n      } else {\n        throw err;\n      }\n    } finally {\n      // Unless the next state is a seek backfill, we clear the seek target since we have finished seeking\n      if (this._nextState !== \"seek-backfill\") {\n        this._seekTarget = undefined;\n      }\n      clearTimeout(seekAckTimeout);\n      this._abort = undefined;\n    }\n  }\n\n  /** Emit the player state to the registered listener */\n  private async _emitStateImpl() {\n    if (!this._listener) {\n      return;\n    }\n\n    if (this._hasError) {\n      return await this._listener({\n        name: this._name,\n        presence: PlayerPresence.ERROR,\n        progress: {},\n        capabilities: this._capabilities,\n        profile: this._profile,\n        playerId: this._id,\n        activeData: undefined,\n        problems: this._problemManager.problems(),\n        urlState: {\n          sourceId: this._sourceId,\n          parameters: this._urlParams,\n        },\n      });\n    }\n\n    const messages = this._messages;\n    this._messages = [];\n\n    let activeData: PlayerStateActiveData | undefined;\n    if (this._start && this._end && this._currentTime) {\n      activeData = {\n        messages,\n        totalBytesReceived: this._receivedBytes,\n        currentTime: this._currentTime,\n        startTime: this._start,\n        endTime: this._end,\n        isPlaying: this._isPlaying,\n        speed: this._speed,\n        lastSeekTime: this._lastSeekEmitTime,\n        topics: this._providerTopics,\n        topicStats: this._providerTopicStats,\n        datatypes: this._providerDatatypes,\n        publishedTopics: this._publishedTopics,\n      };\n    }\n\n    const data: PlayerState = {\n      name: this._name,\n      presence: this._presence,\n      progress: this._progress,\n      capabilities: this._capabilities,\n      profile: this._profile,\n      playerId: this._id,\n      problems: this._problemManager.problems(),\n      activeData,\n      urlState: {\n        sourceId: this._sourceId,\n        parameters: this._urlParams,\n      },\n    };\n\n    return await this._listener(data);\n  }\n\n  /**\n   * Run one tick loop by reading from the message iterator a \"tick\" worth of messages.\n   * */\n  private async _tick(): Promise<void> {\n    if (!this._isPlaying) {\n      return;\n    }\n    if (!this._start || !this._end) {\n      throw new Error(\"Invariant: start & end should be set before tick()\");\n    }\n\n    // compute how long of a time range we want to read by taking into account\n    // the time since our last read and how fast we're currently playing back\n    const tickTime = performance.now();\n    const durationMillis =\n      this._lastTickMillis != undefined && this._lastTickMillis !== 0\n        ? tickTime - this._lastTickMillis\n        : 20;\n    this._lastTickMillis = tickTime;\n\n    // Read at most 300ms worth of messages, otherwise things can get out of control if rendering\n    // is very slow. Also, smooth over the range that we request, so that a single slow frame won't\n    // cause the next frame to also be unnecessarily slow by increasing the frame size.\n    let rangeMillis = Math.min(durationMillis * this._speed, 300);\n    if (this._lastRangeMillis != undefined) {\n      rangeMillis = this._lastRangeMillis * 0.9 + rangeMillis * 0.1;\n    }\n    this._lastRangeMillis = rangeMillis;\n\n    if (!this._currentTime) {\n      throw new Error(\"Invariant: Tried to play with no current time.\");\n    }\n\n    // The end time when we want to stop reading messages and emit state for the tick\n    // The end time is inclusive.\n    const targetTime = add(this._currentTime, fromMillis(rangeMillis));\n    const end: Time = clampTime(targetTime, this._start, this._untilTime ?? this._end);\n\n    // If a lastStamp is available from the previous tick we check the stamp against our current\n    // tick's end time. If this stamp is after our current tick's end time then we don't need to\n    // read any messages and can shortcut the rest of the logic to set the current time to the tick\n    // end time and queue an emit.\n    //\n    // If we have a lastStamp but it isn't after the tick end, then we clear it and proceed with the\n    // tick logic.\n    if (this._lastStamp) {\n      if (compare(this._lastStamp, end) >= 0) {\n        // Wait for the previous render frame to finish\n        await this._queueEmitState.currentPromise;\n\n        this._currentTime = end;\n        this._messages = [];\n        this._queueEmitState();\n\n        if (this._untilTime && compare(this._currentTime, this._untilTime) >= 0) {\n          this.pausePlayback();\n        }\n        return;\n      }\n\n      this._lastStamp = undefined;\n    }\n\n    const msgEvents: MessageEvent<unknown>[] = [];\n\n    // When ending the previous tick, we might have already read a message from the iterator which\n    // belongs to our tick. This logic brings that message into our current batch of message events.\n    if (this._lastMessageEvent) {\n      // If the last message we saw is still ahead of the tick end time, we don't emit anything\n      if (compare(this._lastMessageEvent.receiveTime, end) > 0) {\n        // Wait for the previous render frame to finish\n        await this._queueEmitState.currentPromise;\n\n        this._currentTime = end;\n        this._messages = msgEvents;\n        this._queueEmitState();\n\n        if (this._untilTime && compare(this._currentTime, this._untilTime) >= 0) {\n          this.pausePlayback();\n        }\n        return;\n      }\n\n      msgEvents.push(this._lastMessageEvent);\n      this._lastMessageEvent = undefined;\n    }\n\n    // If we take too long to read the tick data, we set the player into a BUFFERING presence. This\n    // indicates that the player is waiting to load more data. When the tick finally finishes, we\n    // clear this timeout.\n    const tickTimeout = setTimeout(() => {\n      this._presence = PlayerPresence.BUFFERING;\n      this._queueEmitState();\n    }, 500);\n\n    try {\n      // Read from the iterator through the end of the tick time\n      for (;;) {\n        if (!this._playbackIterator) {\n          throw new Error(\"Invariant. this._playbackIterator is undefined.\");\n        }\n\n        const result = await this._playbackIterator.next();\n        if (result.done === true || this._nextState) {\n          break;\n        }\n        const iterResult = result.value;\n\n        if (iterResult.type === \"problem\") {\n          this._problemManager.addProblem(`connid-${iterResult.connectionId}`, iterResult.problem);\n          continue;\n        }\n\n        if (iterResult.type === \"stamp\" && compare(iterResult.stamp, end) >= 0) {\n          this._lastStamp = iterResult.stamp;\n          break;\n        }\n\n        if (iterResult.type === \"message-event\") {\n          // The message is past the tick end time, we need to save it for next tick\n          if (compare(iterResult.msgEvent.receiveTime, end) > 0) {\n            this._lastMessageEvent = iterResult.msgEvent;\n            break;\n          }\n\n          msgEvents.push(iterResult.msgEvent);\n        }\n      }\n    } finally {\n      clearTimeout(tickTimeout);\n    }\n\n    // Set the presence back to PRESENT since we are no longer buffering\n    this._presence = PlayerPresence.PRESENT;\n\n    if (this._nextState) {\n      return;\n    }\n\n    // Wait on any active emit state to finish as part of this tick\n    // Without waiting on the emit state to finish we might drop messages since our emitState\n    // might get debounced\n    await this._queueEmitState.currentPromise;\n\n    this._currentTime = end;\n    this._messages = msgEvents;\n    this._queueEmitState();\n\n    // This tick has reached the end of the untilTime so we go back to pause\n    if (this._untilTime && compare(this._currentTime, this._untilTime) >= 0) {\n      this.pausePlayback();\n    }\n  }\n\n  private async _stateIdle() {\n    this._isPlaying = false;\n    this._presence = PlayerPresence.PRESENT;\n    this._queueEmitState();\n\n    if (this._abort) {\n      throw new Error(\"Invariant: some other abort controller exists\");\n    }\n    const abort = (this._abort = new AbortController());\n\n    const aborted = new Promise<void>((resolve) => {\n      abort.signal.addEventListener(\"abort\", () => {\n        resolve();\n      });\n    });\n\n    for (;;) {\n      this._progress = {\n        fullyLoadedFractionRanges: this._bufferedSource.loadedRanges(),\n        messageCache: this._progress.messageCache,\n      };\n      this._queueEmitState();\n\n      // When idling nothing is querying the source, but our buffered source might be\n      // buffering behind the scenes. Every second we emit state with an update to show that\n      // buffering is happening.\n      await Promise.race([delay(1000), aborted]);\n      if (this._nextState) {\n        break;\n      }\n    }\n  }\n\n  private async _statePlay() {\n    this._presence = PlayerPresence.PRESENT;\n\n    if (!this._currentTime) {\n      throw new Error(\"Invariant: currentTime not set before statePlay\");\n    }\n    if (!this._start || !this._end) {\n      throw new Error(\"Invariant: start & end should be set before statePlay\");\n    }\n\n    // Track the identity of allTopics, if this changes we need to reset our iterator to\n    // get new messages for new topics\n    const allTopics = this._allTopics;\n\n    try {\n      while (this._isPlaying && !this._hasError && !this._nextState) {\n        if (compare(this._currentTime, this._end) >= 0) {\n          // Playback has ended. Reset internal trackers for maintaining the playback speed.\n          this._lastTickMillis = undefined;\n          this._lastRangeMillis = undefined;\n          this._lastStamp = undefined;\n          this._setState(\"idle\");\n          return;\n        }\n\n        const start = Date.now();\n\n        await this._tick();\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition, @typescript-eslint/strict-boolean-expressions\n        if (this._nextState) {\n          return;\n        }\n\n        // If subscriptions changed, update to the new subscriptions\n        if (this._allTopics !== allTopics) {\n          // Discard any last message event since the new iterator will repeat it\n          this._lastMessageEvent = undefined;\n\n          // Bail playback and reset the playback iterator when topics have changed so we can load\n          // the new topics\n          this._setState(\"reset-playback-iterator\");\n          return;\n        }\n\n        this._progress = {\n          fullyLoadedFractionRanges: this._bufferedSource.loadedRanges(),\n          messageCache: this._progress.messageCache,\n        };\n\n        const time = Date.now() - start;\n        // make sure we've slept at least 16 millis or so (aprox 1 frame)\n        // to give the UI some time to breathe and not burn in a tight loop\n        if (time < 16) {\n          await delay(16 - time);\n        }\n      }\n    } catch (err) {\n      this._setError((err as Error).message, err);\n      this._queueEmitState();\n    }\n  }\n\n  private async _stateClose() {\n    this._isPlaying = false;\n    this._metricsCollector.close();\n    await this._blockLoader?.stopLoading();\n    await this._blockLoadingProcess;\n    await this._bufferedSource.stopProducer();\n    await this._bufferedSource.terminate();\n    await this._playbackIterator?.return?.();\n    this._playbackIterator = undefined;\n    await this._iterableSource.terminate?.();\n  }\n\n  private async startBlockLoading() {\n    await this._blockLoader?.startLoading({\n      progress: async (progress) => {\n        this._progress = {\n          fullyLoadedFractionRanges: this._progress.fullyLoadedFractionRanges,\n          messageCache: progress.messageCache,\n        };\n\n        this._queueEmitState();\n      },\n    });\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TransferHandler } from \"comlink\";\n\nconst isAbortSignal = (val: unknown): val is AbortSignal => val instanceof AbortSignal;\n\n/**\n * abortSignalTransferHandler implements a Comlink TransferHandler for AbortSignal instances\n *\n * Serialize creates an array with a boolean for whether the signal is already aborted and a message\n * port to send an abort signal.\n *\n * Deserialize creates a new abort controller and aborts it when the abort message is sent over the\n * message port.\n *\n * Reference: https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal\n */\nconst abortSignalTransferHandler: TransferHandler<AbortSignal, [boolean, MessagePort]> = {\n  canHandle: isAbortSignal,\n  deserialize: ([aborted, msgPort]) => {\n    const controller = new AbortController();\n\n    if (aborted) {\n      controller.abort();\n    } else {\n      msgPort.onmessage = () => {\n        controller.abort();\n      };\n    }\n\n    return controller.signal;\n  },\n  serialize: (abortSignal) => {\n    const { port1, port2 } = new MessageChannel();\n    abortSignal.addEventListener(\"abort\", () => {\n      port1.postMessage(\"aborted\");\n    });\n\n    return [[abortSignal.aborted, port2], [port2]];\n  },\n};\n\nexport { abortSignalTransferHandler };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as Comlink from \"comlink\";\n\nimport { abortSignalTransferHandler } from \"@foxglove/comlink-transfer-handlers\";\nimport { MessageEvent, Time } from \"@foxglove/studio\";\n\nimport type {\n  GetBackfillMessagesArgs,\n  IIterableSource,\n  IMessageCursor,\n  Initalization,\n  IteratorResult,\n  MessageIteratorArgs,\n  IterableSourceInitializeArgs,\n} from \"./IIterableSource\";\nimport type { WorkerIterableSourceWorker } from \"./WorkerIterableSourceWorker\";\n\nComlink.transferHandlers.set(\"abortsignal\", abortSignalTransferHandler);\n\ntype ConstructorArgs = {\n  initWorker: () => Worker;\n  initArgs: IterableSourceInitializeArgs;\n};\n\nexport class WorkerIterableSource implements IIterableSource {\n  private readonly _args: ConstructorArgs;\n\n  private _thread?: Worker;\n  private _worker?: Comlink.Remote<WorkerIterableSourceWorker>;\n\n  public constructor(args: ConstructorArgs) {\n    this._args = args;\n  }\n\n  public async initialize(): Promise<Initalization> {\n    // Note: this launches the worker.\n    this._thread = this._args.initWorker();\n\n    const initialize = Comlink.wrap<\n      (args: IterableSourceInitializeArgs) => Comlink.Remote<WorkerIterableSourceWorker>\n    >(this._thread);\n\n    const worker = (this._worker = await initialize(this._args.initArgs));\n    return await worker.initialize();\n  }\n\n  public async *messageIterator(\n    args: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> {\n    if (this._worker == undefined) {\n      throw new Error(`WorkerIterableSource is not initialized`);\n    }\n\n    const cursor = this.getMessageCursor(args);\n    try {\n      for (;;) {\n        // The fastest framerate that studio renders at is 60fps. So to render a frame studio needs\n        // at minimum ~16 milliseconds of messages before it will render a frame. Here we fetch\n        // batches of 17 milliseconds so that one batch fetch could result in one frame render.\n        // Fetching too much in a batch means we cannot render until the batch is returned.\n        const results = await cursor.nextBatch(17 /* milliseconds */);\n        if (!results || results.length === 0) {\n          break;\n        }\n        yield* results;\n      }\n    } finally {\n      await cursor.end();\n    }\n  }\n\n  public async getBackfillMessages(\n    args: GetBackfillMessagesArgs,\n  ): Promise<MessageEvent<unknown>[]> {\n    if (this._worker == undefined) {\n      throw new Error(`WorkerIterableSource is not initialized`);\n    }\n\n    // An AbortSignal is not clonable, so we remove it from the args and send it as a separate argumet\n    // to our worker getBackfillMessages call. Our installed Comlink handler for AbortSignal handles\n    // making the abort signal available within the worker.\n    const { abortSignal, ...rest } = args;\n    return await this._worker.getBackfillMessages(rest, abortSignal);\n  }\n\n  public getMessageCursor(args: MessageIteratorArgs & { abort?: AbortSignal }): IMessageCursor {\n    if (this._worker == undefined) {\n      throw new Error(`WorkerIterableSource is not initialized`);\n    }\n\n    // An AbortSignal is not clonable, so we remove it from the args and send it as a separate argumet\n    // to our worker getBackfillMessages call. Our installed Comlink handler for AbortSignal handles\n    // making the abort signal available within the worker.\n    const { abort, ...rest } = args;\n    const messageCursorPromise = this._worker.getMessageCursor(rest, abort);\n\n    const cursor: IMessageCursor = {\n      async next() {\n        const messageCursor = await messageCursorPromise;\n        return await messageCursor.next();\n      },\n\n      async nextBatch(durationMs: number) {\n        const messageCursor = await messageCursorPromise;\n        return await messageCursor.nextBatch(durationMs);\n      },\n\n      async readUntil(end: Time) {\n        const messageCursor = await messageCursorPromise;\n        return await messageCursor.readUntil(end);\n      },\n\n      async end() {\n        const messageCursor = await messageCursorPromise;\n        try {\n          await messageCursor.end();\n        } finally {\n          messageCursor[Comlink.releaseProxy]();\n        }\n      },\n    };\n\n    return cursor;\n  }\n\n  public async terminate(): Promise<void> {\n    this._thread?.terminate();\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass Ros1LocalBagDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros1-local-bagfile\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"ROS 1 Bag\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".bag\"];\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const file = args.file;\n    if (!file) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/BagIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { file },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name: file.name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default Ros1LocalBagDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEqual, sortBy, keyBy } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { Sockets } from \"@foxglove/electron-socket/renderer\";\nimport Logger from \"@foxglove/log\";\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { RosNode, TcpSocket } from \"@foxglove/ros1\";\nimport { Time, fromMillis, isGreaterThan, toSec } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerCapabilities,\n  PlayerMetricsCollectorInterface,\n  PlayerPresence,\n  PlayerState,\n  PlayerProblem,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n  TopicWithSchemaName,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport rosDatatypesToMessageDefinition from \"@foxglove/studio-base/util/rosDatatypesToMessageDefinition\";\nimport { HttpServer } from \"@foxglove/xmlrpc\";\n\nconst log = Logger.getLogger(__filename);\nconst rosLog = Logger.getLogger(\"ROS1\");\n\nconst CAPABILITIES = [\n  PlayerCapabilities.advertise,\n  PlayerCapabilities.getParameters,\n  PlayerCapabilities.setParameters,\n];\n\nenum Problem {\n  Connection = \"Connection\",\n  Parameters = \"Parameters\",\n  Graph = \"Graph\",\n  Publish = \"Publish\",\n  Node = \"Node\",\n}\n\ntype Ros1PlayerOpts = {\n  url: string;\n  hostname?: string;\n  metricsCollector: PlayerMetricsCollectorInterface;\n  sourceId: string;\n};\n\n// Connects to `rosmaster` instance using `@foxglove/ros1`\nexport default class Ros1Player implements Player {\n  private _url: string; // rosmaster URL.\n  private _hostname?: string; // ROS_HOSTNAME\n  private _rosNode?: RosNode; // Our ROS node when we're connected.\n  private _id: string = uuidv4(); // Unique ID for this player.\n  private _listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState().\n  private _closed: boolean = false; // Whether the player has been completely closed using close().\n  private _providerTopics?: TopicWithSchemaName[]; // Topics as advertised by rosmaster.\n  private _providerTopicsStats = new Map<string, TopicStats>(); // topic names to topic statistics.\n  private _providerDatatypes: RosDatatypes = new Map(); // All ROS message definitions received from subscriptions and set by publishers.\n  private _publishedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of publisher IDs publishing each topic.\n  private _subscribedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of subscriber IDs subscribed to each topic.\n  private _services = new Map<string, Set<string>>(); // A map of service names to service provider IDs that provide each service.\n  private _parameters = new Map<string, ParameterValue>(); // rosparams\n  private _start?: Time; // The time at which we started playing.\n  private _clockTime?: Time; // The most recent published `/clock` time, if available\n  private _requestedPublishers: AdvertiseOptions[] = []; // Requested publishers by setPublishers()\n  private _requestedSubscriptions: SubscribePayload[] = []; // Requested subscriptions by setSubscriptions()\n  private _parsedMessages: MessageEvent<unknown>[] = []; // Queue of messages that we'll send in next _emitState() call.\n  private _requestTopicsTimeout?: ReturnType<typeof setTimeout>; // setTimeout() handle for _requestTopics().\n  private _hasReceivedMessage = false;\n  private _metricsCollector: PlayerMetricsCollectorInterface;\n  private _presence: PlayerPresence = PlayerPresence.INITIALIZING;\n  private _problems = new PlayerProblemManager();\n  private _emitTimer?: ReturnType<typeof setTimeout>;\n  private readonly _sourceId: string;\n\n  public constructor({ url, hostname, metricsCollector, sourceId }: Ros1PlayerOpts) {\n    log.info(`initializing Ros1Player (url=${url}, hostname=${hostname})`);\n    this._metricsCollector = metricsCollector;\n    this._url = url;\n    this._hostname = hostname;\n    this._start = this._getCurrentTime();\n    this._metricsCollector.playerConstructed();\n    this._sourceId = sourceId;\n    void this._open();\n  }\n\n  private _open = async (): Promise<void> => {\n    const os = OsContextSingleton;\n    if (this._closed || os == undefined) {\n      return;\n    }\n    this._presence = PlayerPresence.INITIALIZING;\n\n    const hostname =\n      this._hostname ??\n      RosNode.GetRosHostname(os.getEnvVar, os.getHostname, os.getNetworkInterfaces);\n\n    const net = await Sockets.Create();\n    const httpServer = await net.createHttpServer();\n    const tcpSocketCreate = async (options: { host: string; port: number }): Promise<TcpSocket> => {\n      return await net.createSocket(options.host, options.port);\n    };\n    const tcpServer = await net.createServer();\n\n    // Mirror the ros_comm c++ library behavior when setting up the tcp server listener.\n    // ros_comm listens on all interfaces unless the hostname is explicity set to 'localhost'\n    // https://github.com/ros/ros_comm/blob/noetic-devel/clients/roscpp/src/libros/transport/transport_tcp.cpp#L393-L395\n    // https://github.com/ros/ros_comm/blob/f5fa3a168760d62e9693f10dcb9adfffc6132d22/clients/roscpp/src/libros/transport/transport.cpp#L67-L72\n    let listenHostname = \"0.0.0.0\";\n    if (hostname === \"localhost\") {\n      listenHostname = \"localhost\";\n    }\n    await tcpServer.listen(undefined, listenHostname, 10);\n\n    if (this._rosNode == undefined) {\n      const rosNode = new RosNode({\n        name: `/foxglovestudio_${os.pid}`,\n        hostname,\n        pid: os.pid,\n        rosMasterUri: this._url,\n        httpServer: httpServer as unknown as HttpServer,\n        tcpSocketCreate,\n        tcpServer,\n        log: rosLog,\n      });\n      this._rosNode = rosNode;\n\n      rosNode.on(\"paramUpdate\", ({ key, value, prevValue, callerId }) => {\n        log.debug(\"paramUpdate\", key, value, prevValue, callerId);\n        this._parameters = new Map(rosNode.parameters);\n      });\n      rosNode.on(\"error\", (error) => {\n        this._addProblem(Problem.Node, {\n          severity: \"warn\",\n          message: \"ROS node error\",\n          tip: `Connectivity will be automatically re-established`,\n          error,\n        });\n      });\n    }\n\n    await this._rosNode.start();\n\n    // Process any advertise requests made before our node was ready.\n    this.setPublishers(this._requestedPublishers);\n\n    // Request topics *after* setting publishers in case we want to subscribe\n    // to topics we are publishing.\n    await this._requestTopics();\n\n    this._presence = PlayerPresence.PRESENT;\n  };\n\n  private _addProblem(\n    id: string,\n    problem: PlayerProblem,\n    { skipEmit = false }: { skipEmit?: boolean } = {},\n  ): void {\n    this._problems.addProblem(id, problem);\n    if (!skipEmit) {\n      this._emitState();\n    }\n  }\n\n  private _clearProblem(id: string, { skipEmit = false }: { skipEmit?: boolean } = {}): void {\n    if (this._problems.removeProblem(id)) {\n      if (!skipEmit) {\n        this._emitState();\n      }\n    }\n  }\n\n  private _clearPublishProblems({ skipEmit = false }: { skipEmit?: boolean } = {}) {\n    if (\n      this._problems.removeProblems(\n        (id) =>\n          id.startsWith(\"msgdef:\") || id.startsWith(\"advertise:\") || id.startsWith(\"publish:\"),\n      )\n    ) {\n      if (!skipEmit) {\n        this._emitState();\n      }\n    }\n  }\n\n  private _topicsChanged = (newTopics: Topic[]): boolean => {\n    if (!this._providerTopics || newTopics.length !== this._providerTopics.length) {\n      return true;\n    }\n    return !isEqual(this._providerTopics, newTopics);\n  };\n\n  private _requestTopics = async (): Promise<void> => {\n    if (this._requestTopicsTimeout) {\n      clearTimeout(this._requestTopicsTimeout);\n    }\n    const rosNode = this._rosNode;\n    if (!rosNode || this._closed) {\n      return;\n    }\n\n    try {\n      const topicArrays = await rosNode.getPublishedTopics();\n      const topics: TopicWithSchemaName[] = topicArrays.map(([name, schemaName]) => ({\n        name,\n        schemaName,\n      }));\n      // Sort them for easy comparison\n      const sortedTopics = sortBy(topics, \"name\");\n\n      if (this._topicsChanged(sortedTopics)) {\n        // Remove stats entries for removed topics\n        const topicsSet = new Set<string>(topics.map((topic) => topic.name));\n        for (const topic of this._providerTopicsStats.keys()) {\n          if (!topicsSet.has(topic)) {\n            this._providerTopicsStats.delete(topic);\n          }\n        }\n\n        this._providerTopics = sortedTopics;\n      }\n\n      // Try subscribing again, since we might now be able to subscribe to some new topics.\n      this.setSubscriptions(this._requestedSubscriptions);\n\n      // Subscribe to all parameters\n      try {\n        const params = await rosNode.subscribeAllParams();\n        if (!isEqual(params, this._parameters)) {\n          this._parameters = new Map();\n          params.forEach((value, key) => this._parameters.set(key, value));\n        }\n        this._clearProblem(Problem.Parameters, { skipEmit: true });\n      } catch (error) {\n        this._addProblem(\n          Problem.Parameters,\n          {\n            severity: \"warn\",\n            message: \"ROS parameter fetch failed\",\n            tip: `Ensure that roscore is running and accessible at: ${this._url}`,\n            error,\n          },\n          { skipEmit: true },\n        );\n      }\n\n      // Fetch the full graph topology\n      await this._updateConnectionGraph(rosNode);\n\n      this._clearProblem(Problem.Connection, { skipEmit: true });\n      this._presence = PlayerPresence.PRESENT;\n      this._emitState();\n    } catch (error) {\n      this._presence = PlayerPresence.INITIALIZING;\n      this._addProblem(\n        Problem.Connection,\n        {\n          severity: \"error\",\n          message: \"ROS connection failed\",\n          tip: `Ensure that roscore is running and accessible at: ${this._url}`,\n          error,\n        },\n        { skipEmit: false },\n      );\n    } finally {\n      // Regardless of what happens, request topics again in a little bit.\n      this._requestTopicsTimeout = setTimeout(this._requestTopics, 3000);\n    }\n  };\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  private _emitState = debouncePromise(() => {\n    if (!this._listener || this._closed) {\n      return Promise.resolve();\n    }\n\n    const providerTopics = this._providerTopics;\n    const start = this._start;\n    if (!providerTopics || !start) {\n      return this._listener({\n        name: this._url,\n        presence: this._presence,\n        progress: {},\n        capabilities: CAPABILITIES,\n        profile: \"ros1\",\n        playerId: this._id,\n        problems: this._problems.problems(),\n        activeData: undefined,\n      });\n    }\n\n    // Time is always moving forward even if we don't get messages from the server.\n    // If we are not connected, don't emit updates since we are not longer getting new data\n    if (this._presence === PlayerPresence.PRESENT) {\n      if (this._emitTimer != undefined) {\n        clearTimeout(this._emitTimer);\n      }\n      this._emitTimer = setTimeout(this._emitState, 100);\n    }\n\n    const currentTime = this._getCurrentTime();\n    const messages = this._parsedMessages;\n    this._parsedMessages = [];\n    return this._listener({\n      name: this._url,\n      presence: this._presence,\n      progress: {},\n      capabilities: CAPABILITIES,\n      profile: \"ros1\",\n      playerId: this._id,\n      problems: this._problems.problems(),\n      urlState: {\n        sourceId: this._sourceId,\n        parameters: { url: this._url },\n      },\n\n      activeData: {\n        messages,\n        totalBytesReceived: this._rosNode?.receivedBytes() ?? 0,\n        startTime: start,\n        endTime: currentTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        // We don't support seeking, so we need to set this to any fixed value. Just avoid 0 so\n        // that we don't accidentally hit falsy checks.\n        lastSeekTime: 1,\n        topics: providerTopics,\n        // Always copy topic stats since message counts and timestamps are being updated\n        topicStats: new Map(this._providerTopicsStats),\n        datatypes: this._providerDatatypes,\n        publishedTopics: this._publishedTopics,\n        subscribedTopics: this._subscribedTopics,\n        services: this._services,\n        parameters: this._parameters,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this._listener = listener;\n    this._emitState();\n  }\n\n  public close(): void {\n    this._closed = true;\n    if (this._rosNode) {\n      this._rosNode.shutdown();\n    }\n    if (this._emitTimer != undefined) {\n      clearTimeout(this._emitTimer);\n      this._emitTimer = undefined;\n    }\n    this._metricsCollector.close();\n    this._hasReceivedMessage = false;\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this._requestedSubscriptions = subscriptions;\n\n    if (!this._rosNode || this._closed) {\n      return;\n    }\n\n    // Subscribe to additional topics used by Ros1Player itself\n    this._addInternalSubscriptions(subscriptions);\n\n    // See what topics we actually can subscribe to.\n    const availableTopicsByTopicName = keyBy(this._providerTopics ?? [], ({ name }) => name);\n    const topicNames = subscriptions\n      .map(({ topic }) => topic)\n      .filter((topicName) => availableTopicsByTopicName[topicName]);\n\n    // Subscribe to all topics that we aren't subscribed to yet.\n    for (const topicName of topicNames) {\n      const availTopic = availableTopicsByTopicName[topicName];\n      if (!availTopic || this._rosNode.subscriptions.has(topicName)) {\n        continue;\n      }\n\n      const { schemaName } = availTopic;\n      const subscription = this._rosNode.subscribe({ topic: topicName, dataType: schemaName });\n\n      subscription.on(\"header\", (_header, msgdef, _reader) => {\n        // We have to create a new object instead of just updating _providerDatatypes to support\n        // shallow memo downstream.\n        const newDatatypes = this._getRosDatatypes(schemaName, msgdef);\n        this._providerDatatypes = new Map([...this._providerDatatypes, ...newDatatypes]);\n      });\n      subscription.on(\"message\", (message, data, _pub) => {\n        this._handleMessage(topicName, message, data.byteLength, schemaName, true);\n        // Clear any existing subscription problems for this topic if we're receiving messages again.\n        this._clearProblem(`subscribe:${topicName}`, { skipEmit: true });\n      });\n      subscription.on(\"error\", (error) => {\n        this._addProblem(`subscribe:${topicName}`, {\n          severity: \"warn\",\n          message: `Topic subscription error for \"${topicName}\"`,\n          tip: `The subscription to \"${topicName}\" will be automatically re-established`,\n          error,\n        });\n      });\n    }\n\n    // Unsubscribe from topics that we are subscribed to but shouldn't be.\n    for (const topicName of this._rosNode.subscriptions.keys()) {\n      if (!topicNames.includes(topicName)) {\n        this._rosNode.unsubscribe(topicName);\n\n        // Reset the message count for this topic\n        this._providerTopicsStats.delete(topicName);\n      }\n    }\n  }\n\n  private _handleMessage = (\n    topic: string,\n    message: unknown,\n    sizeInBytes: number,\n    schemaName: string,\n    // This is a hot path so we avoid extra object allocation from a parameters struct\n    // eslint-disable-next-line @foxglove/no-boolean-parameters\n    external: boolean,\n  ): void => {\n    if (this._providerTopics == undefined) {\n      return;\n    }\n\n    const receiveTime = this._getCurrentTime();\n\n    if (external && !this._hasReceivedMessage) {\n      this._hasReceivedMessage = true;\n      this._metricsCollector.recordTimeToFirstMsgs();\n    }\n\n    const msg: MessageEvent<unknown> = {\n      topic,\n      receiveTime,\n      message,\n      sizeInBytes,\n      schemaName,\n    };\n    this._parsedMessages.push(msg);\n    this._handleInternalMessage(msg);\n\n    // Update the message count for this topic\n    let stats = this._providerTopicsStats.get(topic);\n    if (this._rosNode?.subscriptions.has(topic) === true) {\n      if (!stats) {\n        stats = { numMessages: 0 };\n        this._providerTopicsStats.set(topic, stats);\n      }\n      stats.numMessages++;\n      stats.firstMessageTime ??= receiveTime;\n      if (stats.lastMessageTime == undefined) {\n        stats.lastMessageTime = receiveTime;\n      } else if (isGreaterThan(receiveTime, stats.lastMessageTime)) {\n        stats.lastMessageTime = receiveTime;\n      }\n    }\n\n    this._emitState();\n  };\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    this._requestedPublishers = publishers;\n\n    if (!this._rosNode || this._closed) {\n      return;\n    }\n\n    const validPublishers = publishers.filter(({ topic }) => topic.length > 0 && topic !== \"/\");\n    const topics = new Set<string>(validPublishers.map(({ topic }) => topic));\n\n    // Clear all problems related to publishing\n    this._clearPublishProblems({ skipEmit: true });\n\n    // Unadvertise any topics that were previously published and no longer appear in the list\n    for (const topic of this._rosNode.publications.keys()) {\n      if (!topics.has(topic)) {\n        this._rosNode.unadvertise(topic);\n      }\n    }\n\n    // Unadvertise any topics where the dataType changed\n    for (const { topic, schemaName: datatype } of validPublishers) {\n      const existingPub = this._rosNode.publications.get(topic);\n      if (existingPub != undefined && existingPub.dataType !== datatype) {\n        this._rosNode.unadvertise(topic);\n      }\n    }\n\n    // Advertise new topics\n    for (const advertiseOptions of validPublishers) {\n      const { topic, schemaName: dataType, options } = advertiseOptions;\n\n      if (this._rosNode.publications.has(topic)) {\n        continue;\n      }\n\n      const msgdefProblemId = `msgdef:${topic}`;\n      const advertiseProblemId = `advertise:${topic}`;\n\n      // Try to retrieve the ROS message definition for this topic\n      let msgdef: MessageDefinition[];\n      try {\n        const datatypes = options?.[\"datatypes\"] as RosDatatypes | undefined;\n        if (!datatypes || !(datatypes instanceof Map)) {\n          throw new Error(\"The datatypes option is required for publishing\");\n        }\n        msgdef = rosDatatypesToMessageDefinition(datatypes, dataType);\n      } catch (error) {\n        log.debug(error);\n        this._addProblem(msgdefProblemId, {\n          severity: \"warn\",\n          message: `Unknown message definition for \"${topic}\"`,\n          tip: `Try subscribing to the topic \"${topic}\" before publishing to it`,\n        });\n        continue;\n      }\n\n      // Advertise this topic to ROS as being published by us\n      this._rosNode.advertise({ topic, dataType, messageDefinition: msgdef }).catch((error) =>\n        this._addProblem(advertiseProblemId, {\n          severity: \"error\",\n          message: `Failed to advertise \"${topic}\"`,\n          error,\n        }),\n      );\n    }\n\n    this._emitState();\n  }\n\n  public setParameter(key: string, value: ParameterValue): void {\n    log.debug(`Ros1Player.setParameter(key=${key}, value=${value})`);\n    void this._rosNode?.setParameter(key, value);\n  }\n\n  public publish({ topic, msg }: PublishPayload): void {\n    const problemId = `publish:${topic}`;\n\n    if (this._rosNode != undefined) {\n      if (this._rosNode.isAdvertising(topic)) {\n        this._rosNode\n          .publish(topic, msg)\n          .then(() => this._clearProblem(problemId))\n          .catch((error) =>\n            this._addProblem(problemId, {\n              severity: \"error\",\n              message: `Publishing to ${topic} failed`,\n              error,\n            }),\n          );\n      } else {\n        this._addProblem(problemId, {\n          severity: \"warn\",\n          message: `Unable to publish to \"${topic}\"`,\n          tip: `ROS1 may be disconnected. Please try again in a moment`,\n        });\n      }\n    }\n  }\n\n  public async callService(): Promise<unknown> {\n    throw new Error(\"Service calls are not supported by this data source\");\n  }\n\n  // Bunch of unsupported stuff. Just don't do anything for these.\n  public setGlobalVariables(): void {\n    // no-op\n  }\n\n  private _getRosDatatypes = (\n    datatype: string,\n    messageDefinition: MessageDefinition[],\n  ): RosDatatypes => {\n    const typesByName: RosDatatypes = new Map();\n    for (const def of messageDefinition) {\n      // The first definition usually doesn't have an explicit name so we use the datatype\n      if (def.name == undefined) {\n        typesByName.set(datatype, def);\n      } else {\n        typesByName.set(def.name, def);\n      }\n    }\n    return typesByName;\n  };\n\n  private _addInternalSubscriptions(subscriptions: SubscribePayload[]): void {\n    // Always subscribe to /clock if available\n    if (subscriptions.find((sub) => sub.topic === \"/clock\") == undefined) {\n      subscriptions.unshift({\n        topic: \"/clock\",\n      });\n    }\n  }\n\n  private _handleInternalMessage(msg: MessageEvent<unknown>): void {\n    const maybeClockMsg = msg.message as { clock?: Time };\n    if (msg.topic === \"/clock\" && maybeClockMsg.clock && !isNaN(maybeClockMsg.clock.sec)) {\n      const time = maybeClockMsg.clock;\n      const seconds = toSec(maybeClockMsg.clock);\n      if (isNaN(seconds)) {\n        return;\n      }\n\n      if (this._clockTime == undefined) {\n        this._start = time;\n      }\n\n      this._clockTime = time;\n      (msg as { receiveTime: Time }).receiveTime = this._getCurrentTime();\n    }\n  }\n\n  private async _updateConnectionGraph(rosNode: RosNode): Promise<void> {\n    try {\n      const graph = await rosNode.getSystemState();\n      if (\n        !isEqual(this._publishedTopics, graph.publishers) ||\n        !isEqual(this._subscribedTopics, graph.subscribers) ||\n        !isEqual(this._services, graph.services)\n      ) {\n        this._publishedTopics = graph.publishers;\n        this._subscribedTopics = graph.subscribers;\n        this._services = graph.services;\n      }\n      this._clearProblem(Problem.Graph, { skipEmit: true });\n    } catch (error) {\n      this._addProblem(\n        Problem.Graph,\n        {\n          severity: \"warn\",\n          message: \"Unable to update connection graph\",\n          tip: `The connection graph contains information about publishers and subscribers. A\nstale graph may result in missing topics you expect. Ensure that roscore is reachable at ${this._url}.`,\n          error,\n        },\n        { skipEmit: true },\n      );\n      this._publishedTopics = new Map();\n      this._subscribedTopics = new Map();\n      this._services = new Map();\n    }\n  }\n\n  private _getCurrentTime(): Time {\n    return this._clockTime ?? fromMillis(Date.now());\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isString, isUndefined } from \"lodash\";\n\nimport { RosNode } from \"@foxglove/ros1\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport Ros1Player from \"@foxglove/studio-base/players/Ros1Player\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass Ros1SocketDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros1-socket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"ROS 1\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"ROS\";\n  public description =\n    \"Connect to a running ROS 1 system via a native TCP connection that accesses your ROS master and nodes directly.\";\n  public docsLinks = [{ url: \"https://foxglove.dev/docs/studio/connection/native\" }];\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"ROS_MASTER_URI\",\n        defaultValue: OsContextSingleton?.getEnvVar(\"ROS_MASTER_URI\") ?? \"http://localhost:11311\",\n        description: \"Tells ROS nodes where they can locate the master\",\n      },\n      {\n        id: \"hostname\",\n        label: \"ROS_HOSTNAME\",\n        defaultValue: OsContextSingleton\n          ? RosNode.GetRosHostname(\n              OsContextSingleton.getEnvVar,\n              OsContextSingleton.getHostname,\n              OsContextSingleton.getNetworkInterfaces,\n            )\n          : \"localhost\",\n        description: \"Acts as the declared network address of a ROS node or tool\",\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      return;\n    }\n\n    const hostname = args.params?.hostname;\n    if (!isUndefined(hostname) && !isString(hostname)) {\n      throw new Error(`Unable to initialize Ros1. Invalid hostname ${hostname}`);\n    }\n\n    return new Ros1Player({\n      url,\n      hostname,\n      metricsCollector: args.metricsCollector,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default Ros1SocketDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass Ros2LocalBagDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros2-local-bagfile\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"ROS 2 Bag\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".db3\"];\n  public supportsMultiFile = true;\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const files = args.file ? [args.file] : args.files;\n    const name = args.file ? args.file.name : args.files?.map((file) => file.name).join(\", \");\n\n    if (!files) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/rosdb3/RosDb3IterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { files },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default Ros2LocalBagDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { debounce, isEqual, sortBy, keyBy } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { Sockets } from \"@foxglove/electron-socket/renderer\";\nimport Logger from \"@foxglove/log\";\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { RosNode } from \"@foxglove/ros2\";\nimport { ros2galactic } from \"@foxglove/rosmsg-msgs-common\";\nimport { Time, fromMillis, toSec, isGreaterThan } from \"@foxglove/rostime\";\nimport { Durability, Reliability } from \"@foxglove/rtps\";\nimport { foxgloveMessageSchemas, generateRosMsgDefinition } from \"@foxglove/schemas/internal\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerMetricsCollectorInterface,\n  PlayerPresence,\n  PlayerProblem,\n  PlayerState,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n  TopicWithSchemaName,\n} from \"@foxglove/studio-base/players/types\";\nimport rosDatatypesToMessageDefinition from \"@foxglove/studio-base/util/rosDatatypesToMessageDefinition\";\n\nconst log = Logger.getLogger(__filename);\nconst rosLog = Logger.getLogger(\"ROS2\");\n\nconst CAPABILITIES: string[] = [];\n\nenum Problem {\n  Connection = \"Connection\",\n  Parameters = \"Parameters\",\n  Graph = \"Graph\",\n  Publish = \"Publish\",\n}\n\ntype Ros2PlayerOpts = {\n  domainId: number;\n  metricsCollector: PlayerMetricsCollectorInterface;\n  sourceId: string;\n};\n\n// Connects to a ROS 2 network using RTPS over UDP, discovering peers via UDP multicast.\nexport default class Ros2Player implements Player {\n  private _domainId: number; // ROS 2 DDS (RTPS) domain\n  private _rosNode?: RosNode; // Our ROS node when we're connected.\n  private _id: string = uuidv4(); // Unique ID for this player.\n  private _listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState().\n  private _closed = false; // Whether the player has been completely closed using close().\n  private _providerTopics?: TopicWithSchemaName[]; // Topics as advertised by peers\n  private _providerTopicsStats = new Map<string, TopicStats>(); // topic names to topic statistics.\n  private _providerDatatypes = new Map<string, MessageDefinition>(); // All known ROS 2 message definitions.\n  private _publishedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of publisher IDs publishing each topic.\n  private _subscribedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of subscriber IDs subscribed to each topic.\n  // private _services = new Map<string, Set<string>>(); // A map of service names to service provider IDs that provide each service.\n  // private _parameters = new Map<string, ParameterValue>(); // rosparams\n  private _start?: Time; // The time at which we started playing.\n  private _clockTime?: Time; // The most recent published `/clock` time, if available\n  private _requestedSubscriptions: SubscribePayload[] = []; // Requested subscriptions by setSubscriptions()\n  private _parsedMessages: MessageEvent<unknown>[] = []; // Queue of messages that we'll send in next _emitState() call.\n  private _updateTopicsTimeout?: ReturnType<typeof setTimeout>; // setTimeout() handle for _updateTopics().\n  private _hasReceivedMessage = false;\n  private _metricsCollector: PlayerMetricsCollectorInterface;\n  private _presence: PlayerPresence = PlayerPresence.INITIALIZING;\n  private _problems = new PlayerProblemManager();\n  private _emitTimer?: ReturnType<typeof setTimeout>;\n  private readonly _sourceId: string;\n\n  public constructor({ domainId, metricsCollector, sourceId }: Ros2PlayerOpts) {\n    log.info(`initializing Ros2Player (domainId=${domainId})`);\n    this._domainId = domainId;\n    this._metricsCollector = metricsCollector;\n    this._start = this._getCurrentTime();\n    this._metricsCollector.playerConstructed();\n    this._sourceId = sourceId;\n\n    this._importRos2MsgDefs();\n\n    void this._open();\n  }\n\n  private _importRos2MsgDefs(): void {\n    // Add common message definitions from ROS2 (rcl_interfaces, common_interfaces, etc)\n    for (const dataType in ros2galactic) {\n      const msgDef = (ros2galactic as Record<string, MessageDefinition>)[dataType]!;\n      this._providerDatatypes.set(dataType, msgDef);\n      this._providerDatatypes.set(dataTypeToFullName(dataType), msgDef);\n    }\n\n    // Add message definitions from foxglove schemas\n    for (const schema of Object.values(foxgloveMessageSchemas)) {\n      const { fields, rosMsgInterfaceName, rosFullInterfaceName } = generateRosMsgDefinition(\n        schema,\n        { rosVersion: 2 },\n      );\n      const msgDef: MessageDefinition = { name: rosMsgInterfaceName, definitions: fields };\n      this._providerDatatypes.set(rosMsgInterfaceName, msgDef);\n      this._providerDatatypes.set(rosFullInterfaceName, msgDef);\n    }\n\n    // Add the legacy foxglove_msgs/ImageMarkerArray message definition\n    this._providerDatatypes.set(\"foxglove_msgs/ImageMarkerArray\", {\n      definitions: [\n        { name: \"markers\", type: \"visualization_msgs/ImageMarker\", isComplex: true, isArray: true },\n      ],\n    });\n    this._providerDatatypes.set(\"foxglove_msgs/msg/ImageMarkerArray\", {\n      definitions: [\n        { name: \"markers\", type: \"visualization_msgs/ImageMarker\", isComplex: true, isArray: true },\n      ],\n    });\n  }\n\n  private _open = async (): Promise<void> => {\n    if (this._closed || OsContextSingleton == undefined) {\n      return;\n    }\n    this._presence = PlayerPresence.INITIALIZING;\n\n    const net = await Sockets.Create();\n    // eslint-disable-next-line @typescript-eslint/promise-function-async\n    const udpSocketCreate = () => net.createUdpSocket();\n\n    if (this._rosNode == undefined) {\n      const rosNode = new RosNode({\n        name: `/foxglovestudio_${OsContextSingleton.pid}`,\n        domainId: this._domainId,\n        udpSocketCreate,\n        getNetworkInterfaces: OsContextSingleton.getNetworkInterfaces,\n        log: rosLog,\n      });\n      this._rosNode = rosNode;\n\n      // When new publications are discovered, immediately call _updateTopics()\n      rosNode.on(\"discoveredPublication\", (_pub) => debounce(() => this._updateTopics(), 500));\n\n      // rosNode.on(\"paramUpdate\", ({ key, value, prevValue, callerId }) => {\n      //   log.debug(\"paramUpdate\", key, value, prevValue, callerId);\n      //   this._parameters = new Map(rosNode.parameters);\n      // });\n    }\n\n    await this._rosNode.start();\n\n    this._updateTopics();\n    this._presence = PlayerPresence.PRESENT;\n  };\n\n  private _addProblemAndEmit(id: string, problem: PlayerProblem): void {\n    this._problems.addProblem(id, problem);\n    this._emitState();\n  }\n\n  private _clearPublishProblems({ skipEmit = false }: { skipEmit?: boolean } = {}) {\n    if (\n      this._problems.removeProblems(\n        (id) =>\n          id.startsWith(\"msgdef:\") || id.startsWith(\"advertise:\") || id.startsWith(\"publish:\"),\n      )\n    ) {\n      if (!skipEmit) {\n        this._emitState();\n      }\n    }\n  }\n\n  private _topicsChanged = (newTopics: Topic[]): boolean => {\n    if (!this._providerTopics || newTopics.length !== this._providerTopics.length) {\n      return true;\n    }\n    return !isEqual(this._providerTopics, newTopics);\n  };\n\n  private _updateTopics = (): void => {\n    if (this._updateTopicsTimeout) {\n      clearTimeout(this._updateTopicsTimeout);\n    }\n    const rosNode = this._rosNode;\n    if (!rosNode || this._closed) {\n      return;\n    }\n\n    try {\n      // Convert the map of topics to publication endpoints to a list of topics\n      const topics: TopicWithSchemaName[] = [];\n      for (const [topic, endpoints] of rosNode.getPublishedTopics().entries()) {\n        const dataTypes = new Set<string>();\n        for (const endpoint of endpoints) {\n          dataTypes.add(endpoint.rosDataType);\n        }\n        const dataType = dataTypes.values().next().value as string;\n        const problemId = `subscription:${topic}`;\n        if (dataTypes.size > 1 && !this._problems.hasProblem(problemId)) {\n          const message = `Multiple data types for \"${topic}\": ${Array.from(dataTypes).join(\", \")}`;\n          this._problems.addProblem(problemId, {\n            severity: \"warn\",\n            message,\n            tip: `Only data type \"${dataType}\" will be used`,\n          });\n        }\n\n        topics.push({ name: topic, schemaName: dataType });\n      }\n\n      // Sort them for easy comparison\n      const sortedTopics: TopicWithSchemaName[] = sortBy(topics, \"name\");\n\n      if (this._topicsChanged(sortedTopics)) {\n        // Remove stats entries for removed topics\n        const topicsSet = new Set<string>(topics.map((topic) => topic.name));\n        for (const topic of this._providerTopicsStats.keys()) {\n          if (!topicsSet.has(topic)) {\n            this._providerTopicsStats.delete(topic);\n          }\n        }\n\n        this._providerTopics = sortedTopics;\n\n        // Try subscribing again, since we might be able to subscribe to additional topics\n        this.setSubscriptions(this._requestedSubscriptions);\n      }\n\n      // Subscribe to all parameters\n      // try {\n      //   const params = await rosNode.subscribeAllParams();\n      //   if (!isEqual(params, this._parameters)) {\n      //     this._parameters = new Map();\n      //     params.forEach((value, key) => this._parameters.set(key, value));\n      //   }\n      //   this._clearProblem(Problem.Parameters, true);\n      // } catch (error) {\n      //   this._addProblem(\n      //     Problem.Parameters,\n      //     {\n      //       severity: \"warn\",\n      //       message: \"ROS parameter fetch failed\",\n      //       tip: `Ensure that roscore is running and accessible at: ${this._url}`,\n      //       error,\n      //     },\n      //     true,\n      //   );\n      // }\n\n      // Fetch the full graph topology\n      this._updateConnectionGraph(rosNode);\n\n      this._presence = PlayerPresence.PRESENT;\n      this._emitState();\n    } catch (error) {\n      this._presence = PlayerPresence.INITIALIZING;\n      this._addProblemAndEmit(Problem.Connection, {\n        severity: \"error\",\n        message: \"ROS connection failed\",\n        tip: `Ensure a ROS 2 DDS system is running on the local network and UDP multicast is supported`,\n        error,\n      });\n    } finally {\n      // Regardless of what happens, update topics again in a little bit\n      this._updateTopicsTimeout = setTimeout(this._updateTopics, 3000);\n    }\n  };\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  private _emitState = debouncePromise(() => {\n    if (!this._listener || this._closed) {\n      return Promise.resolve();\n    }\n\n    const providerTopics = this._providerTopics;\n    const start = this._start;\n    if (!providerTopics || !start) {\n      return this._listener({\n        presence: this._presence,\n        progress: {},\n        capabilities: CAPABILITIES,\n        profile: \"ros2\",\n        playerId: this._id,\n        problems: this._problems.problems(),\n        activeData: undefined,\n      });\n    }\n\n    // Time is always moving forward even if we don't get messages from the server.\n    // If we are not connected, don't emit updates since we are not longer getting new data\n    if (this._presence === PlayerPresence.PRESENT) {\n      if (this._emitTimer != undefined) {\n        clearTimeout(this._emitTimer);\n      }\n      this._emitTimer = setTimeout(this._emitState, 100);\n    }\n\n    const currentTime = this._getCurrentTime();\n    const messages = this._parsedMessages;\n    this._parsedMessages = [];\n    return this._listener({\n      presence: this._presence,\n      progress: {},\n      capabilities: CAPABILITIES,\n      profile: \"ros2\",\n      name: \"ROS2\",\n      playerId: this._id,\n      problems: this._problems.problems(),\n      urlState: {\n        sourceId: this._sourceId,\n        parameters: { url: String(this._domainId) },\n      },\n\n      activeData: {\n        messages,\n        totalBytesReceived: this._rosNode?.receivedBytes() ?? 0,\n        startTime: start,\n        endTime: currentTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        // We don't support seeking, so we need to set this to any fixed value. Just avoid 0 so\n        // that we don't accidentally hit falsy checks.\n        lastSeekTime: 1,\n        topics: providerTopics,\n        // Always copy topic stats since message counts and timestamps are being updated\n        topicStats: new Map(this._providerTopicsStats),\n        datatypes: this._providerDatatypes,\n        publishedTopics: this._publishedTopics,\n        subscribedTopics: this._subscribedTopics,\n        // services: this._services,\n        // parameters: this._parameters,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this._listener = listener;\n    this._emitState();\n  }\n\n  public close(): void {\n    this._closed = true;\n    if (this._rosNode) {\n      void this._rosNode.shutdown();\n    }\n    if (this._emitTimer != undefined) {\n      clearTimeout(this._emitTimer);\n      this._emitTimer = undefined;\n    }\n    this._metricsCollector.close();\n    this._hasReceivedMessage = false;\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this._requestedSubscriptions = subscriptions;\n\n    if (!this._rosNode || this._closed) {\n      return;\n    }\n\n    // Subscribe to additional topics used by Ros2Player itself\n    this._addInternalSubscriptions(subscriptions);\n\n    // Filter down to topics we can actually subscribe to\n    const availableTopicsByTopicName = keyBy(this._providerTopics ?? [], ({ name }) => name);\n    const topicNames = subscriptions\n      .map(({ topic }) => topic)\n      .filter((topicName) => availableTopicsByTopicName[topicName]);\n\n    const publishedTopics = this._rosNode.getPublishedTopics();\n\n    // Subscribe to all topics that we aren't subscribed to yet\n    for (const topicName of topicNames) {\n      const availableTopic = availableTopicsByTopicName[topicName];\n      if (!availableTopic || this._rosNode.subscriptions.has(topicName)) {\n        continue;\n      }\n      const schemaName = availableTopic.schemaName;\n\n      // Find the first publisher for this topic to mimic its QoS history settings\n      const rosEndpoint = publishedTopics.get(topicName)?.[0];\n      if (!rosEndpoint) {\n        this._problems.addProblem(`subscription:${topicName}`, {\n          severity: \"warn\",\n          message: `No publisher for \"${topicName}\" (\"${schemaName}\")`,\n          tip: `Publish \"${topicName}\"`,\n        });\n        continue;\n      } else {\n        this._problems.removeProblem(`subscription:${topicName}`);\n      }\n\n      // Try to retrieve the ROS message definition for this topic\n      let msgDefinition: MessageDefinition[] | undefined;\n      try {\n        msgDefinition = rosDatatypesToMessageDefinition(this._providerDatatypes, schemaName);\n        this._problems.removeProblem(`msgdef:${topicName}`);\n      } catch (error) {\n        this._problems.addProblem(`msgdef:${topicName}`, {\n          severity: \"warn\",\n          message: `Unknown message definition for \"${topicName}\" (\"${schemaName}\")`,\n          tip: `Only core ROS 2 data types are currently supported`,\n        });\n      }\n\n      // Pick the best but lowest common denominator QoS profile for this topic\n      const topicEndpoints = publishedTopics.get(topicName) ?? [];\n      const reliableCount = topicEndpoints.reduce(\n        (sum, pub) => sum + (pub.reliability.kind === Reliability.Reliable ? 1 : 0),\n        0,\n      );\n      const transientLocalCount = topicEndpoints.reduce(\n        (sum, pub) => sum + (pub.durability === Durability.TransientLocal ? 1 : 0),\n        0,\n      );\n      const endpointCount = topicEndpoints.length;\n      const durability =\n        transientLocalCount === endpointCount ? Durability.TransientLocal : Durability.Volatile;\n      const reliability = {\n        kind: reliableCount === endpointCount ? Reliability.Reliable : Reliability.BestEffort,\n        maxBlockingTime: rosEndpoint.reliability.maxBlockingTime,\n      };\n\n      const subscription = this._rosNode.subscribe({\n        topic: topicName,\n        dataType: schemaName,\n        durability,\n        history: rosEndpoint.history,\n        reliability,\n        msgDefinition,\n      });\n\n      subscription.on(\"message\", (timestamp, message, data, _pub) => {\n        this._handleMessage(topicName, timestamp, message, schemaName, data.byteLength, true);\n        // Clear any existing subscription problems for this topic if we're receiving messages again.\n        this._problems.removeProblem(`subscription:${topicName}`);\n      });\n      subscription.on(\"error\", (err) => {\n        log.error(`Subscription error for ${topicName}: ${err}`);\n        this._problems.addProblem(`subscription:${topicName}`, {\n          severity: \"error\",\n          message: `Error receiving messages on \"${topicName}\"`,\n          tip: `Report this error if you continue experiencing issues`,\n          error: err,\n        });\n      });\n    }\n\n    // Unsubscribe from topics that we are subscribed to but shouldn't be.\n    for (const topicName of this._rosNode.subscriptions.keys()) {\n      if (!topicNames.includes(topicName)) {\n        this._rosNode.unsubscribe(topicName);\n\n        // Reset the message count for this topic\n        this._providerTopicsStats.delete(topicName);\n      }\n    }\n  }\n\n  private _handleMessage = (\n    topic: string,\n    timestamp: Time,\n    message: unknown,\n    schemaName: string,\n    sizeInBytes: number,\n    // This is a hot path so we avoid extra object allocation from a parameters struct\n    // eslint-disable-next-line @foxglove/no-boolean-parameters\n    external: boolean,\n  ): void => {\n    if (this._providerTopics == undefined) {\n      return;\n    }\n\n    const receiveTime = this._getCurrentTime();\n    const publishTime = timestamp;\n\n    if (external && !this._hasReceivedMessage) {\n      this._hasReceivedMessage = true;\n      this._metricsCollector.recordTimeToFirstMsgs();\n    }\n\n    if (message != undefined) {\n      const msg: MessageEvent<unknown> = {\n        topic,\n        receiveTime,\n        publishTime,\n        message,\n        sizeInBytes,\n        schemaName,\n      };\n      this._parsedMessages.push(msg);\n      this._handleInternalMessage(msg);\n    }\n\n    // Update the message count for this topic\n    let stats = this._providerTopicsStats.get(topic);\n    if (this._rosNode?.subscriptions.has(topic) === true) {\n      if (!stats) {\n        stats = { numMessages: 0 };\n        this._providerTopicsStats.set(topic, stats);\n      }\n      stats.numMessages++;\n      stats.firstMessageTime ??= receiveTime;\n      if (stats.lastMessageTime == undefined) {\n        stats.lastMessageTime = receiveTime;\n      } else if (isGreaterThan(receiveTime, stats.lastMessageTime)) {\n        stats.lastMessageTime = receiveTime;\n      }\n    }\n\n    this._emitState();\n  };\n\n  public setPublishers(_publishers: AdvertiseOptions[]): void {\n    if (!this._rosNode || this._closed) {\n      return;\n    }\n\n    // Clear all problems related to publishing\n    this._clearPublishProblems({ skipEmit: false });\n    this._emitState();\n  }\n\n  public setParameter(_key: string, _value: ParameterValue): void {\n    throw new Error(\"Parameter editing is not supported by this data source\");\n  }\n\n  public publish(_payload: PublishPayload): void {\n    throw new Error(\"Publishing is not supported\");\n  }\n\n  public async callService(): Promise<unknown> {\n    throw new Error(\"Service calls are not supported by this data source\");\n  }\n\n  // Bunch of unsupported stuff. Just don't do anything for these.\n  public setGlobalVariables(): void {\n    // no-op\n  }\n\n  private _addInternalSubscriptions(subscriptions: SubscribePayload[]): void {\n    // Always subscribe to /clock if available\n    if (subscriptions.find((sub) => sub.topic === \"/clock\") == undefined) {\n      subscriptions.unshift({\n        topic: \"/clock\",\n      });\n    }\n  }\n\n  private _handleInternalMessage(msg: MessageEvent<unknown>): void {\n    const maybeClockMsg = msg.message as { clock?: Time };\n    if (msg.topic === \"/clock\" && maybeClockMsg.clock && !isNaN(maybeClockMsg.clock.sec)) {\n      const time = maybeClockMsg.clock;\n      const seconds = toSec(maybeClockMsg.clock);\n      if (isNaN(seconds)) {\n        return;\n      }\n\n      if (this._clockTime == undefined) {\n        this._start = time;\n      }\n\n      this._clockTime = time;\n      (msg as { receiveTime: Time }).receiveTime = this._getCurrentTime();\n    }\n  }\n\n  private _updateConnectionGraph(_rosNode: RosNode): void {\n    //     try {\n    //       const graph = await rosNode.getSystemState();\n    //       if (\n    //         !isEqual(this._publishedTopics, graph.publishers) ||\n    //         !isEqual(this._subscribedTopics, graph.subscribers) ||\n    //         !isEqual(this._services, graph.services)\n    //       ) {\n    //         this._publishedTopics = graph.publishers;\n    //         this._subscribedTopics = graph.subscribers;\n    //         this._services = graph.services;\n    //       }\n    //       this._clearProblem(Problem.Graph, true);\n    //     } catch (error) {\n    //       this._addProblem(\n    //         Problem.Graph,\n    //         {\n    //           severity: \"warn\",\n    //           message: \"Unable to update connection graph\",\n    //           tip: `The connection graph contains information about publishers and subscribers. A\n    // stale graph may result in missing topics you expect. Ensure that roscore is reachable at ${this._url}.`,\n    //           error,\n    //         },\n    //         true,\n    //       );\n    //       this._publishedTopics = new Map();\n    //       this._subscribedTopics = new Map();\n    //       this._services = new Map();\n    //     }\n  }\n\n  private _getCurrentTime(): Time {\n    return this._clockTime ?? fromMillis(Date.now());\n  }\n}\n\nfunction dataTypeToFullName(dataType: string): string {\n  const parts = dataType.split(\"/\");\n  if (parts.length === 2) {\n    return `${parts[0]}/msg/${parts[1]}`;\n  }\n  return dataType;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport Ros2Player from \"@foxglove/studio-base/players/Ros2Player\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass Ros2SocketDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros2-socket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"ROS 2\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"ROS\";\n  public description =\n    \"Connect to a running ROS 2 system via a native UDP connection that accesses your ROS nodes directly.\";\n  public docsLinks = [{ url: \"https://foxglove.dev/docs/studio/connection/ros2\" }];\n  public warning =\n    \"Native ROS 2 connections do not support custom messages, and are deprecated. We recommend using the Foxglove WebSocket connection instead.\";\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"domainId\",\n        label: \"ROS_DOMAIN_ID\",\n        defaultValue: \"0\",\n        description:\n          \"Used by DDS, the default ROS 2 middleware, to compute the UDP ports used for discovery and communication\",\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const domainIdStr = args.params?.domainId;\n    if (!domainIdStr) {\n      return;\n    }\n\n    const domainId = parseInt(domainIdStr);\n\n    return new Ros2Player({ domainId, metricsCollector: args.metricsCollector, sourceId: this.id });\n  }\n}\n\nexport default Ros2SocketDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link } from \"@mui/material\";\n\nimport { IDataSourceFactory } from \"@foxglove/studio-base\";\n\nexport default class Ros2UnavailableDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros2-socket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"ROS 2\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"ROS\";\n\n  public disabledReason = (\n    <>\n      Use the{\" \"}\n      <Link\n        href=\"https://foxglove.dev/docs/studio/connection/ros2#foxglove-websocket\"\n        target=\"_blank\"\n        rel=\"noreferrer\"\n      >\n        Foxglove WebSocket\n      </Link>{\" \"}\n      connection to connect to your ROS 2 system.\n    </>\n  );\n\n  public initialize(): ReturnType<IDataSourceFactory[\"initialize\"]> {\n    return;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { parse as parseMessageDefinition } from \"@foxglove/rosmsg\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\ntype DatatypeDescription = {\n  messageDefinition: string;\n  type: string;\n};\n\n// Extract one big list of datatypes from the individual connections.\nexport function bagConnectionsToDatatypes(\n  connections: readonly DatatypeDescription[],\n  { ros2 }: { ros2: boolean },\n): RosDatatypes {\n  const datatypes: RosDatatypes = new Map();\n  connections.forEach((connection) => {\n    const connectionDefinitions = parseMessageDefinition(connection.messageDefinition, { ros2 });\n    connectionDefinitions.forEach(({ name, definitions }, index) => {\n      // The first definition usually doesn't have an explicit name,\n      // so we get the name from the datatype.\n      if (index === 0) {\n        datatypes.set(connection.type, { name: connection.type, definitions });\n      } else if (name != undefined) {\n        datatypes.set(name, { name, definitions });\n      }\n    });\n  });\n  return datatypes;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { isEqual, sortBy, transform, keyBy } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport roslib from \"@foxglove/roslibjs\";\nimport { parse as parseMessageDefinition } from \"@foxglove/rosmsg\";\nimport { LazyMessageReader } from \"@foxglove/rosmsg-serialization\";\nimport { MessageReader as ROS2MessageReader } from \"@foxglove/rosmsg2-serialization\";\nimport { Time, fromMillis, toSec } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerCapabilities,\n  PlayerState,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  PlayerPresence,\n  PlayerMetricsCollectorInterface,\n  TopicStats,\n  TopicWithSchemaName,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { bagConnectionsToDatatypes } from \"@foxglove/studio-base/util/bagConnectionsHelper\";\n\nconst log = Log.getLogger(__dirname);\n\nconst CAPABILITIES = [PlayerCapabilities.advertise, PlayerCapabilities.callServices];\n\ntype RosNodeDetails = Record<\n  \"subscriptions\" | \"publications\" | \"services\",\n  { node: string; values: string[] }\n>;\n\nfunction collateNodeDetails(\n  details: RosNodeDetails[],\n  key: keyof RosNodeDetails,\n): Map<string, Set<string>> {\n  return transform(\n    details,\n    (acc, detail) => {\n      const { node, values } = detail[key];\n      for (const value of values) {\n        if (!acc.has(value)) {\n          acc.set(value, new Set());\n        }\n        acc.get(value)?.add(node);\n      }\n    },\n    new Map<string, Set<string>>(),\n  );\n}\n\nfunction isClockMessage(topic: string, msg: unknown): msg is { clock: Time } {\n  const maybeClockMsg = msg as { clock?: Time };\n  return topic === \"/clock\" && maybeClockMsg.clock != undefined && !isNaN(maybeClockMsg.clock.sec);\n}\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value != undefined;\n}\n\n// Connects to `rosbridge_server` instance using `roslibjs`. Currently doesn't support seeking or\n// showing simulated time, so current time from Date.now() is always used instead. Also doesn't yet\n// support raw ROS messages; instead we use the CBOR compression provided by roslibjs, which\n// unmarshalls into plain JS objects.\nexport default class RosbridgePlayer implements Player {\n  private _url: string; // WebSocket URL.\n  private _rosClient?: roslib.Ros; // The roslibjs client when we're connected.\n  private _id: string = uuidv4(); // Unique ID for this player.\n  private _isRefreshing = false; // True if currently refreshing the node graph.\n  private _listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState().\n  private _closed: boolean = false; // Whether the player has been completely closed using close().\n  private _providerTopics?: TopicWithSchemaName[]; // Topics as published by the WebSocket.\n  private _providerTopicsStats = new Map<string, TopicStats>(); // topic names to topic statistics.\n  private _providerDatatypes?: RosDatatypes; // Datatypes as published by the WebSocket.\n  private _publishedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of publisher IDs publishing each topic.\n  private _subscribedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of subscriber IDs subscribed to each topic.\n  private _services = new Map<string, Set<string>>(); // A map of service names to service provider IDs that provide each service.\n  private _messageReadersByDatatype: {\n    [datatype: string]: LazyMessageReader | ROS2MessageReader;\n  } = {};\n  private _start?: Time; // The time at which we started playing.\n  private _clockTime?: Time; // The most recent published `/clock` time, if available\n  // active subscriptions\n  private _topicSubscriptions = new Map<string, roslib.Topic>();\n  private _requestedSubscriptions: SubscribePayload[] = []; // Requested subscriptions by setSubscriptions()\n  private _parsedMessages: MessageEvent<unknown>[] = []; // Queue of messages that we'll send in next _emitState() call.\n  private _requestTopicsTimeout?: ReturnType<typeof setTimeout>; // setTimeout() handle for _requestTopics().\n  // active publishers for the current connection\n  private _topicPublishers = new Map<string, roslib.Topic>();\n  // which topics we want to advertise to other nodes\n  private _advertisements: AdvertiseOptions[] = [];\n  private _parsedTopics: Set<string> = new Set();\n  private _receivedBytes: number = 0;\n  private _metricsCollector: PlayerMetricsCollectorInterface;\n  private _hasReceivedMessage = false;\n  private _presence: PlayerPresence = PlayerPresence.NOT_PRESENT;\n  private _problems = new PlayerProblemManager();\n  private _emitTimer?: ReturnType<typeof setTimeout>;\n  private _serviceTypeCache = new Map<string, Promise<string>>();\n  private readonly _sourceId: string;\n  private _rosVersion: 1 | 2 | undefined;\n\n  public constructor({\n    url,\n    metricsCollector,\n    sourceId,\n  }: {\n    url: string;\n    metricsCollector: PlayerMetricsCollectorInterface;\n    sourceId: string;\n  }) {\n    this._presence = PlayerPresence.INITIALIZING;\n    this._metricsCollector = metricsCollector;\n    this._url = url;\n    this._start = fromMillis(Date.now());\n    this._metricsCollector.playerConstructed();\n    this._sourceId = sourceId;\n    this._open();\n  }\n\n  private _open = (): void => {\n    if (this._closed) {\n      return;\n    }\n    if (this._rosClient != undefined) {\n      throw new Error(`Attempted to open a second Rosbridge connection`);\n    }\n    this._problems.removeProblem(\"rosbridge:connection-failed\");\n    log.info(`Opening connection to ${this._url}`);\n\n    // `workersocket` will open the actual WebSocket connection in a WebWorker.\n    const rosClient = new roslib.Ros({ url: this._url, transportLibrary: \"workersocket\" });\n\n    rosClient.on(\"connection\", () => {\n      log.info(`Connected to ${this._url}`);\n      if (this._closed) {\n        return;\n      }\n      this._presence = PlayerPresence.PRESENT;\n      this._problems.removeProblem(\"rosbridge:connection-failed\");\n      this._rosClient = rosClient;\n\n      this._setupPublishers();\n      void this._requestTopics({ forceUpdate: true });\n    });\n\n    rosClient.on(\"error\", (err) => {\n      if (err) {\n        this._problems.addProblem(\"rosbridge:error\", {\n          severity: \"warn\",\n          message: \"Rosbridge error\",\n          error: err,\n        });\n        this._emitState();\n      }\n    });\n\n    rosClient.on(\"close\", () => {\n      this._presence = PlayerPresence.RECONNECTING;\n\n      if (this._requestTopicsTimeout) {\n        clearTimeout(this._requestTopicsTimeout);\n      }\n      for (const [topicName, topic] of this._topicSubscriptions) {\n        topic.unsubscribe();\n        this._topicSubscriptions.delete(topicName);\n      }\n      rosClient.close(); // ensure the underlying worker is cleaned up\n      delete this._rosClient;\n\n      this._problems.addProblem(\"rosbridge:connection-failed\", {\n        severity: \"error\",\n        message: \"Connection failed\",\n        tip: `Check that the rosbridge WebSocket server at ${this._url} is reachable.`,\n      });\n\n      this._emitState();\n\n      // Try connecting again.\n      setTimeout(this._open, 3000);\n    });\n  };\n\n  private _topicsChanged = (newTopics: Topic[]): boolean => {\n    if (!this._providerTopics || newTopics.length !== this._providerTopics.length) {\n      return true;\n    }\n    return !isEqual(this._providerTopics, newTopics);\n  };\n\n  private async _requestTopics(opt?: { forceUpdate: boolean }): Promise<void> {\n    const { forceUpdate = false } = opt ?? {};\n    // clear problems before each topics request so we don't have stale problems from previous failed requests\n    this._problems.removeProblems((id) => id.startsWith(\"requestTopics:\"));\n\n    if (this._requestTopicsTimeout) {\n      clearTimeout(this._requestTopicsTimeout);\n    }\n    const rosClient = this._rosClient;\n    if (!rosClient || this._closed) {\n      return;\n    }\n\n    // getTopicsAndRawTypes might silently hang. When this happens, there is no indication to the user\n    // that the connection is doing anything and studio shows no errors and no data.\n    // This logic adds a warning after 5 seconds (picked arbitrarily) to display a notice to the user.\n    const topicsStallWarningTimeout = setTimeout(() => {\n      this._problems.addProblem(\"topicsAndRawTypesTimeout\", {\n        severity: \"warn\",\n        message: \"Taking too long to get topics and raw types.\",\n      });\n\n      this._emitState();\n    }, 5000);\n\n    try {\n      const result = await new Promise<{\n        topics: string[];\n        types: string[];\n        typedefs_full_text: string[];\n      }>((resolve, reject) => rosClient.getTopicsAndRawTypes(resolve, reject));\n\n      clearTimeout(topicsStallWarningTimeout);\n      this._problems.removeProblem(\"topicsAndRawTypesTimeout\");\n\n      const topicsMissingDatatypes: string[] = [];\n      const topics: TopicWithSchemaName[] = [];\n      const datatypeDescriptions = [];\n      const messageReaders: Record<string, LazyMessageReader | ROS2MessageReader> = {};\n\n      // Automatically detect the ROS version based on the datatypes.\n      // The rosbridge server itself publishes /rosout so the topic should be reliably present.\n      if (result.types.includes(\"rcl_interfaces/msg/Log\")) {\n        this._rosVersion = 2;\n        this._problems.removeProblem(\"unknownRosVersion\");\n      } else if (result.types.includes(\"rosgraph_msgs/Log\")) {\n        this._rosVersion = 1;\n        this._problems.removeProblem(\"unknownRosVersion\");\n      } else {\n        this._rosVersion = 1;\n        this._problems.addProblem(\"unknownRosVersion\", {\n          severity: \"warn\",\n          message: \"Unable to detect ROS version, assuming ROS 1\",\n        });\n      }\n\n      for (let i = 0; i < result.topics.length; i++) {\n        const topicName = result.topics[i]!;\n        const type = result.types[i];\n        const messageDefinition = result.typedefs_full_text[i];\n\n        if (type == undefined || messageDefinition == undefined) {\n          topicsMissingDatatypes.push(topicName);\n          continue;\n        }\n        topics.push({ name: topicName, schemaName: type });\n        datatypeDescriptions.push({ type, messageDefinition });\n        const parsedDefinition = parseMessageDefinition(messageDefinition, {\n          ros2: this._rosVersion === 2,\n        });\n        // https://github.com/typescript-eslint/typescript-eslint/issues/6632\n        if (!messageReaders[type]) {\n          messageReaders[type] =\n            this._rosVersion !== 2\n              ? new LazyMessageReader(parsedDefinition)\n              : new ROS2MessageReader(parsedDefinition);\n        }\n      }\n\n      // We call requestTopics on a timeout to check for new topics. If there are no changes to topics\n      // we want to bail and avoid updating readers, subscribers, etc.\n      // However, during a re-connect, we _do_ want to refresh this list and re-subscribe\n      const sortedTopics = sortBy(topics, \"name\");\n      if (!forceUpdate && !this._topicsChanged(sortedTopics)) {\n        return;\n      }\n\n      if (topicsMissingDatatypes.length > 0) {\n        this._problems.addProblem(\"requestTopics:missing-types\", {\n          severity: \"warn\",\n          message: \"Could not resolve all message types\",\n          tip: `Message types could not be found for these topics: ${topicsMissingDatatypes.join(\n            \",\",\n          )}`,\n        });\n      }\n\n      // Remove stats entries for removed topics\n      const topicsSet = new Set<string>(topics.map((topic) => topic.name));\n      for (const topic of this._providerTopicsStats.keys()) {\n        if (!topicsSet.has(topic)) {\n          this._providerTopicsStats.delete(topic);\n        }\n      }\n\n      this._providerTopics = sortedTopics;\n\n      this._providerDatatypes = bagConnectionsToDatatypes(datatypeDescriptions, {\n        ros2: this._rosVersion === 2,\n      });\n      this._messageReadersByDatatype = messageReaders;\n\n      // Try subscribing again, since we might now be able to subscribe to some new topics.\n      this.setSubscriptions(this._requestedSubscriptions);\n\n      // Refresh the full graph topology\n      this._refreshSystemState().catch((error) => log.error(error));\n    } catch (error) {\n      log.error(error);\n      clearTimeout(topicsStallWarningTimeout);\n      this._problems.removeProblem(\"topicsAndRawTypesTimeout\");\n\n      this._problems.addProblem(\"requestTopics:error\", {\n        severity: \"error\",\n        message: \"Failed to fetch topics from rosbridge\",\n        error,\n      });\n    } finally {\n      this._emitState();\n\n      // Regardless of what happens, request topics again in a little bit.\n      this._requestTopicsTimeout = setTimeout(() => void this._requestTopics(), 3000);\n    }\n  }\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  private _emitState = debouncePromise(() => {\n    if (!this._listener || this._closed) {\n      return Promise.resolve();\n    }\n\n    const { _providerTopics, _providerDatatypes, _start } = this;\n    if (!_providerTopics || !_providerDatatypes || !_start) {\n      return this._listener({\n        name: this._url,\n        presence: this._presence,\n        progress: {},\n        capabilities: CAPABILITIES,\n        profile: undefined,\n        playerId: this._id,\n        activeData: undefined,\n        problems: this._problems.problems(),\n        urlState: {\n          sourceId: this._sourceId,\n          parameters: { url: this._url },\n        },\n      });\n    }\n\n    // When connected\n    // Time is always moving forward even if we don't get messages from the server.\n    if (this._presence === PlayerPresence.PRESENT) {\n      if (this._emitTimer != undefined) {\n        clearTimeout(this._emitTimer);\n      }\n      this._emitTimer = setTimeout(this._emitState, 100);\n    }\n\n    const currentTime = this._getCurrentTime();\n    const messages = this._parsedMessages;\n    this._parsedMessages = [];\n    return this._listener({\n      name: this._url,\n      presence: this._presence,\n      progress: {},\n      capabilities: CAPABILITIES,\n      profile: this._rosVersion === 2 ? \"ros2\" : \"ros1\",\n      playerId: this._id,\n      problems: this._problems.problems(),\n      urlState: {\n        sourceId: this._sourceId,\n        parameters: { url: this._url },\n      },\n\n      activeData: {\n        messages,\n        totalBytesReceived: this._receivedBytes,\n        startTime: _start,\n        endTime: currentTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        // We don't support seeking, so we need to set this to any fixed value. Just avoid 0 so\n        // that we don't accidentally hit falsy checks.\n        lastSeekTime: 1,\n        topics: _providerTopics,\n        // Always copy topic stats since message counts and timestamps are being updated\n        topicStats: new Map(this._providerTopicsStats),\n        datatypes: _providerDatatypes,\n        publishedTopics: this._publishedTopics,\n        subscribedTopics: this._subscribedTopics,\n        services: this._services,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this._listener = listener;\n    this._emitState();\n  }\n\n  public close(): void {\n    this._closed = true;\n    if (this._rosClient) {\n      this._rosClient.close();\n    }\n    if (this._emitTimer != undefined) {\n      clearTimeout(this._emitTimer);\n      this._emitTimer = undefined;\n    }\n    this._metricsCollector.close();\n    this._hasReceivedMessage = false;\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this._requestedSubscriptions = subscriptions;\n\n    if (!this._rosClient || this._closed) {\n      return;\n    }\n\n    // Subscribe to additional topics used by RosbridgePlayer itself\n    this._addInternalSubscriptions(subscriptions);\n\n    this._parsedTopics = new Set(subscriptions.map(({ topic }) => topic));\n\n    // See what topics we actually can subscribe to.\n    const availableTopicsByTopicName = keyBy(this._providerTopics ?? [], ({ name }) => name);\n    const topicNames = subscriptions\n      .map(({ topic }) => topic)\n      .filter((topicName) => availableTopicsByTopicName[topicName]);\n\n    // Subscribe to all topics that we aren't subscribed to yet.\n    for (const topicName of topicNames) {\n      if (this._topicSubscriptions.has(topicName)) {\n        continue;\n      }\n      const topic = new roslib.Topic({\n        ros: this._rosClient,\n        name: topicName,\n        compression: \"cbor-raw\",\n      });\n      const availTopic = availableTopicsByTopicName[topicName];\n      if (!availTopic) {\n        continue;\n      }\n\n      const { schemaName } = availTopic;\n      const messageReader = this._messageReadersByDatatype[schemaName];\n      if (!messageReader) {\n        continue;\n      }\n\n      const problemId = `message:${topicName}`;\n      topic.subscribe((message) => {\n        if (!this._providerTopics) {\n          return;\n        }\n        try {\n          const buffer = (message as { bytes: ArrayBuffer }).bytes;\n          const bytes = new Uint8Array(buffer);\n\n          // This conditional can be removed when the ROS2 deserializer supports size()\n          if (messageReader instanceof LazyMessageReader) {\n            const msgSize = messageReader.size(bytes);\n            if (msgSize > bytes.byteLength) {\n              this._problems.addProblem(problemId, {\n                severity: \"error\",\n                message: `Message buffer not large enough on ${topicName}`,\n                error: new Error(\n                  `Cannot read ${msgSize} byte message from ${bytes.byteLength} byte buffer`,\n                ),\n              });\n              this._emitState();\n              return;\n            }\n          }\n\n          const innerMessage = messageReader.readMessage(bytes);\n\n          // handle clock messages before choosing receiveTime so the clock can set its own receive time\n          if (isClockMessage(topicName, innerMessage)) {\n            const time = innerMessage.clock;\n            const seconds = toSec(innerMessage.clock);\n            if (!isNaN(seconds)) {\n              if (this._clockTime == undefined) {\n                this._start = time;\n              }\n\n              this._clockTime = time;\n            }\n          }\n          const receiveTime = this._getCurrentTime();\n\n          if (!this._hasReceivedMessage) {\n            this._hasReceivedMessage = true;\n            this._metricsCollector.recordTimeToFirstMsgs();\n          }\n\n          if (this._parsedTopics.has(topicName)) {\n            const msg: MessageEvent<unknown> = {\n              topic: topicName,\n              receiveTime,\n              message: innerMessage,\n              schemaName,\n              sizeInBytes: bytes.byteLength,\n            };\n            this._parsedMessages.push(msg);\n          }\n          this._problems.removeProblem(problemId);\n\n          // Update the message count for this topic\n          let stats = this._providerTopicsStats.get(topicName);\n          if (this._topicSubscriptions.has(topicName)) {\n            if (!stats) {\n              stats = { numMessages: 0 };\n              this._providerTopicsStats.set(topicName, stats);\n            }\n            stats.numMessages++;\n          }\n        } catch (error) {\n          this._problems.addProblem(problemId, {\n            severity: \"error\",\n            message: `Failed to parse message on ${topicName}`,\n            error,\n          });\n        }\n\n        this._emitState();\n      });\n      this._topicSubscriptions.set(topicName, topic);\n    }\n\n    // Unsubscribe from topics that we are subscribed to but shouldn't be.\n    for (const [topicName, topic] of this._topicSubscriptions) {\n      if (!topicNames.includes(topicName)) {\n        topic.unsubscribe();\n        this._topicSubscriptions.delete(topicName);\n\n        // Reset the message count for this topic\n        this._providerTopicsStats.delete(topicName);\n      }\n    }\n  }\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    // Since `setPublishers` is rarely called, we can get away with just throwing away the old\n    // Roslib.Topic objects and creating new ones.\n    for (const publisher of this._topicPublishers.values()) {\n      publisher.unadvertise();\n    }\n    this._topicPublishers.clear();\n    this._advertisements = publishers;\n    this._setupPublishers();\n  }\n\n  public setParameter(_key: string, _value: ParameterValue): void {\n    throw new Error(\"Parameter editing is not supported by the Rosbridge connection\");\n  }\n\n  public publish({ topic, msg }: PublishPayload): void {\n    const publisher = this._topicPublishers.get(topic);\n    if (!publisher) {\n      if (this._advertisements.some((opts) => opts.topic === topic)) {\n        // Topic was advertised but the connection is not yet established\n        return;\n      }\n      throw new Error(\n        `Tried to publish on a topic that is not registered as a publisher: ${topic}`,\n      );\n    }\n    publisher.publish(msg);\n  }\n\n  // Query the type name for this service. Cache the query to avoid looking it up again.\n  private async getServiceType(service: string): Promise<string> {\n    if (!this._rosClient) {\n      throw new Error(\"Not connected\");\n    }\n\n    const existing = this._serviceTypeCache.get(service);\n    if (existing) {\n      return await existing;\n    }\n\n    const rosClient = this._rosClient;\n    const serviceTypePromise = new Promise<string>((resolve, reject) => {\n      rosClient.getServiceType(service, resolve, reject);\n    });\n\n    this._serviceTypeCache.set(service, serviceTypePromise);\n\n    return await serviceTypePromise;\n  }\n\n  public async callService(service: string, request: unknown): Promise<unknown> {\n    if (!this._rosClient) {\n      throw new Error(\"Not connected\");\n    }\n\n    if (!isRecord(request)) {\n      throw new Error(\"RosbridgePlayer#callService request must be an object\");\n    }\n\n    const serviceType = await this.getServiceType(service);\n\n    // Create a proxy object for dispatching our service call\n    const proxy = new roslib.Service({\n      ros: this._rosClient,\n      name: service,\n      serviceType,\n    });\n\n    // Send the service request\n    return await new Promise<Record<string, unknown>>((resolve, reject) => {\n      proxy.callService(\n        request,\n        (response: Record<string, unknown>) => resolve(response),\n        (error: Error) => reject(error),\n      );\n    });\n  }\n\n  // Bunch of unsupported stuff. Just don't do anything for these.\n  public startPlayback(): void {\n    // no-op\n  }\n  public pausePlayback(): void {\n    // no-op\n  }\n  public seekPlayback(_time: Time): void {\n    // no-op\n  }\n  public setPlaybackSpeed(_speedFraction: number): void {\n    // no-op\n  }\n  public setGlobalVariables(): void {\n    // no-op\n  }\n\n  private _setupPublishers(): void {\n    // This function will be called again once a connection is established\n    if (!this._rosClient) {\n      return;\n    }\n\n    if (this._advertisements.length <= 0) {\n      return;\n    }\n\n    for (const { topic, schemaName: datatype } of this._advertisements) {\n      const roslibTopic = new roslib.Topic({\n        ros: this._rosClient,\n        name: topic,\n        messageType: datatype,\n        queue_size: 0,\n      });\n      this._topicPublishers.set(topic, roslibTopic);\n      roslibTopic.advertise();\n    }\n  }\n\n  private _addInternalSubscriptions(subscriptions: SubscribePayload[]): void {\n    // Always subscribe to /clock if available\n    if (subscriptions.find((sub) => sub.topic === \"/clock\") == undefined) {\n      subscriptions.unshift({\n        topic: \"/clock\",\n      });\n    }\n  }\n\n  private _getCurrentTime(): Time {\n    return this._clockTime ?? fromMillis(Date.now());\n  }\n\n  // Refreshes the full system state graph. Runs in the background so we don't\n  // block app startup while mapping large node graphs.\n  private async _refreshSystemState(): Promise<void> {\n    if (this._isRefreshing) {\n      return;\n    }\n\n    try {\n      this._isRefreshing = true;\n\n      const nodes = await new Promise<string[]>((resolve, reject) => {\n        this._rosClient?.getNodes((fetchedNodes) => resolve(fetchedNodes), reject);\n      });\n\n      const promises = nodes.map(async (node) => {\n        return await new Promise<RosNodeDetails>((resolve, reject) => {\n          this._rosClient?.getNodeDetails(\n            node,\n            (subscriptions, publications, services) => {\n              resolve({\n                publications: { node, values: publications },\n                services: { node, values: services },\n                subscriptions: { node, values: subscriptions },\n              });\n            },\n            reject,\n          );\n        });\n      });\n\n      const results = await Promise.allSettled(promises);\n      const fulfilled = filterMap(results, (item) =>\n        item.status === \"fulfilled\" ? item.value : undefined,\n      );\n      this._publishedTopics = collateNodeDetails(fulfilled, \"publications\");\n      this._subscribedTopics = collateNodeDetails(fulfilled, \"subscriptions\");\n      this._services = collateNodeDetails(fulfilled, \"services\");\n\n      this._emitState();\n    } catch (error) {\n      this._problems.addProblem(\"requestTopics:system-state\", {\n        severity: \"error\",\n        message: \"Failed to fetch node details from rosbridge\",\n        error,\n      });\n    } finally {\n      this._isRefreshing = false;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport RosbridgePlayer from \"@foxglove/studio-base/players/RosbridgePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass RosbridgeDataSourceFactory implements IDataSourceFactory {\n  public id = \"rosbridge-websocket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Rosbridge\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"Flow\";\n  public docsLinks = [{ url: \"https://foxglove.dev/docs/studio/connection/rosbridge\" }];\n  public description = \"Connect to a ROS 1 or ROS 2 system using the Rosbridge WebSocket protocol.\";\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"WebSocket URL\",\n        defaultValue: \"ws://localhost:9090\",\n        validate: (newValue: string): Error | undefined => {\n          try {\n            const url = new URL(newValue);\n            if (url.protocol !== \"ws:\" && url.protocol !== \"wss:\") {\n              return new Error(`Invalid protocol: ${url.protocol}`);\n            }\n            return undefined;\n          } catch (err) {\n            return new Error(\"Enter a valid url\");\n          }\n        },\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      return;\n    }\n\n    return new RosbridgePlayer({ url, metricsCollector: args.metricsCollector, sourceId: this.id });\n  }\n}\n\nexport default RosbridgeDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass UlogLocalDataSourceFactory implements IDataSourceFactory {\n  public id = \"ulog-local-file\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"PX4 ULog\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".ulg\", \".ulog\"];\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const file = args.file;\n    if (!file) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/ulog/UlogIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { file },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name: file.name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default UlogLocalDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport path from \"path\";\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nconst initWorkers: Record<string, () => Worker> = {\n  \".bag\": () => {\n    return new Worker(\n      // foxglove-depcheck-used: babel-plugin-transform-import-meta\n      new URL(\n        \"@foxglove/studio-base/players/IterablePlayer/BagIterableSourceWorker.worker\",\n        import.meta.url,\n      ),\n    );\n  },\n  \".mcap\": () => {\n    return new Worker(\n      // foxglove-depcheck-used: babel-plugin-transform-import-meta\n      new URL(\n        \"@foxglove/studio-base/players/IterablePlayer/Mcap/McapIterableSourceWorker.worker\",\n        import.meta.url,\n      ),\n    );\n  },\n};\n\nclass RemoteDataSourceFactory implements IDataSourceFactory {\n  public id = \"remote-file\";\n\n  // The remote file feature use to be handled by two separate factories with these IDs.\n  // We consolidated this into one factory that appears in the \"connection\" list and has a `url` field.\n  //\n  // To keep backwards compatability with deep-link urls that used these ids we provide them as legacy aliases\n  public legacyIds = [\"mcap-remote-file\", \"ros1-remote-bagfile\"];\n\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Remote file\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"FileASPX\";\n  public supportedFileTypes = [\".bag\", \".mcap\"];\n  public description = \"Open pre-recorded .bag or .mcap files from a remote location.\";\n  public docsLinks = [\n    { label: \"ROS 1\", url: \"https://foxglove.dev/docs/studio/connection/ros1#cloud-data\" },\n    { label: \"MCAP\", url: \"https://foxglove.dev/docs/studio/connection/mcap#cloud-data\" },\n  ];\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"Remote file URL\",\n        placeholder: \"https://example.com/file.bag\",\n        validate: (newValue: string): Error | undefined => {\n          return this.validateUrl(newValue);\n        },\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      throw new Error(\"Missing url argument\");\n    }\n\n    const extension = path.extname(new URL(url).pathname);\n    const initWorker = initWorkers[extension];\n    if (!initWorker) {\n      throw new Error(`Unsupported extension: ${extension}`);\n    }\n\n    const source = new WorkerIterableSource({ initWorker, initArgs: { url } });\n\n    return new IterablePlayer({\n      source,\n      name: url,\n      metricsCollector: args.metricsCollector,\n      // Use blank url params so the data source is set in the url\n      urlParams: { url },\n      sourceId: this.id,\n    });\n  }\n\n  private validateUrl(newValue: string): Error | undefined {\n    try {\n      const url = new URL(newValue);\n      const extension = path.extname(url.pathname);\n\n      if (extension.length === 0) {\n        return new Error(\"URL must end with a filename and extension\");\n      }\n\n      if (!this.supportedFileTypes.includes(extension)) {\n        const supportedExtensions = new Intl.ListFormat(\"en-US\", { style: \"long\" }).format(\n          this.supportedFileTypes,\n        );\n        return new Error(`Only ${supportedExtensions} files are supported.`);\n      }\n\n      return undefined;\n    } catch (err) {\n      return new Error(\"Enter a valid url\");\n    }\n  }\n}\n\nexport default RemoteDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { Sockets, UdpRemoteInfo, UdpSocketRenderer } from \"@foxglove/electron-socket/renderer\";\nimport Logger from \"@foxglove/log\";\nimport { Time, fromMillis, add as addTimes, toDate, fromDate, fromMicros } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerMetricsCollectorInterface,\n  PlayerPresence,\n  PlayerState,\n  PlayerProblem,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { Model, RawPacket, ReturnMode, packetRate } from \"@foxglove/velodyne-cloud\";\n\nconst log = Logger.getLogger(__filename);\n\nexport const DEFAULT_VELODYNE_PORT = 2369;\n\nconst RPM = 600;\nconst PROBLEM_SOCKET_ERROR = \"SOCKET_ERROR\";\nconst TOPIC_NAME = \"/velodyne_points\";\nconst TOPIC: Topic = { name: TOPIC_NAME, schemaName: \"velodyne_msgs/VelodyneScan\" };\nconst DATATYPES: RosDatatypes = new Map(\n  Object.entries({\n    \"velodyne_msgs/VelodyneScan\": {\n      name: \"velodyne_msgs/VelodyneScan\",\n      definitions: [\n        { type: \"std_msgs/Header\", name: \"header\", isArray: false, isComplex: true },\n        { type: \"velodyne_msgs/VelodynePacket\", name: \"packets\", isArray: true, isComplex: true },\n      ],\n    },\n    \"velodyne_msgs/VelodynePacket\": {\n      name: \"velodyne_msgs/VelodynePacket\",\n      definitions: [\n        { type: \"time\", name: \"stamp\", isArray: false, isComplex: false },\n        { type: \"uint8\", name: \"data\", isArray: true, arrayLength: 1206, isComplex: false },\n      ],\n    },\n    \"std_msgs/Header\": {\n      name: \"std_msgs/Header\",\n      definitions: [\n        { name: \"seq\", type: \"uint32\", isArray: false },\n        { name: \"stamp\", type: \"time\", isArray: false },\n        { name: \"frame_id\", type: \"string\", isArray: false },\n      ],\n    },\n  }),\n);\nconst CAPABILITIES: string[] = [];\n\ntype VelodynePlayerOpts = {\n  port?: number;\n  metricsCollector: PlayerMetricsCollectorInterface;\n};\n\nexport default class VelodynePlayer implements Player {\n  private _id: string = uuidv4(); // Unique ID for this player\n  private _port: number; // Listening UDP port\n  private _listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState()\n  private _socket?: UdpSocketRenderer;\n  private _seq = 0;\n  private _totalBytesReceived = 0;\n  private _closed: boolean = false; // Whether the player has been completely closed using close()\n  private _topic: Topic = { ...TOPIC }; // The one topic we are \"subscribed\" to\n  private _topics = [this._topic]; // Stable list of all topics\n  private _topicStats = new Map<string, TopicStats>(); // Message count and timestamps for our single topic\n  private _start: Time; // The time at which we started playing\n  private _packets: RawPacket[] = []; // Queue of packets that will form the next parsed message\n  private _parsedMessages: MessageEvent<unknown>[] = []; // Queue of messages that we'll send in next _emitState() call\n  private _metricsCollector: PlayerMetricsCollectorInterface;\n  private _presence: PlayerPresence = PlayerPresence.INITIALIZING;\n  private _emitTimer?: ReturnType<typeof setTimeout>;\n\n  // track issues within the player\n  private _problems: PlayerProblem[] = [];\n  private _problemsById = new Map<string, PlayerProblem>();\n\n  public constructor({ port, metricsCollector }: VelodynePlayerOpts) {\n    this._port = port ?? DEFAULT_VELODYNE_PORT;\n    log.info(`initializing VelodynePlayer on port ${this._port}`);\n    this._metricsCollector = metricsCollector;\n    this._start = fromMillis(Date.now());\n    this._metricsCollector.playerConstructed();\n    void this._open();\n  }\n\n  private _open = async (): Promise<void> => {\n    if (this._closed) {\n      return;\n    }\n    this._presence = PlayerPresence.PRESENT;\n    this._emitState();\n\n    if (this._socket == undefined) {\n      const net = await Sockets.Create();\n      this._socket = await net.createUdpSocket();\n      this._socket.on(\"error\", (error) => {\n        this._addProblem(PROBLEM_SOCKET_ERROR, {\n          message: \"Networking error listening for Velodyne data\",\n          severity: \"error\",\n          error,\n          tip: \"Check that your are connected to the same local network (subnet) as the Velodyne sensor\",\n        });\n      });\n      this._socket.on(\"message\", this._handleMessage);\n    } else {\n      try {\n        await this._socket.close();\n      } catch (err) {\n        log.error(`Failed to close socket: ${err}`);\n      }\n    }\n\n    try {\n      await this._socket.bind({ address: \"0.0.0.0\", port: this._port });\n      log.debug(`Bound Velodyne UDP listener socket to port ${this._port}`);\n    } catch (error) {\n      this._addProblem(PROBLEM_SOCKET_ERROR, {\n        message: \"Could not bind to the Velodyne UDP data port\",\n        severity: \"error\",\n        error,\n        tip: `Check that port ${this._port} is not in use by another application`,\n      });\n    }\n  };\n\n  private _handleMessage = (data: Uint8Array, rinfo: UdpRemoteInfo): void => {\n    const receiveTime = fromMillis(Date.now());\n    const date = toDate(receiveTime);\n    date.setMinutes(0, 0, 0);\n    const topOfHour = fromDate(date);\n\n    this._totalBytesReceived += data.byteLength;\n    this._presence = PlayerPresence.PRESENT;\n    this._clearProblem(PROBLEM_SOCKET_ERROR, { skipEmit: true });\n\n    if (this._seq === 0) {\n      this._metricsCollector.recordTimeToFirstMsgs();\n    }\n\n    const rawPacket = new RawPacket(data);\n\n    const frequency = RPM / 60.0;\n    const rate =\n      rawPacket.returnMode === ReturnMode.DualReturn\n        ? packetRate(rawPacket.inferModel() ?? Model.HDL64E) * 2\n        : packetRate(rawPacket.inferModel() ?? Model.HDL64E);\n    const numPackets = Math.ceil(rate / frequency);\n\n    this._packets.push(rawPacket);\n    if (this._packets.length >= numPackets) {\n      const message = {\n        header: { seq: this._seq++, stamp: receiveTime, frame_id: rinfo.address },\n        packets: this._packets.map((raw) => rawPacketToRos(raw, topOfHour)),\n      };\n\n      const sizeInBytes = this._packets.reduce((acc, packet) => acc + packet.data.byteLength, 0);\n      const msg: MessageEvent<unknown> = {\n        topic: TOPIC_NAME,\n        receiveTime,\n        message,\n        sizeInBytes,\n        schemaName: TOPIC.schemaName ?? \"\",\n      };\n      this._parsedMessages.push(msg);\n      this._packets = [];\n\n      // Update the message count\n      let stats = this._topicStats.get(TOPIC_NAME);\n      if (!stats) {\n        stats = { numMessages: 0 };\n        this._topicStats.set(TOPIC_NAME, stats);\n      }\n      stats.numMessages++;\n      stats.firstMessageTime ??= receiveTime;\n      stats.lastMessageTime = receiveTime;\n\n      this._emitState();\n    }\n  };\n\n  private _addProblem(\n    id: string,\n    problem: PlayerProblem,\n    { skipEmit = false }: { skipEmit?: boolean } = {},\n  ): void {\n    this._problemsById.set(id, problem);\n    this._problems = Array.from(this._problemsById.values());\n    if (!skipEmit) {\n      this._emitState();\n    }\n  }\n\n  private _clearProblem(id: string, { skipEmit = false }: { skipEmit?: boolean } = {}): void {\n    if (!this._problemsById.delete(id)) {\n      return;\n    }\n    this._problems = Array.from(this._problemsById.values());\n    if (!skipEmit) {\n      this._emitState();\n    }\n  }\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  private _emitState = debouncePromise(() => {\n    if (!this._listener || this._closed) {\n      return Promise.resolve();\n    }\n\n    // Time is always moving forward even if we don't get messages from the device.\n    // If we are not connected, don't emit updates since we are not longer getting new data\n    if (this._presence === PlayerPresence.PRESENT) {\n      if (this._emitTimer != undefined) {\n        clearTimeout(this._emitTimer);\n      }\n      this._emitTimer = setTimeout(this._emitState, 100);\n    }\n\n    const currentTime = fromMillis(Date.now());\n    const messages = this._parsedMessages;\n    this._parsedMessages = [];\n    return this._listener({\n      name: \"Velodyne\",\n      presence: this._presence,\n      progress: {},\n      capabilities: CAPABILITIES,\n      profile: \"velodyne\",\n      playerId: this._id,\n      problems: this._problems,\n\n      activeData: {\n        messages,\n        totalBytesReceived: this._totalBytesReceived,\n        startTime: this._start,\n        endTime: currentTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        // We don't support seeking, so we need to set this to any fixed value. Just avoid 0 so\n        // that we don't accidentally hit falsy checks.\n        lastSeekTime: 1,\n        topics: this._topics,\n        topicStats: new Map(this._topicStats),\n        datatypes: DATATYPES,\n        publishedTopics: undefined,\n        subscribedTopics: undefined,\n        services: undefined,\n        parameters: undefined,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this._listener = listener;\n    this._emitState();\n  }\n\n  public close(): void {\n    this._closed = true;\n    if (this._socket) {\n      void this._socket.dispose();\n      this._socket = undefined;\n    }\n    if (this._emitTimer != undefined) {\n      clearTimeout(this._emitTimer);\n      this._emitTimer = undefined;\n    }\n    this._metricsCollector.close();\n    this._totalBytesReceived = 0;\n    this._seq = 0;\n    this._packets = [];\n    this._parsedMessages = [];\n  }\n\n  public setSubscriptions(_subscriptions: SubscribePayload[]): void {}\n\n  public setPublishers(_publishers: AdvertiseOptions[]): void {\n    // no-op\n  }\n\n  // Modify a remote parameter such as a rosparam.\n  public setParameter(_key: string, _value: ParameterValue): void {\n    throw new Error(`Parameter modification is not supported for VelodynePlayer`);\n  }\n\n  public publish(_request: PublishPayload): void {\n    throw new Error(`Publishing is not supported for VelodynePlayer`);\n  }\n\n  public async callService(): Promise<unknown> {\n    throw new Error(\"Service calls are not supported for VelodynePlayer\");\n  }\n\n  public setGlobalVariables(_globalVariables: GlobalVariables): void {\n    // no-op\n  }\n}\n\nfunction rawPacketToRos(packet: RawPacket, topOfHour: Time): { stamp: Time; data: Uint8Array } {\n  const microSecSinceTopOfHour = packet.gpsTimestamp;\n  const stamp = addTimes(topOfHour, fromMicros(microSecSinceTopOfHour));\n  return { stamp, data: packet.data };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport VelodynePlayer from \"@foxglove/studio-base/players/VelodynePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass VelodyneDataSourceFactory implements IDataSourceFactory {\n  public id = \"velodyne-device\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Velodyne Lidar\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"GenericScan\";\n  public description =\n    \"Connect directly to Velodyne Lidar hardware to inspect incoming sensor data.\";\n  public docsLinks = [{ url: \"https://foxglove.dev/docs/studio/connection/velodyne\" }];\n\n  public formConfig = {\n    fields: [{ id: \"port\", label: \"UDP Port\", defaultValue: \"2369\" }],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const portStr = args.params?.port;\n    if (portStr == undefined) {\n      return;\n    }\n\n    const port = parseInt(portStr);\n\n    return new VelodynePlayer({ port, metricsCollector: args.metricsCollector });\n  }\n}\n\nexport default VelodyneDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass McapLocalDataSourceFactory implements IDataSourceFactory {\n  public id = \"mcap-local-file\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"MCAP\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".mcap\"];\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const file = args.file;\n    if (!file) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/Mcap/McapIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { file },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name: file.name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default McapLocalDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\n\nimport SampleNuscenesLayout from \"./SampleNuscenesLayout.json\";\n\nclass SampleNuscenesDataSourceFactory implements IDataSourceFactory {\n  public id = \"sample-nuscenes\";\n  public type: IDataSourceFactory[\"type\"] = \"sample\";\n  public displayName = \"Sample: Nuscenes\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"FileASPX\";\n  public hidden = true;\n  public sampleLayout = SampleNuscenesLayout as IDataSourceFactory[\"sampleLayout\"];\n\n  public initialize(\n    args: DataSourceFactoryInitializeArgs,\n  ): ReturnType<IDataSourceFactory[\"initialize\"]> {\n    const bagUrl = \"https://assets.foxglove.dev/NuScenes-v1.0-mini-scene-0061-8c50124.mcap\";\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/Mcap/McapIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { url: bagUrl },\n    });\n\n    return new IterablePlayer({\n      source,\n      isSampleDataSource: true,\n      name: \"Adapted from nuScenes dataset. Copyright © 2020 nuScenes. https://www.nuscenes.org/terms-of-use\",\n      metricsCollector: args.metricsCollector,\n      // Use blank url params so the data source is set in the url\n      urlParams: {},\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default SampleNuscenesDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport type { ColorRGBA, Vector3 } from \"./ros\";\nimport type { Pose } from \"./transforms\";\n\nexport type BaseShape = {\n  pose: Pose;\n  scale: Vector3;\n  color?: ColorRGBA;\n};\n\nexport type MouseEventObject = {\n  object: BaseShape;\n  instanceIndex?: number;\n};\n\nexport type CameraState = {\n  distance: number;\n  perspective: boolean;\n  phi: number;\n  target: readonly [number, number, number];\n  targetOffset: readonly [number, number, number];\n  targetOrientation: readonly [number, number, number, number];\n  thetaOffset: number;\n  fovy: number;\n  near: number;\n  far: number;\n};\n\nexport const DEFAULT_CAMERA_STATE: CameraState = {\n  distance: 20,\n  perspective: true,\n  phi: 60,\n  target: [0, 0, 0],\n  targetOffset: [0, 0, 0],\n  targetOrientation: [0, 0, 0, 1],\n  thetaOffset: 45,\n  fovy: 45,\n  near: 0.5,\n  far: 5000,\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\ntype Args = {\n  topics: Topic[];\n  datatypes: RosDatatypes;\n};\n\n// http://wiki.ros.org/msg\nconst rosPrimitiveToTypescriptTypeMap = new Map<string, string>([\n  [\"uint8\", \"number\"],\n  [\"int8\", \"number\"],\n  [\"uint16\", \"number\"],\n  [\"int16\", \"number\"],\n  [\"uint32\", \"number\"],\n  [\"int32\", \"number\"],\n  [\"float32\", \"number\"],\n  [\"float64\", \"number\"],\n  [\"int64\", \"bigint\"],\n  [\"uint64\", \"bigint\"],\n  [\"string\", \"string\"],\n  [\"bool\", \"boolean\"],\n  [\"time\", \"Time\"],\n  [\"duration\", \"Duration\"],\n]);\n\nexport const typedArrayMap = new Map<string, string>([\n  [\"uint8\", \"Uint8Array\"],\n  [\"int8\", \"Int8Array\"],\n  [\"int16\", \"Int16Array\"],\n  [\"uint16\", \"Uint16Array\"],\n  [\"int32\", \"Int32Array\"],\n  [\"uint32\", \"Uint32Array\"],\n  [\"int64\", \"BigInt64Array\"],\n  [\"uint64\", \"BigUint64Array\"],\n  [\"float32\", \"Float32Array\"],\n  [\"float64\", \"Float64Array\"],\n]);\n\nfunction safeString(str: string): string {\n  return JSON.stringify(str) as string;\n}\n\nexport const generateTypesInterface = (datatypes: RosDatatypes): string => {\n  const seenDatatypes = new Set();\n  let src = `\n    /**\n     * MessageTypeBySchemaName enumerates the message types for for all the schema names\n     * in the current data source.\n     *\n     * You probably want to use Message<...> instead.\n     */\n    export type MessageTypeBySchemaName = {\n  `;\n\n  for (const [datatype, definition] of datatypes) {\n    // Avoid adding a repeating datatype name again.\n    // We shouldn't have this happen so we add a comment indicating it happened.\n    if (seenDatatypes.has(datatype)) {\n      src += `\\n// ${datatype} appeared multiple times`;\n      continue;\n    }\n    seenDatatypes.add(datatype);\n\n    src += `\\n${safeString(datatype)}: {`;\n\n    for (const field of definition.definitions) {\n      const { type, isConstant, isArray } = field;\n      const typedArray = typedArrayMap.get(type);\n      const rosPrimitive = rosPrimitiveToTypescriptTypeMap.get(type);\n\n      const fieldName = safeString(field.name);\n      const sigil = field.optional === true ? \"?\" : \"\";\n\n      if (isConstant === true) {\n        src += `\\n // ${field.name} = ${field.valueText}`;\n      } else if (isArray === true) {\n        if (typedArray) {\n          src += `\\n${fieldName}${sigil}: ${typedArray},`;\n        } else if (rosPrimitive) {\n          src += `\\n${fieldName}${sigil}: ${rosPrimitive}[],`;\n        } else {\n          src += `\\n${fieldName}${sigil}: MessageTypeBySchemaName[${safeString(type)}][],`;\n        }\n      } else {\n        if (rosPrimitive) {\n          src += `\\n${fieldName}${sigil}: ${rosPrimitive},`;\n        } else {\n          src += `\\n${fieldName}${sigil}: MessageTypeBySchemaName[${safeString(type)}],`;\n        }\n      }\n    }\n\n    src += \"\\n},\";\n  }\n\n  src += \"\\n};\";\n\n  return src;\n};\n\nfunction generateTypesByTopicInterface(topics: Topic[]): string {\n  let src = `\n    /**\n     * MessageTypeByTopic enumerates the Messages types for all the topics in\n     * the current data source.\n     *\n     * You probably want to use Input<\"/my-topic\"> instead of MessageTypeByTopic.\n     */\n    export type MessageTypeByTopic = {`;\n\n  for (const topic of topics) {\n    src += `${safeString(topic.name)}: MessageTypeBySchemaName[${safeString(\n      topic.schemaName ?? \"\",\n    )}]\\n`;\n  }\n\n  src += \"\\n};\";\n  return src;\n}\n\nfunction generateTypesLib(args: Args): string {\n  const typesByTopic = generateTypesByTopicInterface(args.topics);\n\n  // A topic may reference a datatype that we don't have in args.datatypes.\n  // This happens for some data sources if nothing's subscribe to a topic and we never get info\n  // about the specific datatype.\n  //\n  // We want the types library to still generate and compile so we use empty placeholders for such datatypes.\n  const allDatatypes = new Map(args.datatypes);\n  for (const topic of args.topics) {\n    if (topic.schemaName == undefined || !allDatatypes.has(topic.schemaName)) {\n      allDatatypes.set(topic.schemaName ?? \"\", {\n        name: topic.schemaName,\n        definitions: [],\n      });\n    }\n  }\n\n  const typesBySchemaName = generateTypesInterface(allDatatypes);\n\n  const src = `\n// NOTE:\n// This file is generated from the current data source.\n// It contains helper types for looking up message definitions by schema name or topic.\n//\n// You likely want to use the higher-level types in \\`./types\\` rather than the types in this file directly.\n\ntype Time = {\n  sec: number,\n  nsec: number,\n};\n\ntype Duration = Time;\n\n${typesBySchemaName}\n\n${typesByTopic}\n`;\n\n  return src;\n}\n\nlet emptyLib: string | undefined;\nfunction generateEmptyTypesLib(): string {\n  return (emptyLib ??= generateTypesLib({ topics: [], datatypes: new Map() }));\n}\n\nexport { generateTypesLib, generateEmptyTypesLib };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nexport const ros_lib_filename = \"ros/index.d.ts\";\nexport const ros_lib_dts = `\n  export declare interface Duration {\n    sec: number;\n    nsec: number;\n  }\n\n  export declare interface Time {\n    sec: number;\n    nsec: number;\n  }\n\n  // Once a data source Messages will be populated with interfaces matching the data source messages.\n  export declare namespace Messages {}\n\n  // Once a data source TopicsToMessageDefinition will be populated with topic names to message interfaces.\n  export declare interface TopicsToMessageDefinition {}\n\n  /**\n   * To correctly type your inputs, you use this type to refer to specific\n   * input topics, e.g. 'Input<\"/your_input_topic\">'. If you have\n   * multiple input topics, use a union type, e.g.\n   * 'Input<\"/your_input_topic_1\"> |\n   * Input<\"/your_input_topic_2\">'.\n   *\n   * These types are dynamically generated from the bag(s) currently in your\n   * Foxglove Studio session, so if a datatype changes, your User Script\n   * may not compile on the newly formatted bag.\n   */\n  export declare interface Input<T extends keyof TopicsToMessageDefinition> {\n    topic: T;\n    receiveTime: Time;\n    message: TopicsToMessageDefinition[T];\n  }\n\n`;\n","import { Time } from \"./types\";\n\n/*\n * Checks ROS-time equality.\n */\nexport const areSame = (t1: Time, t2: Time): boolean => t1.sec === t2.sec && t1.nsec === t2.nsec;\n\n/*\n * Compare two times, returning a negative value if the right is greater or a\n * positive value if the left is greater or 0 if the times are equal useful to\n * supply to Array.prototype.sort\n */\nexport const compare = (left: Time, right: Time): number => {\n  const secDiff = left.sec - right.sec;\n  return secDiff !== 0 ? secDiff : left.nsec - right.nsec;\n};\n\nconst fixTime = (t: Time): Time => {\n  // Equivalent to fromNanoSec(toNanoSec(t)), but no chance of precision loss.\n  // nsec should be non-negative, and less than 1e9.\n  let { sec, nsec } = t;\n  while (nsec > 1e9) {\n    nsec -= 1e9;\n    sec += 1;\n  }\n  while (nsec < 0) {\n    nsec += 1e9;\n    sec -= 1;\n  }\n  return { sec, nsec };\n};\n\nexport const subtractTimes = (\n  { sec: sec1, nsec: nsec1 }: Time,\n  { sec: sec2, nsec: nsec2 }: Time,\n): Time => {\n  return fixTime({ sec: sec1 - sec2, nsec: nsec1 - nsec2 });\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport type { SourceFile, TypeChecker } from \"typescript\";\n\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { Topic, MessageEvent } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\n// make sure to use import type to avoid bringing in the actual implementations to the bundle\n\nexport const DiagnosticSeverity = {\n  Hint: 1,\n  Info: 2,\n  Warning: 4,\n  Error: 8,\n};\n\nexport const Sources = {\n  Typescript: \"Typescript\",\n  DatatypeExtraction: \"DatatypeExtraction\",\n  InputTopicsChecker: \"InputTopicsChecker\",\n  OutputTopicChecker: \"OutputTopicChecker\",\n  Runtime: \"Runtime\",\n};\n\nexport const ErrorCodes = {\n  RUNTIME: 1,\n  DatatypeExtraction: {\n    NO_DEFAULT_EXPORT: 1,\n    NON_FUNC_DEFAULT_EXPORT: 2,\n    NO_TYPE_RETURN: 3,\n    BAD_TYPE_RETURN: 4,\n    UNKNOWN_ERROR: 5,\n    NO_UNIONS: 6,\n    NO_FUNCTIONS: 7,\n    NO_CLASSES: 8,\n    NO_TYPE_LITERALS: 9,\n    NO_TUPLES: 10,\n    NO_INTERSECTION_TYPES: 11,\n    NO_TYPEOF: 12,\n    PREFER_ARRAY_LITERALS: 13,\n    STRICT_MARKERS_RETURN_TYPE: 14,\n    LIMITED_UNIONS: 15,\n    NO_NESTED_ANY: 16,\n    NO_MAPPED_TYPES: 17,\n    INVALID_PROPERTY: 18,\n    INVALID_INDEXED_ACCESS: 19,\n  },\n  InputTopicsChecker: {\n    NO_TOPIC_AVAIL: 1,\n    NO_INPUTS_EXPORT: 2,\n    EMPTY_INPUTS_EXPORT: 3,\n    BAD_INPUTS_TYPE: 4,\n  },\n  OutputTopicChecker: {\n    NO_OUTPUTS: 1,\n    NOT_UNIQUE: 2,\n    EXISTING_TOPIC: 3,\n  },\n};\n\nexport type Diagnostic = {\n  severity: (typeof DiagnosticSeverity)[keyof typeof DiagnosticSeverity];\n  message: string;\n  source: (typeof Sources)[keyof typeof Sources];\n  startLineNumber?: number;\n  startColumn?: number;\n  endLineNumber?: number;\n  endColumn?: number;\n  code: number;\n};\n\nexport type NodeData = {\n  name: string;\n  sourceCode: string;\n  transpiledCode: string;\n  projectCode: Map<string, string> | undefined;\n  diagnostics: readonly Diagnostic[];\n  inputTopics: readonly string[];\n  outputTopic: string;\n  outputDatatype: string;\n  datatypes: RosDatatypes;\n  sourceFile?: SourceFile;\n  typeChecker?: TypeChecker;\n  rosLib: string;\n  typesLib: string;\n  // An array of globalVariable names\n  globalVariables: readonly string[];\n};\n\nexport type NodeRegistration = {\n  nodeId: string;\n  nodeData: NodeData;\n  inputs: readonly string[];\n  output: Topic;\n  processBlockMessage: (\n    messageEvent: MessageEvent<unknown>,\n    globalVariables: GlobalVariables,\n  ) => Promise<MessageEvent<unknown> | undefined>;\n  processMessage: (\n    messageEvent: MessageEvent<unknown>,\n    globalVariables: GlobalVariables,\n  ) => Promise<MessageEvent<unknown> | undefined>;\n  terminate: () => void;\n};\n\nexport type NodeDataTransformer = (nodeData: NodeData, topics: Topic[]) => NodeData;\n\nexport type UserNodeLog = {\n  source: \"registerNode\" | \"processMessage\";\n  value: unknown;\n};\n\nexport type RegistrationOutput = {\n  error?: string;\n  userNodeLogs: UserNodeLog[];\n  userNodeDiagnostics: Diagnostic[];\n};\n\nexport type ProcessMessageOutput = {\n  message: Record<string, unknown> | undefined;\n  error?: string;\n  userNodeLogs: UserNodeLog[];\n  userNodeDiagnostics: Diagnostic[];\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { DeepReadonly } from \"ts-essentials\";\n\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { Time } from \"@foxglove/rostime\";\nimport type { MessageEvent, ParameterValue } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\nimport { NotificationSeverity } from \"@foxglove/studio-base/util/sendNotification\";\n\n// re-exported until other import sites are updated from players/types to @foxglove/studio\nexport type { MessageEvent };\n\nexport type MessageDefinitionsByTopic = {\n  [topic: string]: string;\n};\nexport type ParsedMessageDefinitionsByTopic = {\n  [topic: string]: MessageDefinition[];\n};\n\n// A `Player` is a class that manages playback state. It manages subscriptions,\n// current time, which topics and datatypes are available, and so on.\n// For more details, see the types below.\n\nexport interface Player {\n  // The main way to get information out the player is to set a listener. This listener will be\n  // called whenever the PlayerState changes, so that we can render the new state to the UI. Users\n  // should return a promise from the listener that resolves when the UI has finished updating, so\n  // that we don't get overwhelmed with new state that we can't keep up with. The Player is\n  // responsible for appropriately throttling based on when we resolve this promise.\n  setListener(listener: (playerState: PlayerState) => Promise<void>): void;\n  // Close the player; i.e. terminate any connections it might have open.\n  close(): void;\n  // Set a new set of subscriptions/advertisers. This might trigger fetching\n  // new data, which might in turn trigger a backfill of messages.\n  setSubscriptions(subscriptions: SubscribePayload[]): void;\n  setPublishers(publishers: AdvertiseOptions[]): void;\n  // Modify a remote parameter such as a rosparam.\n  setParameter(key: string, value: ParameterValue): void;\n  // If the Player supports publishing (i.e. PlayerState#capabilities contains\n  // PlayerCapabilities.advertise), publish a message.\n  publish(request: PublishPayload): void;\n  // If the player support service calls (i.e. PlayerState#capabilities contains PlayerCapabilities.callServices)\n  // this will make a service call to the named service with the request payload.\n  callService(service: string, request: unknown): Promise<unknown>;\n  // Basic playback controls. Available if `capabilities` contains PlayerCapabilities.playbackControl.\n  startPlayback?(): void;\n  pausePlayback?(): void;\n  seekPlayback?(time: Time, backfillDuration?: Time): void;\n  playUntil?(time: Time): void;\n  // Seek to a particular time. Might trigger backfilling.\n  // If the Player supports non-real-time speeds (i.e. PlayerState#capabilities contains\n  // PlayerCapabilities.setSpeed), set that speed. E.g. 1.0 is real time, 0.2 is 20% of real time.\n  setPlaybackSpeed?(speedFraction: number): void;\n  // Set the globalVariables for Players that support it.\n  // This is generally used to pass new globalVariables to the UserNodePlayer\n  setGlobalVariables(globalVariables: GlobalVariables): void;\n}\n\nexport enum PlayerPresence {\n  NOT_PRESENT = \"NOT_PRESENT\",\n  INITIALIZING = \"INITIALIZING\",\n  RECONNECTING = \"RECONNECTING\",\n  BUFFERING = \"BUFFERING\",\n  PRESENT = \"PRESENT\",\n  ERROR = \"ERROR\",\n}\n\nexport type PlayerProblem = {\n  severity: NotificationSeverity;\n  message: string;\n  error?: Error;\n  tip?: string;\n};\n\nexport type PlayerURLState = DeepReadonly<{\n  sourceId: string;\n  parameters?: Record<string, string>;\n}>;\n\nexport type PlayerState = {\n  // Information about the player's presence or connection status, for the UI to show a loading indicator.\n  presence: PlayerPresence;\n\n  // Show some sort of progress indication in the playback bar; see `type Progress` for more details.\n  progress: Progress;\n\n  // Capabilities of this particular `Player`, which are not shared across all players.\n  // See `const PlayerCapabilities` for more details.\n  capabilities: (typeof PlayerCapabilities)[keyof typeof PlayerCapabilities][];\n\n  /**\n   * Identifies the semantics of the data being played back, such as which topics or parameters are\n   * semantically meaningful or normalization conventions to use. This typically maps to a shorthand\n   * identifier for a robotics framework such as \"ros1\", \"ros2\", or \"ulog\". See the MCAP profiles\n   * concept at <https://github.com/foxglove/mcap/blob/main/docs/specification/appendix.md#well-known-profiles>.\n   */\n  profile: string | undefined;\n\n  // A unique id for this player (typically a UUID generated on construction). This is used to clear\n  // out any data when switching to a new player.\n  playerId: string;\n\n  // String name for the player\n  // The player could set this value to represent the current connection, name, ports, etc.\n  name?: string;\n\n  // Surface issues during playback or player initialization\n  problems?: PlayerProblem[];\n\n  // The actual data to render panels with. Can be empty during initialization, until all this data\n  // is known. See `type PlayerStateActiveData` for more details.\n  activeData?: PlayerStateActiveData;\n\n  /** State to serialize into the active URL. */\n  urlState?: PlayerURLState;\n};\n\nexport type PlayerStateActiveData = {\n  // An array of (ROS-like) messages that should be rendered. Should be ordered by `receiveTime`,\n  // and should be immediately following the previous array of messages that was emitted as part of\n  // this state. If there is a discontinuity in messages, `lastSeekTime` should be different than\n  // the previous state. Panels collect these messages using the `PanelAPI`.\n  messages: readonly MessageEvent<unknown>[];\n  totalBytesReceived: number; // always-increasing\n\n  // The current playback position, which will be shown in the playback bar. This time should be\n  // equal to or later than the latest `receiveTime` in `messages`. Why not just use\n  // `last(messages).receiveTime`? The reason is that the data source (e.g. ROS bag) might have\n  // empty sections, i.e. `messages` can be empty, but we still want to be able to show a playback\n  // cursor moving forward during these regions.\n  currentTime: Time;\n\n  // The start time to show in the playback bar. Every `message.receiveTime` (and therefore\n  // `currentTime`) has to later than or equal to `startTime`.\n  startTime: Time;\n\n  // The end time to show in the playback bar. Every `message.receiveTime` (and therefore\n  // `currentTime`) has to before than or equal to `endTime`.\n  endTime: Time;\n\n  // Whether or not we're currently playing back. Controls the play/pause icon in the playback bar.\n  // It's still allowed to emit `messages` even when not playing (e.g. when doing a backfill after\n  // a seek).\n  isPlaying: boolean;\n\n  // If the Player supports non-real-time speeds (i.e. PlayerState#capabilities contains\n  // PlayerCapabilities.setSpeed), this represents that speed as a fraction of real time.\n  // E.g. 1.0 is real time, 0.2 is 20% of real time.\n  speed: number;\n\n  // The last time a seek / discontinuity in messages happened. This will clear out data within\n  // `PanelAPI` so we're not looking at stale data.\n  lastSeekTime: number;\n\n  // A list of topics that panels can subscribe to. This list may change across states,\n  // but when a topic is removed from the list we should treat it as a seek (i.e. lastSeekTime\n  // should be bumped). Also, no messages are allowed to be emitted which have a `topic` field that\n  // isn't represented in this list. Finally, every topic must have a `datatype` which is actually\n  // present in the `datatypes` field (see below).\n  topics: Topic[];\n\n  // A map of topic names to topic statistics, such as message count. This should be treated as a\n  // sparse list that may be missing some or all topics, depending on the active data source and its\n  // current state.\n  topicStats: Map<string, TopicStats>;\n\n  // A complete list of ROS datatypes. Allowed to change. But it must always be \"complete\" (every\n  // topic must refer to a datatype that is present in this list, every datatypes that refers to\n  // another datatype must refer to a datatype that is present in this list).\n  datatypes: RosDatatypes;\n\n  // A map of topic names to the set of publisher IDs publishing each topic.\n  publishedTopics?: Map<string, Set<string>>;\n\n  // A map of topic names to the set of subscriber IDs subscribed to each topic.\n  subscribedTopics?: Map<string, Set<string>>;\n\n  // A map of service names to service provider IDs that provide each service.\n  services?: Map<string, Set<string>>;\n\n  // A map of parameter names to parameter values, used to describe remote parameters such as\n  // rosparams.\n  parameters?: Map<string, ParameterValue>;\n};\n\n// Represents a ROS topic, though the actual data does not need to come from a ROS system.\nexport type Topic = {\n  // Of ROS topic format, i.e. \"/some/topic\". We currently depend on this slashes format a bit in\n  // `<MessageHistroy>`, though we could relax this and support arbitrary strings. It's nice to have\n  // a consistent representation for topics that people recognize though.\n  name: string;\n  // Name of the datatype (see `type PlayerStateActiveData` for details).\n  schemaName: string | undefined;\n};\n\nexport type TopicWithSchemaName = Topic & { schemaName: string };\n\nexport type TopicStats = {\n  // The number of messages observed on the topic.\n  numMessages: number;\n  // Timestamp of the first observed message on this topic. Only set for static data sources such as\n  // local files or servers that provide a fixed set of data.\n  firstMessageTime?: Time;\n  // Timestamp of the last observed message on this topic. Only set for static data sources such as\n  // local files or servers that provide a fixed set of data.\n  lastMessageTime?: Time;\n};\n\ntype RosTypedArray =\n  | Int8Array\n  | Uint8Array\n  | Int16Array\n  | Uint16Array\n  | Int32Array\n  | Uint32Array\n  | Float32Array\n  | Float64Array;\n\ntype RosSingularField = number | string | boolean | RosObject | undefined; // No time -- consider it a message.\nexport type RosValue =\n  | RosSingularField\n  | readonly RosSingularField[]\n  | RosTypedArray\n  // eslint-disable-next-line no-restricted-syntax\n  | null;\n\nexport type RosObject = Readonly<{\n  [property: string]: RosValue;\n}>;\n\n// For each memory block we store the actual messages (grouped by topic), and a total byte size of\n// the underlying ArrayBuffers.\nexport type MessageBlock = {\n  readonly messagesByTopic: {\n    readonly [topic: string]: MessageEvent<unknown>[];\n  };\n  readonly sizeInBytes: number;\n};\n\nexport type BlockCache = {\n  blocks: readonly (MessageBlock | undefined)[];\n  startTime: Time;\n};\n\n// Contains different kinds of progress indications\nexport type Progress = Readonly<{\n  // Indicate which ranges are loaded\n  fullyLoadedFractionRanges?: Range[];\n\n  // A raw view into the cached binary data stored by the MemoryCacheDataProvider. Only present when\n  // using the RandomAccessPlayer.\n  readonly messageCache?: BlockCache;\n}>;\n\nexport type SubscriptionPreloadType =\n  | \"full\" // Fetch messages for the entire content range.\n  | \"partial\"; // Fetch messages as needed.\n\n// Represents a subscription to a single topic, for use in `setSubscriptions`.\nexport type SubscribePayload = {\n  // The topic name to subscribe to\n  topic: string;\n  preloadType?: SubscriptionPreloadType;\n};\n\n// Represents a single topic publisher, for use in `setPublishers`.\nexport type AdvertiseOptions = {\n  /** The topic name */\n  topic: string;\n\n  /** The schema name */\n  schemaName: string;\n\n  /** Additional player-specific advertise options */\n  options?: Record<string, unknown>;\n};\n\n// The actual message to publish.\nexport type PublishPayload = { topic: string; msg: Record<string, unknown> };\n\n// Capabilities that are not shared by all players.\nexport const PlayerCapabilities = {\n  // Publishing messages. Need to be connected to some sort of live robotics system (e.g. ROS).\n  advertise: \"advertise\",\n\n  // Calling services\n  callServices: \"callServices\",\n\n  // Setting speed to something that is not real time.\n  setSpeed: \"setSpeed\",\n\n  // Ability to play, pause, and seek in time.\n  playbackControl: \"playbackControl\",\n\n  // List and retrieve values for configuration key/value pairs\n  getParameters: \"getParameters\",\n\n  // Set values for configuration key/value pairs\n  setParameters: \"setParameters\",\n};\n\n// A metrics collector is an interface passed into a `Player`, which will get called when certain\n// events happen, so we can track those events in some metrics system.\nexport interface PlayerMetricsCollectorInterface {\n  setProperty(key: string, value: string | number | boolean): void;\n  playerConstructed(): void;\n  play(speed: number): void;\n  seek(time: Time): void;\n  setSpeed(speed: number): void;\n  pause(): void;\n  close(): void;\n  setSubscriptions(subscriptions: SubscribePayload[]): void;\n  recordBytesReceived(bytes: number): void;\n  recordPlaybackTime(time: Time, params: { stillLoadingData: boolean }): void;\n  recordUncachedRangeRequest(): void;\n  recordTimeToFirstMsgs(): void;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { isEmpty, isEqual, pick } from \"lodash\";\nimport {\n  updateTree,\n  createDragToUpdates,\n  createRemoveUpdate,\n  createHideUpdate,\n  getNodeAtPath,\n  MosaicPath,\n  getLeaves,\n  MosaicNode,\n} from \"react-mosaic-component\";\nimport { MarkOptional } from \"ts-essentials\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport {\n  StartDragPayload,\n  EndDragPayload,\n  SplitPanelPayload,\n  DropPanelPayload,\n  SwapPanelPayload,\n  AddPanelPayload,\n  ClosePanelPayload,\n  MoveTabPayload,\n  PanelsActions,\n  LayoutData,\n  ConfigsPayload,\n  CreateTabPanelPayload,\n  ChangePanelLayoutPayload,\n  SaveConfigsPayload,\n  SaveFullConfigPayload,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport {\n  SavedProps,\n  PlaybackConfig,\n  MosaicDropTargetPosition,\n} from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\nimport {\n  updateTabPanelLayout,\n  replaceAndRemovePanels,\n  getPanelIdForType,\n  getPanelTypeFromId,\n  getPanelIdsInsideTabPanels,\n  DEFAULT_TAB_PANEL_CONFIG,\n  getConfigsForNestedPanelsInsideTab,\n  getAllPanelIds,\n  inlineTabPanelLayouts,\n  getSaveConfigsPayloadForAddedPanel,\n  addPanelToTab,\n  reorderTabWithinTabPanel,\n  moveTabBetweenTabPanels,\n  createAddUpdates,\n  removePanelFromTabPanel,\n  getPathFromNode,\n} from \"@foxglove/studio-base/util/layout\";\n\nimport { isTabPanelConfig } from \"../../util/layout\";\n\nexport const defaultPlaybackConfig: PlaybackConfig = {\n  speed: 1.0,\n};\n\nfunction changePanelLayout(\n  state: LayoutData,\n  { layout, trimConfigById = true }: ChangePanelLayoutPayload,\n): LayoutData {\n  const panelIds: string[] = getLeaves(layout ?? ReactNull).filter((panelId) => !isEmpty(panelId));\n  const panelIdsInsideTabPanels = getPanelIdsInsideTabPanels(panelIds, state.configById);\n  // Filter configById in case a panel was removed from the layout\n  // We don't want its configById hanging around forever\n  const configById = trimConfigById\n    ? pick(state.configById, [...panelIdsInsideTabPanels, ...panelIds])\n    : state.configById;\n  return { ...state, configById, layout };\n}\n\nfunction savePanelConfigs(state: LayoutData, payload: SaveConfigsPayload): LayoutData {\n  const { configs } = payload;\n  const prevConfigById = state.configById;\n\n  // create a configById object with new configs merged on top of previous configs\n  //\n  // Note: If no configs are changed, the return value of newConfigById is the same as the state input\n  //       This keeps the state object unchagned if the configs values did not change.\n  const newConfigById = configs.reduce(\n    (currentSavedProps, { id, config, defaultConfig = {}, override = false }) => {\n      if (override) {\n        return { ...currentSavedProps, [id]: config };\n      }\n\n      const oldConfig = currentSavedProps[id];\n      const newConfig = {\n        // merge the partial new config with the default config and the old config\n        // any entries in the new config can override default config and previous config entries\n        ...defaultConfig,\n        ...currentSavedProps[id],\n        ...config,\n      };\n\n      // if the new config is unchanged, return currentSavedProps to keep same object\n      // keeping the same object around is useful for upstream consumers of state which look at changes\n      // in object reference to mean the object changed\n      if (isEqual(oldConfig, newConfig)) {\n        return currentSavedProps;\n      }\n\n      return { ...currentSavedProps, [id]: newConfig };\n    },\n    state.configById,\n  );\n  const tabPanelConfigSaved = configs.find(({ id }) => getPanelTypeFromId(id) === TAB_PANEL_TYPE);\n  if (tabPanelConfigSaved) {\n    // eslint-disable-next-line no-restricted-syntax\n    const panelIds = getLeaves(state.layout ?? null);\n    const panelIdsInsideTabPanels = getPanelIdsInsideTabPanels(panelIds, newConfigById);\n    // Filter savedProps in case a panel was removed from a Tab layout\n    // We don't want its savedProps hanging around forever\n    return { ...state, configById: pick(newConfigById, [...panelIdsInsideTabPanels, ...panelIds]) };\n  }\n\n  // if none of the configs changed, then we keep the same state object\n  if (prevConfigById === newConfigById) {\n    return state;\n  }\n  return { ...state, configById: newConfigById };\n}\n\nfunction saveFullPanelConfig(state: LayoutData, payload: SaveFullConfigPayload): LayoutData {\n  const { panelType, perPanelFunc } = payload;\n  const newProps = { ...state.configById };\n  const fullConfig = state.configById;\n  for (const [panelId, panelConfig] of Object.entries(fullConfig)) {\n    if (getPanelTypeFromId(panelId) === panelType) {\n      newProps[panelId] = perPanelFunc(panelConfig);\n    }\n  }\n\n  return { ...state, configById: newProps };\n}\n\nconst closePanel = (\n  panelsState: LayoutData,\n  { tabId, root, path }: ClosePanelPayload,\n): LayoutData => {\n  if (tabId != undefined) {\n    const config = panelsState.configById[tabId] as TabPanelConfig;\n    const saveConfigsPayload = removePanelFromTabPanel(path, config, tabId);\n    return savePanelConfigs(panelsState, saveConfigsPayload);\n  } else if (typeof root === \"string\") {\n    // When layout consists of 1 panel, clear the layout\n    return changePanelLayout(panelsState, { layout: undefined });\n  }\n  const update = createRemoveUpdate(root, path);\n  const newLayout = updateTree(root, [update]);\n  return changePanelLayout(panelsState, { layout: newLayout });\n};\n\nconst splitPanel = (\n  panelsState: LayoutData,\n  { id, tabId, direction, config, root, path }: SplitPanelPayload,\n): LayoutData => {\n  const type = getPanelTypeFromId(id);\n  const newId = getPanelIdForType(type);\n  let newPanelsState = { ...panelsState };\n  const { configById: savedProps } = newPanelsState;\n  if (tabId != undefined) {\n    const prevConfig = savedProps[tabId] as TabPanelConfig;\n    const activeTabLayout = prevConfig.tabs[prevConfig.activeTabIdx]?.layout;\n    if (activeTabLayout != undefined) {\n      const newTabLayout = updateTree(activeTabLayout, [\n        {\n          path: getPathFromNode(id, activeTabLayout),\n          spec: { $set: { first: id, second: newId, direction } },\n        },\n      ]);\n      const newTabConfig = updateTabPanelLayout(newTabLayout, prevConfig);\n      newPanelsState = savePanelConfigs(newPanelsState, {\n        configs: [\n          { id: tabId, config: newTabConfig },\n          { id: newId, config },\n        ],\n      });\n    }\n  } else {\n    newPanelsState = changePanelLayout(newPanelsState, {\n      layout: updateTree(root, [{ path, spec: { $set: { first: id, second: newId, direction } } }]),\n      trimConfigById: type !== TAB_PANEL_TYPE,\n    });\n\n    const relatedConfigs =\n      type === TAB_PANEL_TYPE\n        ? (getPanelIdsInsideTabPanels([id], savedProps).reduce(\n            (res: Record<string, unknown>, panelId: string) => ({\n              ...res,\n              [panelId]: savedProps[panelId],\n            }),\n            {},\n          ) as SavedProps)\n        : undefined;\n    newPanelsState = savePanelConfigs(\n      newPanelsState,\n      getSaveConfigsPayloadForAddedPanel({ id: newId, config, relatedConfigs }),\n    );\n  }\n  return newPanelsState;\n};\n\nconst swapPanel = (\n  panelsState: LayoutData,\n  {\n    tabId,\n    originalId,\n    type,\n    config,\n    relatedConfigs,\n    root,\n    path,\n  }: MarkOptional<SwapPanelPayload, \"originalId\">,\n): LayoutData => {\n  const newId = getPanelIdForType(type);\n  let newPanelsState = { ...panelsState };\n  // For a panel inside a Tab panel, update the Tab panel's tab layouts via savedProps\n  if (tabId != undefined && originalId != undefined) {\n    const tabSavedProps = newPanelsState.configById[tabId] as TabPanelConfig | undefined;\n    if (tabSavedProps) {\n      const activeTabLayout = tabSavedProps.tabs[tabSavedProps.activeTabIdx]?.layout;\n      if (activeTabLayout != undefined) {\n        const newTabLayout = replaceAndRemovePanels({ originalId, newId }, activeTabLayout);\n\n        const newTabConfig = updateTabPanelLayout(newTabLayout, tabSavedProps);\n        newPanelsState = savePanelConfigs(newPanelsState, {\n          configs: [{ id: tabId, config: newTabConfig }],\n        });\n      }\n    }\n  } else {\n    newPanelsState = changePanelLayout(newPanelsState, {\n      layout: updateTree(root, [{ path, spec: { $set: newId } }]),\n      trimConfigById: type !== TAB_PANEL_TYPE,\n    });\n  }\n\n  newPanelsState = savePanelConfigs(\n    newPanelsState,\n    getSaveConfigsPayloadForAddedPanel({ id: newId, config, relatedConfigs }),\n  );\n  return newPanelsState;\n};\n\nconst createTabPanelWithSingleTab = (\n  panelsState: LayoutData,\n  { idToReplace, layout, idsToRemove }: CreateTabPanelPayload,\n): LayoutData => {\n  const newId = getPanelIdForType(TAB_PANEL_TYPE);\n  const { configById: savedProps } = panelsState;\n  // Build the layout for the new tab\n  const layoutWithInlinedTabs = inlineTabPanelLayouts(layout, savedProps, idsToRemove);\n  const panelIdsNotInNewTab = getAllPanelIds(layout, savedProps).filter(\n    (leaf: string) => !idsToRemove.includes(leaf),\n  );\n  const tabLayout = replaceAndRemovePanels(\n    { idsToRemove: panelIdsNotInNewTab },\n    layoutWithInlinedTabs,\n  );\n\n  const newLayout = replaceAndRemovePanels({ originalId: idToReplace, newId, idsToRemove }, layout);\n  let newPanelsState = changePanelLayout(panelsState, {\n    layout: newLayout ?? \"\",\n    trimConfigById: false,\n  });\n\n  const tabPanelConfig = {\n    id: newId,\n    config: { ...DEFAULT_TAB_PANEL_CONFIG, tabs: [{ title: \"1\", layout: tabLayout }] },\n  };\n  const nestedPanelConfigs = getConfigsForNestedPanelsInsideTab(\n    idToReplace,\n    newId,\n    idsToRemove,\n    savedProps,\n  );\n  newPanelsState = savePanelConfigs(newPanelsState, {\n    configs: [tabPanelConfig, ...nestedPanelConfigs],\n  });\n  return newPanelsState;\n};\n\nconst createTabPanelWithMultipleTabs = (\n  panelsState: LayoutData,\n  { idToReplace, layout, idsToRemove }: CreateTabPanelPayload,\n): LayoutData => {\n  const { configById: savedProps } = panelsState;\n  const newId = getPanelIdForType(TAB_PANEL_TYPE);\n  const newLayout = replaceAndRemovePanels({ originalId: idToReplace, newId, idsToRemove }, layout);\n  let newPanelsState = changePanelLayout(\n    { ...panelsState },\n    { layout: newLayout ?? \"\", trimConfigById: false },\n  );\n\n  const tabs = idsToRemove.map((panelId) => ({\n    title: getPanelTypeFromId(panelId),\n    layout: panelId,\n  }));\n  const tabPanelConfig = { id: newId, config: { ...DEFAULT_TAB_PANEL_CONFIG, tabs } };\n  const nestedPanelConfigs = getConfigsForNestedPanelsInsideTab(\n    idToReplace,\n    newId,\n    idsToRemove,\n    savedProps,\n  );\n  newPanelsState = savePanelConfigs(newPanelsState, {\n    configs: [tabPanelConfig, ...nestedPanelConfigs],\n  });\n\n  return newPanelsState;\n};\n\nconst moveTab = (panelsState: LayoutData, { source, target }: MoveTabPayload): LayoutData => {\n  const saveConfigsPayload =\n    source.panelId === target.panelId\n      ? reorderTabWithinTabPanel({ source, target, savedProps: panelsState.configById })\n      : moveTabBetweenTabPanels({ source, target, savedProps: panelsState.configById });\n  return savePanelConfigs(panelsState, saveConfigsPayload);\n};\n\nconst addPanel = (\n  panelsState: LayoutData,\n  { tabId, id, config, relatedConfigs }: AddPanelPayload,\n) => {\n  let newPanelsState = { ...panelsState };\n  let saveConfigsPayload: { configs: ConfigsPayload[] } = { configs: [] };\n  if (config) {\n    saveConfigsPayload = getSaveConfigsPayloadForAddedPanel({ id, config, relatedConfigs });\n  }\n  let layout: MosaicNode<string> | undefined;\n  if (tabId != undefined) {\n    const tabPanelConfig = panelsState.configById[tabId];\n    if (isTabPanelConfig(tabPanelConfig)) {\n      layout = tabPanelConfig.tabs[tabPanelConfig.activeTabIdx]?.layout;\n    }\n  } else {\n    layout = panelsState.layout;\n  }\n  const fixedLayout: MosaicNode<string> = isEmpty(layout)\n    ? id\n    : { direction: \"row\", first: id, second: layout as MosaicNode<string> };\n  const changeLayoutPayload = {\n    layout: fixedLayout,\n    trimConfigById: !relatedConfigs,\n  };\n  if (tabId != undefined && typeof changeLayoutPayload.layout === \"string\") {\n    newPanelsState = savePanelConfigs(newPanelsState, {\n      configs: [\n        {\n          id: tabId,\n          config: updateTabPanelLayout(changeLayoutPayload.layout, {\n            ...DEFAULT_TAB_PANEL_CONFIG,\n            ...panelsState.configById[tabId],\n          }),\n        },\n      ],\n    });\n  } else {\n    newPanelsState = changePanelLayout(newPanelsState, changeLayoutPayload);\n  }\n  newPanelsState = savePanelConfigs(newPanelsState, saveConfigsPayload);\n  return newPanelsState;\n};\n\nconst dropPanel = (\n  panelsState: LayoutData,\n  { newPanelType, destinationPath = [], position, tabId, config, relatedConfigs }: DropPanelPayload,\n) => {\n  const id = getPanelIdForType(newPanelType);\n\n  const configs = [];\n  // This means we've dragged into a Tab panel\n  if (tabId != undefined) {\n    const { configs: newConfigs } = addPanelToTab(\n      id,\n      destinationPath,\n      position,\n      panelsState.configById[tabId],\n      tabId,\n    );\n    configs.push(...newConfigs);\n  }\n\n  const newLayout =\n    tabId != undefined\n      ? panelsState.layout\n      : updateTree<string>(\n          panelsState.layout as MosaicNode<string>,\n          createAddUpdates(panelsState.layout, id, destinationPath, position ?? \"left\"),\n        );\n\n  // 'relatedConfigs' are used in Tab panel presets, so that the panels'\n  // respective configs will be saved globally.\n  if (config) {\n    const { configs: newConfigs } = getSaveConfigsPayloadForAddedPanel({\n      id,\n      config,\n      relatedConfigs,\n    });\n    configs.push(...newConfigs);\n  }\n\n  let newPanelsState = changePanelLayout(panelsState, {\n    layout: newLayout,\n    trimConfigById: !relatedConfigs,\n  });\n  newPanelsState = savePanelConfigs(newPanelsState, { configs });\n  return newPanelsState;\n};\n\nconst dragWithinSameTab = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    sourceTabId,\n    position,\n    destinationPath,\n    ownPath,\n    sourceTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    sourceTabId: string;\n    position: MosaicDropTargetPosition;\n    destinationPath: MosaicPath;\n    ownPath: MosaicPath;\n    sourceTabConfig: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  const currentTabLayout = sourceTabConfig.tabs[sourceTabConfig.activeTabIdx]?.layout;\n  let newPanelsState = { ...panelsState };\n  if (typeof currentTabLayout === \"string\") {\n    newPanelsState = changePanelLayout(panelsState, {\n      layout: originalLayout,\n      trimConfigById: false,\n    });\n    // We assume `begin` handler already removed tab from config. Here it is replacing it, or keeping it as is\n    newPanelsState = savePanelConfigs(newPanelsState, {\n      configs: [\n        { id: sourceTabId, config: updateTabPanelLayout(currentTabLayout, sourceTabConfig) },\n        ...sourceTabChildConfigs,\n      ],\n    });\n  } else if (currentTabLayout != undefined) {\n    const updates = createDragToUpdates(currentTabLayout, ownPath, destinationPath, position);\n    const newTree = updateTree(currentTabLayout, updates);\n\n    newPanelsState = changePanelLayout(panelsState, {\n      layout: originalLayout,\n      trimConfigById: false,\n    });\n    newPanelsState = savePanelConfigs(newPanelsState, {\n      configs: [\n        {\n          id: sourceTabId,\n          config: updateTabPanelLayout(\n            newTree,\n            panelsState.configById[sourceTabId] as TabPanelConfig,\n          ),\n        },\n        ...sourceTabChildConfigs,\n      ],\n    });\n  }\n  return newPanelsState;\n};\n\nconst dragToMainFromTab = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    sourceTabId,\n    position,\n    destinationPath,\n    ownPath,\n    sourceTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    sourceTabId: string;\n    position: MosaicDropTargetPosition;\n    destinationPath: MosaicPath;\n    ownPath: MosaicPath;\n    sourceTabConfig: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  const currentTabLayout = sourceTabConfig.tabs[sourceTabConfig.activeTabIdx]?.layout;\n  if (currentTabLayout == undefined) {\n    return panelsState;\n  }\n  // Remove panel from tab layout\n  const saveConfigsPayload = removePanelFromTabPanel(\n    ownPath,\n    panelsState.configById[sourceTabId] as TabPanelConfig,\n    sourceTabId,\n  );\n  const panelConfigs = {\n    ...saveConfigsPayload,\n    configs: [...saveConfigsPayload.configs, ...sourceTabChildConfigs],\n  };\n\n  // Insert it into main layout\n  const currentNode = getNodeAtPath(currentTabLayout, ownPath);\n  if (typeof currentNode !== \"string\") {\n    return panelsState;\n  }\n  const newLayout = updateTree(\n    originalLayout,\n    createAddUpdates(originalLayout, currentNode, destinationPath, position),\n  );\n\n  let newPanelsState = changePanelLayout(panelsState, { layout: newLayout, trimConfigById: false });\n  newPanelsState = savePanelConfigs(newPanelsState, panelConfigs);\n  return newPanelsState;\n};\n\nconst dragToTabFromMain = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    panelId,\n    targetTabId,\n    position,\n    destinationPath,\n    ownPath,\n    targetTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    panelId: string;\n    targetTabId: string;\n    position?: MosaicDropTargetPosition;\n    destinationPath?: MosaicPath;\n    ownPath: MosaicPath;\n    targetTabConfig?: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  const saveConfigsPayload = addPanelToTab(\n    panelId,\n    destinationPath,\n    position,\n    targetTabConfig,\n    targetTabId,\n  );\n  const panelConfigs = {\n    ...saveConfigsPayload,\n    configs: [...saveConfigsPayload.configs, ...sourceTabChildConfigs],\n  };\n  const update = createRemoveUpdate(originalLayout, ownPath);\n  const newLayout = updateTree(originalLayout, [update]);\n  let newPanelsState = changePanelLayout(panelsState, { layout: newLayout, trimConfigById: false });\n  newPanelsState = savePanelConfigs(newPanelsState, { configs: panelConfigs.configs });\n  return newPanelsState;\n};\n\nconst dragToTabFromTab = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    panelId,\n    sourceTabId,\n    targetTabId,\n    position,\n    destinationPath,\n    ownPath,\n    targetTabConfig,\n    sourceTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    panelId: string;\n    sourceTabId: string;\n    targetTabId: string;\n    position?: MosaicDropTargetPosition;\n    destinationPath?: MosaicPath;\n    ownPath: MosaicPath;\n    targetTabConfig?: TabPanelConfig;\n    sourceTabConfig: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  // Remove panel from tab layout\n  const { configs: fromTabConfigs } = removePanelFromTabPanel(\n    ownPath,\n    sourceTabConfig,\n    sourceTabId,\n  );\n\n  // Insert it into another tab\n  const { configs: toTabConfigs } = addPanelToTab(\n    panelId,\n    destinationPath,\n    position,\n    targetTabConfig,\n    targetTabId,\n  );\n  let newPanelsState = changePanelLayout(panelsState, {\n    layout: originalLayout,\n    trimConfigById: false,\n  });\n  newPanelsState = savePanelConfigs(newPanelsState, {\n    configs: [\n      ...fromTabConfigs,\n      ...toTabConfigs,\n      // if the target tab is inside the source tab, make sure not to overwrite it with its old config\n      ...sourceTabChildConfigs.filter(({ id }) => id !== targetTabId),\n    ],\n  });\n  return newPanelsState;\n};\n\nconst startDrag = (\n  panelsState: LayoutData,\n  { path, sourceTabId }: StartDragPayload,\n): LayoutData => {\n  // Collapse or remove the panel being dragged so it's temporarily hidden from the layout.\n  if (path.length > 0) {\n    if (sourceTabId != undefined) {\n      const tabConfig = panelsState.configById[sourceTabId] as TabPanelConfig;\n      const activeLayout = tabConfig.tabs[tabConfig.activeTabIdx]?.layout;\n      if (activeLayout == undefined) {\n        return panelsState;\n      }\n      const newTabLayout = updateTree(activeLayout, [createHideUpdate(path)]);\n      const newTabConfig = updateTabPanelLayout(newTabLayout, tabConfig);\n      return savePanelConfigs(panelsState, {\n        configs: [{ id: sourceTabId, config: newTabConfig }],\n      });\n    }\n    return changePanelLayout(panelsState, {\n      layout: updateTree<string>(panelsState.layout ?? \"\", [createHideUpdate(path)]),\n      trimConfigById: false,\n    });\n  } else if (sourceTabId != undefined) {\n    // If we've dragged a panel from a single panel tab layout, remove that panel\n    const sourceTabConfig = panelsState.configById[sourceTabId] as TabPanelConfig;\n    return savePanelConfigs(panelsState, {\n      configs: [{ id: sourceTabId, config: updateTabPanelLayout(undefined, sourceTabConfig) }],\n    });\n  }\n  throw new Error(\"Can't drag the top-level panel of a layout\");\n};\n\nconst endDrag = (panelsState: LayoutData, dragPayload: EndDragPayload): LayoutData => {\n  const {\n    originalLayout,\n    originalSavedProps,\n    panelId,\n    sourceTabId,\n    targetTabId,\n    position,\n    destinationPath,\n    ownPath,\n  } = dragPayload;\n  const toMainFromTab = sourceTabId != undefined && targetTabId == undefined;\n  const toTabfromMain = sourceTabId == undefined && targetTabId != undefined;\n  const toTabfromTab = sourceTabId != undefined && targetTabId != undefined;\n  const withinSameTab = sourceTabId === targetTabId && toTabfromTab; // In case it's simply a drag within the main layout.\n\n  const sourceTabConfig =\n    sourceTabId != undefined ? (originalSavedProps[sourceTabId] as TabPanelConfig) : undefined;\n  const targetTabConfig =\n    targetTabId != undefined ? (originalSavedProps[targetTabId] as TabPanelConfig) : undefined;\n  const panelIdsInsideTabPanels =\n    sourceTabId != undefined ? getPanelIdsInsideTabPanels([sourceTabId], originalSavedProps) : [];\n\n  const sourceTabChildConfigs = filterMap(panelIdsInsideTabPanels, (id) => {\n    const config = originalSavedProps[id];\n    return config ? { id, config } : undefined;\n  });\n\n  // If dragging within the same tab without position & destination just cancel the drag.\n  if (withinSameTab && position == undefined && destinationPath == undefined) {\n    return { ...panelsState, layout: originalLayout, configById: originalSavedProps };\n  }\n\n  if (withinSameTab && sourceTabConfig && position != undefined && destinationPath != undefined) {\n    return dragWithinSameTab(panelsState, {\n      originalLayout,\n      sourceTabId,\n      position,\n      destinationPath,\n      ownPath,\n      sourceTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (toMainFromTab && sourceTabConfig && position != undefined && destinationPath != undefined) {\n    return dragToMainFromTab(panelsState, {\n      originalLayout,\n      sourceTabId,\n      position,\n      destinationPath,\n      ownPath,\n      sourceTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (toTabfromMain) {\n    return dragToTabFromMain(panelsState, {\n      originalLayout,\n      panelId,\n      targetTabId,\n      position,\n      destinationPath,\n      ownPath,\n      targetTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (toTabfromTab && sourceTabConfig) {\n    return dragToTabFromTab(panelsState, {\n      originalLayout,\n      panelId,\n      sourceTabId,\n      targetTabId,\n      position,\n      destinationPath,\n      ownPath,\n      targetTabConfig,\n      sourceTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (position != undefined && destinationPath != undefined && !isEqual(destinationPath, ownPath)) {\n    const updates = createDragToUpdates(originalLayout, ownPath, destinationPath, position);\n    const newLayout = updateTree(originalLayout, updates);\n    return changePanelLayout(panelsState, { layout: newLayout, trimConfigById: false });\n  }\n\n  // The drag was canceled; restore the original layout to re-show/re-add the dragged panel.\n  // This undoes the effects of startDrag().\n  return { ...panelsState, layout: originalLayout, configById: originalSavedProps };\n};\n\nexport default function (panelsState: Readonly<LayoutData>, action: PanelsActions): LayoutData {\n  // start the newPanelsState as the current panels state so if there are no changes the identity\n  // of the panels state object remains the same\n  switch (action.type) {\n    case \"CHANGE_PANEL_LAYOUT\":\n      return changePanelLayout(panelsState, action.payload);\n\n    case \"SAVE_PANEL_CONFIGS\":\n      return savePanelConfigs(panelsState, action.payload);\n\n    case \"SAVE_FULL_PANEL_CONFIG\":\n      return saveFullPanelConfig(panelsState, action.payload);\n\n    case \"CREATE_TAB_PANEL\":\n      return action.payload.singleTab\n        ? createTabPanelWithSingleTab(panelsState, action.payload)\n        : createTabPanelWithMultipleTabs(panelsState, action.payload);\n\n    case \"OVERWRITE_GLOBAL_DATA\":\n      return {\n        ...panelsState,\n        globalVariables: action.payload,\n      };\n\n    case \"SET_GLOBAL_DATA\": {\n      const globalVariables = {\n        ...panelsState.globalVariables,\n        ...action.payload,\n      };\n      Object.keys(globalVariables).forEach((key) => {\n        if (globalVariables[key] == undefined) {\n          delete globalVariables[key];\n        }\n      });\n      return {\n        ...panelsState,\n        globalVariables,\n      };\n    }\n\n    case \"SET_USER_NODES\": {\n      const userNodes = { ...panelsState.userNodes };\n      for (const [key, value] of Object.entries(action.payload)) {\n        if (value == undefined) {\n          delete userNodes[key];\n        } else {\n          userNodes[key] = value;\n        }\n      }\n      return {\n        ...panelsState,\n        userNodes,\n      };\n    }\n\n    case \"SET_PLAYBACK_CONFIG\":\n      return {\n        ...panelsState,\n        playbackConfig: {\n          ...panelsState.playbackConfig,\n          ...action.payload,\n        },\n      };\n    case \"CLOSE_PANEL\":\n      return closePanel(panelsState, action.payload);\n\n    case \"SPLIT_PANEL\":\n      return splitPanel(panelsState, action.payload);\n\n    case \"SWAP_PANEL\":\n      return swapPanel(panelsState, action.payload);\n\n    case \"MOVE_TAB\":\n      return moveTab(panelsState, action.payload);\n\n    case \"ADD_PANEL\":\n      return addPanel(panelsState, action.payload);\n\n    case \"DROP_PANEL\":\n      return dropPanel(panelsState, action.payload);\n\n    case \"START_DRAG\":\n      return startDrag(panelsState, action.payload);\n\n    case \"END_DRAG\":\n      return endDrag(panelsState, action.payload);\n\n    default:\n      throw new Error(\"This reducer should only be used for panel actions\");\n  }\n\n  return panelsState;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { pick, uniq } from \"lodash\";\nimport { ReactNode, useCallback, useEffect, useMemo, useState } from \"react\";\nimport { createSelector, createSelectorCreator, defaultMemoize } from \"reselect\";\nimport { DeepReadonly } from \"ts-essentials\";\nimport { createStore, StoreApi } from \"zustand\";\n\nimport { usePanelContext } from \"@foxglove/studio-base/components/PanelContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport {\n  ImmutableSettingsTree,\n  PanelStateContext,\n  PanelStateStore,\n  SharedPanelState,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nfunction createPanelStateStore(): StoreApi<PanelStateStore> {\n  return createStore((set) => {\n    return {\n      sequenceNumbers: {},\n      settingsTrees: {},\n      sharedPanelState: {},\n      defaultTitles: {},\n\n      incrementSequenceNumber: (panelId: string) => {\n        set((state) => {\n          return {\n            sequenceNumbers: {\n              ...state.sequenceNumbers,\n              [panelId]: (state.sequenceNumbers[panelId] ?? 0) + 1,\n            },\n          };\n        });\n      },\n\n      updateSettingsTree: (panelId, settingsTree) => {\n        set((state) => ({\n          settingsTrees: {\n            ...state.settingsTrees,\n            [panelId]: settingsTree,\n          },\n        }));\n      },\n\n      updateDefaultTitle: (panelId, defaultTitle) => {\n        set((state) => ({ defaultTitles: { ...state.defaultTitles, [panelId]: defaultTitle } }));\n      },\n\n      updateSharedPanelState: (type: string, data: SharedPanelState) => {\n        set((old) => ({ sharedPanelState: { ...old.sharedPanelState, [type]: data } }));\n      },\n    };\n  });\n}\n\nconst updateSettingsTreeSelector = (store: PanelStateStore) => store.updateSettingsTree;\n\n/**\n * Returns updater function for the current panels settings tree.\n */\nexport function usePanelSettingsTreeUpdate(): (newTree: ImmutableSettingsTree) => void {\n  const { id } = usePanelContext();\n  const updateStoreTree = usePanelStateStore(updateSettingsTreeSelector);\n\n  const updateSettingsTree = useCallback(\n    (newTree: ImmutableSettingsTree) => {\n      updateStoreTree(id, newTree);\n    },\n    [id, updateStoreTree],\n  );\n\n  /** Cleanup unmounted panels\n   * `actionHandler` can capture panel variables in closure context and keep them in memory\n   * even after unmounting. To prevent this we set the panelSettingsTree entry to undefined,\n   * allowing the actionHandler and its captured closure context from the unmounted panel to\n   * be garbage collected.\n   */\n  useEffect(() => {\n    return () => {\n      updateStoreTree(id, undefined);\n    };\n  }, [id, updateStoreTree]);\n\n  return updateSettingsTree;\n}\n\nconst updateSharedDataSelector = (store: PanelStateStore) => store.updateSharedPanelState;\nconst updateDefaultTitleSelector = (store: PanelStateStore) => store.updateDefaultTitle;\n\n/**\n * Returns a [state, setState] pair that can be used to read and update shared transient\n * panel state.\n */\nexport function useSharedPanelState(): [\n  DeepReadonly<SharedPanelState>,\n  (data: DeepReadonly<SharedPanelState>) => void,\n] {\n  const panelId = usePanelContext().id;\n  const panelType = useMemo(() => getPanelTypeFromId(panelId), [panelId]);\n\n  const selector = useCallback(\n    (store: PanelStateStore) => {\n      return store.sharedPanelState[panelType];\n    },\n    [panelType],\n  );\n\n  const updateSharedData = usePanelStateStore(updateSharedDataSelector);\n  const sharedData = usePanelStateStore(selector);\n  const update = useCallback(\n    (data: DeepReadonly<SharedPanelState>) => {\n      updateSharedData(panelType, data);\n    },\n    [panelType, updateSharedData],\n  );\n\n  return [sharedData, update];\n}\n\n/**\n * Returns a [state, setState] pair that can be used to read and update a panel's default title.\n */\nexport function useDefaultPanelTitle(): [\n  string | undefined,\n  (defaultTitle: string | undefined) => void,\n] {\n  const panelId = usePanelContext().id;\n\n  const selector = useCallback((store: PanelStateStore) => store.defaultTitles[panelId], [panelId]);\n\n  const updateDefaultTitle = usePanelStateStore(updateDefaultTitleSelector);\n  const defaultTitle = usePanelStateStore(selector);\n  const update = useCallback(\n    (newValue: string | undefined) => {\n      updateDefaultTitle(panelId, newValue);\n    },\n    [panelId, updateDefaultTitle],\n  );\n\n  return [defaultTitle, update];\n}\n\n/**\n * True if both objects have the same keys, ignoring values.\n */\nfunction hasSameKeys(\n  a: undefined | Record<string, unknown>,\n  b: undefined | Record<string, unknown>,\n) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a == undefined && b != undefined) {\n    return false;\n  }\n  if (a != undefined && b == undefined) {\n    return false;\n  }\n\n  if (a != undefined && b != undefined) {\n    for (const keyA in a) {\n      if (!Object.prototype.hasOwnProperty.call(b, keyA)) {\n        return false;\n      }\n    }\n\n    for (const keyB in b) {\n      if (!Object.prototype.hasOwnProperty.call(a, keyB)) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\nconst createHasSameKeySelector = createSelectorCreator(defaultMemoize, hasSameKeys);\n\nconst selectCurrentLayoutId = (state: LayoutState) => state.selectedLayout?.id;\n\nconst selectLayoutConfigById = createHasSameKeySelector(\n  (state: LayoutState) => state.selectedLayout?.data?.configById,\n  (config) => config,\n);\n\nconst selectPanelTypesInUse = createSelector(selectLayoutConfigById, (config) => {\n  return uniq(Object.keys(config ?? {}).map(getPanelTypeFromId));\n});\n\nexport function PanelStateContextProvider({ children }: { children?: ReactNode }): JSX.Element {\n  const [store] = useState(createPanelStateStore());\n\n  // discared shared panel state for panel types that are no longer in the layout\n  const panelTypesInUse = useCurrentLayoutSelector(selectPanelTypesInUse);\n  useEffect(() => {\n    store.setState((old) => ({ sharedPanelState: pick(old.sharedPanelState, panelTypesInUse) }));\n  }, [panelTypesInUse, store]);\n\n  // clear shared panel state on layout change\n  const currentLayoutId = useCurrentLayoutSelector(selectCurrentLayoutId);\n  useEffect(() => {\n    void currentLayoutId;\n    store.setState({ sharedPanelState: {} });\n  }, [currentLayoutId, store]);\n\n  return <PanelStateContext.Provider value={store}>{children}</PanelStateContext.Provider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\ntype ReportErrorHandler = (error: Error) => void;\n\nconst globalWithHandler = global as { foxgloveStudioReportErrorFn?: ReportErrorHandler };\n\n/**\n * Report an error that has escaped past normal error-handling flows in the app and should be\n * triaged and diagnosed.\n */\nexport function reportError(error: Error): void {\n  globalWithHandler.foxgloveStudioReportErrorFn?.(error);\n}\n\n/**\n * Set the handler function which will be called when an error is passed to `reportError()`. The default is\n * a no-op.\n */\nexport function setReportErrorHandler(fn: ReportErrorHandler): void {\n  globalWithHandler.foxgloveStudioReportErrorFn = fn;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport createCache from \"@emotion/cache\";\nimport { CacheProvider } from \"@emotion/react\";\nimport { ThemeProvider as MuiThemeProvider } from \"@mui/material\";\nimport { useEffect, useLayoutEffect, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { Language } from \"@foxglove/studio-base/i18n\";\nimport { createMuiTheme } from \"@foxglove/studio-base/theme\";\n\n// Make sure mui styles are loaded first so that our makeStyles customizations\n// take precedence.\nconst muiCache = createCache({ key: \"mui\", prepend: true });\n\n// By default the ThemeProvider adds an extra div to the DOM tree. We can disable this with a\n// custom `as` component to FluentThemeProvider. The component must support a `ref` property\n// otherwise we get react warnings.\nconst ThemeContainer = React.forwardRef((props, _ref) => <>{props.children}</>);\nThemeContainer.displayName = \"ThemeContainer\";\n\nexport default function ThemeProvider({\n  children,\n  isDark,\n}: React.PropsWithChildren<{ isDark: boolean }>): React.ReactElement | ReactNull {\n  useEffect(() => {\n    // Trick CodeEditor into sync with our theme\n    document.documentElement.setAttribute(\"data-color-mode\", isDark ? \"dark\" : \"light\");\n  }, [isDark]);\n\n  const { i18n } = useTranslation();\n  const muiTheme = useMemo(\n    () => createMuiTheme(isDark ? \"dark\" : \"light\", i18n.language as Language),\n    [i18n.language, isDark],\n  );\n\n  useLayoutEffect(() => {\n    // Set the theme color to match the sidebar and playback bar\n    const meta = document.createElement(\"meta\");\n    meta.name = \"theme-color\";\n    meta.content = muiTheme.palette.background.paper;\n    document.head.appendChild(meta);\n    return () => meta.remove();\n  }, [muiTheme]);\n\n  return (\n    <CacheProvider value={muiCache}>\n      <MuiThemeProvider theme={muiTheme}>{children}</MuiThemeProvider>\n    </CacheProvider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// this type mirrors the MessageChannel and MessagePort APIs which are available on\n// instances of web-workers and shared-workers respectively, as well as avaiable on\n// 'global' within them.\nexport interface Channel {\n  postMessage(data: unknown, transfer?: (Transferable | OffscreenCanvas)[]): void;\n  onmessage?: ((ev: MessageEvent) => unknown) | null; // eslint-disable-line no-restricted-syntax\n  terminate: () => void;\n}\n\nconst RESPONSE = \"$$RESPONSE\";\nconst ERROR = \"$$ERROR\";\n\n// helper function to create linked channels for testing\nexport function createLinkedChannels(): { local: Channel; remote: Channel } {\n  const local: Channel = {\n    onmessage: undefined,\n\n    postMessage(data: unknown, _transfer?: Array<ArrayBuffer>) {\n      const ev = new MessageEvent(\"message\", { data });\n      if (remote.onmessage) {\n        remote.onmessage(ev);\n      }\n    },\n    terminate: () => {\n      // no-op\n    },\n  };\n\n  const remote: Channel = {\n    onmessage: undefined,\n\n    postMessage(data: unknown, _transfer?: Array<ArrayBuffer>) {\n      const ev = new MessageEvent(\"message\", { data });\n      if (local.onmessage) {\n        local.onmessage(ev);\n      }\n    },\n    terminate: () => {\n      // no-op\n    },\n  };\n  return { local, remote };\n}\n\n// This class allows you to hook up bi-directional async calls across web-worker\n// boundaries where a single call to or from a worker can 'wait' on the response.\n// Errors in receivers are propigated back to the caller as a rejection.\n// It also supports returning transferables over the web-worker postMessage api,\n// which was the main shortcomming with the worker-rpc npm module.\n// To attach rpc to an instance of a worker in the main thread:\n//   const rpc = new Rpc(workerInstace);\n// To attach rpc within an a web worker:\n//   const rpc = new Rpc(global);\n// Check out the tests for more examples.\nexport default class Rpc {\n  public static transferables = \"$$TRANSFERABLES\";\n  private _channel: Omit<Channel, \"terminate\">;\n  private _messageId: number = 0;\n  private _pendingCallbacks: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    [key: number]: (arg0: any) => void;\n  } = {};\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private _receivers: Map<string, (arg0: any) => any> = new Map();\n\n  public constructor(channel: Omit<Channel, \"terminate\">) {\n    this._channel = channel;\n    if (this._channel.onmessage) {\n      throw new Error(\n        \"channel.onmessage is already set. Can only use one Rpc instance per channel.\",\n      );\n    }\n    this._channel.onmessage = this._onChannelMessage;\n  }\n\n  private _onChannelMessage = (ev: MessageEvent): void => {\n    const { id, topic, data } = ev.data;\n    if (topic === RESPONSE) {\n      this._pendingCallbacks[id]?.(ev.data);\n      delete this._pendingCallbacks[id];\n      return;\n    }\n    // invoke the receive handler in a promise so if it throws synchronously we can reject\n    new Promise<Record<string, Transferable[] | undefined> | undefined>((resolve) => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      const handler = this._receivers.get(topic);\n      if (!handler) {\n        throw new Error(`no receiver registered for ${topic}`);\n      }\n      // This works both when `handler` returns a value or a Promise.\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      resolve(handler(data));\n    })\n      .then((result) => {\n        if (!result) {\n          return this._channel.postMessage({ topic: RESPONSE, id });\n        }\n        const transferables = result[Rpc.transferables];\n        delete result[Rpc.transferables];\n        const message = {\n          topic: RESPONSE,\n          id,\n          data: result,\n        };\n        this._channel.postMessage(message, transferables);\n      })\n      .catch((err) => {\n        const message = {\n          topic: RESPONSE,\n          id,\n          data: {\n            [ERROR]: true,\n            name: err.name,\n            message: err.message,\n            stack: err.stack,\n          },\n        };\n        this._channel.postMessage(message);\n      });\n  };\n\n  /** Call this when the channel has been terminated to reject any outstanding send callbacks. */\n  public terminate(): void {\n    for (const [id, callback] of Object.entries(this._pendingCallbacks)) {\n      callback({\n        topic: RESPONSE,\n        id,\n        data: {\n          [ERROR]: true,\n          name: \"Error\",\n          message: \"Rpc terminated\",\n          stack: new Error().stack,\n        },\n      });\n    }\n  }\n\n  // send a message across the rpc boundary to a receiver on the other side\n  // this returns a promise for the receiver's response.  If there is no registered\n  // receiver for the given topic, this method throws\n  public async send<TResult, TData = unknown>(\n    topic: string,\n    data?: TData,\n    transfer?: (Transferable | OffscreenCanvas)[],\n  ): Promise<TResult> {\n    const id = this._messageId++;\n    const message = { topic, id, data };\n    const result = new Promise<TResult>((resolve, reject) => {\n      this._pendingCallbacks[id] = (info) => {\n        if (info.data?.[ERROR] != undefined) {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n          const error = new Error(info.data.message);\n          error.name = info.data.name;\n          error.stack = info.data.stack;\n          reject(error);\n        } else {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n          resolve(info.data);\n        }\n      };\n    });\n    this._channel.postMessage(message, transfer);\n    return await result;\n  }\n\n  // register a receiver for a given message on a topic\n  // only one receiver can be registered per topic and currently\n  // 'deregistering' a receiver is not supported since this is not common\n  public receive<T, TOut>(topic: string, handler: (arg0: T) => TOut): void {\n    if (this._receivers.has(topic)) {\n      throw new Error(`Receiver already registered for topic: ${topic}`);\n    }\n    this._receivers.set(topic, handler);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport function assertNever(_: never, msg: string): never {\n  throw new Error(msg);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { mightActuallyBePartial } from \"@foxglove/studio-base/util/mightActuallyBePartial\";\n\nfunction fallbackCopy(text: string) {\n  const body = document.body;\n  const el = document.createElement(\"textarea\");\n  body.appendChild(el);\n  el.value = text;\n  el.select();\n  document.execCommand(\"copy\");\n  body.removeChild(el);\n}\n\nexport default {\n  // Copy a string to the clipboard\n  async copy(text: string): Promise<void> {\n    // attempt to use the new async clipboard methods. If those are not available or fail, fallback to the old\n    // `execCommand` method.\n    if (mightActuallyBePartial(navigator.clipboard).writeText != undefined) {\n      try {\n        return await navigator.clipboard.writeText(text);\n      } catch (error) {\n        fallbackCopy(text);\n      }\n    } else {\n      fallbackCopy(text);\n    }\n  },\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// extra boundary added for jest testing, since jsdom's Blob doesn't support .text()\nexport function downloadTextFile(text: string, fileName: string): void {\n  return downloadFiles([{ blob: new Blob([text]), fileName }]);\n}\n\nexport function downloadFiles(files: { blob: Blob; fileName: string }[]): void {\n  const body = document.body;\n\n  const link = document.createElement(\"a\");\n  link.style.display = \"none\";\n  body.appendChild(link);\n\n  const urls = files.map((file) => {\n    const url = window.URL.createObjectURL(file.blob);\n    link.setAttribute(\"download\", file.fileName);\n    link.setAttribute(\"href\", url);\n    link.click();\n    return url;\n  });\n\n  // remove the link after triggering download\n  window.requestAnimationFrame(() => {\n    body.removeChild(link);\n    urls.forEach((url) => {\n      URL.revokeObjectURL(url);\n    });\n  });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { DetailsType } from \"@foxglove/studio-base/util/sendNotification\";\n\nexport class AppError extends Error {\n  public details: DetailsType;\n  public extraInfo: unknown;\n  public override message: string;\n\n  public constructor(details: DetailsType, extraInfo?: unknown) {\n    super();\n    this.details = details;\n    this.extraInfo = extraInfo;\n    this.name = \"AppError\";\n    this.message = \"\";\n\n    if (details instanceof Error) {\n      this.message = details.stack ?? details.message;\n    } else if (typeof details === \"string\") {\n      this.message = details;\n    }\n\n    if (extraInfo != undefined) {\n      // If `extraInfo` was passed via a componentDidCatch:\n      // https://reactjs.org/docs/react-component.html#componentdidcatch\n      if ((extraInfo as { componentStack: unknown }).componentStack != undefined) {\n        this.message += `\\n\\n${(extraInfo as { componentStack: unknown }).componentStack}`;\n      } else {\n        try {\n          const stringifiedExtraInfo = JSON.stringify(extraInfo);\n          this.message += `\\n\\n${stringifiedExtraInfo}`;\n        } catch (e) {\n          this.message += `\\n\\n[ Either cyclic object or object with BigInt(s) ]`;\n        }\n      }\n    }\n\n    if (this.message === \"\") {\n      this.message = \"Unknown Error\";\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Time } from \"@foxglove/rostime\";\n\nconst DIGITS_WITHOUT_DECIMAL_POINT_RE = /^\\d+$/;\nconst DIGITS_WITH_DECIMAL_POINT_RE = /^(?!\\.$)(\\d*)\\.(\\d*)$/;\nconst THOUSAND_YEARS_IN_NANOSEC = 1000n * 365n * 24n * 60n * 60n * BigInt(1e9);\n\n/**\n * Parses a ROS time (UNIX timestamp) containing a whole or floating point number of seconds. If\n * more than 9 digits of nanoseconds are given, the rest will be truncated.\n *\n * Parsing is lenient: if the numeric value given is too large and contains no decimal point, assume\n * it is ms, µs, ns instead of seconds (or a smaller unit, in powers of 1000).\n */\nexport default function parseFuzzyRosTime(stamp: string): Time | undefined {\n  const trimmedStamp = stamp.trim();\n  if (DIGITS_WITHOUT_DECIMAL_POINT_RE.test(trimmedStamp)) {\n    // Start by assuming the input is in seconds, and convert to nanoseconds.\n    let nanos = BigInt(trimmedStamp) * BigInt(1e9);\n    while (nanos > THOUSAND_YEARS_IN_NANOSEC) {\n      nanos /= 1000n;\n    }\n    return { sec: Number(nanos / BigInt(1e9)), nsec: Number(nanos % BigInt(1e9)) };\n  }\n\n  const match = DIGITS_WITH_DECIMAL_POINT_RE.exec(trimmedStamp);\n  if (match?.[1] != undefined && match[2] != undefined) {\n    // There can be at most 9 digits of nanoseconds. Truncate any others.\n    return { sec: Number(match[1]), nsec: Number(match[2].substr(0, 9).padEnd(9, \"0\")) };\n  }\n\n  return undefined;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport momentDurationFormatSetup from \"moment-duration-format\";\nimport moment from \"moment-timezone\";\n\nimport { Time, toDate, fromDate } from \"@foxglove/rostime\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\n\nimport parseFuzzyRosTime from \"./parseFuzzyRosTime\";\n\n// All time functions that require `moment` should live in this file.\n\n// @ts-expect-error suppress Argument of type 'typeof moment' is not assignable to parameter of type 'typeof import ...\n// There is some miss-match between the moment we import and the one the type declarations expect\nmomentDurationFormatSetup(moment);\n\nexport function format(stamp: Time, timezone?: string): string {\n  return `${formatDate(stamp, timezone)} ${formatTime(stamp, timezone)}`;\n}\n\nexport function formatDate(stamp: Time, timezone?: string): string {\n  if (stamp.sec < 0 || stamp.nsec < 0) {\n    console.error(\"Times are not allowed to be negative\");\n    return \"(invalid negative time)\";\n  }\n  return moment\n    .tz(toDate(stamp), timezone != undefined ? timezone : moment.tz.guess())\n    .format(\"YYYY-MM-DD\");\n}\n\nexport function formatTime(stamp: Time, timezone?: string): string {\n  if (stamp.sec < 0 || stamp.nsec < 0) {\n    console.error(\"Times are not allowed to be negative\");\n    return \"(invalid negative time)\";\n  }\n  return moment\n    .tz(toDate(stamp), timezone != undefined ? timezone : moment.tz.guess())\n    .format(\"h:mm:ss.SSS A z\");\n}\n\nexport function formatDuration(stamp: Time): string {\n  return moment\n    .duration(Math.round(stamp.sec * 1000 + stamp.nsec / 1e6))\n    .format(\"h:mm:ss.SSS\", { trim: false });\n}\n\nexport function parseTimeStr(str: string, timezone?: string): Time | undefined {\n  const newMomentTimeObj =\n    timezone != undefined\n      ? moment.tz(str, \"YYYY-MM-DD h:mm:ss.SSS A z\", timezone)\n      : moment(str, \"YYYY-MM-DD h:mm:ss.SSS A z\");\n  const date = newMomentTimeObj.toDate();\n  const result = newMomentTimeObj.isValid() ? fromDate(date) : undefined;\n\n  if (!result || result.sec <= 0 || result.nsec < 0) {\n    return undefined;\n  }\n  return result;\n}\n\nconst todTimeRegex = /^\\d+:\\d+:\\d+.\\d+\\s[PpAa][Mm]\\s[A-Za-z$]+/;\nexport const getValidatedTimeAndMethodFromString = ({\n  text,\n  date,\n  timezone,\n}: {\n  text?: string;\n  date: string;\n  timezone?: string;\n}): { time?: Time; method: TimeDisplayMethod } | undefined => {\n  if (text == undefined || text === \"\") {\n    return;\n  }\n  const isInvalidRawTime = isNaN(+text);\n  const isInvalidTodTime = !(todTimeRegex.test(text) && parseTimeStr(`${date} ${text}`, timezone));\n\n  if (isInvalidRawTime && isInvalidTodTime) {\n    return;\n  }\n\n  return {\n    time: !isInvalidRawTime ? parseFuzzyRosTime(text) : parseTimeStr(`${date} ${text}`, timezone),\n    method: isInvalidRawTime ? \"TOD\" : \"SEC\",\n  };\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { useTheme } from \"@mui/material\";\nimport type { Base16Theme } from \"base16\";\n\nexport const DEFAULT_STUDIO_NODE_PREFIX = \"/studio_script/\";\n\nexport function useJsonTreeTheme(): Pick<\n  Base16Theme,\n  \"base00\" | \"base07\" | \"base0B\" | \"base09\" | \"base08\" | \"base0D\" | \"base03\"\n> {\n  const {\n    palette: { mode, text },\n  } = useTheme();\n\n  return {\n    dark: {\n      base00: \"transparent\", // bg\n      base0B: \"#ffa657\", // string & date, item string\n      base09: \"#7ee787\", // # & boolean\n      base07: \"#79c0ff\", // text\n      base08: \"#ff7b72\", // null, undefined, function, & symbol\n      base0D: \"#79c0ff\", // label & arrow\n      base03: text.secondary, // item string expanded\n    },\n    light: {\n      base00: \"transparent\", // bg\n      base0B: \"#953800\", // string & date, item string\n      base09: \"#116329\", // # & boolean\n      base07: \"#0550ae\", // text\n      base08: \"#cf222e\", // null, undefined, function, & symbol\n      base0D: \"#0550ae\", // label & arrow\n      base03: text.secondary, // item string expanded\n    },\n  }[mode];\n}\n\nexport const TAB_PANEL_TYPE = \"Tab\";\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport default function isDesktopApp(): boolean {\n  return Boolean((global as unknown as { desktopBridge: unknown }).desktopBridge);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { compact, flatMap, xor, uniq } from \"lodash\";\nimport {\n  createRemoveUpdate,\n  getLeaves,\n  getNodeAtPath,\n  updateTree,\n  MosaicUpdate,\n  isParent,\n  MosaicNode,\n  MosaicPath,\n} from \"react-mosaic-component\";\nimport { MosaicDirection, MosaicKey } from \"react-mosaic-component/lib/types\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Logger from \"@foxglove/log\";\nimport {\n  ConfigsPayload,\n  SaveConfigsPayload,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { TabConfig, TabLocation, TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport {\n  PanelConfig,\n  MosaicDropTargetPosition,\n  SavedProps,\n} from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\n\nconst log = Logger.getLogger(__filename);\n\n/** Key injected into panel configs for user-selected title (overrides setDefaultPanelTitle) */\nexport const PANEL_TITLE_CONFIG_KEY = \"foxglovePanelTitle\";\n\n// given a panel type, create a unique id for a panel\n// with the type embedded within the id\n// we need this because react-mosaic\nexport function getPanelIdForType(type: string): string {\n  const factor = 1e10;\n  const rnd = Math.round(Math.random() * factor).toString(36);\n  // a panel id consists of its type, an exclamation mark for splitting, and a random val\n  // because each panel id functions is the react 'key' for the react-mosaic-component layout\n  // but also must encode the panel type for panel factory construction\n  return `${type}!${rnd}`;\n}\n\nexport function getPanelTypeFromId(id: string): string {\n  return id.split(\"!\")[0] ?? \"\";\n}\n\nexport function isTabPanel(panelId: string): boolean {\n  return getPanelTypeFromId(panelId) === TAB_PANEL_TYPE;\n}\n\nexport function isTabPanelConfig(config: PanelConfig | undefined): config is TabPanelConfig {\n  return config != undefined && \"tabs\" in config && \"activeTabIdx\" in config;\n}\n\n// Traverses `tree` to find the path to the specified `node`\nexport function getPathFromNode<T extends MosaicKey>(\n  node: T | undefined,\n  tree: MosaicNode<T> | null, // eslint-disable-line no-restricted-syntax\n  path: MosaicPath = [],\n): MosaicPath {\n  if (tree === node) {\n    return path;\n  }\n  if (tree != undefined && isParent(tree)) {\n    const first = getPathFromNode(node, tree.first, [...path, \"first\"]);\n    if (first.length > 0) {\n      return first;\n    }\n    const second = getPathFromNode(node, tree.second, [...path, \"second\"]);\n    if (second.length > 0) {\n      return second;\n    }\n  }\n  return [];\n}\n\ntype PanelIdMap = {\n  [panelId: string]: string;\n};\nfunction mapTemplateIdsToNewIds(templateIds: string[]): PanelIdMap {\n  const result: PanelIdMap = {};\n  for (const id of templateIds) {\n    result[id] = getPanelIdForType(getPanelTypeFromId(id));\n  }\n  return result;\n}\n\ntype IndexableMosaic = MosaicNode<string> & Record<string, unknown>;\n\nfunction getLayoutWithNewPanelIds(\n  layout: undefined | IndexableMosaic,\n  panelIdMap: PanelIdMap,\n): MosaicNode<string> | undefined {\n  if (typeof layout === \"string\") {\n    // return corresponding ID if it exists in panelIdMap\n    // (e.g. for Tab panel presets with 1 panel in active layout)\n    return panelIdMap[layout] ?? getPanelIdForType(getPanelTypeFromId(layout));\n  }\n\n  if (layout == undefined) {\n    return undefined;\n  }\n  const newLayout: Record<string, unknown> = {};\n  for (const key in layout) {\n    if (typeof layout[key] === \"object\" && !Array.isArray(layout[key])) {\n      newLayout[key] = getLayoutWithNewPanelIds(layout[key] as IndexableMosaic, panelIdMap);\n    } else if (typeof layout[key] === \"string\" && panelIdMap[layout[key] as string] != undefined) {\n      newLayout[key] = panelIdMap[layout[key] as string];\n    } else {\n      newLayout[key] = layout[key];\n    }\n  }\n  return newLayout as unknown as MosaicNode<string>;\n}\n\n// Recursively removes all empty nodes from a layout\nfunction compactLayout(layout: MosaicNode<string>): MosaicNode<string> {\n  if (typeof layout === \"string\") {\n    return layout;\n  }\n\n  const prunedChildren = [layout.first, layout.second].filter(Boolean).map(compactLayout);\n  const [first, second] = prunedChildren;\n  if (first == undefined && second == undefined) {\n    return \"\";\n  } else if (first != undefined && second != undefined) {\n    return {\n      ...layout,\n      first,\n      second,\n    };\n  }\n\n  return {\n    ...layout,\n    first: first ?? second ?? \"\",\n    second: \"\",\n  };\n}\n\n// Recursively replaces all leaves of the current layout\nfunction replaceLeafLayouts(\n  layout: MosaicNode<string>,\n  replacerFn: (layout: MosaicNode<string>) => MosaicNode<string>,\n): MosaicNode<string> {\n  if (typeof layout === \"string\") {\n    return replacerFn(layout);\n  }\n  return {\n    ...layout,\n    first: replaceLeafLayouts(layout.first, replacerFn),\n    second: replaceLeafLayouts(layout.second, replacerFn),\n  };\n}\n\n// Replaces Tab panels with their active tab's layout\nexport function inlineTabPanelLayouts(\n  layout: MosaicNode<string>,\n  savedProps: SavedProps,\n  preserveTabPanelIds: readonly string[],\n): MosaicNode<string> {\n  const tabFreeLayout = replaceLeafLayouts(layout, (id) => {\n    if (typeof id === \"string\" && isTabPanel(id) && !preserveTabPanelIds.includes(id)) {\n      const panelProps = getValidTabPanelConfig(id, savedProps);\n      const tabLayout = panelProps.tabs[panelProps.activeTabIdx]?.layout;\n      if (tabLayout != undefined) {\n        return inlineTabPanelLayouts(tabLayout, savedProps, preserveTabPanelIds);\n      }\n    }\n    return id;\n  });\n  return compactLayout(tabFreeLayout);\n}\n\n// Maps panels to their parent Tab panel\nexport const getParentTabPanelByPanelId = (\n  savedProps: SavedProps,\n): {\n  [key: string]: string;\n} =>\n  Object.entries(savedProps).reduce(\n    (\n      memo: Record<string, string>,\n      [savedPanelId, savedConfig]: [string, undefined | PanelConfig],\n    ) => {\n      if (isTabPanel(savedPanelId) && savedConfig != undefined) {\n        const tabPanelConfig = savedConfig as Partial<TabPanelConfig>;\n        tabPanelConfig.tabs?.forEach((tab) => {\n          const panelIdsInTab = getLeaves(tab.layout ?? ReactNull);\n          panelIdsInTab.forEach((id) => (memo[id] = savedPanelId));\n        });\n      }\n      return memo;\n    },\n    {},\n  );\n\nconst replaceMaybeTabLayoutWithNewPanelIds = (panelIdMap: PanelIdMap) => {\n  return ({ id, config }: { id: string; config: Partial<TabPanelConfig> }) => {\n    return config.tabs\n      ? {\n          id,\n          config: {\n            ...config,\n            tabs: config.tabs.map((tab: TabConfig) => ({\n              ...tab,\n              layout: getLayoutWithNewPanelIds(tab.layout as IndexableMosaic, panelIdMap),\n            })),\n          },\n        }\n      : { id, config };\n  };\n};\n\nexport const getSaveConfigsPayloadForAddedPanel = ({\n  id,\n  config,\n  relatedConfigs,\n}: {\n  id: string;\n  config: PanelConfig;\n  relatedConfigs?: SavedProps;\n}): SaveConfigsPayload => {\n  if (!relatedConfigs) {\n    return { configs: [{ id, config }] };\n  }\n  const templateIds = getPanelIdsInsideTabPanels([id], { [id]: config });\n  const panelIdMap = mapTemplateIdsToNewIds(templateIds);\n  const newConfigs = filterMap(templateIds, (templateId) => {\n    const panelId = panelIdMap[templateId];\n    const relatedConfig = relatedConfigs[templateId];\n    if (panelId == undefined || relatedConfig == undefined) {\n      return;\n    }\n\n    return {\n      id: panelId,\n      config: relatedConfig,\n    };\n  });\n  const allConfigs = [...newConfigs, { id, config }].map(\n    replaceMaybeTabLayoutWithNewPanelIds(panelIdMap),\n  );\n  return { configs: allConfigs };\n};\n\nexport function getPanelIdsInsideTabPanels(panelIds: string[], savedProps: SavedProps): string[] {\n  const tabPanelIds = panelIds.filter(isTabPanel);\n  const tabLayouts: MosaicNode<string>[] = [];\n  tabPanelIds.forEach((panelId) => {\n    const tabProps = savedProps[panelId] as Partial<TabPanelConfig> | undefined;\n    if (tabProps?.tabs) {\n      tabProps.tabs.forEach((tab: TabConfig) => {\n        tabLayouts.push(\n          tab.layout as MosaicNode<string>,\n          ...getPanelIdsInsideTabPanels(getLeaves(tab.layout ?? ReactNull), savedProps),\n        );\n      });\n    }\n  });\n  return flatMap(tabLayouts, getLeaves);\n}\n\nexport const DEFAULT_TAB_PANEL_CONFIG: TabPanelConfig = {\n  activeTabIdx: 0,\n  tabs: [{ title: \"1\", layout: undefined }],\n};\n// Returns all panelIds for a given layout (including layouts stored in Tab panels)\nexport function getAllPanelIds(layout: MosaicNode<string>, savedProps: SavedProps): string[] {\n  const layoutPanelIds = getLeaves(layout);\n  const tabPanelIds = getPanelIdsInsideTabPanels(layoutPanelIds, savedProps);\n  return [...layoutPanelIds, ...tabPanelIds];\n}\n\nexport const validateTabPanelConfig = (config?: PanelConfig): config is TabPanelConfig => {\n  if (!config) {\n    return false;\n  }\n\n  if (!Array.isArray(config.tabs) || typeof config.activeTabIdx !== \"number\") {\n    const error = new Error(\n      \"A non-Tab panel config is being operated on as if it were a Tab panel.\",\n    );\n    log.info(`Invalid Tab panel config: ${error.message}`, config);\n    reportError(error);\n    return false;\n  }\n  if (config.activeTabIdx >= config.tabs.length) {\n    const error = new Error(\"A Tab panel has an activeTabIdx for a nonexistent tab.\");\n    log.info(`Invalid Tab panel config: ${error.message}`, config);\n    reportError(error);\n    return false;\n  }\n  return true;\n};\n\nexport const updateTabPanelLayout = (\n  layout: MosaicNode<string> | undefined,\n  tabPanelConfig: TabPanelConfig,\n): TabPanelConfig => {\n  const updatedTabs = tabPanelConfig.tabs.map((tab, i) => {\n    if (i === tabPanelConfig.activeTabIdx) {\n      return { ...tab, layout };\n    }\n    return tab;\n  });\n  // Create a new tab if there isn't one active\n  if (tabPanelConfig.activeTabIdx === -1) {\n    updatedTabs.push({ layout, title: \"1\" });\n  }\n  return {\n    ...tabPanelConfig,\n    tabs: updatedTabs,\n    activeTabIdx: Math.max(0, tabPanelConfig.activeTabIdx),\n  };\n};\n\nexport const removePanelFromTabPanel = (\n  path: MosaicPath = [],\n  config: TabPanelConfig,\n  tabId: string,\n): SaveConfigsPayload => {\n  if (!validateTabPanelConfig(config)) {\n    return { configs: [] };\n  }\n\n  const currentTabLayout = config.tabs[config.activeTabIdx]?.layout;\n  let newTree: MosaicNode<string> | undefined;\n  if (path.length === 0) {\n    newTree = undefined;\n  } else {\n    const update = createRemoveUpdate(currentTabLayout ?? ReactNull, path);\n    newTree = updateTree<string>(currentTabLayout as MosaicNode<string>, [update]);\n  }\n\n  const saveConfigsPayload = {\n    configs: [{ id: tabId, config: updateTabPanelLayout(newTree, config) }],\n  };\n  return saveConfigsPayload;\n};\n\nexport const createAddUpdates = (\n  tree: MosaicNode<string> | undefined,\n  panelId: string,\n  newPath: MosaicPath,\n  position: MosaicDropTargetPosition,\n): MosaicUpdate<string>[] => {\n  if (tree == undefined) {\n    return [];\n  }\n  const node = getNodeAtPath(tree, newPath) as MosaicNode<string>;\n  const before = position === \"left\" || position === \"top\";\n  const [first, second] = before ? [panelId, node] : [node, panelId];\n  const direction: MosaicDirection = position === \"left\" || position === \"right\" ? \"row\" : \"column\";\n  const updates = [{ path: newPath, spec: { $set: { first, second, direction } } }];\n  return updates;\n};\n\nexport const addPanelToTab = (\n  insertedPanelId: string,\n  destinationPath: MosaicPath | undefined,\n  destinationPosition: MosaicDropTargetPosition | undefined,\n  tabConfig: PanelConfig | undefined,\n  tabId: string,\n): SaveConfigsPayload => {\n  const safeTabConfig = validateTabPanelConfig(tabConfig) ? tabConfig : DEFAULT_TAB_PANEL_CONFIG;\n\n  const currentTabLayout = safeTabConfig.tabs[safeTabConfig.activeTabIdx]?.layout;\n  const newTree =\n    currentTabLayout != undefined && destinationPath && destinationPosition != undefined\n      ? updateTree<string>(\n          currentTabLayout,\n          createAddUpdates(currentTabLayout, insertedPanelId, destinationPath, destinationPosition),\n        )\n      : insertedPanelId;\n\n  const saveConfigsPayload = {\n    configs: [\n      {\n        id: tabId,\n        config: updateTabPanelLayout(newTree, safeTabConfig),\n      },\n    ],\n  };\n  return saveConfigsPayload;\n};\n\nfunction getValidTabPanelConfig(panelId: string, savedProps: SavedProps): TabPanelConfig {\n  const config = savedProps[panelId];\n  if (!config) {\n    return DEFAULT_TAB_PANEL_CONFIG;\n  }\n  return validateTabPanelConfig(config) ? config : DEFAULT_TAB_PANEL_CONFIG;\n}\n\nexport const reorderTabWithinTabPanel = ({\n  source,\n  target,\n  savedProps,\n}: {\n  source: TabLocation;\n  target: TabLocation;\n  savedProps: SavedProps;\n}): SaveConfigsPayload => {\n  const { tabs, activeTabIdx } = getValidTabPanelConfig(source.panelId, savedProps);\n\n  const sourceIndex = source.tabIndex ?? tabs.length - 1; // source.tabIndex will always be set\n  const targetIndex = target.tabIndex ?? tabs.length - 1; // target.tabIndex will only be set when dropping on a tab\n\n  const nextSourceTabs = [...tabs.slice(0, sourceIndex), ...tabs.slice(sourceIndex + 1)];\n  nextSourceTabs.splice(targetIndex, 0, tabs[sourceIndex]!);\n\n  // Update activeTabIdx so the active tab does not change when we move the tab\n  const movedActiveTab = activeTabIdx === source.tabIndex;\n  const movedToBeforeActiveTab = targetIndex <= activeTabIdx && sourceIndex >= activeTabIdx;\n  const movedFromBeforeActiveTab = sourceIndex <= activeTabIdx && targetIndex >= activeTabIdx;\n\n  let nextActiveTabIdx = activeTabIdx;\n  if (movedActiveTab) {\n    nextActiveTabIdx = targetIndex;\n  } else if (movedToBeforeActiveTab) {\n    nextActiveTabIdx++;\n  } else if (movedFromBeforeActiveTab) {\n    nextActiveTabIdx--;\n  }\n\n  return {\n    configs: [\n      { id: source.panelId, config: { tabs: nextSourceTabs, activeTabIdx: nextActiveTabIdx } },\n    ],\n  };\n};\n\nexport const moveTabBetweenTabPanels = ({\n  source,\n  target,\n  savedProps,\n}: {\n  source: TabLocation;\n  target: TabLocation;\n  savedProps: SavedProps;\n}): SaveConfigsPayload => {\n  const sourceConfig = getValidTabPanelConfig(source.panelId, savedProps);\n  const targetConfig = getValidTabPanelConfig(target.panelId, savedProps);\n\n  const sourceIndex = source.tabIndex ?? sourceConfig.tabs.length;\n  const targetIndex = target.tabIndex ?? targetConfig.tabs.length;\n  const nextTabsSource = [\n    ...sourceConfig.tabs.slice(0, sourceIndex),\n    ...sourceConfig.tabs.slice(sourceIndex + 1),\n  ];\n\n  const nextTabsTarget = targetConfig.tabs.slice();\n  nextTabsTarget.splice(targetIndex, 0, sourceConfig.tabs[sourceIndex]!);\n\n  // Update activeTabIdx so the active tab does not change as we move the tab\n  const movedToBeforeActiveTabSource = sourceIndex <= sourceConfig.activeTabIdx;\n  const nextActiveTabIdxSource = movedToBeforeActiveTabSource\n    ? Math.max(0, sourceConfig.activeTabIdx - 1)\n    : sourceConfig.activeTabIdx;\n\n  const movedToBeforeActiveTabTarget = targetIndex <= targetConfig.activeTabIdx;\n  const nextActiveTabIdxTarget = movedToBeforeActiveTabTarget\n    ? targetConfig.activeTabIdx + 1\n    : targetConfig.activeTabIdx;\n\n  return {\n    configs: [\n      {\n        id: source.panelId,\n        config: { tabs: nextTabsSource, activeTabIdx: nextActiveTabIdxSource },\n      },\n      {\n        id: target.panelId,\n        config: { tabs: nextTabsTarget, activeTabIdx: nextActiveTabIdxTarget },\n      },\n    ],\n  };\n};\n\nexport const replaceAndRemovePanels = (\n  panelArgs: {\n    originalId?: string;\n    newId?: string;\n    idsToRemove?: readonly string[];\n  },\n  layout: MosaicNode<string>,\n): MosaicNode<string> | undefined => {\n  const { originalId, newId, idsToRemove = [] } = panelArgs;\n  const panelIds = getLeaves(layout);\n  if (xor(panelIds, idsToRemove).length === 0) {\n    return newId;\n  }\n\n  return uniq(compact([...idsToRemove, originalId])).reduce(\n    (currentLayout: MosaicNode<string> | undefined, panelIdToRemove) => {\n      if (!panelIds.includes(panelIdToRemove)) {\n        return currentLayout;\n      } else if (currentLayout === originalId) {\n        return newId;\n      } else if (currentLayout == undefined || currentLayout === panelIdToRemove) {\n        return undefined;\n      }\n\n      const pathToNode = getPathFromNode(panelIdToRemove, currentLayout);\n      const update =\n        panelIdToRemove === originalId\n          ? ({ path: pathToNode, spec: { $set: newId } } as MosaicUpdate<string>)\n          : createRemoveUpdate(currentLayout, pathToNode);\n      return updateTree(currentLayout, [update]);\n    },\n    layout,\n  );\n};\n\nexport function getConfigsForNestedPanelsInsideTab(\n  panelIdToReplace: string | undefined,\n  tabPanelId: string | undefined,\n  panelIdsToRemove: readonly string[],\n  savedProps: SavedProps,\n): ConfigsPayload[] {\n  const configs: ConfigsPayload[] = [];\n  const tabPanelIds = Object.keys(savedProps).filter(isTabPanel);\n  tabPanelIds.forEach((panelId) => {\n    const { tabs, activeTabIdx } = getValidTabPanelConfig(panelId, savedProps);\n    const tabLayout = tabs[activeTabIdx]?.layout;\n    if (\n      tabLayout != undefined &&\n      getLeaves(tabLayout).some((id) => panelIdsToRemove.includes(id))\n    ) {\n      const newTabLayout = replaceAndRemovePanels(\n        { originalId: panelIdToReplace, newId: tabPanelId, idsToRemove: panelIdsToRemove },\n        tabLayout,\n      );\n      const newTabConfig = updateTabPanelLayout(\n        newTabLayout,\n        savedProps[panelId] as TabPanelConfig,\n      );\n      configs.push({ id: panelId, config: newTabConfig });\n    }\n  });\n  return configs;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Casts a value to a possibly undefined value of a new type.\n */\nexport function maybeCast<T>(v: unknown): undefined | T {\n  return v as undefined | T;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Marks a value as possibly having missing properties even if the specified type is\n * complete. Used to manually add checks for missing values without flagging the\n * @typescript-eslint/no-unnecessary-condition rule.\n *\n * If you need this it probably means your types are not rigorous enough.\n */\nexport function mightActuallyBePartial<T>(value: T): Partial<T> {\n  return value as Partial<T>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// Overwrite the default fetch error handler with one that catches one message: \"Failed to fetch\". We see this often\n// in our logs and want the logs to more fully reflect the error message.\nexport default function overwriteFetch(): void {\n  const originalFetch = global.fetch;\n  global.fetch = async (url: RequestInfo | URL, init?: RequestInit) => {\n    // Use this replacement error instead of the original one, because this one will have the correct stack trace.\n    const replacementError = new TypeError(`Failed to fetch: ${url}`);\n    return await originalFetch(url, init).catch((error) => {\n      if (error.message === \"Failed to fetch\") {\n        throw replacementError;\n      }\n      throw error;\n    });\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n// Provide a shim for global process variable users\n// We avoid using the npm process module since it has unfavorable performance for process.nextTick\n// and uses setTimeout(..., 0). Instead we use queueMicrotask which is much faster.\nconst process = {\n  // We want to be able to use Function type for _fn_ param\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  nextTick: (fn: Function, ...args: unknown[]): void => {\n    queueMicrotask(() => {\n      fn(...args);\n    });\n  },\n\n  title: \"browser\",\n  browser: true,\n  env: {},\n  argv: [],\n};\n\n// ts-prune-ignore-next\nexport default process;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { keyBy } from \"lodash\";\nimport { createSelector } from \"reselect\";\n\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\nexport const getTopicsByTopicName = createSelector(\n  (topics: readonly Topic[]) => topics,\n  (\n    topics: readonly Topic[],\n  ): {\n    [key: string]: Topic;\n  } => {\n    return keyBy(topics, ({ name }) => name);\n  },\n);\n\n// Only exported for tests\nexport const constantsByDatatype = createSelector(\n  (datatypes: RosDatatypes) => datatypes,\n  (\n    datatypes: RosDatatypes,\n  ): {\n    [key: string]: {\n      [key: string]: string;\n    };\n  } => {\n    type Result = Record<string | number, string>;\n    const results: Record<string, Result> = {};\n    for (const [datatype, value] of datatypes) {\n      const result: Result = (results[datatype] = {});\n      for (const field of value.definitions) {\n        if (\n          field.isConstant === true &&\n          field.value != undefined &&\n          typeof field.value !== \"boolean\"\n        ) {\n          if (result[field.value.toString()] != undefined) {\n            result[field.value.toString()] = \"<multiple constants match>\";\n          } else {\n            result[field.value.toString()] = field.name;\n          }\n        }\n      }\n    }\n    return results;\n  },\n);\n\n// Foxglove Studio enum annotations are of the form: \"Foo__foxglove_enum\" (notice double underscore)\n// This method returns type name from \"Foo\" or undefined name doesn't match this format\nexport function extractTypeFromStudioEnumAnnotation(name: string): string | undefined {\n  const match = /(.*)__(foxglove|webviz)_enum$/.exec(name);\n  if (match) {\n    return match[1];\n  }\n  return undefined;\n}\n\n// returns a map of the form {datatype -> {field -> {value -> name}}}\nexport const enumValuesByDatatypeAndField = createSelector(\n  (datatypes: RosDatatypes) => datatypes,\n  (\n    datatypes: RosDatatypes,\n  ): { [datatype: string]: { [field: string]: { [value: string]: string } } } => {\n    const results: { [datatype: string]: { [field: string]: { [value: string]: string } } } = {};\n    for (const [datatype, value] of datatypes) {\n      const currentResult: { [field: string]: { [value: string]: string } } = {};\n      // keep track of parsed constants\n      let constants: { [key: string]: string } = {};\n      // constants' types\n      let lastType: string | undefined;\n      for (const field of value.definitions) {\n        if (lastType != undefined && field.type !== lastType) {\n          // encountering new type resets the accumulated constants\n          constants = {};\n          lastType = undefined;\n        }\n\n        if (\n          field.isConstant === true &&\n          field.value != undefined &&\n          typeof field.value !== \"boolean\"\n        ) {\n          lastType = field.type;\n          if (constants[field.value.toString()] != undefined) {\n            constants[field.value.toString()] = \"<multiple constants match>\";\n          } else {\n            constants[field.value.toString()] = field.name;\n          }\n          continue;\n        }\n        // check if current field is annotation of the form: \"Foo bar__foxglove_enum\"\n        // This means that \"bar\" is enum of type \"Foo\"\n        const fieldName = extractTypeFromStudioEnumAnnotation(field.name);\n        if (fieldName != undefined) {\n          // associate all constants of type field.type with the annotated field\n          const fieldConstants = constantsByDatatype(datatypes)[field.type];\n          if (fieldConstants) {\n            currentResult[fieldName] = fieldConstants;\n          }\n          continue;\n        }\n\n        // this field was already covered by annotation, skip it\n        if (currentResult[field.name]) {\n          continue;\n        }\n\n        // otherwise assign accumulated constants for that field\n        if (Object.keys(constants).length > 0) {\n          currentResult[field.name] = constants;\n        }\n        // and start over - reset constants\n        constants = {};\n      }\n      // only assign result if we found non-empty mapping into constants\n      if (Object.keys(currentResult).length > 0) {\n        results[datatype] = currentResult;\n      }\n    }\n    return results;\n  },\n);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// For some handlers it's important to know if the error was due to the application malfunctioning\n// (programming error, dependency being down, etc) or a user mistake (incorrect/malformed data,\n// etc). We should generally prevent users from making mistakes in the first place, but sometimes\n// its unavoidable to bail out with a generic error message (e.g. when dragging in a malformed\n// ROS bag).\nimport { ReactNode } from \"react\";\n\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { AppError } from \"@foxglove/studio-base/util/errors\";\nimport { inWebWorker } from \"@foxglove/studio-base/util/workers\";\n\nexport type NotificationType = \"app\" | \"user\";\nexport type DetailsType = string | Error | ReactNode;\nexport type NotificationSeverity = \"error\" | \"warn\" | \"info\";\nexport type NotificationHandler = (\n  message: string,\n  details: DetailsType,\n  type: NotificationType,\n  severity: NotificationSeverity,\n) => void;\nexport type NotificationMessage = {\n  readonly id?: string;\n  readonly message: string;\n  readonly details: DetailsType;\n  readonly subText?: string;\n  readonly created?: Date;\n  readonly severity: NotificationSeverity;\n};\n\nconst defaultNotificationHandler: NotificationHandler = (\n  message: string,\n  details: DetailsType,\n  type: NotificationType,\n  severity: NotificationSeverity,\n): void => {\n  if (inWebWorker()) {\n    const webWorkerError =\n      \"Web Worker has uninitialized sendNotification function; this means this error message cannot show up in the UI (so we show it here in the console instead).\";\n    if (process.env.NODE_ENV === \"test\") {\n      throw new Error(webWorkerError);\n    } else {\n      const consoleFn =\n        severity === \"error\" ? console.error : severity === \"warn\" ? console.warn : console.info;\n      consoleFn(webWorkerError, message, details, type);\n    }\n    return;\n  } else if (process.env.NODE_ENV === \"test\") {\n    return;\n  }\n  console.error(\"Notification before error display is mounted\", message, details, type);\n};\n\nlet addNotification: NotificationHandler = defaultNotificationHandler;\n\nexport function setNotificationHandler(handler: NotificationHandler): void {\n  if (addNotification !== defaultNotificationHandler) {\n    throw new Error(\"Tried to overwrite existing NotificationHandler\");\n  }\n  addNotification = handler;\n}\n\nexport function unsetNotificationHandler(): void {\n  if (addNotification === defaultNotificationHandler) {\n    throw new Error(\"Tried to unset NotificationHandler but it was already the default\");\n  }\n  addNotification = defaultNotificationHandler;\n}\n\n// Call this to add an notification to the application nav bar error component if mounted.\n// If the component is not mounted, use the console as a fallback.\nexport default function sendNotification(\n  message: string,\n  details: DetailsType,\n  type: NotificationType,\n  severity: NotificationSeverity,\n): void {\n  // We only want to send non-user errors and warnings to Sentry\n  if (type === \"app\") {\n    if (severity === \"warn\" || severity === \"error\") {\n      reportError(new AppError(details, message));\n    }\n  }\n\n  addNotification(message, details, type, severity);\n}\n\nsendNotification.expectCalledDuringTest = (): void => {\n  throw new Error(\"Should be overriden in setupTestFramework.ts\");\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport default function setImmediate(\n  callback: (..._args: unknown[]) => void,\n  ...args: unknown[]\n): NodeJS.Immediate {\n  void Promise.resolve().then(() => callback(...args));\n  return undefined as unknown as NodeJS.Immediate;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// No time functions that require `moment` should live in this file.\nimport log from \"@foxglove/log\";\nimport { Time } from \"@foxglove/rostime\";\nimport { MessageEvent } from \"@foxglove/studio-base/players/types\";\nimport { MarkerArray, StampedMessage } from \"@foxglove/studio-base/types/Messages\";\n\nexport type TimestampMethod = \"receiveTime\" | \"headerStamp\";\n\nexport function formatTimeRaw(stamp: Time): string {\n  if (stamp.sec < 0 || stamp.nsec < 0) {\n    log.error(\"Times are not allowed to be negative\");\n    return \"(invalid negative time)\";\n  }\n  return `${stamp.sec}.${stamp.nsec.toFixed().padStart(9, \"0\")}`;\n}\n\nconst DURATION_20_YEARS_SEC = 20 * 365 * 24 * 60 * 60;\n\n// Values \"too small\" to be absolute epoch-based times are probably relative durations.\nexport function isAbsoluteTime(time: Time): boolean {\n  return time.sec > DURATION_20_YEARS_SEC;\n}\n\nexport function formatFrame({ sec, nsec }: Time): string {\n  return `${sec}.${String.prototype.padStart.call(nsec, 9, \"0\")}`;\n}\n\nexport function getTimestampForMessageEvent(\n  messageEvent: MessageEvent<unknown>,\n  timestampMethod?: TimestampMethod,\n): Time | undefined {\n  return timestampMethod === \"headerStamp\"\n    ? getTimestampForMessage(messageEvent.message)\n    : messageEvent.receiveTime;\n}\n\nexport function getTimestampForMessage(message: unknown): Time | undefined {\n  if ((message as Partial<StampedMessage>).header != undefined) {\n    // This message has a \"header\" field\n    const stamp = (message as Partial<StampedMessage>).header?.stamp;\n    if (stamp != undefined && \"sec\" in stamp && \"nsec\" in stamp) {\n      return stamp;\n    }\n  } else if ((message as Partial<MarkerArray>).markers?.[0]?.header != undefined) {\n    // This is a marker array message with a \"markers\" array and at least one entry\n    const stamp = (message as MarkerArray).markers[0]?.header.stamp;\n    if (stamp != undefined && \"sec\" in stamp && \"nsec\" in stamp) {\n      return stamp;\n    }\n  }\n\n  return undefined;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nexport const inWebWorker = (): boolean => {\n  return (\n    typeof global.postMessage !== \"undefined\" &&\n    typeof WorkerGlobalScope !== \"undefined\" &&\n    self instanceof WorkerGlobalScope\n  );\n};\n\n// To debug shared workers, enter 'chrome://inspect/#workers' into the url bar.\nexport const inSharedWorker = (): boolean =>\n  typeof SharedWorkerGlobalScope !== \"undefined\" && self instanceof SharedWorkerGlobalScope;\n\nexport const enforceFetchIsBlocked = <R, Args extends readonly unknown[]>(\n  fn: (...args: Args) => R,\n): ((...args: Args) => Promise<R>) => {\n  const canFetch =\n    typeof fetch !== \"undefined\" &&\n    fetch(\"data:test\")\n      .then(() => true)\n      .catch(() => false);\n  return async (...args) => {\n    if (await canFetch) {\n      throw new Error(\"Content security policy too loose.\");\n    }\n    return fn(...args);\n  };\n};\n"],"names":["___CSS_LOADER_URL_IMPORT_0___","___CSS_LOADER_URL_IMPORT_1___","___CSS_LOADER_URL_IMPORT_2___","___CSS_LOADER_URL_IMPORT_3___","___CSS_LOADER_URL_IMPORT_4___","___CSS_LOADER_URL_IMPORT_5___","___CSS_LOADER_EXPORT___","___CSS_LOADER_URL_REPLACEMENT_0___","___CSS_LOADER_URL_REPLACEMENT_1___","___CSS_LOADER_URL_REPLACEMENT_2___","___CSS_LOADER_URL_REPLACEMENT_3___","___CSS_LOADER_URL_REPLACEMENT_4___","___CSS_LOADER_URL_REPLACEMENT_5___","module","id","x","grammar","d","loc","char","acc","arr","LazilyInitialized","compute","promise","MutexLocked","value","body","debouncePromise","fn","calling","callPending","debouncedFn","args","start","Condvar","resolve","item","ArrayMap","index","key","greaterThanIndex","newEntry","lessThanIndex","list","left","right","mid","midKey","MultiMap","values","VecQueue","oldLen","newLen","oldCount","offset","i","sortedIndexByTuple","items","filterMap","mapFn","results","mappedItem","minIndexBy","collection","compare","minIdx","minItem","useRethrow","_","setError","err","useShallowMemo","ref","useVisibilityState","visibility","setVisibility","listener","log","useMustNotChangeImpl","valueRef","noOpImpl","useMustNotChange","useValueChangedDebugLogImpl","msg","prevValue","reducer","useCrash","dispatch","AppSetting","selectDatatypes","ctx","selectTopics","selectStartTime","selectCapabilities","selectPlayerId","useDataSourceInfo","datatypes","topics","startTime","capabilities","playerId","selectSetSubscriptions","useMessageReducer","props","restore","addMessage","addMessages","preloadType","useShouldNotChangeOften","requestedTopics","subscriptions","topic","setSubscriptions","state","messageEvents","lastSeekTime","newReducedValue","messageEvent","concatAndTruncate","array1","array2","limit","toTakeFromArray1","ret","toTakeFromArray2","useMessagesByTopic","params","historySize","useDeepMemo","prevMessagesByTopic","messages","newMessagesByTopic","newMessages","retTopic","prevMessages","filterBlockByTopics","block","blockMessages","useSubscribeToTopicsForBlocks","pipelineSetSubscriptions","useBlocksByTopic","allBlocks","useConfigById","panelId","getCurrentLayoutState","savePanelConfigs","configSelector","maybeCast","config","saveConfig","newConfig","currentConfig","Constants","renderRow","data","style","dataSet","inlineStyle","Typography","OuterElementContext","React","OuterElementType","outerProps","ReactWindowListboxAdapter","children","other","itemData","totalHeight","MAX_FZF_MATCHES","useStyles","theme","defaultGetText","name","EMPTY_SET","itemToFzfResult","HighlightChars","useTheme","nodes","inputRef","classes","cx","stateValue","setValue","getItemText","getItemValue","selectedItem","disabled","filterText","onBlurCallback","onChangeCallback","onSelectCallback","placeholder","readOnly","selectOnFocus","sortWhenFiltering","fzfUnfiltered","fzf","autocompleteItems","hasError","selectedItemValue","setSelectionRange","selectionStart","selectionEnd","focus","blur","onChange","_event","newValue","onSelect","selectedValue","filterOptions","options","Clear","TextField","optProps","selected","itemValue","MenuItem","CopyButton","className","color","edge","size","iconSize","getText","copied","setCopied","handleCopy","EMPTY_TOPIC_STATS","smoothValues","oldValue","calculateStaticItemFrequency","numMessages","firstMessageTime","lastMessageTime","duration","durationSec","topicDurationSec","calculateLiveItemFrequency","selectCurrentTime","playerState","selectEndTime","selectTopicStats","selectPlayerCapabilities","EMPTY_FREQUENCIES","useTopicPublishFrequencies","playerCurrentTime","endTime","topicStats","playerCapabilities","samplesByTopic","playerIsStaticSource","currentTime","result","stat","frequency","sample","messageDelta","timeDelta","newFrequency","smoothedFrequency","EM_DASH","DirectTopicStatsUpdater","interval","latestStats","useLatest","updateCount","rootRef","frequenciesByTopic","latestFrequenciesByTopic","updateStats","field","Root","DropTarget","prop","isOver","EmptyPanelLayout","tabId","addPanel","t","drop","monitor","onPanelSelect","type","relatedConfigs","EmptyState","ErrorBoundary","error","errorInfo","actions","sanitizeStack","stack","ErrorStacktrace","hideSourceLocations","lines","line","match","ErrorDisplay","hideErrorSourceLocations","showErrorDetails","setShowErrorDetails","errorDetails","stackWithoutMessage","errorString","HoverableIconButton","icon","activeIcon","activeColor","onMouseLeave","onMouseEnter","rest","hovered","setHovered","handleMouseEnter","event","handleMouseLeave","validationErrorToString","validationResult","useState","useCallback","useRef","useLayoutEffect","useEffect","ValidatedInputBase","dataTestId","dataValidator","onError","parse","maxHeight","stringify","inputStr","setInputStr","prevIncomingVal","isEditing","setIsEditing","memorizedInputValidation","newInputVal","onChangeFcn","newVal","newError","e","handleChange","val","inputElem","Stack","Error","JsonInput","callHandlers","handlers","preventDefault","KeyListener","element","handleEvent","target","getFieldPaths","output","addFieldPathsForType","curPath","typeName","seenTypes","msgdef","fieldPath","tryToSetDefaultGlobalVar","variableName","setGlobalVariables","defaultVar","getFirstInvalidVariableFromRosPath","rosPath","globalVariables","messagePath","globalVars","path","messagePathParts","getExamplePrimitive","primitiveType","supportsMathModifiers","prioritizedDatatype","validTypes","autoSize","noMultiSlices","inputStyle","disableAutocomplete","topicFields","onChangeProp","rawValue","newCursorPosition","setImmediate","autocomplete","autocompleteType","autocompleteRange","completeStart","completeEnd","completedPath","completedField","isSimpleField","messageIsValidType","keepGoingAfterTopicName","topicName","messagePathStructuresForDataype","structureTraversalResult","invalidGlobalVariablesVariable","topicNamesAutocompleteItems","topicNamesAndFieldsAutocompleteItems","autocompleteFilterText","msgPathPart","initialFilterLength","msgPath","orderedAutocompleteItems","TypicalFilterNames","isTypicalFilterName","sortFn","naturalSort","a","b","rosPrimitives","STRUCTURE_ITEM_INTEGER_TYPES","isRosPrimitive","structureItemIsIntegerPrimitive","lastDatatypes","lastStructures","messagePathStructures","structureFor","datatype","seenDatatypes","nextByName","rosDatatype","msgField","next","validTerminatingStructureItem","structureItem","messagePathsForDatatype","clonedMessagePath","messagePaths","traverse","builtString","typicalFilterItem","typicalFilterName","typicalFilterValue","matchingFilterPart","pathPart","traverseStructure","initialStructureItem","currentItem","assertNever","grammarObj","quoteTopicNameIfNeeded","quoteFieldNameIfNeeded","parseRosPath","parser","getTopicsFromPaths","paths","DRIFT_THRESHOLD_SEC","WAIT_FOR_SEEK_SEC","MessageOrderTracker","problems","didSeek","message","messageTime","info","formattedTime","errorMessage","promiseTimeout","ms","reason","_resolve","reject","MAX_PROMISE_TIMEOUT_TIME_MS","pauseFrameForPromises","promises","sendNotification","defaultPlayerState","createMessagePipelineStore","promisesToWaitForRef","initialPlayer","set","get","action","payloads","payload","service","request","player","condvar","updateSubscriberAction","prevState","previousSubscriptionsById","newTopicsBySubscriberId","newTopics","previousSubscription","prevTopics","sub","newTopic","actionTopics","newSubscriptionsById","subscriberIdsByTopic","subs","subscription","ids","updatePlayerStateAction","seenTopics","messagesBySubscriberId","subsById","lastMessageEventByTopic","subscriberMessageEvents","msgEvent","newPublicState","newPublishersById","ContextInternal","useMessagePipelineGetter","store","useGuaranteedContext","useMessagePipeline","selector","selectRenderDone","selectSubscriptions","MessagePipelineProvider","debouncedPlayerSetSubscriptions","messageRate","useAppConfigurationValue","renderDone","msPerFrameRef","cleanupListener","createPlayerListener","concatProblems","origState","updateState","messageOrderTracker","closed","resolveFn","listenerPlayerState","newPlayerState","called","delta","frameTime","promisesToWaitFor","MosaicPathContext","PanelErrorBoundary","reportError","Link","Box","Button","usePanelDrag","sourceTabId","onDragStart","onDragEnd","mosaicWindowActions","mosaicId","getCurrentLayout","startDrag","endDrag","connectDragSource","connectDragPreview","useDrag","selectedLayout","originalLayout","originalConfigById","deferredHide","ownPath","dropResult","position","destinationPath","targetTabId","ActionsOverlay","PerfInfo","Container","direction","StyledButton","Panel","PanelComponent","ConnectedPanel","childId","overrideConfig","otherProps","isMounted","useMountedState","mosaicActions","selectedPanelIds","setSelectedPanelIds","selectAllPanels","togglePanelSelected","getSelectedPanelIds","isSelected","numSelectedPanelsIfSelected","updatePanelConfigs","createTabPanel","closePanel","swapPanel","quickActionsKeyPressed","setQuickActionsKeyPressed","fullscreen","setFullscreen","fullscreenSourceRect","setFullscreenSourceRect","hasFullscreenDescendant","_setHasFullscreenDescendant","panelRootRef","panelCatalog","mosaicPath","isTopLevelPanel","parentPanelContext","PanelContext","title","defaultConfig","savedConfig","resetPanel","savedDefaultConfig","panelComponentConfig","openSiblingPanel","panelType","siblingConfigCreator","updateIfExists","panelsState","siblingDefaultConfig","siblingPanelInfo","siblingModule","lastNode","siblingPathEnd","siblingPath","siblingId","siblingConfig","newPanelPath","newPanelConfig","newPanelId","replacePanel","newPanelType","panelSettingsOpen","onPanelRootClick","groupPanels","layout","createTabs","removePanel","splitPanel","savedProps","tabSavedProps","newId","activeTabLayout","pathToPanelInTab","newTabLayout","newTabConfig","enterFullscreen","exitFullscreen","setHasFullscreenDescendant","keyUpHandlers","keyDownHandlers","fullScreenKeyHandlers","otherPanelProps","childProps","child","renderCount","perfInfo","quickActionsOverlayRef","overlay","dragSpec","connectOverlayDragSource","connectOverlayDragPreview","connectToolbarDragHandle","connectToolbarDragPreview","_id","_phase","actualDuration","_baseDuration","_startTime","_commitTime","_interactions","Transition","fullscreenState","PanelRoot","el","Tab","LibraryAddOutlined","DeleteForeverOutlined","BorderAll","usePanelContext","context","useSynchronousMountedState","mountedRef","EmptyParameters","converterKey","schema","initRenderStateBuilder","prevVariables","prevBlocks","prevSeekTime","prevSubscriptions","prevSortedTopics","prevMessageConverters","prevSharedPanelState","prevCurrentFrame","unconvertedSubscriptionTopics","topicSchemaConverters","prevRenderState","input","appSettings","colorScheme","currentFrame","hoverValue","messageConverters","sharedPanelState","sortedTopics","watchedFields","shouldRender","activeData","renderState","noConversion","subscriberTopic","existingConverters","conv","converter","parameters","convertibleTo","postProcessedFrame","converters","convertedMessage","newBlocks","frames","topicsToPreloadForPanel","forEachSortedArrays","stamp","arrays","compareFn","forEach","cursors","minCursorIndex","cursor","array","selectContext","selectInstalledMessageConverters","PanelExtensionAdapter","initPanel","initialState","messagePipelineContext","pauseFrame","seekPlayback","dataSourceProfile","setWatchedFields","localSubscriptions","setLocalSubscriptions","setAppSettings","subscribedAppSettings","setSubscribedAppSettings","renderFn","setRenderFn","isPanelInitializedRef","slowRender","setSlowRender","setDefaultPanelTitle","useGlobalVariables","setHoverValue","clearHoverValue","advertisementsRef","appConfiguration","getMessagePipelineContext","buildRenderState","setBuildRenderState","setSharedPanelState","handler","old","newAppSettings","renderingRef","resumeFrame","doneCalled","updatePanelSettingsTree","partialExtensionContext","getState","existingConfig","secondsFromStart","newWatchedFields","subscribePayloads","localSubs","settings","panelContainerRef","panelElement","onUnmount","renderFunction","PanelToolbar","PanelRemounter","sequenceNumber","UnconnectedUnknownPanel","UnknownPanel","HideTopLevelDropTargets","TabMosaicWrapper","useDrop","_item","nestedDropResult","UnconnectedPanelLayout","createTile","defaultPanelType","panelComponents","panelInfo","renderTile","panel","mosaicWindow","CircularProgress","bodyToRender","newLayout","LoadingState","selectedLayoutLoadingSelector","selectedLayoutExistsSelector","selectedLayoutMosaicSelector","PanelLayout","changePanelLayout","setSelectedLayoutId","openLayoutBrowser","layoutManager","layoutExists","layoutLoading","mosaicLayout","registeredExtensions","enableNewTopNav","createNewLayout","layoutData","selectExistingLayout","layouts","STextHighlight","TextHighlight","targetStr","searchText","_params","blurActiveElement","DraggablePanelItem","mode","searchQuery","onClick","onDrop","checked","highlighted","scrollRef","highlightedItem","scrollContainer","scrollContainerToTop","mergedRef","targetString","onClickWithStopPropagation","Card","CardActionArea","CardMedia","CardContent","Tooltip","Fade","ListItem","ListItemButton","ListItemText","verifyPanels","panels","panelTypes","mightActuallyBePartial","dispName","existingPanel","otherDisplayName","PanelList","selectedPanelType","setSearchQuery","highlightedPanelIdx","setHighlightedPanelIdx","dropPanel","onPanelMenuItemDrop","handleSearchChange","query","namespacedPanels","countByTitle","allRegularPanels","allPreconfiguredPanels","regular","preconfigured","sortByTitle","getFilteredPanels","searchResult","filteredRegularPanels","filteredPreconfiguredPanels","allFilteredPanels","highlightedPanel","noResults","onKeyDown","existing","displayPanelListItem","Search","IconButton","Close","List","PANEL_ROOT_CLASS_NAME","usePanelRootStyles","palette","transitions","sourceRect","classNames","StyledIconButton","subMenuActive","ChangePanelMenu","anchorEl","onClose","panelContext","open","handleSwap","fixMui35287","Popper","TransitionProps","placement","Grow","Paper","ClickAwayListener","getPanelTypeFromMosaic","node","PanelActionsDropdown","isUnknownPanel","menuAnchorEl","setMenuAnchorEl","subMenuAnchorEl","setSubmenuAnchorEl","menuOpen","submenuOpen","getPanelType","handleMenuClick","handleMenuClose","handleSubmenuClick","handleSubmenuClose","handleSubmenuMouseEnter","close","split","menuItems","buttonRef","ToolbarIconButton","MoreVert","Menu","ChevronRight","Divider","idx","PanelToolbarControlsComponent","additionalIcons","PanelCatalogContext","openPanelSettings","hasSettingsSelector","hasSettings","userProfileStorage","UserProfileStorageContext","settingsOnboardingTooltip","loadOnboardingState","useAsyncFn","tooltip","onboarding","settingsTooltipShownForPanelTypes","onDismissTooltip","profile","draft","openSettings","settingsButton","Settings","showSettingsButton","PanelToolbarControls","PANEL_TOOLBAR_MIN_HEIGHT","backgroundColor","isFullscreen","customTitle","additionalIconsWithHelp","FullscreenExit","rootDragRef","controlsDragRef","defaultPanelTitle","componentId","isTimestampScale","scales","Wrapper","VerticalBarWrapper","xValue","positionX","xScale","pixels","range","pos","AppConfigurationContext","useAppConfiguration","storage","selectWithUnstableIdentityWarning","toggleSelectedPanel","containingTabId","configById","panelIdsToDeselect","activeTabIdx","tabs","childrenPanelIds","parentTabPanelByPanelId","nextParentId","parentTabPanelIds","nextSelectedPanelIds","CurrentLayoutContext","usePanelMosaicId","useCurrentLayoutActions","useCurrentLayoutSelector","currentLayout","forceUpdate","mounted","layoutState","useSelectedPanels","setSelectedPanelIdsState","newIds","panelIds","selectedIds","CurrentUserContext","useCurrentUser","useCurrentUserType","user","ExtensionCatalogContext","useExtensionCatalog","equalityFn","LayoutManagerContext","useLayoutManager","usePanelCatalog","PanelStateContext","usePanelStateStore","TimelineInteractionStateContext","selectClearHoverValue","useClearHoverValue","useTimelineInteractionState","selectSetHoverValue","useSetHoverValue","useHoverValue","hasArgs","UserNodeStateContext","UserNodeStateProvider","setState","setUserNodeDiagnostics","nodeId","diagnostics","addUserNodeLogs","logs","clearUserNodeLogs","setUserNodeRosLib","rosLib","setUserNodeTypesLib","typesLib","useUserNodeState","useUserProfileStorage","LeftSidebarItemKeys","RightSidebarItemKeys","WorkspaceContext","WorkspaceStoreSelectors","useWorkspaceStore","setterValue","useWorkspaceActions","signIn","supportsAccountSettings","currentEnableNewTopNav","initialEnableNewTopNav","initialTab","selectedSidebarItem","selectedLeftSidebarItem","selectedRightSidebarItem","setter","leftSidebarOpen","oldItem","leftSidebarSize","rightSidebarOpen","rightSidebarSize","useAppTimeFormat","timeFormat","setTimeFormat","timeZone","effectiveFormat","formatDateCallback","date","formatTimeCallback","formatTime","formatDurationCallback","performance","useMemoryInfo","opt","refreshIntervalMs","memoryInfo","setMemoryInfo","configurationValue","setConfigurationValue","wrappedSetter","EMPTY_GLOBAL_VARIABLES","globalVariablesSelector","overwriteGlobalVariables","contextType","debugContextName","warn","prev","prevPrev","lastTime","DialogHostIdContext","useDialogHostId","GlobalCss","GlobalStyles","EventsContext","useEvents","NO_EVENTS","createEventsStore","events","filter","eventsSupported","deviceId","EventsProvider","StudioLogsSettingsContext","useStudioLogsSettings","defaultGlobalLevel","createStudioLogsSettingsStore","globalLevel","disabledChannels","channels","channelByName","sortedChannels","channel","regenerateChannels","currentGlobalLevel","didChange","logChannels","anyChannel","level","prefix","StudioLogsSettingsProvider","studioLogsSettingsSavedState","setStudioLogsSettingsSavedState","useLocalStorage","studioLogsSettingsStore","setStudioLogsSettingsStore","savedStateRef","storeChannelsCount","intervalHandle","createTimelineInteractionStateStore","eventsAtHoverValue","newBounds","hoveredEvent","TimelineInteractionStateProvider","SidebarContent","disablePadding","disableToolbar","leadingItems","overflow","trailingItems","BlockheadFilledIcon","SvgIcon","ConfirmModal","originalOnComplete","completed","onComplete","useKeyPressEvent","buttons","Dialog","DialogTitle","DialogContent","DialogActions","useConfirm","modal","setModal","AVATAR_ICON_SIZE","AccountInfo","signOut","enqueueSnackbar","confirm","confirmModal","loading","beginSignOut","onSignoutClick","response","onSettingsClick","process","AccountSyncGraphic","width","SigninForm","AccountSettings","currentUser","content","APP_BAR_HEIGHT","APP_BAR_PRIMARY_COLOR","APP_BAR_FOREGROUND_COLOR","APP_BAR_BACKGROUND_COLOR","tinycolor","AppBarIconButton","CustomWindowControls","isMaximized","onMinimizeWindow","onMaximizeWindow","onUnmaximizeWindow","onCloseWindow","Minimize","FilterNone","CheckBoxOutlineBlank","FoxgloveLogo","toMB","bytes","MemoryUseIndicator","usedPercent","usedMb","limitMb","NullAnalytics","AnalyticsContext","useAnalytics","AppContext","useAppContext","AppEvent","useAddPanel","AddPanelMenu","anchorPosition","anchorReference","disablePortal","handleClose","selection","NotificationModal","details","severity","subText","onRequestClose","displayPropsBySeverity","detailsElement","ProblemsList","setProblemModal","localProblemModal","setLocalProblemModal","showProblemModal","problem","ErrorOutlineOutlined","InfoOutlined","DEFAULT_END_TEXT_LENGTH","TextMiddleTruncate","text","endTextLength","startTextLen","startText","endText","LEFT_ICON_SIZE","selectPlayerName","selectPlayerPresence","selectPlayerProblems","DataSource","onSelectDataSourceAction","playerName","playerPresence","playerProblems","reconnecting","initializing","playerDisplayName","problemModal","ButtonBase","UserMenu","currentUserType","analytics","prefsDialogActions","onSignInClick","onPreferencesClick","tab","onProfileClick","onDocsClick","onSlackClick","leftInset","debugDragRegion","DRAGGABLE_STYLE","NOT_DRAGGABLE_STYLE","selectCurrentLayoutId","selectWorkspace","disableSignIn","onDoubleClick","showCustomWindowControls","appBarLayoutButton","enableMemoryUseIndicator","currentLayoutId","shallow","setRightSidebarOpen","setLeftSidebarOpen","userAnchorEl","setUserAnchorEl","panelAnchorEl","setPanelAnchorEl","userMenuOpen","panelMenuOpen","handleDoubleClick","Avatar","Person","HighlightedText","highlight","regex","parts","part","formatEventDuration","intDuration","EventViewComponent","isHovered","onHoverStart","onHoverEnd","fields","EventView","selectSeek","selectEventFilter","selectSetEventFilter","selectEvents","selectHoveredEvent","selectSetHoveredEvent","selectEventsAtHoverValue","selectSelectedEventId","selectSelectEvent","EventsList","selectedEventId","selectEvent","seek","setHoveredEvent","setFilter","timestampedEvents","clearFilter","AppBar","WssErrorModal","setOpen","topicToFzfResult","str","indices","selectSortedTopics","TopicListItem","positions","MemoTopicListItem","TopicList","setFilterText","filteredTopics","Skeleton","Timestamp","disableDate","horizontal","time","formatDate","currentTimeStr","rawTimeStr","MultilineMiddleTruncate","selectPlayerSourceId","DataSourceInfoContent","disableSource","durationRef","endTimeRef","playerSourceId","isLiveConnection","MemoDataSourceInfoContent","EmDash","DataSourceInfoView","durationStr","StyledTab","StyledTabs","Tabs","ProblemCount","selectEventsSupported","DataSourceSidebar","activeTab","setActiveTab","showEventsTab","isLoading","hasDismissedWssErrorModal","setHasDismissedWssErrorModal","hasWssConnectionProblem","Add","_ev","DropOverlay","DocumentDropListener","hovering","setHovering","onDropProp","allowedExtensions","ev","handles","handlePromises","allFiles","directories","dataItems","entry","file","fileSystemHandle","directory","entries","filteredFiles","filteredHandles","handle","onDragOver","dataTransfer","onDragLeave","LinkHandlerContext","TextContentRoot","shape","spacing","typography","shadows","TextContent","allowMarkdownHtml","handleLink","linkRenderer","linkProps","ExtensionMarketplaceContext","useExtensionMarketplace","extensionMarketplace","ExtensionDetails","extension","installed","isInstalled","setIsInstalled","downloadExtension","installExtension","uninstallExtension","marketplace","readmeUrl","changelogUrl","canInstall","canUninstall","readmeContent","useAsync","changelogContent","install","isDesktopApp","url","uninstall","ChevronLeft","StyledListItemButton","displayNameForNamespace","namespace","ExtensionListEntry","description","publisher","version","ExtensionsSettings","focusedExtension","setFocusedExtension","marketplaceEntries","refreshMarketplaceEntries","marketplaceMap","installedEntries","marketplaceEntry","namespacedEntries","filteredMarketplaceEntries","SignInPrompt","onDismiss","openAccountSettings","topNavEnabled","UnsavedChangesPrompt","isOnline","defaultSelectedKey","defaultPersonalCopyName","selectedKey","setSelectedKey","handleChoiceGroupChange","personalCopyName","setPersonalCopyName","personalCopyNameRef","handleNameChange","nameError","handleSubmit","handleCancel","RadioGroup","FormControlLabel","Radio","useUnsavedChangesPrompt","setLayout","resolveRef","setIsOnline","onlineListener","unsavedChangesPrompt","openUnsavedChangesPrompt","useUnmount","LayoutStorageDebuggingContext","useCallbackWithToast","callback","deps","ModalPrompt","initialValue","label","transformer","onConfirmAction","onSubmitAction","usePrompt","layoutPermissionIsShared","permission","layoutIsShared","layoutAppearsDeleted","showOpenFilePicker","StyledListItem","editingName","hasModifications","deletedOnServer","StyledMenuItem","debug","anySelectedModifiedLayouts","multiSelectedIds","onRename","onDuplicate","onDelete","onShare","onExport","onOverwrite","onRevert","onMakePersonalCopy","layoutDebug","setEditingName","nameFieldValue","setNameFieldValue","contextMenuTarget","setContextMenuTarget","multiSelection","overwriteAction","confirmRevert","makePersonalCopyAction","renameAction","duplicateAction","shareAction","exportAction","onSubmit","newName","onTextFieldKeyDown","onBlur","nameInputRef","confirmDelete","prompt","handleContextMenu","handleMenuButtonClick","currentTarget","sectionItems","unsavedChangesMessage","filteredItems","actionIcon","LayoutSection","emptyText","selectedId","LayoutRow","lastId","thisId","end","useLayoutBrowserReducer","selectedLayoutIdSelector","LayoutBrowser","menuClose","currentDateForStorybook","promptModal","busyListener","errorListener","reloadLayouts","shared","personal","promptForUnsavedChanges","onSelectLayout","selectedViaClick","onRenameLayout","onDuplicateLayout","onDeleteLayout","targetLayout","onExportLayout","download","onShareLayout","onOverwriteLayout","onRevertLayout","importLayout","fileHandles","newLayouts","fileHandle","layoutName","parsedState","hideSignInPrompt","setHideSignInPrompt","showSignInPrompt","pendingMultiAction","CloudOff","FileOpenOutlined","FormGroup","Switch","MultiProvider","providers","wrapped","wrappedChildren","provider","Snow","effect","containerRef","requestID","container","scene","camera","POINT_COUNT","colors","sizes","phases","vertex","geometry","material","points","renderer","render","animating","animate","PlayerSelectionContext","usePlayerSelection","BlockheadIcon","_extends","source","styles","BuiltinIcon","FormField","maybeError","FormHelperText","View","onCancel","onOpen","onBack","Connection","availableSources","activeSource","mdUp","useMediaQuery","selectSource","enabledSourcesFirst","enabledSources","disabledSources","selectedConnectionIdx","setSelectedConnectionIdx","foundIdx","selectedIdx","selectedSource","fieldErrors","setFieldErrors","fieldValues","setFieldValues","connectionIdx","defaultFieldValues","disableOpen","iconName","displayName","Alert","FoxgloveLogoText","DataSourceOption","secondaryText","href","button","SidebarItems","onSelectView","freeUser","teamOrEnterpriseUser","demoItem","sidebarItems","Start","recentSources","selectRecent","startItems","recent","useOpenFile","sources","allExtensions","all","matchingSources","foundSource","OpenDialog","defaultActiveView","activeDataSource","backdropAnimation","activeView","setActiveView","openFile","firstSampleSource","view","onModalClose","backdrop","now","connectionSources","ActionMenu","allowShare","onReset","setAnchorEl","handleClick","isValidHexColor","alphaType","ColorPickerControl","onEnterKey","parsedValue","swatchColor","editedValue","setEditedValue","editedValueIsInvalid","updateColor","updateEditedValue","Tag","calculateBorderColor","parsedColor","ColorSwatch","ColorPickerInput","hideClearButton","anchorElement","setAnchorElement","displayValue","clearValue","shouldHideClearButton","Cancel","Popover","ColorGradientInput","leftAnchor","setLeftAnchor","rightAnchor","setRightAnchor","handleLeftClick","handleRightClick","leftColor","rightColor","safeLeftColor","safeRightColor","NumberInput","iconDown","iconUp","step","min","max","precision","scrubValue","latestValue","placeHolderValue","updateValue","clampedValue","onPointerDown","scrubStart","onPointerUp","onPointerMove","scale","Vec2Input","inputValue","Vec3Input","UNDEFINED_SENTINEL_VALUE","INVALID_SENTINEL_VALUE","prefersDarkMode","inputBackgroundColor","FieldInput","actionHandler","Autocomplete","option","ToggleButtonGroup","ToggleButton","MessagePathInput","selectedOptionIndex","selectedOption","isEmpty","selectValue","Select","_value","FieldLabel","labels","FieldEditorComponent","paddingLeft","FieldEditor","NodeActionsMenu","onSelectAction","anyItemHasIcon","Icon","ListItemIcon","StyledCheckbox","Checkbox","VisibilityToggle","prepareSettingsNodes","roots","filterTreeNodes","filtered","NODE_HEADER_MIN_HEIGHT","ExpansionArrow","expanded","Component","ArrowRight","makeStablePath","SelectVisibilityFilterOptions","showVisibleFilter","showInvisibleFilter","getSelectVisibilityFilterField","NodeEditorComponent","defaultOpen","focusedPath","indent","allowVisibilityToggle","visible","selectVisibilityFilterEnabled","selectVisibilityFilter","toggleVisibility","handleNodeAction","actionId","isFocused","hasChildren","hasProperties","fieldEditors","filterFn","childNodes","NodeEditor","IconComponent","onEditLabel","toggleEditing","toggleOpen","onLabelKeyDown","inlineActions","menuActions","Check","Edit","SettingsTreeEditor","filteredNodes","definedNodes","selectedPanelId","customPanelTitle","panelTitleField","handleTitleChange","showTitleField","root","StyledTextarea","ShareJsonModal","decodedValue","handleDownload","DeleteOutline","singlePanelIdSelector","selectIncrementSequenceNumber","EMPTY_SETTINGS_TREE","PanelSettings","selectedPanelIdsForTests","selectedLayoutId","singlePanelId","originalSelectedPanelIds","incrementSequenceNumber","showShareModal","setShowShareModal","shareModal","panelConfigById","settingsTree","resetToDefaults","isSettingsTree","fadeInAnimation","selectRefreshEvents","selectDeviceId","CreateEventDialog","refreshEvents","setEvent","updateMetadata","updateType","keyval","appModuleCreateEvent","countedMetadata","kv","duplicateKey","count","canSubmit","createdEvent","createEvent","filteredMeta","keyedMetadata","onMetaDataKeyDown","keyboardEvent","addRow","removeRow","formattedStartTime","FormControl","FormLabel","oldEvent","durationUnit","ButtonGroup","hasDuplicate","evt","Remove","EventIcon","EventOutlinedIcon","LoopIcon","strokeWidth","SPEED_OPTIONS","formatSpeed","configSpeedSelector","PlaybackSpeedControls","configSpeed","speed","setPlaybackSpeed","setPlaybackConfig","setSpeed","newSpeed","displayedSpeed","ArrowDropDown","StyledTextField","PlaybackTimeMethodMenu","timeRawString","timeOfDayString","PlaybackTimeDisplayMethod","timezone","onSeek","onPause","isPlaying","timeOutID","currentTimeString","inputText","setInputText","setHasError","validTimeAndMethod","Warning","selectActiveData","PlaybackTimeDisplay","activeDataSelector","RepeatAdapter","play","repeatEnabled","EventTick","MemoEventTick","EventsOverlay","getStartTime","getEndTime","PlaybackBarHoverTicks","hoverTimeDisplay","scaleBounds","displayHoverTime","HoverBar","selectHoveredEvents","PlaybackControlsTooltipContent","hoveredEvents","timeFromStart","tooltipItems","metaKey","metaValue","STRIPE_WIDTH","animatedBackground","ProgressPlot","availableRanges","clampedRanges","ranges","mergedRanges","interpolateValue","scaleValue","minA","maxA","minB","maxB","defaultRenderSlider","Slider","fraction","renderSlider","onHoverOver","onHoverOut","elRef","getValueAtMouse","scaled","mouseDown","setMouseDown","mouseDownRef","mouseInside","setMouseInside","mouseInsideRef","selectRanges","selectPresence","Scrubber","hoverComponentId","hoverElRef","presence","hoverStamp","setHoverStamp","latestStartTime","latestEndTime","popperRef","positionRef","handlePointerMove","ARROW_SEEK_BIG_MS","ARROW_SEEK_DEFAULT_MS","ARROW_SEEK_SMALL_MS","DIRECTION","jumpSeek","directionSign","modifierKeys","timeMs","deltaMs","PlaybackControls","pause","getTimeInfo","playUntil","repeat","setRepeat","createEventDialogOpen","setCreateEventDialogOpen","toggleRepeat","togglePlayPause","current","seekForwardAction","targetTime","seekBackwardAction","toggleCreateEventDialog","disableControls","RemountOnValueChange","Parent","HelpMenu","anchorOrigin","transformOrigin","ListSubheader","Noop","NewSidebar","anchor","SelectedComponent","TabSpacer","mosiacLeftSidebarSplitPercentage","mosiacRightSidebarSplitPercentage","Sidebars","bottomItems","onSelectKey","leftItems","selectedLeftKey","onSelectLeftKey","setLeftSidebarSize","rightItems","selectedRightKey","onSelectRightKey","setRightSidebarSize","mosaicValue","setMosaicValue","allOldLeftItems","helpAnchorEl","setHelpAnchorEl","helpMenuOpen","handleHelpClick","handleHelpClose","oldLeftSidebarOpen","leftTargetWidth","rightTargetWidth","defaultLeftPercentage","defaultRightPercentage","SelectedLeftComponent","onClickTabAction","topTabs","Badge","bottomTabs","onChangeMosaicValue","HelpOutline","SignInFormModal","useStudioLogsSettingsTree","logsConfig","itemDetailByPath","settingsRoot","miscRoot","channelName","studioSpacePrefix","pkgName","srcPath","component","pkgNode","componentNode","leafId","enable","pathStr","StudioLogsSettings","logSettings","StudioLogsSettingsSidebar","updateAppURLState","urlState","newURL","k","v","parseAppURLState","ds","layoutId","timeString","dsParams","cleanKey","windowAppURLState","selectCanSeek","selectUrlState","selectLayoutId","updateUrl","newState","newStateUrl","useStateToURLSynchronization","playerUrlState","stablePlayerUrlState","canSeek","debouncedCurrentTime","URLStateSyncAdapter","SyncAdapters","syncAdapters","changeGlobalKey","newKey","oldKey","keys","Variable","editedName","setEditedName","setExpanded","deleteVariable","onChangeValue","activeElementIsChild","isDuplicate","InputBase","ANIMATION_RESET_DELAY_MS","VariablesList","globalVariableNames","skipAnimation","timeoutId","previousGlobalVariablesRef","changedVariables","setChangedVariables","newChangedVariables","timerId","useFeatures","features","ExperimentalFeatureItem","feature","enabled","setEnabled","ExperimentalFeatureSettings","LaunchPreferenceValue","MESSAGE_RATES","LANGUAGE_OPTIONS","formatTimezone","tz","zoneAbbr","offsetStr","ColorSchemeSettings","setColorScheme","DarkMode","Brightness5","Computer","TimezoneSettings","setTimezone","detectItem","fixedItems","timezoneItems","allItems","TimeFormat","orientation","exampleTime","LaunchDefault","preference","setPreference","sanitizedPreference","Web","QuestionAnswerOutlined","MessageFramerate","setMessageRate","rate","AutoUpdate","updatesEnabled","setUpdatedEnabled","RosPackagePath","rosPackagePath","setRosPackagePath","rosPackagePathPlaceholder","LanguageSettings","i18n","selectedLanguage","setSelectedLanguage","onChangeLanguage","lang","language","aboutItems","selectWorkspaceInitialActiveTab","PreferencesDialog","_activeTab","initialActiveTab","crashReportingEnabled","setCrashReportingEnabled","telemetryEnabled","setTelemetryEnabled","smUp","supportsAppUpdates","handleTabChange","WarningAmber","link","selectWorkspacePrefsDialogOpen","WorkspaceDialogs","prefsDialogOpen","NativeAppMenuContext","useNativeAppMenu","blockScrollEventPropagation","useCalloutDismissalBlocker","useSessionStorageValue","changeListener","selectHasUrlState","useDefaultWebLaunchPreference","hasUrlState","launchPreference","setLaunchPreference","useElectronFilesToOpen","fileList","setFileList","update","useSyncSourceFromUrl","targetUrlState","currentUserRequired","unappliedSourceArgs","setUnappliedSourceArgs","useSyncLayoutFromUrl","unappliedLayoutArgs","setUnappliedLayoutArgs","useSyncTimeFromUrl","unappliedTime","setUnappliedTime","useInitialDeepLinkState","deepLinks","currentUserRequiredParam","useNativeAppMenuEvent","eventName","nativeAppMenu","createWorkspaceContextStore","WorkspaceContextProvider","activeElementIsInput","keyboardEventHasModifier","AddPanel","ExtensionsSidebar","DEFAULT_DEEPLINKS","selectIsPlaying","selectPause","selectPlay","selectPlayUntil","selectWorkspaceSidebarItem","selectWorkspaceLeftSidebarItem","selectWorkspaceLeftSidebarOpen","selectWorkspaceLeftSidebarSize","selectWorkspaceRightSidebarItem","selectWorkspaceRightSidebarOpen","selectWorkspaceRightSidebarSize","WorkspaceContent","sidebarItem","leftSidebarItem","rightSidebarItem","selectLeftSidebarItem","selectRightSidebarItem","selectSidebarItem","allowedDropExtensions","extensions","isPlayerPresent","showOpenDialogOnStartup","enableStudioLogsSidebar","showSignInForm","showOpenDialog","setShowOpenDialog","openHandle","arrayBuffer","matchedSource","ext","openFiles","files","otherFiles","filesToOpen","dropHandler","DataSourceSidebarItem","PanelSettingsSidebar","sidebarBottomItems","topItems","leftSidebarItems","rightSidebarItems","getMessagePipeline","PanelStateContextProvider","Workspace","ColorSchemeThemeProvider","systemSetting","useMedia","isDark","ThemeProvider","CssBaseline","DocumentTitleAdapter","NativeWindowContext","useNativeWindow","IDB_KEY","IDB_STORE","useIndexedDbRecents","initialRecents","recents","setRecents","newRecentsRef","save","recentsToSave","newRecent","exists","savedRecent","haveUnsavedRecents","addRecent","record","fullRecord","AnalyticsMetricsCollector","_time","_speed","_subscriptions","_bytes","_metadata","MemoizedLibGenerator","lib","hasTransformerErrors","nodeData","basicDatatypes","def","definition","maybePlainObject","rawVal","UserNodePlayer","userNodeActions","nodeTopics","nodeDatatypes","allDatatypes","userNodeDatatypes","nodeRegistration","generateTypesLib","parsedMessages","nodeRegistrations","parsedMessagesPromises","messagePromises","messagePromise","nodeParsedMessages","blocks","fullRegistrations","reg","allInputTopics","outputBlocks","messagesByTopic","outTopic","outputMessage","userNodes","prevNode","newNode","maxNodeRegistrationCacheCount","userNode","cacheEntry","sourceCode","transformMessage","inputTopics","outputTopic","transpiledCode","projectCode","outputDatatype","rpc","terminateCondvar","problemKey","buildMessageProcessor","terminateSignal","worker","port","Rpc","userNodeDiagnostics","userNodeLogs","allDiagnostics","terminate","allNodeRegistrations","validNodeRegistrations","playerTopics","allNodeOutputs","didUpdate","shouldReset","inputTopicsForRecompute","userNodeId","inputTopic","messagesForRecompute","messageForRecompute","messagesToBeParsed","playerProgress","nodeSubscriptions","realTopicSubscriptions","inputs","publishers","backfillDuration","EMPTY_USER_NODES","userNodesSelector","PlayerManager","playerSources","nativeWindow","metricsCollector","layoutStorage","basePlayer","setBasePlayer","globalVariablesRef","userNodePlayer","sourceId","newPlayer","sourceLayout","curFile","multiFile","createSelectRecentCallback","MessagePipeline","recentId","foundRecent","severityToToastAppearance","SendNotificationToastAdapter","notificationDetails","setNotificationDetails","_type","anchorWithOffset","origin","CloseSnackbarAction","closeSnackbar","StudioToastProvider","LayoutStorageContext","useLayoutStorage","defaultLayout","SAVE_INTERVAL_MS","CurrentLayoutProvider","getUserProfile","setUserProfile","layoutStateListeners","addLayoutStateListener","removeLayoutStateListener","setLayoutStateInternal","layoutStateRef","setLayoutState","selectedPanelIdsListeners","addSelectedPanelIdsListener","removeSelectedPanelIdsListener","saveToProfile","unsavedLayoutsRef","debouncedSaveTimeout","performAction","oldData","newData","layoutsToSave","updatedLayout","perPanelFunc","closedId","originalIsSelected","beforePanelIds","afterPanelIds","activateExtension","unwrappedExtensionSource","require","fullId","createExtensionRegistryStore","loaders","res","foxeFileData","namespacedLoader","loader","extensionList","allContributionPoints","contributionPoints","ExtensionCatalogProvider","refreshExtensions","MARKETPLACE_URL","ExtensionMarketplaceProvider","getAvailableExtensions","getMarkdown","RemoteLayoutStorageContext","useRemoteLayoutStorage","NamespacedLayoutStorage","migrateUnnamespacedLayouts","importFromNamespace","WriteThroughLayoutCache","cache","isLayoutEqual","computeLayoutSyncOperations","localLayouts","remoteLayouts","ops","remoteLayoutsById","localLayout","remoteLayout","DEFAULT_PUBLISH_SETTINGS","migrateLegacyToNew3DConfig","legacyConfig","replacePanelInLayout","oldId","newPanelsState","tabPanelIds","tabConfig","migrateLegacyToNew3DPanels","legacy3DPanels","migratePanelsState","migrateLayout","baseline","updateOrFetchLayout","remote","LayoutManager","_prototype","_propertyKey","descriptor","method","online","local","existingLocal","unmigratedData","newWorking","updatedBaseline","isRename","abortSignal","syncOperations","localOps","remoteOps","op","operations","operation","cleanups","newBaseline","cleanup","delay","SYNC_INTERVAL_BASE_MS","SYNC_INTERVAL_MAX_MS","LayoutManagerProvider","remoteLayoutStorage","enableLayoutDebugging","useNetworkState","visibilityState","enableSyncing","controller","failures","syncNow","injectEdit","injectRename","injectDelete","setOnline","debugging","getBuiltin","getDebug","getLegacyPlot","getNewImage","PanelCatalogProvider","showDebugPanels","enableLegacyPlotPanel","enableNewImagePanel","extensionPanels","wrappedExtensionPanels","PanelWrapper","panelProps","allPanelsInfo","allPanels","visiblePanels","panelList","panelsByType","byType","DEFAULT_PROFILE","LOCAL_STORAGE_KEY","UserProfileLocalStorageProvider","newProfile","LaunchPreferenceScreen","globalPreference","setGlobalPreference","setSessionPreference","rememberPreference","setRememberPreference","launchInWeb","launchInDesktop","toggleRememberPreference","Grid","LaunchingInDesktopScreen","cleanWebURL","openWeb","desktopURL","LaunchPreference","globalLaunchPreference","sessionLaunchPreference","activePreference","hasParams","contextMenuHandler","App","dataSources","extensionLoaders","enableLaunchPreferenceScreen","enableGlobalCss","extraProviders","MaybeLaunchPreference","DndProvider","USE_DEFAULT_FORMATTER","timeFormatter","groupDigits","obj","maybeTime","nsec","rng","installDevtoolsFormatters","waitForFonts","font","preferences","general","panelSettings","plot","dataSourceInfo","openDialog","settingsEditor","threeDee","appBar","translations","defaultNS","initI18n","DATABASE_BASE_NAME","METADATA_STORE_NAME","EXTENSION_STORE_NAME","IdbExtensionStorage","db","records","transaction","parsePackageName","qualifiedName","validatePackageInfo","parsedPublisher","IdbExtensionLoader","zip","srcText","pkgInfoText","rawInfo","normalizedPublisher","PlayerProblemManager","changed","predicate","rosDatatypesToMessageDefinition","rootDatatypeName","seenDatatypeNames","datatypeNameStack","currentDatatypeName","currentDatatype","msgDefinition","JsonMessageWriter","Buffer","WorkerSocketAdapter","wsUrl","protocols","textEncoder","SUBSCRIPTION_WARNING_SUPPRESSION_MS","ZERO_TIME","GET_ALL_PARAMS_REQUEST_ID","GET_ALL_PARAMS_PERIOD_MS","ROS_ENCODINGS","SUPPORTED_PUBLICATION_ENCODINGS","FALLBACK_PUBLICATION_ENCODING","SUPPORTED_SERVICE_ENCODINGS","FoxgloveWebSocketPlayer","maybeRosDistro","rosDistro","isRos1","rosDataTypes","dataType","msgDef","dataTypeToFullName","problemId","statusLevelToProblemSeverity","newChannels","parsedChannel","schemaEncoding","schemaData","base64","parseChannel","existingChannel","resolvedChannel","removedChannels","chanInfo","subId","subscriptionId","receiveTime","stats","timestamp","newParameters","param","p","services","requestType","responseType","parsedRequest","parsedResponse","requestMsgDef","requestMessageWriter","types","resolvedService","serviceIds","serviceId","srv","responseCallback","newMap","publisherIds","subscriberIds","providerIds","topicsSet","clientChannel","replacer","_key","serviceName","serviceCallRequest","encoding","schemaName","encodingProblemId","msgdefProblemId","messageWriter","channelId","FoxgloveWebSocketDataSourceFactory","NoopMetricsCollector","TIME_ZERO","IteratorCursor","iterator","abort","durationMs","firstResult","cutoffTime","BlockLoader","totalNs","blockCount","blockTopics","needTopics","totalBytesRemoved","blockBytesRemoved","beginBlockId","lastBlockId","progress","totalBlockSizeBytes","blockId","topicsToFetch","existingBlock","endBlockId","endIdx","cursorStartTime","cursorEndTime","iteratorArgs","currentBlockId","untilTime","sizeInBytes","iterResult","msgTopic","messageSizeInBytes","removedSize","thisBlock","blockIndex","CachingIterableSource","maxEnd","maxEndNanos","readHead","cacheBlockIndex","cacheIndex","cachedItem","sourceReadStart","nextBlockIndex","nextBlock","sourceReadEnd","sourceMessageIterator","pendingIterResults","newBlock","insertIndex","receiveTimeNs","pendingIterResult","pendingSizeInBytes","out","needsTopics","cacheBlock","readIdx","prevBlock","sourceBackfill","sourceStartNs","rangeNs","prevRange","activeBlock","oldestIdx","oldestBlock","prevItem","DEFAULT_READ_AHEAD_DURATION","BufferedIterableSource","sourceIterator","readUntil","self","DEFAULT_CACHE_SIZE_BYTES","START_DELAY_MS","MIN_MEM_CACHE_BLOCK_SIZE_NS","MAX_BLOCKS","SEEK_ON_START_NS","IterablePlayer","urlParams","enablePreload","newSubscriptions","allTopics","preloadTopics","_publishers","_payload","publishersByTopic","uniqueTopics","existingTopic","startStr","endStr","stopTime","tickTimeout","seekAckTimeout","tickTime","durationMillis","rangeMillis","msgEvents","aborted","abortSignalTransferHandler","msgPort","port1","port2","WorkerIterableSource","initialize","messageCursorPromise","messageCursor","Ros1LocalBagDataSourceFactory","rosLog","CAPABILITIES","Problem","Ros1Player","hostname","os","net","httpServer","tcpSocketCreate","tcpServer","listenHostname","rosNode","callerId","providerTopics","external","messageDefinition","typesByName","skipEmit","availableTopicsByTopicName","topicNames","availTopic","_header","_reader","newDatatypes","_pub","validPublishers","existingPub","advertiseOptions","advertiseProblemId","maybeClockMsg","seconds","graph","Ros1SocketDataSourceFactory","Ros2LocalBagDataSourceFactory","Ros2Player","domainId","udpSocketCreate","endpoints","dataTypes","endpoint","publishTime","rosMsgInterfaceName","rosFullInterfaceName","publishedTopics","availableTopic","rosEndpoint","topicEndpoints","reliableCount","sum","pub","transientLocalCount","endpointCount","durability","reliability","_rosNode","Ros2SocketDataSourceFactory","domainIdStr","Ros2UnavailableDataSourceFactory","bagConnectionsToDatatypes","connections","ros2","connection","definitions","collateNodeDetails","detail","isClockMessage","isRecord","RosbridgePlayer","rosClient","_providerTopics","_providerDatatypes","_start","topicsStallWarningTimeout","topicsMissingDatatypes","datatypeDescriptions","messageReaders","parsedDefinition","messageReader","buffer","msgSize","innerMessage","opts","serviceTypePromise","serviceType","proxy","_speedFraction","roslibTopic","fetchedNodes","publications","fulfilled","RosbridgeDataSourceFactory","UlogLocalDataSourceFactory","initWorkers","RemoteDataSourceFactory","initWorker","supportedExtensions","DEFAULT_VELODYNE_PORT","RPM","PROBLEM_SOCKET_ERROR","TOPIC_NAME","TOPIC","DATATYPES","VelodynePlayer","rinfo","topOfHour","rawPacket","numPackets","raw","rawPacketToRos","packet","_request","_globalVariables","microSecSinceTopOfHour","VelodyneDataSourceFactory","portStr","McapLocalDataSourceFactory","SampleNuscenesDataSourceFactory","bagUrl","DEFAULT_CAMERA_STATE","rosPrimitiveToTypescriptTypeMap","typedArrayMap","safeString","generateTypesInterface","src","isConstant","isArray","typedArray","rosPrimitive","fieldName","sigil","generateTypesByTopicInterface","typesByTopic","emptyLib","generateEmptyTypesLib","ros_lib_filename","ros_lib_dts","areSame","t1","t2","secDiff","fixTime","sec","subtractTimes","sec1","nsec1","sec2","nsec2","DiagnosticSeverity","Sources","ErrorCodes","PlayerPresence","PlayerCapabilities","defaultPlaybackConfig","trimConfigById","panelIdsInsideTabPanels","configs","prevConfigById","newConfigById","currentSavedProps","override","oldConfig","saveFullPanelConfig","newProps","fullConfig","panelConfig","saveConfigsPayload","prevConfig","originalId","createTabPanelWithSingleTab","idToReplace","idsToRemove","layoutWithInlinedTabs","panelIdsNotInNewTab","leaf","tabLayout","tabPanelConfig","nestedPanelConfigs","createTabPanelWithMultipleTabs","moveTab","changeLayoutPayload","newConfigs","dragWithinSameTab","sourceTabConfig","sourceTabChildConfigs","currentTabLayout","updates","newTree","dragToMainFromTab","panelConfigs","currentNode","dragToTabFromMain","targetTabConfig","dragToTabFromTab","fromTabConfigs","toTabConfigs","activeLayout","dragPayload","originalSavedProps","toMainFromTab","toTabfromMain","toTabfromTab","withinSameTab","createPanelStateStore","defaultTitle","updateSettingsTreeSelector","usePanelSettingsTreeUpdate","updateStoreTree","updateSettingsTree","updateSharedDataSelector","updateDefaultTitleSelector","useSharedPanelState","updateSharedData","sharedData","useDefaultPanelTitle","updateDefaultTitle","hasSameKeys","keyA","keyB","createHasSameKeySelector","selectLayoutConfigById","selectPanelTypesInUse","panelTypesInUse","globalWithHandler","setReportErrorHandler","muiCache","ThemeContainer","_ref","muiTheme","meta","RESPONSE","ERROR","createLinkedChannels","_transfer","transferables","transfer","fallbackCopy","downloadTextFile","fileName","downloadFiles","urls","AppError","extraInfo","stringifiedExtraInfo","DIGITS_WITHOUT_DECIMAL_POINT_RE","DIGITS_WITH_DECIMAL_POINT_RE","THOUSAND_YEARS_IN_NANOSEC","parseFuzzyRosTime","trimmedStamp","nanos","format","formatDuration","parseTimeStr","newMomentTimeObj","todTimeRegex","getValidatedTimeAndMethodFromString","isInvalidRawTime","isInvalidTodTime","DEFAULT_STUDIO_NODE_PREFIX","useJsonTreeTheme","TAB_PANEL_TYPE","__filename","PANEL_TITLE_CONFIG_KEY","getPanelIdForType","rnd","getPanelTypeFromId","isTabPanel","isTabPanelConfig","getPathFromNode","tree","first","second","mapTemplateIdsToNewIds","templateIds","getLayoutWithNewPanelIds","panelIdMap","compactLayout","prunedChildren","replaceLeafLayouts","replacerFn","inlineTabPanelLayouts","preserveTabPanelIds","tabFreeLayout","getValidTabPanelConfig","getParentTabPanelByPanelId","memo","savedPanelId","replaceMaybeTabLayoutWithNewPanelIds","getSaveConfigsPayloadForAddedPanel","getPanelIdsInsideTabPanels","templateId","relatedConfig","tabLayouts","tabProps","DEFAULT_TAB_PANEL_CONFIG","getAllPanelIds","layoutPanelIds","validateTabPanelConfig","updateTabPanelLayout","updatedTabs","removePanelFromTabPanel","createAddUpdates","newPath","before","addPanelToTab","insertedPanelId","destinationPosition","safeTabConfig","reorderTabWithinTabPanel","sourceIndex","targetIndex","nextSourceTabs","movedActiveTab","movedToBeforeActiveTab","movedFromBeforeActiveTab","nextActiveTabIdx","moveTabBetweenTabPanels","sourceConfig","targetConfig","nextTabsSource","nextTabsTarget","nextActiveTabIdxSource","nextActiveTabIdxTarget","replaceAndRemovePanels","panelArgs","panelIdToRemove","pathToNode","getConfigsForNestedPanelsInsideTab","panelIdToReplace","tabPanelId","panelIdsToRemove","overwriteFetch","originalFetch","init","replacementError","getTopicsByTopicName","constantsByDatatype","extractTypeFromStudioEnumAnnotation","enumValuesByDatatypeAndField","currentResult","constants","lastType","fieldConstants","defaultNotificationHandler","addNotification","setNotificationHandler","unsetNotificationHandler","formatTimeRaw","DURATION_20_YEARS_SEC","isAbsoluteTime","formatFrame","getTimestampForMessageEvent","timestampMethod","getTimestampForMessage","inWebWorker","inSharedWorker","enforceFetchIsBlocked","canFetch"],"sourceRoot":""}