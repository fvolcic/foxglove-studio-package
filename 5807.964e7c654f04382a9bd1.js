"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5807],{14571:(S,h,n)=>{n.d(h,{o:()=>c});var d=n(52322),o=n(2784);class c extends o.Component{constructor(){super(...arguments),this.state={hadError:!1}}componentDidCatch(g){this.setState({hadError:!0}),this.props.onError(g)}render(){return this.state.hadError?(0,d.jsx)(d.Fragment,{}):this.props.children}}},96133:(S,h,n)=>{n.d(h,{J:()=>d});function d(o,c){if(typeof o.value=="object")throw new Error("filterMatches only works on paths where global variables have been filled in");if(o.value==null)return!1;let u=c;for(const g of o.path)if(typeof u!="object"||u==null||(u=u[g],u==null))return!1;return u!=null&&u==o.value}},62273:(S,h,n)=>{n.d(h,{T:()=>o});var d=n(96133);function o(c,u){if(c.topic!==u.topicName)return[];const g=[];function m(p,y){const f=u.messagePath[y];if(f==null){g.push(p);return}if(p!=null)switch(f.type){case"slice":{if(!Array.isArray(p))return;if(typeof f.start=="object"||typeof f.end=="object")throw new Error("Variables in slices are not supported");const{start:I,end:v}=f;for(let M=I;M<p.length&&M<=v;M++)m(p[M],y+1);return}case"filter":return(0,d.J)(f,p)?m(p,y+1):void 0;case"name":return typeof p!="object"?void 0:m(p[f.name],y+1)}}return m(c.message,0),g}},15807:(S,h,n)=>{n.r(h),n.d(h,{default:()=>q});var d=n(52322),o=n(2784),c=n(28316),u=n(57051),g=n(14571),m=n(14075),p=n(591),y=n(88724),f=n(47746),I=n(68434),v=n(76635),M=n(8740),k=n(1012),O=n(62273),T=n(93812),Z=n(77075),B=n(10363);function V(e,a){const t=typeof e=="object"?e.data:e;if(t!=null)for(const r of a){let l;try{if(typeof t=="boolean"||typeof t=="number"){if(l=JSON.parse(r.rawValue),typeof l!="boolean"&&typeof l!="number")continue}else typeof t=="string"?l=r.rawValue:typeof t=="bigint"?l=BigInt(r.rawValue):(0,B.v)(t,"Unsupported rule value")}catch{continue}if(r.operator==="="&&t===l)return r;if(r.operator==="<"&&t<l)return r;if(r.operator==="<="&&t<=l)return r;if(r.operator===">"&&t>l)return r;if(r.operator===">="&&t>=l)return r}}var x=n(76665),F=n(5817),U=n.n(F);function G(e){return`data ${{"=":"=","<":"<","<=":"\u2264",">":">",">=":"\u2265"}[e.operator]} ${e.rawValue}`}function $(e,a){return(0,x.ZP)(e,t=>{switch(a.action){case"perform-node-action":if(a.payload.path[0]==="rules"){if(a.payload.id==="delete-rule"){const r=+a.payload.path[1];t.rules.splice(r,1)}else if(a.payload.id==="add-rule"||a.payload.id==="add-rule-above"||a.payload.id==="add-rule-below"){let r=t.rules.length;a.payload.id==="add-rule-above"&&a.payload.path[1]!=="default"?r=+a.payload.path[1]:a.payload.id==="add-rule-below"&&(r=+a.payload.path[1]+1),t.rules.splice(r,0,{operator:"=",rawValue:"true",color:`#${Math.floor(Math.random()*16777216).toString(16)}`,label:"Label"})}else if(a.payload.id==="move-up"){const r=+a.payload.path[1],[l]=t.rules.splice(r,1);t.rules.splice(r-1,0,l)}else if(a.payload.id==="move-down"){const r=+a.payload.path[1],[l]=t.rules.splice(r,1);t.rules.splice(r+1,0,l)}}break;case"update":switch(a.payload.path[0]){case"general":(0,v.set)(t,[a.payload.path[1]],a.payload.value);break;case"rules":if(a.payload.path[1]==="default")(0,v.set)(t,[a.payload.path[2]],a.payload.value);else{const r=+a.payload.path[1];(0,v.set)(t.rules[r],[a.payload.path[2]],a.payload.value)}break;default:throw new Error(`Unexpected payload.path[0]: ${a.payload.path[0]}`)}break}})}const z=U()((e,a,t)=>{const r=[{type:"action",id:"delete-rule",label:"Delete rule",icon:"Delete"},a>0&&{type:"action",id:"move-up",label:"Move up",icon:"MoveUp"},a<t.length-1&&{type:"action",id:"move-down",label:"Move down",icon:"MoveDown"},{type:"action",id:"add-rule-above",label:"Add rule above",icon:"Add"},{type:"action",id:"add-rule-below",label:"Add rule below",icon:"Add"}];return{label:G(e),actions:r.filter(l=>l!==!1),fields:{operator:{label:"Comparison",input:"select",value:e.operator,options:[{label:"Equal to",value:"="},{label:"Less than",value:"<"},{label:"Less than or equal to",value:"<="},{label:"Greater than",value:">"},{label:"Greater than or equal to",value:">="}]},rawValue:{label:"Compare with",input:"string",value:e.rawValue},color:{label:"Color",input:"rgb",value:e.color},label:{label:"Label",input:"string",value:e.label}}}});function H(e,a,t){const{path:r,style:l,rules:i}=e,s=(0,o.useMemo)(()=>({error:t,fields:{path:{label:"Message path",input:"messagepath",value:r,error:a},style:{label:"Style",input:"select",value:l,options:[{label:"Bulb",value:"bulb"},{label:"Background",value:"background"}]}}}),[t,r,a,l]),{fallbackColor:E,fallbackLabel:C}=e,j=(0,o.useMemo)(()=>({label:"Rules (first matching rule wins)",actions:[{type:"action",id:"add-rule",label:"Add rule",icon:"Add"}],children:Object.fromEntries(i.map((w,P)=>[P.toString(),z(w,P,i)]).concat([["default",{label:"Otherwise",fields:{fallbackColor:{label:"Color",input:"rgb",value:E,help:"Color to use when no other rules match"},fallbackLabel:{label:"Label",input:"string",value:C,help:"Label to use when no other rules match"}},actions:[{type:"action",id:"add-rule-above",label:"Add rule above",icon:"Add"}]}]]))}),[E,C,i]);return(0,u.O4)({general:s,rules:j})}const J={path:"",style:"bulb",fallbackColor:"#a0a0a0",fallbackLabel:"False",rules:[{operator:"=",rawValue:"true",color:"#68e24a",label:"True"}]},K=(0,M.D2)("div",{root:{width:40,height:40,borderRadius:"50%",position:"relative",backgroundImage:["radial-gradient(transparent, transparent 55%, rgba(255,255,255,0.4) 80%, rgba(255,255,255,0.4))","radial-gradient(circle at 38% 35%, rgba(255,255,255,0.8), transparent 30%, transparent)","radial-gradient(circle at 46% 44%, transparent, transparent 61%, rgba(0,0,0,0.7) 74%, rgba(0,0,0,0.7))"].join(",")}});function Q(e){if(e.length<=1)return e[0];throw new Error("Message path produced multiple results")}function W(e,a){try{switch(a.type){case"frame":{if(e.pathParseError!=null)return{...e,latestMessage:(0,v.last)(a.messages),error:void 0};let t=e.latestMatchingQueriedData,r=e.latestMessage;if(e.parsedPath)for(const l of a.messages){if(l.topic!==e.parsedPath.topicName)continue;const i=Q((0,O.T)(l,e.parsedPath));i!=null&&(t=i,r=l)}return{...e,latestMessage:r,latestMatchingQueriedData:t,error:void 0}}case"path":{const t=(0,k.ZP)(a.path);let r;t?.messagePath.some(s=>s.type==="filter"&&typeof s.value=="object"||s.type==="slice"&&(typeof s.start=="object"||typeof s.end=="object"))===!0&&(r="Message paths using variables are not currently supported");let l,i;try{l=t&&r==null&&e.latestMessage?Q((0,O.T)(e.latestMessage,t)):void 0}catch(s){i=s}return{...e,path:a.path,parsedPath:t,latestMatchingQueriedData:l,error:i,pathParseError:r}}case"seek":return{...e,latestMessage:void 0,latestMatchingQueriedData:void 0,error:void 0}}}catch(t){return{...e,latestMatchingQueriedData:void 0,error:t}}}function Y({context:e}){const[a,t]=(0,o.useState)(()=>()=>{}),{palette:{augmentColor:r}}=(0,f.Z)(),[l,i]=(0,o.useState)(()=>({...J,...e.initialState})),[s,E]=(0,o.useReducer)(W,l,({path:b})=>({path:b,parsedPath:(0,k.ZP)(b),latestMessage:void 0,latestMatchingQueriedData:void 0,pathParseError:void 0,error:void 0}));(0,o.useLayoutEffect)(()=>{E({type:"path",path:l.path})},[l.path]),(0,o.useEffect)(()=>{e.saveState(l),e.setDefaultPanelTitle(l.path===""?void 0:l.path)},[l,e]),(0,o.useEffect)(()=>(e.onRender=(b,R)=>{t(()=>R),b.didSeek===!0&&E({type:"seek"}),b.currentFrame&&E({type:"frame",messages:b.currentFrame})},e.watch("currentFrame"),e.watch("didSeek"),()=>{e.onRender=void 0}),[e]);const C=(0,o.useCallback)(b=>i(R=>$(R,b)),[i]),j=H(l,s.pathParseError,s.error?.message);(0,o.useEffect)(()=>{e.updatePanelSettingsEditor({actionHandler:C,nodes:j})},[e,C,j]),(0,o.useEffect)(()=>(s.parsedPath?.topicName!=null&&e.subscribe([s.parsedPath.topicName]),()=>e.unsubscribeAll()),[e,s.parsedPath?.topicName]),(0,o.useEffect)(()=>{a()},[a]);const w=typeof s.latestMatchingQueriedData=="boolean"||typeof s.latestMatchingQueriedData=="bigint"||typeof s.latestMatchingQueriedData=="string"||typeof s.latestMatchingQueriedData=="number"?s.latestMatchingQueriedData:void 0,{style:P,rules:N,fallbackColor:A,fallbackLabel:_}=l,D=(0,o.useMemo)(()=>V(w,N),[w,N]);return(0,d.jsx)(T.Z,{fullHeight:!0,children:(0,d.jsx)(T.Z,{flexGrow:1,justifyContent:"space-around",alignItems:"center",overflow:"hidden",padding:1,style:{backgroundColor:P==="background"?D?.color??A:void 0},children:(0,d.jsxs)(T.Z,{direction:"row",alignItems:"center",gap:2,children:[P==="bulb"&&(0,d.jsx)(K,{style:{backgroundColor:D?.color??A}}),(0,d.jsx)(I.Z,{color:P==="background"?r({color:{main:D?.color??A}}).contrastText:D?.color??A,fontFamily:Z.R.MONOSPACE,variant:"h1",whiteSpace:"pre",children:D?.label??_})]})})})}function X(e,a){return c.render((0,d.jsx)(o.StrictMode,{children:(0,d.jsx)(g.o,{onError:e,children:(0,d.jsx)(y.Z,{isDark:!0,children:(0,d.jsx)(Y,{context:a})})})}),a.panelElement),()=>{c.unmountComponentAtNode(a.panelElement)}}function L(e){const a=(0,u.iY)(),t=(0,o.useMemo)(()=>X.bind(void 0,a),[a]);return(0,d.jsx)(p._,{config:e.config,saveConfig:e.saveConfig,initPanel:t})}L.panelType="Indicator",L.defaultConfig={};const q=(0,m.Z)(L)}}]);

//# sourceMappingURL=5807.964e7c654f04382a9bd1.js.map