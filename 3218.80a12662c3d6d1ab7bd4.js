"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3218],{3218:(v,y,n)=>{n.r(y),n.d(y,{Root:()=>F});var g=n(52322),u=n(2784),o=n(14549),h=n(56348),m=n(23503),w="../../packages/studio-web/src/services/IdbLayoutStorage.ts";const l=m.ZP.getLogger(w),L="foxglove-layouts",i="layouts";class p{constructor(){this._db=h.X3(L,1,{upgrade(e){e.createObjectStore(i,{keyPath:["namespace","layout.id"]}).createIndex("namespace","namespace")}})}async list(e){const a=[],t=await(await this._db).getAllFromIndex(i,"namespace",e);for(const s of t)try{a.push((0,o.migrateLayout)(s.layout))}catch(r){l.error(r)}return a}async get(e,a){const t=await(await this._db).get(i,[e,a]);return t==null?void 0:(0,o.migrateLayout)(t.layout)}async put(e,a){return await(await this._db).put(i,{namespace:e,layout:a}),a}async delete(e,a){await(await this._db).delete(i,[e,a])}async importLayouts({fromNamespace:e,toNamespace:a}){const t=(await this._db).transaction("layouts","readwrite"),s=t.objectStore("layouts");try{for await(const r of s.index("namespace").iterate(e))await s.put({namespace:a,layout:r.value.layout}),await r.delete();await t.done}catch(r){l.error(r)}}async migrateUnnamespacedLayouts(e){await this._migrateFromLocalStorage()}async _migrateFromLocalStorage(){const e="studio.layouts",a=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s?.startsWith(`${e}.`)===!0&&a.push(s)}for(const t of a){const s=localStorage.getItem(t);if(s!=null)try{const r=(0,o.migrateLayout)(JSON.parse(s)),[x,b,S,f]=t.split(".");if(S==null||f==null||f!==r.id){l.error(`Failed to migrate ${t} from localStorage`);continue}await(await this._db).put("layouts",{namespace:S,layout:r}),localStorage.removeItem(t)}catch(r){l.error(r)}}}}class c{constructor({defaults:e}){this.changeListeners=new Map,this.defaults=e}get(e){const a=localStorage.getItem(c.KEY_PREFIX+e);try{return a==null?this.defaults?.[e]:JSON.parse(a)}catch{return}}async set(e,a){a==null?localStorage.removeItem(c.KEY_PREFIX+e):localStorage.setItem(c.KEY_PREFIX+e,JSON.stringify(a)??"");const t=this.changeListeners.get(e);t&&[...t].forEach(s=>s(a))}addChangeListener(e,a){let t=this.changeListeners.get(e);t||(t=new Set,this.changeListeners.set(e,t)),t.add(a)}removeChangeListener(e,a){const t=this.changeListeners.get(e);t&&t.delete(a)}}c.KEY_PREFIX="studio.app-configuration.";const E=!1;function F(d){const e=(0,u.useMemo)(()=>new c({defaults:{[o.AppSetting.SHOW_DEBUG_PANELS]:E}}),[]),a=(0,u.useMemo)(()=>new p,[]),[t]=(0,u.useState)(()=>[new o.IdbExtensionLoader("org"),new o.IdbExtensionLoader("local")]),s=(0,u.useMemo)(()=>{const r=[new o.Ros1LocalBagDataSourceFactory,new o.Ros2LocalBagDataSourceFactory,new o.FoxgloveWebSocketDataSourceFactory,new o.RosbridgeDataSourceFactory,new o.UlogLocalDataSourceFactory,new o.SampleNuscenesDataSourceFactory,new o.McapLocalDataSourceFactory,new o.RemoteDataSourceFactory];return d.dataSources??r},[d.dataSources]);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(o.App,{enableLaunchPreferenceScreen:!0,deepLinks:[window.location.href],dataSources:s,appConfiguration:e,layoutStorage:a,extensionLoaders:t,enableGlobalCss:!0,extraProviders:d.extraProviders})})}}}]);

//# sourceMappingURL=3218.80a12662c3d6d1ab7bd4.js.map